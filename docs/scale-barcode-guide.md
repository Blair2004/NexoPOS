# Scale Barcode Support - User Guide

## Overview

NexoPOS now supports scale barcodes - special barcodes generated by weighing scales that encode both product identification and weight/price information in a single barcode. This feature enables seamless integration with electronic scales commonly used in grocery stores, delis, and markets.

## What are Scale Barcodes?

Scale barcodes are specially formatted barcodes that contain:
- **Product identifier** - A code that identifies which product is being weighed
- **Variable data** - Weight (in grams) or price (in cents)
- **Check digit** - For barcode validation

### Common Format (EAN-13)

The most common format is EAN-13 with this structure:

```
2 XXXXX WWWWW C
│   │     │    │
│   │     │    └─ Check digit
│   │     └────── Weight/Price (5 digits)
│   └──────────── Product code (5 digits)
└──────────────── Scale prefix (typically "2")
```

**Example Barcode: `2123450012349`**
- Prefix: `2` (indicates scale barcode)
- Product Code: `12345`
- Weight/Price: `00123` (0.123 kg or $1.23)
- Check Digit: `9`

## Configuration

### Accessing Settings

1. Navigate to **Dashboard → Settings → POS → Scale Barcode**
2. Configure the following options:

### Configuration Options

#### 1. Enable Scale Barcode
- **Options:** Yes / No
- **Default:** No
- **Description:** Turn scale barcode support on or off

#### 2. Barcode Prefix
- **Default:** `2`
- **Description:** The leading digit(s) that identify a barcode as a scale barcode
- **Common values:** 
  - `2` - Standard for most scales
  - `21` to `29` - Extended prefix options

#### 3. Barcode Type
- **Options:** Weight / Price
- **Default:** Weight
- **Description:** 
  - **Weight:** Barcode contains weight in grams (converted to kg)
  - **Price:** Barcode contains price in cents (converted to currency)

#### 4. Product Code Length
- **Default:** 5 digits
- **Range:** 1-10 digits
- **Description:** Number of digits used for the product identifier

#### 5. Weight/Price Value Length
- **Default:** 5 digits
- **Range:** 1-10 digits
- **Description:** Number of digits used for weight or price data

### Configuration Examples

#### Example 1: Standard Weight-Based Scale
```
Prefix: 2
Type: Weight
Product Length: 5
Value Length: 5
Result: 13-digit barcode (2 + 5 + 5 + 1 check digit)
```

**Sample Barcode:** `2123450012349`
- Product: `12345`
- Weight: `123` grams = `0.123` kg

#### Example 2: Price-Based Scale
```
Prefix: 2
Type: Price
Product Length: 5
Value Length: 5
Result: 13-digit barcode
```

**Sample Barcode:** `2123450123449`
- Product: `12345`
- Price: `1234` cents = `$12.34`

## Using Scale Barcodes at POS

### Setup Products for Scale Barcodes

1. **Create/Edit Product**
   - Set the product barcode to match the product code used by your scale
   - Example: If scale uses code `12345`, set product barcode to `12345`
   - The scale will generate full barcodes like `2123450012349`

2. **Configure Scale**
   - Program your scale to use the correct prefix (default: `2`)
   - Set the scale to generate EAN-13 format barcodes
   - Assign product codes to match your NexoPOS products

### Scanning Process

1. **Weigh Item on Scale**
   - Place item on electronic scale
   - Scale prints barcode with embedded weight/price

2. **Scan Barcode at POS**
   - Scan the printed barcode using barcode scanner
   - NexoPOS automatically detects it's a scale barcode
   - Product is added to cart with correct quantity/price

3. **Automatic Processing**
   - **For Weight Type:**
     - Product quantity is set to the scanned weight
     - Example: 0.123 kg displayed as quantity
   
   - **For Price Type:**
     - Quantity calculated: Price ÷ Unit Price
     - Useful for pre-priced items

### Visual Feedback

When a scale barcode is scanned, you'll see a notification:
- **Weight:** "Scale barcode detected: 0.123 kg"
- **Price:** "Scale barcode detected: $12.34"

## Troubleshooting

### Barcode Not Recognized

**Problem:** Scale barcode is not detected as scale barcode

**Solutions:**
1. Verify scale barcode support is enabled in settings
2. Check if barcode starts with correct prefix
3. Ensure barcode is 13 digits (or configured length)
4. Verify product exists with matching product code

### Wrong Quantity/Price

**Problem:** Incorrect quantity or price when scanning

**Solutions:**
1. Check barcode type setting (Weight vs Price)
2. Verify scale is configured for same format
3. Ensure scale uses grams for weight (not kg directly)
4. For price type, ensure cents are used (not dollars)

### Product Not Found

**Problem:** "Product not found" error when scanning

**Solutions:**
1. Check product exists with barcode matching product code
2. Verify product code length matches scale configuration
3. Example: Scale uses 5-digit codes, ensure NexoPOS product barcode is 5 digits
4. Product must be marked as "Available" status

## Best Practices

### 1. Product Code Management
- Use consistent product codes across scale and NexoPOS
- Keep product codes to 5 digits for standard compatibility
- Document your product code scheme

### 2. Scale Configuration
- Configure all scales with identical settings
- Test each scale after configuration
- Keep backup of scale programming

### 3. Training Staff
- Train staff on scale barcode process
- Explain difference between regular and scale barcodes
- Practice with test items

### 4. Inventory Management
- Products with scale barcodes should use appropriate units (kg, lb)
- Enable stock tracking for weight-based items
- Set appropriate low stock thresholds

## Technical Details

### Barcode Format Specifications

**Standard EAN-13 Scale Barcode:**
- Total Length: 13 digits
- Components:
  1. Prefix: 1-2 digits (configurable)
  2. Product Code: 3-6 digits (configurable)
  3. Variable Data: 4-6 digits (configurable)
  4. Check Digit: 1 digit (calculated)

### Supported Scales

This implementation supports scales that generate:
- EAN-13 format barcodes
- Embedded weight in grams
- Embedded price in cents
- Standard check digit calculation

**Compatible Scale Types:**
- Toledo scales
- Mettler Toledo scales
- Bizerba scales
- CAS scales
- Any scale supporting EAN-13 with embedded data

### Data Conversion

**Weight Conversion:**
- Scale value in grams → NexoPOS quantity in kg
- Example: 1234 grams → 1.234 kg

**Price Conversion:**
- Scale value in cents → NexoPOS currency
- Example: 1234 cents → $12.34

## API Integration

### Response Format

When a scale barcode is detected, the API response includes:

```json
{
  "type": "product",
  "product": {
    "id": 123,
    "name": "Product Name",
    "barcode": "12345",
    "scale_barcode_data": {
      "product_code": "12345",
      "value": 0.123,
      "type": "weight",
      "original_barcode": "2123450012349"
    },
    // ... other product data
  }
}
```

### Custom Integration

Developers can hook into scale barcode processing:

```php
// Filter scale barcode before processing
add_filter('ns-scale-barcode-parse', function($data, $barcode) {
    // Custom processing
    return $data;
}, 10, 2);
```

## Frequently Asked Questions

### Q: Can I use multiple prefixes?
**A:** Currently only one prefix is supported. Choose the most common prefix for your scales.

### Q: What if my scale uses a different format?
**A:** The current implementation supports standard EAN-13 format. Custom formats may require code modifications.

### Q: Can I mix weight and price scales?
**A:** The system uses a single global setting. All scales should use the same type (weight or price).

### Q: How accurate is the weight measurement?
**A:** Accuracy depends on scale precision. The system preserves 3 decimal places (grams to kg conversion).

### Q: Can I print scale barcodes from NexoPOS?
**A:** Barcode generation is available via ScaleBarcodeService for testing, but scales typically generate their own barcodes.

## Support

For technical support or feature requests:
- Check NexoPOS documentation
- Visit NexoPOS community forums
- Contact your scale manufacturer for scale-specific issues

## Version History

- **v6.x** - Initial scale barcode support implementation
  - Weight-based scale barcodes
  - Price-based scale barcodes
  - Configurable barcode format
  - POS integration
  - Automatic quantity/price detection
