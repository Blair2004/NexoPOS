"use strict";(self.webpackChunknexopos_4x=self.webpackChunknexopos_4x||[]).push([[979,89,4],{9763:(e,t,s)=>{function r(e){POS.changeVisibleSection(e)}s.d(t,{Z:()=>r})},1703:(e,t,s)=>{function r(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}s.d(t,{Z:()=>n});var n=function(){function e(t){var s=t.settings,r=t.options,n=t.type;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.printingURL={refund:"refund_printing_url",sale:"sale_printing_url",payment:"payment_printing_url"},this.settings=s,this.options=r,this.type=n||"refund"}var t,s,n;return t=e,(s=[{key:"processRegularPrinting",value:function(e){var t=document.querySelector("printing-section");t&&t.remove();var s=this.settings[this.printingURL[this.type]].replace("{reference_id}",e),r=document.createElement("iframe");r.id="printing-section",r.className="hidden",r.src=s,document.body.appendChild(r),setTimeout((function(){document.querySelector("#printing-section").remove()}),5e3)}},{key:"printOrder",value:function(e){"default"===this.options.ns_pos_printing_gateway?this.processRegularPrinting(e):this.processCustomPrinting(e,this.options.ns_pos_printing_gateway)}},{key:"processCustomPrinting",value:function(e,t){nsHooks.applyFilters("ns-order-custom-refund-print",{printed:!1,reference_id:e,gateway:t}).printed||nsSnackBar.error(__("Unsupported print gateway.")).subscribe()}}])&&r(t.prototype,s),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},279:(e,t,s)=>{s.d(t,{$:()=>c});var r=s(9671),n=s(7389),i=s(2242),o=s(4492);function a(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.product=t}var t,s,c;return t=e,(s=[{key:"run",value:function(e){var t=this;return new Promise((function(s,a){var c=new i.G({popupClass:"shadow-lg h-1/2-screen w-3/4 md:w-1/2 lg:w-2/5 xl:w-1/4 bg-white"}),l=t.product;if(!1===POS.options.getValue().ns_pos_show_quantity&&POS.processingAddQueue){if("enabled"===l.$original().stock_management&&"materialized"===l.$original().type){var u=POS.getStockUsage(l.$original().id,e.unit_quantity_id)-(l.quantity||0);if(1>parseFloat(e.$quantities().quantity)-u)return r.kX.error((0,n.__)("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",(e.$quantities().quantity-u).toString())).subscribe()}s({quantity:1})}else c.open(o.Z,{resolve:s,reject:a,product:l,data:e})}))}}])&&a(t.prototype,s),c&&a(t,c),Object.defineProperty(t,"prototype",{writable:!1}),e}()},3220:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(7389);const n={name:"ns-numpad-plus",props:["value","currency","limit"],data:function(){return{screenValue:0,order:null,cursor:parseInt(ns.currency.ns_currency_precision),orderSubscription:null,allSelected:!0,keyRows:[[7,8,9].map((function(e){return{identifier:e,value:e}})),[4,5,6].map((function(e){return{identifier:e,value:e}})),[1,2,3].map((function(e){return{identifier:e,value:e}})),[{identifier:".",value:"."},{identifier:0,value:0},{identifier:"backspace",icon:"la-backspace"}],[{identifier:"next",value:(0,r.__)("Enter")}]]}},mounted:function(){var e=this;this.screenValue=this.value||0;var t=new Array(10).fill("").map((function(e,t){return t}));nsHotPress.create("numpad-keys").whenVisible([".is-popup"]).whenPressed(t,(function(t,s){e.inputValue({value:s})})),nsHotPress.create("numpad-backspace").whenVisible([".is-popup"]).whenPressed("backspace",(function(){return e.inputValue({identifier:"backspace"})})),nsHotPress.create("numpad-increase").whenVisible([".is-popup"]).whenPressed("+",(function(){return e.increaseBy({value:1})})),nsHotPress.create("numpad-dot").whenVisible([".is-popup"]).whenPressed(".",(function(){return e.inputValue({identifier:"."})})),nsHotPress.create("numpad-reduce").whenVisible([".is-popup"]).whenPressed("-",(function(){return e.increaseBy({value:-1})})),nsHotPress.create("numpad-save").whenVisible([".is-popup"]).whenPressed("enter",(function(){return e.inputValue({identifier:"next"})}))},watch:{value:function(){this.value.toString().length>0?this.screenValue=this.value:this.screenValue=""}},beforeDestroy:function(){nsHotPress.destroy("numpad-backspace"),nsHotPress.destroy("numpad-increase"),nsHotPress.destroy("numpad-reduce"),nsHotPress.destroy("numpad-save"),nsHotPress.destroy("numpad-dot")},methods:{increaseBy:function(e){this.screenValue=(parseFloat(e.value)+(parseFloat(this.screenValue)||0)).toString(),this.allSelected=!1},inputValue:function(e){if("next"!==e.identifier){if("backspace"===e.identifier)this.allSelected?(this.screenValue="0",this.allSelected=!1):this.screenValue=this.screenValue.toString().substr(0,this.screenValue.length-1);else if("."===e.identifier)this.allSelected?(this.screenValue="0.",this.allSelected=!1):null===this.screenValue.toString().match(/^[0-9][1-9]*\.[0-9]*$/)&&(this.screenValue=this.screenValue+=".");else if(e.value.toString().match(/^\d+$/)){if(this.limit>0&&this.screenValue.length>=this.limit)return;this.allSelected?(this.screenValue=e.value.toString(),this.allSelected=!1):(this.screenValue+=""+e.value.toString(),"percentage"===this.mode&&(this.screenValue=this.screenValue>100?100:this.screenValue))}this.$emit("changed",this.screenValue)}else this.$emit("next",this.screenValue)}}};const i=(0,s(1900).Z)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"numpad-holder"}},e._l(e.keyRows,(function(t,r){return s("div",{key:r},[s("div",{staticClass:"grid grid-flow-row grid-cols-3 grid-rows-1 text-lg",attrs:{id:"numpad"}},[e._l(t,(function(r,n){return s("div",{key:n,staticClass:"select-none ns-numpad-key border-l border-b h-24 font-bold flex items-center justify-center cursor-pointer",class:1===t.length?"col-span-3":"",on:{click:function(t){return e.inputValue(r)}}},[void 0!==r.value?s("span",[e._v(e._s(r.value))]):e._e(),e._v(" "),r.icon?s("i",{staticClass:"las",class:r.icon}):e._e()])})),e._v(" "),e._t("numpad-footer")],2)])})),0)}),[],!1,null,null,null).exports},4979:(e,t,s)=>{s.r(t),s.d(t,{default:()=>xe});var r=s(7757),n=s.n(r),i=s(2242),o=s(6386),a=s(7389);function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}const u={name:"ns-pos-discount-popup",data:function(){return{finalValue:1,virtualStock:null,popupSubscription:null,mode:"",type:"",allSelected:!0,isLoading:!1,keys:[].concat(c([7,8,9].map((function(e){return{identifier:e,value:e}}))),c([4,5,6].map((function(e){return{identifier:e,value:e}}))),c([1,2,3].map((function(e){return{identifier:e,value:e}}))),[{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}])}},mounted:function(){var e=this;this.mode=this.$popupParams.reference.discount_type||"percentage",this.type=this.$popupParams.type,"percentage"===this.mode?this.finalValue=this.$popupParams.reference.discount_percentage||1:this.finalValue=this.$popupParams.reference.discount||1,this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.$popup.close()}))},methods:{__:a.__,setPercentageType:function(e){this.mode=e},closePopup:function(){this.$popup.close()},inputValue:function(e){"next"===e.identifier?(this.$popupParams.onSubmit({discount_type:this.mode,discount_percentage:"percentage"===this.mode?this.finalValue:void 0,discount:"flat"===this.mode?this.finalValue:void 0}),this.$popup.close()):"backspace"===e.identifier?this.allSelected?(this.finalValue=0,this.allSelected=!1):(this.finalValue=this.finalValue.toString(),this.finalValue=this.finalValue.substr(0,this.finalValue.length-1)||0):this.allSelected?(this.finalValue=e.value,this.finalValue=parseFloat(this.finalValue),this.allSelected=!1):(this.finalValue+=""+e.value,this.finalValue=parseFloat(this.finalValue),"percentage"===this.mode&&(this.finalValue=this.finalValue>100?100:this.finalValue))}}};var d=s(1900);const p=(0,d.Z)(u,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow min-h-2/5-screen w-6/7-screen md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen relative",attrs:{id:"discount-popup"}},[s("div",{staticClass:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},[s("div",["product"===e.type?s("h1",{staticClass:"text-xl font-bold text-primary text-center"},[e._v(e._s(e.__("Product Discount")))]):e._e(),e._v(" "),"cart"===e.type?s("h1",{staticClass:"text-xl font-bold text-primary text-center"},[e._v(e._s(e.__("Cart Discount")))]):e._e()]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"h-16 ns-box-body text-white flex items-center justify-center",attrs:{id:"screen"}},[s("h1",{staticClass:"font-bold text-3xl"},["flat"===e.mode?s("span",[e._v(e._s(e._f("currency")(e.finalValue)))]):e._e(),e._v(" "),"percentage"===e.mode?s("span",[e._v(e._s(e.finalValue)+"%")]):e._e()])]),e._v(" "),s("div",{staticClass:"flex",attrs:{id:"switch-mode"}},[s("button",{staticClass:"outline-none w-1/2 py-2 flex items-center justify-center",class:"flat"===e.mode?"bg-tab-active":"bg-tab-inactive text-tertiary",on:{click:function(t){return e.setPercentageType("flat")}}},[e._v(e._s(e.__("Flat")))]),e._v(" "),s("hr",{staticClass:"border-r border-box-edge"}),e._v(" "),s("button",{staticClass:"outline-none w-1/2 py-2 flex items-center justify-center",class:"percentage"===e.mode?"bg-tab-active":"bg-tab-inactive text-tertiary",on:{click:function(t){return e.setPercentageType("percentage")}}},[e._v(e._s(e.__("Percentage")))])]),e._v(" "),s("div",{staticClass:"grid grid-flow-row grid-cols-3 grid-rows-3",attrs:{id:"numpad"}},e._l(e.keys,(function(t,r){return s("div",{key:r,staticClass:"text-primary ns-numpad-key info text-xl font-bold border h-24 flex items-center justify-center cursor-pointer",on:{click:function(s){return e.inputValue(t)}}},[void 0!==t.value?s("span",[e._v(e._s(t.value))]):e._e(),e._v(" "),t.icon?s("i",{staticClass:"las",class:t.icon}):e._e()])})),0)])}),[],!1,null,null,null).exports;var _=s(3601),f=s(9671);function v(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}const b={name:"sample-payment",props:["label","identifier"],data:function(){return{backValue:"0",number:parseInt(1+new Array(parseInt(ns.currency.ns_currency_precision)).fill("").map((function(e){return 0})).join("")),order:null,settings:{},settingsSubscription:null,cursor:parseInt(ns.currency.ns_currency_precision),orderSubscription:null,allSelected:!0,keys:[].concat(v([7,8,9].map((function(e){return{identifier:e,value:e}}))),v([4,5,6].map((function(e){return{identifier:e,value:e}}))),v([1,2,3].map((function(e){return{identifier:e,value:e}}))),[{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}])}},computed:{amountShortcuts:function(){return null!==nsShortcuts.ns_pos_amount_shortcut?nsShortcuts.ns_pos_amount_shortcut.split("|"):[]}},mounted:function(){var e=this;this.orderSubscription=POS.order.subscribe((function(t){e.order=t})),this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t}));var t=new Array(10).fill("").map((function(e,t){return t}));nsHotPress.create("numpad-keys").whenVisible([".is-popup"]).whenPressed(t,(function(t,s){e.inputValue({value:s})})),nsHotPress.create("numpad-backspace").whenVisible([".is-popup"]).whenPressed("backspace",(function(){return e.inputValue({identifier:"backspace"})})),nsHotPress.create("numpad-save").whenVisible([".is-popup"]).whenPressed("enter",(function(){""===e.backValue?(e.$emit("submit"),e.backValue=0):e.inputValue({identifier:"next"})}))},beforeDestroy:function(){nsHotPress.destroy("numpad-keys"),nsHotPress.destroy("numpad-backspace"),nsHotPress.destroy("numpad-save")},destroyed:function(){this.orderSubscription.unsubscribe()},methods:{__:a.__,toggleDiscount:function(){var e=this;if(void 0===this.settings.cart_discount||!0!==this.settings.cart_discount)return f.kX.error((0,a.__)("You're not allowed to add a discount on the cart.")).subscribe();i.G.show(p,{reference:this.order,type:"cart",onSubmit:function(t){POS.updateCart(e.order,t)}})},makeFullPayment:function(){var e=this;i.G.show(_.default,{title:(0,a.__)("Confirm Full Payment"),message:(0,a.__)("A full payment will be made using {paymentType} for {total}").replace("{paymentType}",this.label).replace("{total}",this.$options.filters.currency(this.order.total)),onAction:function(t){if(t){var s=POS.order.getValue();s.tendered<s.total&&POS.addPayment({value:e.order.total-s.tendered,identifier:e.identifier,selected:!1,label:e.label,readonly:!1}),e.$emit("submit"),e.backValue="0"}}})},increaseBy:function(e){var t=parseInt(1+new Array(this.cursor).fill("").map((function(e){return 0})).join(""));this.backValue=(parseFloat(e.value)*t+(parseFloat(this.backValue)||0)).toString(),this.allSelected=!1},inputValue:function(e){"next"===e.identifier?(POS.addPayment({value:parseFloat(this.backValue/this.number),identifier:this.identifier,selected:!1,label:this.label,readonly:!1}),this.backValue="0"):"backspace"===e.identifier?this.allSelected?(this.backValue="0",this.allSelected=!1):this.backValue=this.backValue.substr(1):e.value.toString().match(/^\d+$/)&&(this.allSelected?(this.backValue=e.value.toString(),this.allSelected=!1):(this.backValue+=e.value.toString(),"percentage"===this.mode&&(this.backValue=this.backValue>100?100:this.backValue))),"0"===this.backValue&&(this.backValue="")}}};const h=(0,d.Z)(b,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-full w-full py-2"},[e.order?s("div",{staticClass:"px-2 pb-2"},[s("div",{staticClass:"grid grid-cols-2 gap-2"},[s("div",{staticClass:"h-16 flex justify-between items-center border elevation-surface info text-xl md:text-3xl p-2",attrs:{id:"details"}},[s("span",[e._v(e._s(e.__("Total"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.total)))])]),e._v(" "),s("div",{staticClass:"cursor-pointer h-16 flex justify-between items-center border elevation-surface error text-xl md:text-3xl p-2",attrs:{id:"discount"},on:{click:function(t){return e.toggleDiscount()}}},[s("span",[e._v(e._s(e.__("Discount"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.discount)))])]),e._v(" "),s("div",{staticClass:"h-16 flex justify-between items-center border elevation-surface success text-xl md:text-3xl p-2",attrs:{id:"paid"}},[s("span",[e._v(e._s(e.__("Paid"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.tendered)))])]),e._v(" "),s("div",{staticClass:"h-16 flex justify-between items-center border elevation-surface warning text-xl md:text-3xl p-2",attrs:{id:"change"}},[s("span",[e._v(e._s(e.__("Change"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.change)))])]),e._v(" "),s("div",{staticClass:"col-span-2 h-16 flex justify-between items-center elevation-surface border text-xl md:text-3xl p-2",attrs:{id:"change"}},[s("span",[e._v(e._s(e.__("Screen"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.backValue/e.number)))])])])]):e._e(),e._v(" "),s("div",{staticClass:"px-2 pb-2"},[s("div",{staticClass:"-mx-2 flex flex-wrap"},[s("div",{staticClass:"pl-2 pr-1 flex-auto"},[s("div",{staticClass:"grid grid-flow-row grid-cols-3 gap-2 grid-rows-3",staticStyle:{padding:"1px"},attrs:{id:"numpad"}},[e._l(e.keys,(function(t,r){return s("div",{key:r,staticClass:"ns-numpad-key text-2xl border h-16 flex items-center justify-center cursor-pointer",staticStyle:{margin:"-1px"},on:{click:function(s){return e.inputValue(t)}}},[void 0!==t.value?s("span",[e._v(e._s(t.value))]):e._e(),e._v(" "),t.icon?s("i",{staticClass:"las",class:t.icon}):e._e()])})),e._v(" "),s("div",{staticClass:"hover:bg-green-500 col-span-3 bg-success-secondary border-success-tertiary text-2xl text-white border h-16 flex items-center justify-center cursor-pointer",on:{click:function(t){return e.makeFullPayment()}}},[e._v("\n                        "+e._s(e.__("Full Payment")))])],2)]),e._v(" "),s("div",{staticClass:"w-1/2 md:w-72 pr-2 pl-1"},[s("div",{staticClass:"grid grid-flow-row grid-rows-1 gap-2"},e._l(e.amountShortcuts,(function(t,r){return s("div",{key:r,staticClass:"ns-numpad-key text-2xl border h-16 flex items-center justify-center cursor-pointer",on:{click:function(s){return e.increaseBy({value:t})}}},[s("span",[e._v(e._s(e._f("currency")(t)))])])})),0)])])])])}),[],!1,null,null,null).exports,y={name:"cash-payment",props:["identifier","label"],components:{samplePayment:h}};const x=(0,d.Z)(y,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("sample-payment",{attrs:{identifier:e.identifier,label:e.label},on:{submit:function(t){return e.$emit("submit")}}})}),[],!1,null,null,null).exports;const w={name:"creditcart-payment",props:["identifier"]};const C=(0,d.Z)(w,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("h1",[e._v("Credit Card")])}),[],!1,null,null,null).exports;const g={name:"bank-payment",props:["identifier","label"],components:{samplePayment:h}};const P=(0,d.Z)(g,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("sample-payment",{attrs:{identifier:e.identifier,label:e.label},on:{submit:function(t){return e.$emit("submit")}}})}),[],!1,null,null,null).exports;var k=s(4864);const S={name:"ns-account-payment",components:{nsNumpad:k.Z},props:["identifier","label"],data:function(){return{subscription:null,screenValue:0,order:null}},methods:{__:a.__,handleChange:function(e){this.screenValue=e},proceedAddingPayment:function(e){var t=parseFloat(e),s=this.order.payments;return t<=0?f.kX.error((0,a.__)("Please provide a valid payment amount.")).subscribe():s.filter((function(e){return"account-payment"===e.identifier})).length>0?f.kX.error((0,a.__)("The customer account can only be used once per order. Consider deleting the previously used payment.")).subscribe():t>this.order.customer.account_amount?f.kX.error((0,a.__)("Not enough funds to add {amount} as a payment. Available balance {balance}.").replace("{amount}",this.$options.filters.currency(t)).replace("{balance}",this.$options.filters.currency(this.order.customer.account_amount))).subscribe():(POS.addPayment({value:t,identifier:"account-payment",selected:!1,label:this.label,readonly:!1}),this.order.customer.account_amount-=t,POS.selectCustomer(this.order.customer),void this.$emit("submit"))},proceedFullPayment:function(){this.proceedAddingPayment(this.order.total)},makeFullPayment:function(){var e=this;Popup.show(_.default,{title:(0,a.__)("Confirm Full Payment"),message:(0,a.__)("You're about to use {amount} from the customer account to make a payment. Would you like to proceed ?").replace("{amount}",this.$options.filters.currency(this.order.total)),onAction:function(t){t&&e.proceedFullPayment()}})}},mounted:function(){var e=this;this.subscription=POS.order.subscribe((function(t){return e.order=t}))},destroyed:function(){this.subscription.unsubscribe()}};const O=(0,d.Z)(S,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-full w-full py-2"},[e.order?s("div",{staticClass:"px-2 pb-2"},[s("div",{staticClass:"grid grid-cols-2 gap-2"},[s("div",{staticClass:"h-16 flex justify-between items-center elevation-surface border info text-xl md:text-3xl p-2",attrs:{id:"details"}},[s("span",[e._v(e._s(e.__("Total"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.total)))])]),e._v(" "),s("div",{staticClass:"cursor-pointer h-16 flex justify-between items-center elevation-surface error border text-xl md:text-3xl p-2",attrs:{id:"discount"},on:{click:function(t){return e.toggleDiscount()}}},[s("span",[e._v(e._s(e.__("Discount"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.discount)))])]),e._v(" "),s("div",{staticClass:"h-16 flex justify-between items-center elevation-surface success border text-xl md:text-3xl p-2",attrs:{id:"paid"}},[s("span",[e._v(e._s(e.__("Paid"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.tendered)))])]),e._v(" "),s("div",{staticClass:"h-16 flex justify-between items-center elevation-surface warning border text-xl md:text-3xl p-2",attrs:{id:"change"}},[s("span",[e._v(e._s(e.__("Change"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.change)))])]),e._v(" "),s("div",{staticClass:"col-span-2 h-16 flex justify-between items-center elevation-surface border success text-xl md:text-3xl p-2",attrs:{id:"change"}},[s("span",[e._v(e._s(e.__("Current Balance"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.customer.account_amount)))])]),e._v(" "),s("div",{staticClass:"col-span-2 h-16 flex justify-between items-center elevation-surface border text-primary text-xl md:text-3xl p-2",attrs:{id:"change"}},[s("span",[e._v(e._s(e.__("Screen"))+" : ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.screenValue)))])])])]):e._e(),e._v(" "),s("div",{staticClass:"px-2 pb-2"},[s("div",{staticClass:"-mx-2 flex flex-wrap"},[s("div",{staticClass:"pl-2 pr-1 flex-auto"},[s("ns-numpad",{attrs:{floating:!0},on:{changed:function(t){return e.handleChange(t)},next:function(t){return e.proceedAddingPayment(t)}},scopedSlots:e._u([{key:"numpad-footer",fn:function(){return[s("div",{staticClass:"hover:bg-success-tertiary col-span-3 bg-success-secondary text-2xl text-white border border-success-secondary h-16 flex items-center justify-center cursor-pointer",on:{click:function(t){return e.makeFullPayment()}}},[e._v("\n                        "+e._s(e.__("Full Payment")))])]},proxy:!0}])})],1),e._v(" "),s("div",{staticClass:"w-1/2 md:w-72 pr-2 pl-1"},[s("div",{staticClass:"grid grid-flow-row grid-rows-1 gap-2"},[s("div",{staticClass:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer",on:{click:function(t){return e.increaseBy({value:100})}}},[s("span",[e._v(e._s(e._f("currency")(100)))])]),e._v(" "),s("div",{staticClass:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer",on:{click:function(t){return e.increaseBy({value:500})}}},[s("span",[e._v(e._s(e._f("currency")(500)))])]),e._v(" "),s("div",{staticClass:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer",on:{click:function(t){return e.increaseBy({value:1e3})}}},[s("span",[e._v(e._s(e._f("currency")(1e3)))])])])])])])])}),[],!1,null,null,null).exports;var j=s(2004),$=s(3296);function T(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function V(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?T(Object(s),!0).forEach((function(t){A(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function A(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Z(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}const D={name:"ns-pos-payment",data:function(){return{paymentTypesSubscription:null,paymentsType:[],order:null,showPayment:!1,orderSubscription:null,currentPaymentComponent:null}},computed:{activePayment:function(){var e;return(e=this.paymentsType.filter((function(e){return e.selected}))).length>0&&e[0]},expectedPayment:function(){var e=this.order.customer.group.minimal_credit_payment;return this.order.total*e/100}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){if("click-overlay"===t.event)e.closePopup()})),this.order=this.$popupParams.order,this.paymentTypesSubscription=POS.paymentsType.subscribe((function(t){e.paymentsType=t,t.filter((function(e){e.selected&&POS.selectedPaymentType.next(e)}))})),nsHooks.doAction("ns-pos-payment-mounted",this)},watch:{activePayment:function(e){this.loadPaymentComponent(e)}},destroyed:function(){this.paymentTypesSubscription.unsubscribe(),nsHooks.doAction("ns-pos-payment-destroyed",this)},methods:{__:a.__,resolveIfQueued:o.Z,loadPaymentComponent:function(e){switch(e.identifier){case"cash-payment":this.currentPaymentComponent=x;break;case"creditcard-payment":this.currentPaymentComponent=C;break;case"bank-payment":this.currentPaymentComponent=P;break;case"account-payment":this.currentPaymentComponent=O;break;default:this.currentPaymentComponent=h}},selectPayment:function(){var e,t=this;return(e=n().mark((function e(){var s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,s){i.G.show($.Z,{label:(0,a.__)("Select Payment Gateway"),options:t.paymentsType.map((function(e){return{label:e.label,value:e.identifier}})),value:t.activePayment.identifier,resolve:e,reject:s})}));case 3:s=e.sent,t.select(t.paymentsType.filter((function(e){return e.identifier===s[0].value}))[0]),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){Z(i,r,n,o,a,"next",e)}function a(e){Z(i,r,n,o,a,"throw",e)}o(void 0)}))})()},select:function(e){this.showPayment=!1,POS.setPaymentActive(e)},closePopup:function(){this.$popup.close(),POS.selectedPaymentType.next(null)},deletePayment:function(e){POS.removePayment(e)},selectPaymentAsActive:function(e){this.select(this.paymentsType.filter((function(t){return t.identifier===e.target.value}))[0])},submitOrder:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=i.G.show(j.default);try{var r=V(V({},POS.order.getValue()),t);POS.submitOrder(r).then((function(t){s.close(),f.kX.success(t.message).subscribe(),POS.printOrderReceipt(t.data.order),e.$popup.close()}),(function(e){s.close(),f.kX.error(e.message).subscribe()}))}catch(e){s.close(),f.kX.error(error.message).subscribe()}}}};const F=(0,d.Z)(D,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.order?s("div",{staticClass:"w-screen h-screen p-4 flex overflow-hidden",attrs:{id:"ns-payment-popup"}},[s("div",{staticClass:"flex flex-col flex-auto lg:flex-row shadow-xl"},[s("div",{staticClass:"w-full lg:w-56 lg:h-full flex justify-between px-2 lg:px-0 lg:block items-center lg:items-start"},[s("h3",{staticClass:"lg:hidden text-xl text-center my-4 font-bold lg:my-8"},[e._v(e._s(e.__("Gateway"))+" "),s("span",[e._v(": "+e._s(e.activePayment.label))])]),e._v(" "),s("div",{staticClass:"h-16 hidden lg:block"}),e._v(" "),s("ul",{staticClass:"hidden lg:block"},[e._l(e.paymentsType,(function(t){return s("li",{key:t.identifier,staticClass:"cursor-pointer ns-payment-gateway py-2 px-3",class:t.selected&&!e.showPayment?"ns-visible":"",on:{click:function(s){return e.select(t)}}},[e._v(e._s(t.label))])})),e._v(" "),s("li",{staticClass:"cursor-pointer py-2 px-3 ns-payment-list border-t mt-4 flex items-center justify-between",class:e.showPayment?"ns-visible":"",on:{click:function(t){e.showPayment=!0}}},[s("span",[e._v(e._s(e.__("Payment List")))]),e._v(" "),s("span",{staticClass:"px-2 rounded-full h-8 w-8 flex items-center justify-center ns-label"},[e._v(e._s(e.order.payments.length))])])],2),e._v(" "),s("ns-close-button",{staticClass:"lg:hidden",on:{click:function(t){return e.closePopup()}}})],1),e._v(" "),s("div",{staticClass:"overflow-hidden flex flex-col flex-auto"},[s("div",{staticClass:"flex flex-col flex-auto overflow-hidden"},[s("div",{staticClass:"h-12 hidden items-center justify-between lg:flex"},[s("div",[s("h3",{staticClass:"text-xl hidden lg:block text-center my-4 font-bold lg:my-8"},[e._v(e._s(e.__("Gateway"))+" "),s("span",{staticClass:"hidden-md"},[e._v(": "+e._s(e.activePayment.label))])])]),e._v(" "),s("div",{staticClass:"px-2"},[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),e.showPayment?e._e():s("div",{staticClass:"flex flex-auto ns-payment-wrapper overflow-y-auto"},[s(e.currentPaymentComponent,{tag:"component",attrs:{label:e.activePayment.label,identifier:e.activePayment.identifier},on:{submit:function(t){return e.submitOrder()}}})],1),e._v(" "),e.showPayment?s("div",{staticClass:"flex flex-auto ns-payment-wrapper overflow-y-auto p-2 flex-col"},[s("h3",{staticClass:"text-center font-bold py-2"},[e._v(e._s(e.__("List Of Payments")))]),e._v(" "),s("ul",{staticClass:"flex-auto"},[0===e.order.payments.length?s("li",{staticClass:"p-2 flex justify-center mb-2 items-center"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.__("No Payment added.")))])]):e._e(),e._v(" "),e._l(e.order.payments,(function(t,r){return s("li",{key:r,staticClass:"p-2 flex justify-between mb-2 items-center"},[s("span",[e._v(e._s(t.label))]),e._v(" "),s("div",{staticClass:"flex items-center"},[s("span",[e._v(e._s(e._f("currency")(t.value)))]),e._v(" "),s("button",{staticClass:"rounded-full  h-8 w-8 flex items-center justify-center ml-2",on:{click:function(s){return e.deletePayment(t)}}},[s("i",{staticClass:"las la-trash-alt"})])])])}))],2)]):e._e()]),e._v(" "),s("div",{staticClass:"flex lg:hidden ns-payment-buttons"},[s("button",{staticClass:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 font-bold ns-payment-type-button",on:{click:function(t){return e.selectPayment()}}},[s("span",{staticClass:"text-sm"},[e._v(e._s(e.__("Payment Type")))])]),e._v(" "),e.order.tendered>=e.order.total?s("button",{staticClass:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 ns-submit-button font-bold",on:{click:function(t){return e.submitOrder()}}},[s("span",{staticClass:"text-sm"},[e._v(e._s(e.__("Submit Payment")))])]):e._e(),e._v(" "),e.order.tendered<e.order.total?s("button",{staticClass:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 ns-layaway-button font-bold",on:{click:function(t){return e.submitOrder({payment_status:"unpaid"})}}},[s("span",{staticClass:"text-sm"},[e._v(e._s(e.__("Layaway")))])]):e._e(),e._v(" "),s("button",{staticClass:"w-1/3 flex ns-payment-button text-2xl flex-auto h-12 items-center justify-center font-bold",on:{click:function(t){e.showPayment=!0}}},[s("span",{staticClass:"text-sm mr-1"},[e._v(e._s(e.__("Payment List")))]),e._v(" "),s("span",{staticClass:"px-2 rounded-full h-6 w-6 text-xs flex items-center justify-center ns-label"},[e._v(e._s(e.order.payments.length))])])]),e._v(" "),s("div",{staticClass:"flex-col sm:flex-row w-full ns-payment-footer justify-end p-2 hidden lg:flex"},[s("div",{staticClass:"flex justify-end"},[e.order.tendered>=e.order.total?s("ns-button",{attrs:{type:e.order.tendered>=e.order.total?"success":"info"},on:{click:function(t){return e.submitOrder()}}},[s("span",[s("i",{staticClass:"las la-cash-register"}),e._v(" "+e._s(e.__("Submit Payment")))])]):e._e(),e._v(" "),e.order.tendered<e.order.total?s("ns-button",{attrs:{type:e.order.tendered>=e.order.total?"success":"info"},on:{click:function(t){return e.submitOrder({payment_status:"unpaid"})}}},[s("span",[s("i",{staticClass:"las la-bookmark"}),e._v(" "+e._s(e.__("Layaway"))+" â€” "+e._s(e._f("currency")(e.expectedPayment)))])]):e._e()],1)])])])]):e._e()}),[],!1,null,null,null).exports;s(4492);var E=s(279),R=s(664),q=s(9510);function N(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var X=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t}var t,s,r;return t=e,(s=[{key:"run",value:function(){var e=this;return new Promise((function(t,s){return 0===e.order.products.length?(f.kX.error((0,a.__)("You need to provide some products before proceeding.")).subscribe(),s(!1)):t(!0)}))}}])&&N(t.prototype,s),r&&N(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function I(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.ProductsQueue=X;var H=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t}var t,s,r;return t=e,(s=[{key:"run",value:function(){var e=this;return new Promise((function(t,s){return void 0===e.order.customer?i.G.show(q.Z,{resolve:t,reject:s}):t(!0)}))}}])&&I(t.prototype,s),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function G(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.CustomerQueue=H;var Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t}var t,s,r;return t=e,(s=[{key:"run",value:function(){var e=this;return new Promise((function(t,s){i.G.show(F,{resolve:t,reject:s,order:e.order})}))}}])&&G(t.prototype,s),r&&G(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.PaymentQueue=Q;var U=s(664).Z,Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t}var t,s,r;return t=e,(s=[{key:"run",value:function(){var e=this;return new Promise((function(t,s){if(void 0===e.order.type)return i.G.show(U,{resolve:t,reject:s});t(!0)}))}}])&&L(t.prototype,s),r&&L(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();window.TypeQueue=Y;var W=s(9763),M=s(9702),z=s(8603);const B={name:"ns-pos-hold-orders",data:function(){return{order:{},title:"",show:!0}},mounted:function(){this.popupCloser(),this.show=POS.getHoldPopupEnabled(),this.show||this.$popupParams.resolve({title:this.title}),this.$refs.reference.focus(),this.$refs.reference.select(),this.order=this.$popupParams.order,this.title=this.$popupParams.order.title||""},methods:{__:a.__,popupCloser:z.Z,submitHold:function(){this.$popup.close(),this.$popupParams.resolve({title:this.title})}}};const J=(0,d.Z)(B,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow-lg w-6/7-screen md:w-3/7-screen lg:w-2/6-screen"},[s("div",{staticClass:"p-2 flex ns-box-header justify-between border-b items-center"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.__("Hold Order")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.$popup.close()}}})],1)]),e._v(" "),s("div",{staticClass:"flex-auto ns-box-body"},[s("div",{staticClass:"border-b h-16 flex items-center justify-center"},[s("span",{staticClass:"text-5xl text-primary"},[e._v(e._s(e._f("currency")(e.order.total)))])]),e._v(" "),s("div",{staticClass:"p-2"},[s("div",{staticClass:"input-group border-2 info"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.title,expression:"title"}],ref:"reference",staticClass:"outline-none rounded border-2 p-2 w-full",attrs:{type:"text",placeholder:"Order Reference"},domProps:{value:e.title},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitHold()},input:function(t){t.target.composing||(e.title=t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"p-2"},[s("p",{staticClass:"text-secondary"},[e._v("\n                "+e._s(e.__("The current order will be set on hold. You can retreive this order from the pending order button. Providing a reference to it might help you to identify the order more quickly."))+"\n            ")])])]),e._v(" "),s("div",{staticClass:"flex ns-box-footer"},[s("div",{staticClass:" cursor-pointer w-1/2 py-3 flex justify-center items-center bg-green-500 text-white font-semibold",on:{click:function(t){return e.submitHold()}}},[e._v("\n            "+e._s(e.__("Confirm"))+"\n        ")]),e._v(" "),s("div",{staticClass:"cursor-pointer w-1/2 py-3 flex justify-center items-center bg-error-secondary text-white font-semibold",on:{click:function(t){return e.$popup.close()}}},[e._v("\n            "+e._s(e.__("Cancel"))+"\n        ")])])])}),[],!1,null,null,null).exports;var K=s(7266);const ee={name:"ns-pos-note-popup",data:function(){return{validation:new K.Z,fields:[{label:(0,a.__)("Note"),name:"note",value:"",description:(0,a.__)("More details about this order"),type:"textarea"},{label:(0,a.__)("Display On Receipt"),name:"note_visibility",value:"",options:[{label:(0,a.__)("Yes"),value:"visible"},{label:(0,a.__)("No"),value:"hidden"}],description:(0,a.__)("Will display the note on the receipt"),type:"switch"}]}},mounted:function(){var e=this;this.popupCloser(),this.fields.forEach((function(t){"note"===t.name?t.value=e.$popupParams.note:"note_visibility"===t.name&&(t.value=e.$popupParams.note_visibility)}))},methods:{__:a.__,popupResolver:o.Z,popupCloser:z.Z,closePopup:function(){this.popupResolver(!1)},saveNote:function(){if(!this.validation.validateFields(this.fields)){var e=this.validation.validateFieldsErrors(this.fields);return this.validation.triggerFieldsErrors(this.fields,e),this.$forceUpdate(),console.log(this.fields),f.kX.error((0,a.__)("Unable to proceed the form is not valid.")).subscribe()}return this.popupResolver(this.validation.extractFields(this.fields))}}};const te=(0,d.Z)(ee,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg ns-box w-95vw md:w-3/5-screen lg:w-2/5-screen"},[s("div",{staticClass:"p-2 flex justify-between items-center border-b ns-box-header"},[s("h3",{staticClass:"font-bold"},[e._v(e._s(e.__("Order Note")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2"},e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),s("div",{staticClass:"p-2 flex justify-end border-t ns-box-footer"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.saveNote()}}},[e._v("Save")])],1)])}),[],!1,null,null,null).exports;const se={name:"ns-pos-tax-popup",data:function(){return{validation:new K.Z,tax_group:[],order:null,orderSubscriber:null,optionsSubscriber:null,options:{},tax_groups:[],activeTab:"",group_fields:[{label:(0,a.__)("Select Tax"),name:"tax_group_id",description:(0,a.__)("Define the tax that apply to the sale."),type:"select",disabled:!0,value:"",validation:"required",options:[]},{label:(0,a.__)("Type"),name:"tax_type",disabled:!0,value:"",description:(0,a.__)("Define how the tax is computed"),type:"select",validation:"required",options:[{label:(0,a.__)("Exclusive"),value:"exclusive"},{label:(0,a.__)("Inclusive"),value:"inclusive"}]}]}},mounted:function(){var e=this;this.loadGroups(),this.popupCloser(),this.activeTab=this.$popupParams.activeTab||"settings",this.group_fields.forEach((function(t){t.value=e.$popupParams[t.name]||void 0})),this.orderSubscriber=POS.order.subscribe((function(t){e.order=t})),this.optionsSubscriber=POS.options.subscribe((function(t){e.options=t,["variable_vat","products_variable_vat"].includes(e.options.ns_pos_vat)&&e.group_fields.forEach((function(e){return e.disabled=!1}))}))},destroyed:function(){this.orderSubscriber.unsubscribe(),this.optionsSubscriber.unsubscribe()},methods:{__:a.__,popupCloser:z.Z,popupResolver:o.Z,changeActive:function(e){this.activeTab=e},closePopup:function(){this.popupResolver(!1)},saveTax:function(){if(!this.validation.validateFields(this.group_fields))return f.kX.error((0,a.__)("Unable to proceed the form is not valid.")).subscribe();var e=this.validation.extractFields(this.group_fields);this.popupResolver(e)},loadGroups:function(){var e=this;f.ih.get("/api/nexopos/v4/taxes/groups").subscribe((function(t){e.groups=t,e.group_fields.forEach((function(t){"tax_group_id"===t.name&&(t.options=e.groups.map((function(e){return{label:e.name,value:e.id}})))}))}))}}};const re=(0,d.Z)(se,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow-lg w-95vw md:w-3/5-screen lg:w-2/5-screen"},[s("div",{staticClass:"p-2 flex justify-between items-center border-b ns-box-header"},[s("h3",{staticClass:"text-blog"},[e._v(e._s(e.__("Tax & Summary")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 ns-box-body"},[s("ns-tabs",{attrs:{active:e.activeTab},on:{changeTab:function(t){return e.changeActive(t)}}},[s("ns-tabs-item",{attrs:{padding:"0",label:e.__("Settings"),identifier:"settings",active:!0}},[s("div",{staticClass:"p-2 border-b ns-box-body"},e._l(e.group_fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),s("div",{staticClass:"flex justify-end p-2"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.saveTax()}}},[e._v(e._s(e.__("Save")))])],1)]),e._v(" "),s("ns-tabs-item",{attrs:{padding:"0",label:e.__("Summary"),identifier:"summary",active:!1}},[e.order?s("div",{staticClass:"p-2"},[e._l(e.order.taxes,(function(t){return s("div",{key:t.id,staticClass:"mb-2 border shadow p-2 w-full flex justify-between items-center elevation-surface"},[s("span",[e._v(e._s(t.tax_name))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(t.tax_value)))])])})),e._v(" "),0===e.order.taxes.length?s("div",{staticClass:"p-2 text-center text-primary"},[e._v(e._s(e.__("No tax is active")))]):e._e()],2):e._e()]),e._v(" "),s("ns-tabs-item",{attrs:{padding:"0",label:e.__("Product Taxes"),identifier:"product_taxes",active:!1}},[e.order?s("div",{staticClass:"p-2"},[s("div",{staticClass:"border shadow p-2 w-full flex justify-between items-center elevation-surface"},[s("span",[e._v(e._s(e.__("Product Taxes")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.products_tax_value)))])])]):e._e()])],1)],1)])}),[],!1,null,null,null).exports;var ne=s(241);const ie={name:"ns-pos-order-settings",mounted:function(){var e=this;nsHttpClient.get("/api/nexopos/v4/fields/ns.pos-order-settings").subscribe((function(t){t.forEach((function(t){t.value=e.$popupParams.order[t.name]||""})),e.fields=e.validation.createFields(t)}),(function(e){})),this.popupCloser()},data:function(){return{fields:[],validation:new K.Z}},methods:{__,popupCloser,popupResolver,closePopup:function(){this.popupResolver(!1)},saveSettings:function(){var e=this.validation.extractFields(this.fields);this.popupResolver(e)}}};const oe=(0,d.Z)(ie,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg flex flex-col ns-box w-95vw h-95vh md:w-3/5-screen md:h-3/5-screen lg:w-2/5-screen"},[s("div",{staticClass:"p-2 border-b ns-box-header items-center flex justify-between"},[s("h3",{staticClass:"text-semibold"},[e._v(e._s(e.__("Order Settings")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 flex-auto border-b ns-box-body overflow-y-auto"},e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),s("div",{staticClass:"p-2 flex justify-end ns-box-footer"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.saveSettings()}}},[e._v(e._s(e.__("Save")))])],1)])}),[],!1,null,null,null).exports;var ae=s(3220);const ce={name:"ns-pos-product-price-product",components:{nsNumpad:k.Z,nsNumpadPlus:ae.Z},computed:{},data:function(){return{product:{},optionsSubscription:null,options:{}}},mounted:function(){var e=this;this.popupCloser(),this.product=this.$popupParams.product,this.optionsSubscription=POS.options.subscribe((function(t){e.options=t}))},beforeDestroy:function(){this.optionsSubscription.unsubscribe()},methods:{popupResolver,popupCloser,__,updateProductPrice:function(e){this.product.unit_price=e},resolveProductPrice:function(e){this.popupResolver(this.product.unit_price)}}};const le=(0,d.Z)(ce,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow-lg w-95vw md:w-3/5-screen lg:w-2/5-screen"},[s("div",{staticClass:"popup-heading ns-box-header"},[s("h3",[e._v(e._s(e.__("Product Price")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.popupResolver(!1)}}})],1)]),e._v(" "),s("div",{staticClass:"flex flex-col ns-box-body"},[s("div",{staticClass:"h-16 flex items-center justify-center elevation-surface info font-bold"},[s("h2",{staticClass:"text-2xl"},[e._v(e._s(e._f("currency")(e.product.unit_price)))])]),e._v(" "),"default"===e.options.ns_pos_numpad?s("ns-numpad",{attrs:{floating:e.options.ns_pos_allow_decimal_quantities,value:e.product.unit_price},on:{changed:function(t){return e.updateProductPrice(t)},next:function(t){return e.resolveProductPrice(t)}}}):e._e(),e._v(" "),"advanced"===e.options.ns_pos_numpad?s("ns-numpad-plus",{attrs:{value:e.product.unit_price},on:{changed:function(t){return e.updateProductPrice(t)},next:function(t){return e.resolveProductPrice(t)}}}):e._e()],1)])}),[],!1,null,null,null).exports;var ue=s(2277);function de(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}const pe={name:"ns-pos-quick-product-popup",methods:{__:a.__,popupCloser:z.Z,popupResolver:o.Z,close:function(){this.popupResolver(!1)},addProduct:function(){var e,t=this;return(e=n().mark((function e(){var s,r,i,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.validation.extractFields(t.fields),r=t.fields.filter((function(e){return void 0===e.show||"function"==typeof e.show&&e.show(s)})),t.validation.validateFields(r)){e.next=5;break}return e.abrupt("return",f.kX.error((0,a.__)("Unable to proceed. The form is not valid.")).subscribe());case 5:return(i=t.validation.extractFields(r)).$original=function(){return{stock_management:"disabled",category_id:0,tax_group:t.tax_groups.filter((function(e){return parseInt(e.id)===parseInt(i.tax_group_id)}))[0],tax_group_id:i.tax_group_id,tax_type:i.tax_type}},"product"===i.product_type?(i.unit_name=t.units.filter((function(e){return e.id===i.unit_id}))[0].name,i.quantity=parseFloat(i.quantity),i.unit_price=parseFloat(i.unit_price),i.mode="custom",i.price_with_tax=i.unit_price,i.price_without_tax=i.unit_price,i.tax_value=0):(i.unit_name=(0,a.__)("N/A"),i.unit_price=0,i.quantity=1),e.next=10,POS.defineQuantities(i,t.units);case 10:o=e.sent,i.$quantities=function(){return o},i=POS.computeProductTax(i),POS.addToCart(i),t.close();case 15:case"end":return e.stop()}}),e)})),function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){de(i,r,n,o,a,"next",e)}function a(e){de(i,r,n,o,a,"throw",e)}o(void 0)}))})()},loadData:function(){var e=this;this.loaded=!1,(0,ue.D)(nsHttpClient.get("/api/nexopos/v4/units"),nsHttpClient.get("/api/nexopos/v4/taxes/groups")).subscribe({next:function(t){e.units=t[0],e.tax_groups=t[1],e.fields.filter((function(e){"tax_group_id"===e.name&&(e.options=t[1].map((function(e){return{label:e.name,value:e.id}}))),"unit_id"===e.name&&(e.options=t[0].map((function(e){return{label:e.name,value:e.id}})))})),e.buildForm()},error:function(e){}})},buildForm:function(){this.fields=this.validation.createFields(this.fields),this.loaded=!0}},computed:{form:function(){return this.validation.extractFields(this.fields)}},data:function(){return{units:[],tax_groups:[],loaded:!1,validation:new K.Z,fields:[{label:(0,a.__)("Name"),name:"name",type:"text",description:(0,a.__)("Provide a unique name for the product."),validation:"required"},{label:(0,a.__)("Product Type"),name:"product_type",type:"select",description:(0,a.__)("Define the product type."),options:[{label:(0,a.__)("Normal"),value:"product"},{label:(0,a.__)("Dynamic"),value:"dynamic"}],value:"product",validation:"required"},{label:(0,a.__)("Rate"),name:"rate",type:"text",description:(0,a.__)("In case the product is computed based on a percentage, define the rate here."),validation:"required",show:function(e){return"dynamic"===e.product_type}},{label:(0,a.__)("Unit Price"),name:"unit_price",type:"text",description:(0,a.__)("Define what is the sale price of the item."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,a.__)("Quantity"),name:"quantity",type:"text",value:1,description:(0,a.__)("Set the quantity of the product."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,a.__)("Unit"),name:"unit_id",type:"select",options:[],description:(0,a.__)("Assign a unit to the product."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,a.__)("Tax Type"),name:"tax_type",type:"select",options:[{label:(0,a.__)("Disabled"),value:""},{label:(0,a.__)("Inclusive"),value:"inclusive"},{label:(0,a.__)("Exclusive"),value:"exclusive"}],description:(0,a.__)("Define what is tax type of the item."),show:function(e){return"product"===e.product_type}},{label:(0,a.__)("Tax Group"),name:"tax_group_id",type:"select",options:[],description:(0,a.__)("Choose the tax group that should apply to the item."),show:function(e){return"product"===e.product_type}}]}},mounted:function(){this.popupCloser(),this.loadData()}};const _e=(0,d.Z)(pe,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"w-95vw flex flex-col h-95vh shadow-lg md:w-3/5-screen lg:w-2/5-screen md:h-3/5-screen ns-box"},[s("div",{staticClass:"header ns-box-header border-b flex justify-between p-2 items-center"},[s("h3",[e._v(e._s(e.__("Product / Service")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"ns-box-body p-2 flex-auto overflow-y-auto"},[e.loaded?e._e():s("div",{staticClass:"h-full w-full flex justify-center items-center"},[s("ns-spinner")],1),e._v(" "),e.loaded?[e._l(e.fields,(function(t,r){return[t.show&&t.show(e.form)||!t.show?s("ns-field",{key:r,attrs:{field:t}}):e._e()]}))]:e._e()],2),e._v(" "),s("div",{staticClass:"ns-box-footer border-t flex justify-between p-2"},[s("div"),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.addProduct()}}},[e._v(e._s(e.__("Create")))])],1)])])}),[],!1,null,null,null).exports;function fe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ve(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(s),!0).forEach((function(t){me(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):fe(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function me(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function be(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}function he(e){return function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){be(i,r,n,o,a,"next",e)}function a(e){be(i,r,n,o,a,"throw",e)}o(void 0)}))}}const ye={name:"ns-pos-cart",data:function(){return{popup:null,products:[],visibleSection:null,visibleSectionSubscriber:null,optionsSubscriber:null,options:{},typeSubscribe:null,orderSubscribe:null,productSubscribe:null,settingsSubscribe:null,settings:{},types:[],order:{}}},computed:{selectedType:function(){return this.order.type?this.order.type.label:"N/A"},isVisible:function(){return"cart"===this.visibleSection},customerName:function(){return this.order.customer?this.order.customer.name:"N/A"},couponName:function(){return(0,a.__)("Apply Coupon")}},mounted:function(){var e=this;for(var t in this.optionsSubscriber=POS.options.subscribe((function(t){e.options=t,console.log(t)})),this.typeSubscribe=POS.types.subscribe((function(t){return e.types=t})),this.orderSubscribe=POS.order.subscribe((function(t){e.order=t})),this.productSubscribe=POS.products.subscribe((function(t){e.products=t,e.$forceUpdate()})),this.settingsSubscribe=POS.settings.subscribe((function(t){e.settings=t})),this.visibleSectionSubscriber=POS.visibleSection.subscribe((function(t){e.visibleSection=t})),nsShortcuts)["ns_pos_keyboard_hold_order"].includes(t)&&nsHotPress.create("ns_pos_keyboard_hold_order").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[t],(function(t){t.preventDefault(),e.holdOrder()})),["ns_pos_keyboard_payment"].includes(t)&&nsHotPress.create("ns_pos_keyboard_payment").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[t],(function(t){t.preventDefault(),e.payOrder()})),["ns_pos_keyboard_shipping"].includes(t)&&nsHotPress.create("ns_pos_keyboard_shipping").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[t],(function(t){t.preventDefault(),e.openShippingPopup()})),["ns_pos_keyboard_note"].includes(t)&&nsHotPress.create("ns_pos_keyboard_note").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[t],(function(t){t.preventDefault(),e.openNotePopup()}))},destroyed:function(){this.visibleSectionSubscriber.unsubscribe(),this.typeSubscribe.unsubscribe(),this.orderSubscribe.unsubscribe(),this.productSubscribe.unsubscribe(),this.settingsSubscribe.unsubscribe(),this.optionsSubscriber.unsubscribe(),nsHotPress.destroy("ns_pos_keyboard_hold_order"),nsHotPress.destroy("ns_pos_keyboard_payment"),nsHotPress.destroy("ns_pos_keyboard_shipping"),nsHotPress.destroy("ns_pos_keyboard_note")},methods:{__:a.__,switchTo:W.Z,openAddQuickProduct:function(){new Promise((function(e,t){i.G.show(_e,{resolve:e,reject:t})})).then((function(e){})).catch((function(e){}))},summarizeCoupons:function(){var e=this.order.coupons.map((function(e){return e.value}));return e.length>0?e.reduce((function(e,t){return e+t})):0},changeProductPrice:function(e){var t=this;return he(n().mark((function s(){var r,o;return n().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(t.settings.edit_purchase_price){s.next=2;break}return s.abrupt("return",f.kX.error((0,a.__)("You don't have the right to edit the purchase price.")).subscribe());case 2:if("dynamic"!==e.product_type){s.next=4;break}return s.abrupt("return",f.kX.error((0,a.__)("Dynamic product can't have their price updated.")).subscribe());case 4:if(!t.settings.unit_price_editable){s.next=25;break}return s.prev=5,s.next=8,new Promise((function(t,s){return i.G.show(le,{product:Object.assign({},e),resolve:t,reject:s})}));case 8:return r=s.sent,o=ve(ve({},e.$quantities()),{custom_price_edit:r}),e.$quantities=function(){return o},e.mode="custom",e=POS.computeProductTax(e),POS.recomputeProducts(POS.products.getValue()),POS.refreshCart(),s.abrupt("return",f.kX.success((0,a.__)("The product price has been updated.")).subscribe());case 18:if(s.prev=18,s.t0=s.catch(5),!1===s.t0){s.next=23;break}throw f.kX.error(s.t0).subscribe(),s.t0;case 23:s.next=26;break;case 25:return s.abrupt("return",f.kX.error((0,a.__)("The editable price feature is disabled.")).subscribe());case 26:case"end":return s.stop()}}),s,null,[[5,18]])})))()},selectCoupon:function(){return he(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,t){i.G.show(ne.Z,{resolve:e,reject:t})}));case 3:e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,null,[[0,6]])})))()},defineOrderSettings:function(){var e=this;return he(n().mark((function t(){var s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.settings.edit_settings){t.next=2;break}return t.abrupt("return",f.kX.error((0,a.__)("You're not allowed to edit the order settings.")).subscribe());case 2:return t.prev=2,t.next=5,new Promise((function(t,s){i.G.show(oe,{resolve:t,reject:s,order:e.order})}));case 5:s=t.sent,POS.order.next(ve(ve({},e.order),s)),t.next=11;break;case 9:t.prev=9,t.t0=t.catch(2);case 11:case"end":return t.stop()}}),t,null,[[2,9]])})))()},openNotePopup:function(){var e=this;return he(n().mark((function t(){var s,r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,s){var r=e.order.note,n=e.order.note_visibility;i.G.show(te,{resolve:t,reject:s,note:r,note_visibility:n})}));case 3:s=t.sent,r=ve(ve({},e.order),s),POS.order.next(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),!1!==t.t0&&f.kX.error(t.t0.message).subscribe();case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},selectTaxGroup:function(){var e=arguments,t=this;return he(n().mark((function s(){var r,o,a;return n().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:"settings",s.prev=1,s.next=4,new Promise((function(e,s){var n=t.order.taxes,o=t.order.tax_group_id,a=t.order.tax_type;i.G.show(re,{resolve:e,reject:s,taxes:n,tax_group_id:o,tax_type:a,activeTab:r})}));case 4:o=s.sent,a=ve(ve({},t.order),o),POS.order.next(a),POS.refreshCart(),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(1),console.log(s.t0);case 13:case"end":return s.stop()}}),s,null,[[1,10]])})))()},openTaxSummary:function(){this.selectTaxGroup("summary")},voidOngoingOrder:function(){POS.voidOrder(this.order)},holdOrder:function(){var e=this;return he(n().mark((function t(){var s,r,o;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("hold"!==e.order.payment_status&&e.order.payments.length>0)){t.next=2;break}return t.abrupt("return",f.kX.error((0,a.__)("Unable to hold an order which payment status has been updated already.")).subscribe());case 2:s=f.kq.applyFilters("ns-hold-queue",[X,H,Y]),t.t0=n().keys(s);case 4:if((t.t1=t.t0()).done){t.next=18;break}return r=t.t1.value,t.prev=6,o=new s[r](e.order),t.next=10,o.run();case 10:t.sent,t.next=16;break;case 13:return t.prev=13,t.t2=t.catch(6),t.abrupt("return",!1);case 16:t.next=4;break;case 18:f.kq.applyFilters("ns-override-hold-popup",(function(){new Promise((function(t,s){i.G.show(J,{resolve:t,reject:s,order:e.order})})).then((function(t){e.order.title=t.title,e.order.payment_status="hold",POS.order.next(e.order);var s=i.G.show(j.default);POS.submitOrder().then((function(e){s.close(),f.kX.success(e.message).subscribe()}),(function(e){s.close(),f.kX.error(e.message).subscribe()}))}))}))();case 20:case"end":return t.stop()}}),t,null,[[6,13]])})))()},openDiscountPopup:function(e,t){return this.settings.products_discount||"product"!==t?this.settings.cart_discount||"cart"!==t?void i.G.show(p,{reference:e,type:t,onSubmit:function(s){"product"===t?POS.updateProduct(e,s):"cart"===t&&POS.updateCart(e,s)}},{popupClass:"bg-white h:2/3 shadow-lg xl:w-1/4 lg:w-2/5 md:w-2/3 w-full"}):f.kX.error((0,a.__)("You're not allowed to add a discount on the cart.")).subscribe():f.kX.error((0,a.__)("You're not allowed to add a discount on the product.")).subscribe()},selectCustomer:function(){i.G.show(q.Z)},toggleMode:function(e){if(!this.options.ns_pos_allow_wholesale_price)return f.kX.error((0,a.__)("Unable to change the price mode. This feature has been disabled.")).subscribe();"normal"===e.mode?i.G.show(_.default,{title:(0,a.__)("Enable WholeSale Price"),message:(0,a.__)("Would you like to switch to wholesale price ?"),onAction:function(t){t&&POS.updateProduct(e,{mode:"wholesale"})}}):i.G.show(_.default,{title:(0,a.__)("Enable Normal Price"),message:(0,a.__)("Would you like to switch to normal price ?"),onAction:function(t){t&&POS.updateProduct(e,{mode:"normal"})}})},remove:function(e){i.G.show(_.default,{title:(0,a.__)("Confirm Your Action"),message:(0,a.__)("Would you like to delete this product ?"),onAction:function(t){t&&POS.removeProduct(e)}})},allowQuantityModification:function(e){return"product"===e.product_type},changeQuantity:function(e){this.allowQuantityModification(e)&&new E.$(e).run({unit_quantity_id:e.unit_quantity_id,unit_name:e.unit_name,$quantities:e.$quantities}).then((function(t){POS.updateProduct(e,t)}))},payOrder:function(){var e=this;return he(n().mark((function t(){var s,r,i;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=f.kq.applyFilters("ns-pay-queue",[X,H,Y,Q]),t.t0=n().keys(s);case 2:if((t.t1=t.t0()).done){t.next=16;break}return r=t.t1.value,t.prev=4,i=new s[r](e.order),t.next=8,i.run();case 8:t.sent,t.next=14;break;case 11:return t.prev=11,t.t2=t.catch(4),t.abrupt("return",!1);case 14:t.next=2;break;case 16:case"end":return t.stop()}}),t,null,[[4,11]])})))()},openOrderType:function(){i.G.show(R.Z)},openShippingPopup:function(){i.G.show(M.Z)}}};const xe=(0,d.Z)(ye,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flex-auto flex flex-col",attrs:{id:"pos-cart"}},["cart"===e.visibleSection?s("div",{staticClass:"flex pl-2 ns-tab",attrs:{id:"tools"}},[s("div",{staticClass:"flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold active tab",on:{click:function(t){return e.switchTo("cart")}}},[s("span",[e._v(e._s(e.__("Cart")))]),e._v(" "),e.order?s("span",{staticClass:"flex items-center justify-center text-sm rounded-full h-6 w-6 bg-green-500 text-white ml-1"},[e._v(e._s(e.order.products.length))]):e._e()]),e._v(" "),s("div",{staticClass:"cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l inactive tab",on:{click:function(t){return e.switchTo("grid")}}},[e._v("\n            "+e._s(e.__("Products"))+"\n        ")])]):e._e(),e._v(" "),s("div",{staticClass:"rounded shadow ns-tab-item flex-auto flex overflow-hidden"},[s("div",{staticClass:"cart-table flex flex-auto flex-col overflow-hidden"},[s("div",{staticClass:"w-full p-2 border-b",attrs:{id:"cart-toolbox"}},[s("div",{staticClass:"border rounded overflow-hidden"},[s("div",{staticClass:"flex flex-wrap"},[s("div",{staticClass:"ns-button"},[s("button",{staticClass:"w-full h-10 px-3 outline-none",on:{click:function(t){return e.openNotePopup()}}},[s("i",{staticClass:"las la-comment"}),e._v(" "),s("span",{staticClass:"ml-1 hidden md:inline-block"},[e._v(e._s(e.__("Comments")))])])]),e._v(" "),s("hr",{staticClass:"h-10",staticStyle:{width:"1px"}}),e._v(" "),s("div",{staticClass:"ns-button"},[s("button",{staticClass:"w-full h-10 px-3 outline-none flex items-center",on:{click:function(t){return e.selectTaxGroup()}}},[s("i",{staticClass:"las la-balance-scale-left"}),e._v(" "),s("span",{staticClass:"ml-1 hidden md:inline-block"},[e._v(e._s(e.__("Taxes")))]),e._v(" "),e.order.taxes&&e.order.taxes.length>0?s("span",{staticClass:"ml-1 rounded-full flex items-center justify-center h-6 w-6 bg-info-secondary text-white"},[e._v(e._s(e.order.taxes.length))]):e._e()])]),e._v(" "),s("hr",{staticClass:"h-10",staticStyle:{width:"1px"}}),e._v(" "),s("div",{staticClass:"ns-button"},[s("button",{staticClass:"w-full h-10 px-3 outline-none flex items-center",on:{click:function(t){return e.selectCoupon()}}},[s("i",{staticClass:"las la-tags"}),e._v(" "),s("span",{staticClass:"ml-1 hidden md:inline-block"},[e._v(e._s(e.__("Coupons")))]),e._v(" "),e.order.coupons&&e.order.coupons.length>0?s("span",{staticClass:"ml-1 rounded-full flex items-center justify-center h-6 w-6 bg-info-secondary text-white"},[e._v(e._s(e.order.coupons.length))]):e._e()])]),e._v(" "),s("hr",{staticClass:"h-10",staticStyle:{width:"1px"}}),e._v(" "),s("div",{staticClass:"ns-button"},[s("button",{staticClass:"w-full h-10 px-3 outline-none flex items-center",on:{click:function(t){return e.defineOrderSettings()}}},[s("i",{staticClass:"las la-tools"}),e._v(" "),s("span",{staticClass:"ml-1 hidden md:inline-block"},[e._v(e._s(e.__("Settings")))])])]),e._v(" "),s("hr",{staticClass:"h-10",staticStyle:{width:"1px"}}),e._v(" "),"yes"===e.options.ns_pos_quick_product?s("div",{staticClass:"ns-button"},[s("button",{staticClass:"w-full h-10 px-3 outline-none flex items-center",on:{click:function(t){return e.openAddQuickProduct()}}},[s("i",{staticClass:"las la-plus"}),e._v(" "),s("span",{staticClass:"ml-1 hidden md:inline-block"},[e._v(e._s(e.__("Product")))])])]):e._e(),e._v(" "),s("hr",{staticClass:"h-10",staticStyle:{width:"1px"}})])])]),e._v(" "),s("div",{staticClass:"w-full text-primary font-semibold flex",attrs:{id:"cart-table-header"}},[s("div",{staticClass:"w-full lg:w-4/6 p-2 border border-l-0 border-t-0"},[e._v(e._s(e.__("Product")))]),e._v(" "),s("div",{staticClass:"hidden lg:flex lg:w-1/6 p-2 border-b border-t-0"},[e._v(e._s(e.__("Quantity")))]),e._v(" "),s("div",{staticClass:"hidden lg:flex lg:w-1/6 p-2 border border-r-0 border-t-0"},[e._v(e._s(e.__("Total")))])]),e._v(" "),s("div",{staticClass:"flex flex-auto flex-col overflow-auto",attrs:{id:"cart-products-table"}},[0===e.products.length?s("div",{staticClass:"text-primary flex"},[s("div",{staticClass:"w-full text-center py-4 border-b"},[s("h3",[e._v(e._s(e.__("No products added...")))])])]):e._e(),e._v(" "),e._l(e.products,(function(t,r){return s("div",{key:t.barcode,staticClass:"product-item flex",attrs:{"product-index":r}},[s("div",{staticClass:"w-full lg:w-4/6 p-2 border border-l-0 border-t-0"},[s("div",{staticClass:"flex justify-between product-details mb-1"},[s("h3",{staticClass:"font-semibold"},[e._v("\n                                "+e._s(t.name)+" â€” "+e._s(t.unit_name)+"\n                            ")]),e._v(" "),s("div",{staticClass:"-mx-1 flex product-options"},[s("div",{staticClass:"px-1"},[s("a",{staticClass:"hover:text-error-secondary cursor-pointer outline-none border-dashed py-1 border-b border-error-secondary text-sm",on:{click:function(s){return e.remove(t)}}},[s("i",{staticClass:"las la-trash text-xl"})])]),e._v(" "),e.options.ns_pos_allow_wholesale_price&&e.allowQuantityModification(t)?s("div",{staticClass:"px-1"},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b  text-sm",class:"wholesale"===t.mode?"text-success-secondary border-success-secondary":"border-info-primary",on:{click:function(s){return e.toggleMode(t)}}},[s("i",{staticClass:"las la-award text-xl"})])]):e._e()])]),e._v(" "),s("div",{staticClass:"flex justify-between product-controls"},[s("div",{staticClass:"-mx-1 flex flex-wrap"},[s("div",{staticClass:"px-1 w-1/2 md:w-auto mb-1"},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b  text-sm",class:"wholesale"===t.mode?"text-success-secondary hover:text-success-secondary border-success-secondary":"border-info-primary",on:{click:function(s){return e.changeProductPrice(t)}}},[e._v(e._s(e.__("Price"))+" : "+e._s(e._f("currency")(t.unit_price)))])]),e._v(" "),s("div",{staticClass:"px-1 w-1/2 md:w-auto mb-1"},[e.allowQuantityModification(t)?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(s){return e.openDiscountPopup(t,"product")}}},[e._v(e._s(e.__("Discount"))+" "),"percentage"===t.discount_type?s("span",[e._v(e._s(t.discount_percentage)+"%")]):e._e(),e._v(" : "+e._s(e._f("currency")(t.discount)))]):e._e()]),e._v(" "),s("div",{staticClass:"px-1 w-1/2 md:w-auto mb-1 lg:hidden"},[e.allowQuantityModification(t)?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(s){return e.changeQuantity(t)}}},[e._v(e._s(e.__("Quantity"))+": "+e._s(t.quantity))]):e._e()]),e._v(" "),s("div",{staticClass:"px-1 w-1/2 md:w-auto mb-1 lg:hidden"},[s("span",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm"},[e._v(e._s(e.__("Total"))+": "+e._s(e._f("currency")(t.total_price)))])])])])]),e._v(" "),s("div",{staticClass:"hidden lg:flex w-1/6 p-2 border-b items-center justify-center",class:e.allowQuantityModification(t)?"cursor-pointer ns-numpad-key":"",on:{click:function(s){return e.changeQuantity(t)}}},[e.allowQuantityModification(t)?s("span",{staticClass:"border-b border-dashed border-info-primary p-2"},[e._v(e._s(t.quantity))]):e._e()]),e._v(" "),s("div",{staticClass:"hidden lg:flex w-1/6 p-2 border border-r-0 border-t-0 items-center justify-center"},[e._v(e._s(e._f("currency")(t.total_price)))])])}))],2),e._v(" "),s("div",{staticClass:"flex",attrs:{id:"cart-products-summary"}},["both"===e.visibleSection?s("table",{staticClass:"table ns-table w-full text-sm "},[s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.selectCustomer()}}},[e._v(e._s(e.__("Customer"))+": "+e._s(e.customerName))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[e._v(e._s(e.__("Sub Total")))]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[e._v(e._s(e._f("currency")(e.order.subtotal)))])]),e._v(" "),e.order.coupons.length>0?s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}}),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.selectCoupon()}}},[e._v(e._s(e.__("Coupons")))])]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[e._v(e._s(e._f("currency")(e.summarizeCoupons())))])]):e._e(),e._v(" "),s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openOrderType()}}},[e._v(e._s(e.__("Type"))+": "+e._s(e.selectedType))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("span",[e._v(e._s(e.__("Discount")))]),e._v(" "),"percentage"===e.order.discount_type?s("span",[e._v("("+e._s(e.order.discount_percentage)+"%)")]):e._e(),e._v(" "),"flat"===e.order.discount_type?s("span",[e._v("("+e._s(e.__("Flat"))+")")]):e._e()]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openDiscountPopup(e.order,"cart")}}},[e._v(e._s(e._f("currency")(e.order.discount)))])])]),e._v(" "),e.order.type&&"delivery"===e.order.type.identifier?s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}}),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openShippingPopup()}}},[e._v(e._s(e.__("Shipping")))])]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[e._v(e._s(e._f("currency")(e.order.shipping)))])]):e._e(),e._v(" "),s("tr",{staticClass:"success"},[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[e.order&&"exclusive"===e.options.ns_pos_tax_type||e.order&&"inclusive"===e.options.ns_pos_tax_type?["yes"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax Included"))+": "+e._s(e._f("currency")(e.order.total_tax_value+e.order.products_tax_value)))]):"no"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax"))+": "+e._s(e._f("currency")(e.order.total_tax_value)))]):e._e()]:e._e()],2),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[e._v(e._s(e.__("Total")))]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[e._v(e._s(e._f("currency")(e.order.total)))])])]):e._e(),e._v(" "),"cart"===e.visibleSection?s("table",{staticClass:"table ns-table w-full text-sm"},[s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.selectCustomer()}}},[e._v(e._s(e.__("Customer"))+": "+e._s(e.customerName))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("div",{staticClass:"flex justify-between"},[s("span",[e._v(e._s(e.__("Sub Total")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.subtotal)))])])])]),e._v(" "),e.order.coupons.length>0?s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}}),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.selectCoupon()}}},[e._v(e._s(e.__("Coupons")))])]),e._v(" "),s("td",{staticClass:"border p-2 text-right",attrs:{width:"200"}},[e._v(e._s(e._f("currency")(e.summarizeCoupons())))])]):e._e(),e._v(" "),s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openOrderType()}}},[e._v(e._s(e.__("Type"))+": "+e._s(e.selectedType))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("div",{staticClass:"flex justify-between items-center"},[s("p",[s("span",[e._v(e._s(e.__("Discount")))]),e._v(" "),"percentage"===e.order.discount_type?s("span",[e._v("("+e._s(e.order.discount_percentage)+"%)")]):e._e(),e._v(" "),"flat"===e.order.discount_type?s("span",[e._v("("+e._s(e.__("Flat"))+")")]):e._e()]),e._v(" "),s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openDiscountPopup(e.order,"cart")}}},[e._v(e._s(e._f("currency")(e.order.discount)))])])])]),e._v(" "),e.order.type&&"delivery"===e.order.type.identifier?s("tr",[s("td",{staticClass:"border p-2",attrs:{width:"200"}}),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openShippingPopup()}}},[e._v(e._s(e.__("Shipping")))]),e._v(" "),s("span")])]):e._e(),e._v(" "),s("tr",{staticClass:"success"},[s("td",{staticClass:"border p-2",attrs:{width:"200"}},[e.order&&"exclusive"===e.options.ns_pos_tax_type?["yes"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax"))+": "+e._s(e._f("currency")(e.order.total_tax_value)))]):"no"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax Inclusive"))+": "+e._s(e._f("currency")(e.order.total_tax_value+e.order.products_tax_value)))]):e._e()]:e.order&&"inclusive"===e.options.ns_pos_tax_type?["yes"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax Included"))+": "+e._s(e._f("currency")(e.order.total_tax_value)))]):"no"===e.options.ns_pos_price_with_tax?s("a",{staticClass:"cursor-pointer outline-none border-dashed py-1 border-b border-info-primary text-sm",on:{click:function(t){return e.openTaxSummary()}}},[e._v(e._s(e.__("Tax Included"))+": "+e._s(e._f("currency")(e.order.total_tax_value+e.order.products_tax_value)))]):e._e()]:e._e()],2),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"200"}},[s("div",{staticClass:"flex justify-between w-full"},[s("span",[e._v(e._s(e.__("Total")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.total)))])])])])]):e._e()]),e._v(" "),s("div",{staticClass:"h-16 flex flex-shrink-0 border-t border-box-edge",attrs:{id:"cart-bottom-buttons"}},[s("div",{staticClass:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-green-500 text-white hover:bg-green-600 border-r border-green-600 flex-auto",attrs:{id:"pay-button"},on:{click:function(t){return e.payOrder()}}},[s("i",{staticClass:"mr-2 text-2xl lg:text-xl las la-cash-register"}),e._v(" "),s("span",{staticClass:"text-lg hidden md:inline lg:text-2xl"},[e._v(e._s(e.__("Pay")))])]),e._v(" "),s("div",{staticClass:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-blue-500 text-white border-r hover:bg-blue-600 border-blue-600 flex-auto",attrs:{id:"hold-button"},on:{click:function(t){return e.holdOrder()}}},[s("i",{staticClass:"mr-2 text-2xl lg:text-xl las la-pause"}),e._v(" "),s("span",{staticClass:"text-lg hidden md:inline lg:text-2xl"},[e._v(e._s(e.__("Hold")))])]),e._v(" "),s("div",{staticClass:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-white border-r border-box-edge hover:bg-indigo-100 flex-auto text-gray-700",attrs:{id:"discount-button"},on:{click:function(t){return e.openDiscountPopup(e.order,"cart")}}},[s("i",{staticClass:"mr-2 text-2xl lg:text-xl las la-percent"}),e._v(" "),s("span",{staticClass:"text-lg hidden md:inline lg:text-2xl"},[e._v(e._s(e.__("Discount")))])]),e._v(" "),s("div",{staticClass:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-red-500 text-white border-box-edge hover:bg-red-600 flex-auto",attrs:{id:"void-button"},on:{click:function(t){return e.voidOngoingOrder(e.order)}}},[s("i",{staticClass:"mr-2 text-2xl lg:text-xl las la-trash"}),e._v(" "),s("span",{staticClass:"text-lg hidden md:inline lg:text-2xl"},[e._v(e._s(e.__("Void")))])])])])])])}),[],!1,null,null,null).exports},3613:(e,t,s)=>{s.d(t,{Z:()=>J});var r=s(7757),n=s.n(r),i=s(9671),o=s(1356),a=s(2277),c=s(7266),l=s(8603),u=s(7389);function d(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function p(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?d(Object(s),!0).forEach((function(t){_(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function _(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const f={mounted:function(){this.popuCloser(),this.loadFields(),this.product=this.$popupParams.product},data:function(){return{formValidation:new c.Z,fields:[],product:null}},methods:{__:u.__,popuCloser:l.Z,close:function(){this.$popupParams.reject(!1),this.$popup.close()},addProduct:function(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){var e=this.formValidation.extractFields(this.fields),t=p(p({},this.product),e);return this.$popupParams.resolve(t),console.log(e,t),this.close()}i.kX.error((0,u.__)("The form is not valid.")).subscribe()},loadFields:function(){var e=this;i.ih.get("/api/nexopos/v4/fields/ns.refund-product").subscribe((function(t){e.fields=e.formValidation.createFields(t),e.fields.forEach((function(t){t.value=e.product[t.name]||""}))}))}}};var v=s(1900);const m=(0,v.Z)(f,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-xl ns-box w-95vw md:w-3/5-screen lg:w-3/7-screen h-95vh md:h-3/5-screen lg:h-3/7-screen overflow-hidden flex flex-col"},[s("div",{staticClass:"p-2 flex justify-between border-b ns-box-header items-center"},[s("h3",{staticClass:"text-semibold"},[e._v(e._s(e.__("Products")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"flex-auto overflow-y-auto relative ns-scrollbar"},[s("div",{staticClass:"p-2"},e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),0===e.fields.length?s("div",{staticClass:"h-full w-full flex items-center justify-center"},[s("ns-spinner")],1):e._e()]),e._v(" "),s("div",{staticClass:"p-2 flex justify-between items-center border-t ns-box-body"},[s("div"),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.addProduct()}}},[e._v(e._s(e.__("Add Product")))])],1)])])}),[],!1,null,null,null).exports;var b=s(6386),h=s(4864);const y={components:{nsNumpad:h.Z},data:function(){return{product:null,seeValue:0,availableQuantity:0}},mounted:function(){this.product=this.$popupParams.product,this.availableQuantity=this.$popupParams.availableQuantity,this.seeValue=this.product.quantity},methods:{__:u.__,popupResolver:b.Z,close:function(){this.$popupParams.reject(!1),this.$popup.close()},setChangedValue:function(e){this.seeValue=e},updateQuantity:function(e){if(e>this.availableQuantity)return i.kX.error("Unable to proceed as the quantity provided is exceed the available quantity.").subscribe();this.product.quantity=parseFloat(e),this.$popupParams.resolve(this.product),this.$popup.close()}}};const x=(0,v.Z)(y,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-xl ns-box overflow-hidden w-95vw md:w-4/6-screen lg:w-3/7-screen"},[s("div",{staticClass:"p-2 flex justify-between ns-box-header"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.__("Quantity")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),e.product?s("div",{staticClass:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},[s("span",[e._v(e._s(e.seeValue))]),e._v(" "),s("span",{staticClass:"text-primary text-sm"},[e._v("("+e._s(e.availableQuantity)+" "+e._s(e.__("available"))+")")])]):e._e(),e._v(" "),e.product?s("div",{staticClass:"flex-auto overflow-y-auto p-2"},[s("ns-numpad",{attrs:{value:e.product.quantity},on:{next:function(t){return e.updateQuantity(t)},changed:function(t){return e.setChangedValue(t)}}})],1):e._e()])}),[],!1,null,null,null).exports;var w=s(3296),C=s(3601),g=s(2242),P=s(1703);function k(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function S(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?k(Object(s),!0).forEach((function(t){O(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function O(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const j={components:{nsNumpad:h.Z},props:["order"],computed:{screenValue:function(){var e=parseInt(1+new Array(parseInt(ns.currency.ns_currency_precision)).fill("").map((function(e){return 0})).join(""));return this.screen/e},total:function(){return this.refundables.length>0?this.refundables.map((function(e){return parseFloat(e.unit_price)*parseFloat(e.quantity)})).reduce((function(e,t){return e+t}))+this.shippingFees:0+this.shippingFees},shippingFees:function(){return this.refundShipping?this.order.shipping:0}},data:function(){return{isSubmitting:!1,formValidation:new c.Z,refundables:[],paymentOptions:[],paymentField:[],print:new P.Z({settings:systemSettings,options:systemOptions,type:"refund"}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map((function(e){return{label:"".concat(e.name," - ").concat(e.unit.name," (x").concat(e.quantity,")"),value:e.id}})),validation:"required",name:"product_id",label:(0,u.__)("Product"),description:(0,u.__)("Select the product to perform a refund.")}]}},methods:{__:u.__,updateScreen:function(e){this.screen=e},toggleRefundShipping:function(e){this.refundShipping=e,this.refundShipping},proceedPayment:function(){var e=this;return!1===this.selectedPaymentGateway?i.kX.error((0,u.__)("Please select a payment gateway before proceeding.")).subscribe():0===this.total?i.kX.error((0,u.__)("There is nothing to refund.")).subscribe():0===this.screenValue?i.kX.error((0,u.__)("Please provide a valid payment amount.")).subscribe():void g.G.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("The refund will be made on the current order."),onAction:function(t){t&&e.doProceed()}})},doProceed:function(){var e=this,t={products:this.refundables,total:this.screenValue,payment:this.selectedPaymentGateway,refund_shipping:this.refundShipping};this.isSubmitting=!0,i.ih.post("/api/nexopos/v4/orders/".concat(this.order.id,"/refund"),t).subscribe({next:function(t){e.isSubmitting=!1,e.$emit("changed",!0),"refunded"===t.data.order.payment_status&&e.$emit("loadTab","details"),e.print.printOrder(t.data.orderRefund.id),i.kX.success(t.message).subscribe()},error:function(t){e.isSubmitting=!1,i.kX.error(t.message).subscribe()}})},addProduct:function(){var e=this;if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return i.kX.error((0,u.__)("Please select a product before proceeding.")).subscribe();var t=this.formValidation.extractFields(this.selectFields),s=this.order.products.filter((function(e){return e.id===t.product_id})),r=this.refundables.filter((function(e){return e.id===t.product_id}));if(r.length>0){var n=r.map((function(e){return parseInt(e.quantity)})).reduce((function(e,t){return e+t}));if(n===s[0].quantity)return i.kX.error((0,u.__)("Not enough quantity to proceed.")).subscribe()}if(0===s[0].quantity)return i.kX.error((0,u.__)("Not enough quantity to proceed.")).subscribe();var o=S(S({},s[0]),{condition:"",description:""});new Promise((function(e,t){g.G.show(m,{resolve:e,reject:t,product:o})})).then((function(t){t.quantity=e.getProductOriginalQuantity(t.id)-e.getProductUsedQuantity(t.id),e.refundables.push(t)}),(function(e){return e}))},getProductOriginalQuantity:function(e){var t=this.order.products.filter((function(t){return t.id===e}));return t.length>0?t.map((function(e){return parseFloat(e.quantity)})).reduce((function(e,t){return e+t})):0},getProductUsedQuantity:function(e){var t=this.refundables.filter((function(t){return t.id===e}));return t.length>0?t.map((function(e){return parseFloat(e.quantity)})).reduce((function(e,t){return e+t})):0},openSettings:function(e){var t=this;new Promise((function(t,s){g.G.show(m,{resolve:t,reject:s,product:e})})).then((function(s){var r=t.refundables.indexOf(e);t.$set(t.refundables,r,s)}),(function(e){return e}))},selectPaymentGateway:function(){var e=this;new Promise((function(t,s){g.G.show(w.Z,S({resolve:t,reject:s,value:[e.selectedPaymentOption]},e.paymentField[0]))})).then((function(t){e.selectedPaymentGateway=t[0]}),(function(e){return e}))},changeQuantity:function(e){var t=this;new Promise((function(s,r){var n=t.getProductOriginalQuantity(e.id)-t.getProductUsedQuantity(e.id)+parseFloat(e.quantity);g.G.show(x,{resolve:s,reject:r,product:e,availableQuantity:n})})).then((function(s){if(s.quantity>t.getProductUsedQuantity(e.id)-e.quantity){var r=t.refundables.indexOf(e);t.$set(t.refundables,r,s)}}))},deleteProduct:function(e){var t=this;new Promise((function(s,r){g.G.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("Would you like to delete this product ?"),onAction:function(s){if(s){var r=t.refundables.indexOf(e);t.refundables.splice(r,1)}}})}))}},mounted:function(){var e=this;this.selectFields=this.formValidation.createFields(this.selectFields),i.ih.get("/api/nexopos/v4/orders/payments").subscribe((function(t){e.paymentField=t}))}};const $=(0,v.Z)(j,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"-m-4 flex-auto flex flex-wrap relative"},[e.isSubmitting?s("div",{staticClass:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},[s("ns-spinner")],1):e._e(),e._v(" "),s("div",{staticClass:"px-4 w-full lg:w-1/2"},[s("h3",{staticClass:"py-2 border-b-2 text-primary border-info-primary"},[e._v(e._s(e.__("Refund With Products")))]),e._v(" "),s("div",{staticClass:"my-2"},[s("ul",[s("li",{staticClass:"border-b border-info-primary flex justify-between items-center mb-2"},[s("div",{staticClass:"flex-auto flex-col flex"},[s("div",{staticClass:"p-2 flex"},e._l(e.selectFields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),s("div",{staticClass:"flex justify-between p-2"},[s("div",{staticClass:"flex items-center text-primary"},[e.order.shipping>0?s("span",{staticClass:"mr-2"},[e._v(e._s(e.__("Refund Shipping")))]):e._e(),e._v(" "),e.order.shipping>0?s("ns-checkbox",{attrs:{checked:e.refundShipping},on:{change:function(t){return e.toggleRefundShipping(t)}}}):e._e()],1),e._v(" "),s("div",[s("button",{staticClass:"border rounded-full px-2 py-1 ns-inset-button info",on:{click:function(t){return e.addProduct()}}},[e._v(e._s(e.__("Add Product")))])])])])]),e._v(" "),s("li",[s("h4",{staticClass:"py-1 border-b-2 text-primary border-info-primary"},[e._v(e._s(e.__("Products")))])]),e._v(" "),e._l(e.refundables,(function(t){return s("li",{key:t.id,staticClass:"elevation-surface border flex justify-between items-center mb-2"},[s("div",{staticClass:"px-2 text-primary flex justify-between flex-auto"},[s("div",{staticClass:"flex flex-col"},[s("p",{staticClass:"py-2"},[s("span",[e._v(e._s(t.name))]),e._v(" "),"damaged"===t.condition?s("span",{staticClass:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},[e._v(e._s(e.__("Damaged")))]):e._e(),e._v(" "),"unspoiled"===t.condition?s("span",{staticClass:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},[e._v(e._s(e.__("Unspoiled")))]):e._e()]),e._v(" "),s("small",[e._v(e._s(t.unit.name))])]),e._v(" "),s("div",{staticClass:"flex items-center justify-center"},[s("span",{staticClass:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},[e._v(e._s(e._f("currency")(t.unit_price*t.quantity)))])])]),e._v(" "),s("div",{staticClass:"flex"},[s("p",{staticClass:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center",on:{click:function(s){return e.openSettings(t)}}},[s("i",{staticClass:"las la-cog text-xl"})]),e._v(" "),s("p",{staticClass:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center",on:{click:function(s){return e.deleteProduct(t)}}},[s("i",{staticClass:"las la-trash"})]),e._v(" "),s("p",{staticClass:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center",on:{click:function(s){return e.changeQuantity(t)}}},[e._v(e._s(t.quantity))])])])}))],2)])]),e._v(" "),s("div",{staticClass:"px-4 w-full lg:w-1/2"},[s("h3",{staticClass:"py-2 border-b-2 text-primary border-info-primary"},[e._v(e._s(e.__("Summary")))]),e._v(" "),s("div",{staticClass:"py-2"},[s("div",{staticClass:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},[s("span",[e._v(e._s(e.__("Total")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.total)))])]),e._v(" "),s("div",{staticClass:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},[s("span",[e._v(e._s(e.__("Paid")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.tendered)))])]),e._v(" "),s("div",{staticClass:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer",on:{click:function(t){return e.selectPaymentGateway()}}},[s("span",[e._v(e._s(e.__("Payment Gateway")))]),e._v(" "),s("span",[e._v(e._s(e.selectedPaymentGateway?e.selectedPaymentGateway.label:"N/A"))])]),e._v(" "),s("div",{staticClass:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},[s("span",[e._v(e._s(e.__("Screen")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.screenValue)))])]),e._v(" "),s("div",[s("ns-numpad",{attrs:{currency:!0,value:e.screen},on:{changed:function(t){return e.updateScreen(t)},next:function(t){return e.proceedPayment(t)}}})],1)])])])}),[],!1,null,null,null).exports;var T=s(9089);function V(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,s,r;return t=e,(s=[{key:"getTypeLabel",value:function(e){var t=typeLabels.filter((function(t){return t.value===e}));return t.length>0?t[0].label:(0,u.__)("Unknown Status")}},{key:"getDeliveryStatus",value:function(e){var t=deliveryStatuses.filter((function(t){return t.value===e}));return t.length>0?t[0].label:(0,u.__)("Unknown Status")}},{key:"getProcessingStatus",value:function(e){var t=processingStatuses.filter((function(t){return t.value===e}));return t.length>0?t[0].label:(0,u.__)("Unknown Status")}},{key:"getPaymentStatus",value:function(e){var t=paymentLabels.filter((function(t){return t.value===e}));return t.length>0?t[0].label:(0,u.__)("Unknown Status")}}])&&V(t.prototype,s),r&&V(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Z(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function D(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(s),!0).forEach((function(t){F(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Z(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function F(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const E={props:["order"],data:function(){return{labels:new A,validation:new c.Z,inputValue:0,fields:[],paymentTypes}},computed:{paymentsLabels:function(){var e=new Object;return this.paymentTypes.forEach((function(t){e[t.value]=t.label})),e}},methods:{__:u.__,updateValue:function(e){this.inputValue=e},loadPaymentFields:function(){var e=this;i.ih.get("/api/nexopos/v4/orders/payments").subscribe((function(t){e.fields=e.validation.createFields(t)}))},submitPayment:function(e){var t=this;if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return i.kX.error((0,u.__)("Unable to proceed the form is not valid")).subscribe();if(0==parseFloat(e))return i.kX.error((0,u.__)("Please provide a valid value")).subscribe();e=parseFloat(e);var s=D(D({},this.validation.extractFields(this.fields)),{},{value:e});Popup.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",this.$options.filters.currency(e)),onAction:function(e){e&&i.ih.post("/api/nexopos/v4/orders/".concat(t.order.id,"/payments"),s).subscribe((function(e){i.kX.success(e.message).subscribe(),t.$emit("changed")}),(function(e){i.kX.error(e.message).subscribe()}))}})}},components:{nsNumpad:h.Z},mounted:function(){this.loadPaymentFields()}};const R=(0,v.Z)(E,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{},[s("div",{staticClass:"flex -mx-4 flex-wrap"},[s("div",{staticClass:"px-2 w-full md:w-1/2"},[s("div",{staticClass:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},[s("span",[e._v(e._s(e.__("Total")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.total)))])])]),e._v(" "),s("div",{staticClass:"px-2 w-full md:w-1/2"},[s("div",{staticClass:"my-1 h-12 py-1 px-2 flex justify-between items-center  elevation-surface success border text-xl font-bold"},[s("span",[e._v(e._s(e.__("Paid")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.tendered)))])])]),e._v(" "),s("div",{staticClass:"px-2 w-full md:w-1/2"},[s("div",{staticClass:"my-1 h-12 py-1 px-2 flex justify-between items-center  elevation-surface error border text-xl font-bold"},[s("span",[e._v(e._s(e.__("Unpaid")))]),e._v(" "),e.order.total-e.order.tendered>0?s("span",[e._v(e._s(e._f("currency")(e.order.total-e.order.tendered)))]):e._e(),e._v(" "),e.order.total-e.order.tendered<=0?s("span",[e._v(e._s(e._f("currency")(0)))]):e._e()])]),e._v(" "),s("div",{staticClass:"px-2 w-full md:w-1/2"},[s("div",{staticClass:"my-1 h-12 py-1 px-2 flex justify-between items-center  elevation-surface warning border text-xl font-bold"},[s("span",[e._v(e._s(e.__("Customer Account")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.order.customer.account_amount)))])])])]),e._v(" "),s("div",{staticClass:"flex -mx-4 flex-wrap"},[s("div",{staticClass:"px-2 w-full mb-4 md:w-1/2"},["paid"!==e.order.payment_status?s("div",[s("h3",{staticClass:"font-semibold border-b-2 border-info-primary py-2"},[e._v("\n                    "+e._s(e.__("Payment"))+"\n                ")]),e._v(" "),s("div",{staticClass:"py-2"},[e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),e._v(" "),s("div",{staticClass:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},[e._v("\n                        "+e._s(e._f("currency")(e.inputValue))+"\n                    ")]),e._v(" "),s("ns-numpad",{attrs:{floating:!0,value:e.inputValue},on:{next:function(t){return e.submitPayment(t)},changed:function(t){return e.updateValue(t)}}})],2)]):e._e(),e._v(" "),"paid"===e.order.payment_status?s("div",{staticClass:"flex items-center justify-center h-full"},[s("h3",{staticClass:"text-primary font-semibold"},[e._v(e._s(e.__("No payment possible for paid order.")))])]):e._e()]),e._v(" "),s("div",{staticClass:"px-2 w-full mb-4 md:w-1/2"},[s("h3",{staticClass:"font-semibold border-b-2 border-info-primary py-2 mb-2"},[e._v("\n                "+e._s(e.__("Payment History"))+"\n            ")]),e._v(" "),s("ul",e._l(e.order.payments,(function(t){return s("li",{key:t.id,staticClass:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[s("span",[e._v(e._s(e.paymentsLabels[t.identifier]||e.__("Unknown")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(t.value)))])])})),0)])])])}),[],!1,null,null,null).exports;var q=s(3306);const N={props:["order"],data:function(){return{processingStatuses,deliveryStatuses,labels:new A,showProcessingSelect:!1,showDeliverySelect:!1}},mounted:function(){},methods:{__:u.__,submitProcessingChange:function(){var e=this;g.G.show(C.default,{title:(0,u.__)("Would you proceed ?"),message:(0,u.__)("The processing status of the order will be changed. Please confirm your action."),onAction:function(t){t&&i.ih.post("/api/nexopos/v4/orders/".concat(e.order.id,"/processing"),{process_status:e.order.process_status}).subscribe({next:function(t){e.showProcessingSelect=!1,i.kX.success(t.message).subscribe()},error:function(e){i.kX.error(e.message||(0,u.__)("Unexpected error occured.")).subscribe()}})}})},openRefunds:function(){var e=this;try{new Promise((function(t,s){var r=e.order;g.G.show(q.Z,{order:r,resolve:t,reject:s})}))}catch(e){}},submitDeliveryStatus:function(){var e=this;g.G.show(C.default,{title:(0,u.__)("Would you proceed ?"),message:(0,u.__)("The delivery status of the order will be changed. Please confirm your action."),onAction:function(t){t&&i.ih.post("/api/nexopos/v4/orders/".concat(e.order.id,"/delivery"),{delivery_status:e.order.delivery_status}).subscribe({next:function(t){e.showDeliverySelect=!1,i.kX.success(t.message).subscribe()},error:function(e){i.kX.error(e.message||(0,u.__)("Unexpected error occured.")).subscribe()}})}})}}};const X=(0,v.Z)(N,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"-mx-4 flex flex-wrap"},[s("div",{staticClass:"flex-auto"},[s("div",{staticClass:"w-full mb-2 flex-wrap flex"},[s("div",{staticClass:"w-full mb-2 px-4"},[s("h3",{staticClass:"font-semibold text-secondary pb-2 border-b border-info-primary"},[e._v(e._s(e.__("Payment Summary")))])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"elevation-surface border p-2 flex justify-between items-start"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[e._v(e._s(e.__("Sub Total")))])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e._f("currency")(e.order.subtotal)))])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start ns-notice error"},[s("div",[s("h4",{staticClass:"text-semibold"},[s("span",{staticClass:"text-white"},[e._v(e._s(e.__("Discount")))]),e._v(" "),"percentage"===e.order.discount_type?s("span",{staticClass:"text-white ml-1"},[e._v("("+e._s(e.order.discount_percentage)+"%)")]):e._e(),e._v(" "),"flat"===e.order.discount_type?s("span",{staticClass:"text-white ml-1"},[e._v("(Flat)")]):e._e()])]),e._v(" "),s("div",{staticClass:"font-semibold"},[s("span",[e._v(e._s(e._f("currency")(e.order.discount)))])])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[e._v(e._s(e.__("Shipping")))])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e._f("currency")(e.order.shipping)))])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start ns-notice error"},[s("div",[s("h4",{staticClass:"text-semibold"},[e._v("\n                            "+e._s(e.__("Coupons"))+"\n                        ")])]),e._v(" "),s("div",{staticClass:"font-semibold"},[s("span",[e._v(e._s(e._f("currency")(e.order.total_coupons)))])])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start ns-notice info"},[s("div",[s("h4",{staticClass:"text-semibold"},[e._v(e._s(e.__("Total")))])]),e._v(" "),s("div",{staticClass:"font-semibold"},[e._v(e._s(e._f("currency")(e.order.total)))])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start ns-notice warning"},[s("div",[s("h4",{staticClass:"text-semibold"},[e._v(e._s(e.__("Taxes")))])]),e._v(" "),s("div",{staticClass:"font-semibold"},[e._v(e._s(e._f("currency")(e.order.tax_value)))])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start text-primary elevation-surface error border"},[s("div",[s("h4",{staticClass:"text-semibold"},[e._v(e._s(e.__("Change")))])]),e._v(" "),s("div",{staticClass:"font-semibold"},[e._v(e._s(e._f("currency")(e.order.change)))])])]),e._v(" "),s("div",{staticClass:"mb-2 w-full md:w-1/2 px-4"},[s("div",{staticClass:"p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold"},[e._v(e._s(e.__("Paid")))])]),e._v(" "),s("div",{staticClass:"font-semibold"},[e._v(e._s(e._f("currency")(e.order.tendered)))])])])])]),e._v(" "),s("div",{staticClass:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},[s("div",{staticClass:"mb-2"},[s("h3",{staticClass:"font-semibold text-secondary pb-2 border-b border-info-primary"},[e._v(e._s(e.__("Order Status")))])]),e._v(" "),s("div",{staticClass:"mb-2 p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[s("span",[e._v(e._s(e.__("Customer")))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e.order.nexopos_customers_name))])]),e._v(" "),s("div",{staticClass:"mb-2 p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[s("span",[e._v(e._s(e.__("Type")))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e.labels.getTypeLabel(e.order.type)))])]),e._v(" "),s("div",{staticClass:"mb-2 p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[s("span",[e._v(e._s(e.__("Delivery Status")))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},[s("div",{staticClass:"w-full text-center"},[e.showDeliverySelect?e._e():s("span",{staticClass:"font-semibold text-secondary border-b border-info-primary cursor-pointer border-dashed",on:{click:function(t){e.showDeliverySelect=!0}}},[e._v(e._s(e.labels.getDeliveryStatus(e.order.delivery_status)))])]),e._v(" "),e.showDeliverySelect?s("div",{staticClass:"flex-auto flex"},[s("div",{staticClass:"ns-select flex items-center justify-center"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.order.delivery_status,expression:"order.delivery_status"}],ref:"process_status",staticClass:"flex-auto border-info-primary rounded-lg",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.order,"delivery_status",t.target.multiple?s:s[0])}}},e._l(e.deliveryStatuses,(function(t,r){return s("option",{key:r,domProps:{value:t.value}},[e._v(e._s(t.label))])})),0)]),e._v(" "),s("div",{staticClass:"pl-2 flex"},[s("ns-close-button",{on:{click:function(t){e.showDeliverySelect=!1}}}),e._v(" "),s("button",{staticClass:"bg-success-primary text-white rounded-full px-2 py-1",on:{click:function(t){return e.submitDeliveryStatus(e.order)}}},[e._v(e._s(e.__("Save")))])],1)]):e._e()])]),e._v(" "),s("div",{staticClass:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[s("span",[e._v(e._s(e.__("Processing Status")))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},[s("div",{staticClass:"w-full text-center"},[e.showProcessingSelect?e._e():s("span",{staticClass:"border-b border-info-primary cursor-pointer border-dashed",on:{click:function(t){e.showProcessingSelect=!0}}},[e._v(e._s(e.labels.getProcessingStatus(e.order.process_status)))])]),e._v(" "),e.showProcessingSelect?s("div",{staticClass:"flex-auto flex"},[s("div",{staticClass:"ns-select flex items-center justify-center"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.order.process_status,expression:"order.process_status"}],ref:"process_status",staticClass:"flex-auto border-info-primary rounded-lg",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.order,"process_status",t.target.multiple?s:s[0])}}},e._l(e.processingStatuses,(function(t,r){return s("option",{key:r,domProps:{value:t.value}},[e._v(e._s(t.label))])})),0)]),e._v(" "),s("div",{staticClass:"pl-2 flex"},[s("ns-close-button",{on:{click:function(t){e.showProcessingSelect=!1}}}),e._v(" "),s("button",{staticClass:"bg-success-primary text-white rounded-full px-2 py-1",on:{click:function(t){return e.submitProcessingChange(e.order)}}},[e._v(e._s(e.__("Save")))])],1)]):e._e()])]),e._v(" "),s("div",{staticClass:"mb-2 p-2 flex justify-between items-start elevation-surface border"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[s("span",[e._v(e._s(e.__("Payment Status")))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e.labels.getPaymentStatus(e.order.payment_status)))])])]),e._v(" "),s("div",{staticClass:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},[s("div",{staticClass:"mb-2"},[s("h3",{staticClass:"font-semibold text-secondary pb-2 border-b border-info-primary"},[e._v(e._s(e.__("Products")))])]),e._v(" "),e._l(e.order.products,(function(t){return s("div",{key:t.id,staticClass:"p-2 flex justify-between items-start elevation-surface border mb-6"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[e._v(e._s(t.name)+" (x"+e._s(t.quantity)+")")]),e._v(" "),s("p",{staticClass:"text-secondary text-sm"},[e._v(e._s(t.unit.name||"N/A"))])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e._f("currency")(t.total_price)))])])})),e._v(" "),s("div",{staticClass:"mb-2"},[s("h3",{staticClass:"font-semibold text-secondary pb-2 border-b border-info-primary flex justify-between"},[s("span",[e._v(e._s(e.__("Refunded Products")))]),e._v(" "),s("a",{staticClass:"border-b border-info-primary border-dashed",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.openRefunds()}}},[e._v(e._s(e.__("All Refunds")))])])]),e._v(" "),e._l(e.order.refunded_products,(function(t){return s("div",{key:t.id,staticClass:"p-2 flex justify-between items-start elevation-surface border  mb-6"},[s("div",[s("h4",{staticClass:"text-semibold text-primary"},[e._v(e._s(t.order_product.name)+" (x"+e._s(t.quantity)+")")]),e._v(" "),s("p",{staticClass:"text-secondary text-sm"},[e._v(e._s(t.unit.name||"N/A")+" | "),s("span",{staticClass:"rounded-full px-2",class:"damaged"===t.condition?"bg-error-tertiary text-white":"bg-info-tertiary text-white"},[e._v(e._s(t.condition))])])]),e._v(" "),s("div",{staticClass:"font-semibold text-secondary"},[e._v(e._s(e._f("currency")(t.total_price)))])])}))],2)])}),[],!1,null,null,null).exports;function I(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function H(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const G={name:"ns-order-instalments-payment",components:{nsNotice:s(7975).nsNotice},data:function(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:(0,u.__)("Select the payment type that must apply to the current order."),label:(0,u.__)("Payment Type"),validation:"required",options:paymentTypes}],print:new P.Z({settings:systemSettings,options:systemOptions,type:"payment"}),validation:new c.Z,order:null,instalment:null}},methods:{__:u.__,popupResolver:b.Z,popupCloser:l.Z,close:function(){this.popupResolver(!1)},updateInstalmentAsDue:function(e){var t=this;nsHttpClient.put("/api/nexopos/v4/orders/".concat(this.order.id,"/instalments/").concat(this.instalment.id,"/"),{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:function(e){t.submitPayment()},error:function(e){i.kX.error(e.message||(0,u.__)("An unexpected error has occured")).subscribe()}})},submitPayment:function(){var e=this;if(!this.validation.validateFields(this.fields))return i.kX.error(__m("The form is not valid.")).subcribe();nsHttpClient.post("/api/nexopos/v4/orders/".concat(this.order.id,"/instalments/").concat(this.instalment.id,"/pay"),function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?I(Object(s),!0).forEach((function(t){H(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},this.validation.extractFields(this.fields))).subscribe({next:function(t){e.popupResolver(!0),e.print.printOrder(t.data.payment.id),i.kX.success(t.message).subscribe()},error:function(t){"failed"===t.status&&Popup.show(C.default,{title:(0,u.__)("Update Instalment Date"),message:(0,u.__)("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:function(t){t&&e.updateInstalmentAsDue(e.instalment)}}),i.kX.error(t.message||(0,u.__)("An unexpected error has occured")).subscribe()}})}},mounted:function(){this.popupCloser(),this.order=this.$popupParams.order,this.instalment=this.$popupParams.instalment,this.fields=this.validation.createFields(this.fields)}};const Q=(0,v.Z)(G,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg ns-box w-95vw md:w-2/3-screen lg:w-1/3-screen"},[s("div",{staticClass:"p-2 flex justify-between border-b items-center"},[s("h3",[e._v(e._s(e.__("Payment Method")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 ns-box-body"},[s("ns-notice",{staticClass:"py-2 p-4 text-center border text-primary rounded-lg",attrs:{color:"info"}},[e._v(e._s(e.__("Before submitting the payment, choose the payment type used for that order.")))]),e._v(" "),s("br"),e._v(" "),e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})}))],2),e._v(" "),s("div",{staticClass:"border-t ns-box-footer p-2 flex justify-end"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.submitPayment()}}},[e._v(e._s(e.__("Submit Payment")))])],1)])}),[],!1,null,null,null).exports;function L(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}const U={props:["order"],name:"ns-order-instalments",data:function(){return{labels:new A,original:[],instalments:[],print:new P.Z({settings:systemSettings,options:systemOptions,type:"payment"})}},mounted:function(){this.loadInstalments()},computed:{totalInstalments:function(){return this.instalments.length>0?this.instalments.map((function(e){return e.amount})).reduce((function(e,t){return parseFloat(e)+parseFloat(t)})):0}},methods:{__:u.__,loadInstalments:function(){var e=this;i.ih.get("/api/nexopos/v4/orders/".concat(this.order.id,"/instalments")).subscribe((function(t){e.original=t,e.instalments=t.map((function(e){return e.price_clicked=!1,e.date_clicked=!1,e.date=moment(e.date).format("YYYY-MM-DD"),e}))}))},showReceipt:function(e){if(null===e.payment_id)return i.kX.error((0,u.__)("This instalment doesn't have any payment attached.")).subscribe();this.print.printOrder(e.payment_id)},addInstalment:function(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment:function(e){var t=this;Popup.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("Would you like to create this instalment ?"),onAction:function(s){s&&i.ih.post("/api/nexopos/v4/orders/".concat(t.order.id,"/instalments"),{instalment:e}).subscribe({next:function(e){t.loadInstalments(),i.kX.success(e.message).subscribe()},error:function(e){i.kX.error(e.message||(0,u.__)("An unexpected error has occured")).subscribe()}})}})},deleteInstalment:function(e){var t=this;Popup.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("Would you like to delete this instalment ?"),onAction:function(s){s&&i.ih.delete("/api/nexopos/v4/orders/".concat(t.order.id,"/instalments/").concat(e.id)).subscribe({next:function(s){var r=t.instalments.indexOf(e);t.instalments.splice(r,1),i.kX.success(s.message).subscribe()},error:function(e){i.kX.error(e.message||(0,u.__)("An unexpected error has occured")).subscribe()}})}})},markAsPaid:function(e){var t,s=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,r){Popup.show(Q,{order:s.order,instalment:e,resolve:t,reject:r})}));case 3:t.sent,s.loadInstalments(),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})),function(){var e=this,s=arguments;return new Promise((function(r,n){var i=t.apply(e,s);function o(e){L(i,r,n,o,a,"next",e)}function a(e){L(i,r,n,o,a,"throw",e)}o(void 0)}))})()},togglePriceEdition:function(e){var t=this;e.paid||(e.price_clicked=!e.price_clicked,this.$forceUpdate(),e.price_clicked&&setTimeout((function(){t.$refs.amount[0].select()}),100))},updateInstalment:function(e){var t=this;Popup.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("Would you like to update that instalment ?"),onAction:function(s){s&&i.ih.put("/api/nexopos/v4/orders/".concat(t.order.id,"/instalments/").concat(e.id),{instalment:e}).subscribe({next:function(e){i.kX.success(e.message).subscribe()},error:function(e){i.kX.error(e.message||(0,u.__)("An unexpected error has occured")).subscribe()}})}})},toggleDateEdition:function(e){var t=this;e.paid||(e.date_clicked=!e.date_clicked,this.$forceUpdate(),e.date_clicked&&setTimeout((function(){t.$refs.date[0].select()}),200))}}};const Y=(0,v.Z)(U,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"-mx-4 flex-auto flex flex-wrap"},[s("div",{staticClass:"flex flex-auto"},[s("div",{staticClass:"w-full mb-2 flex-wrap"},[s("div",{staticClass:"w-full mb-2 px-4"},[s("h3",{staticClass:"font-semibold text-secondary pb-2 border-b border-info-primary"},[e._v(e._s(e.__("Instalments")))])]),e._v(" "),s("div",{staticClass:"px-4"},[s("ul",{staticClass:"border-table-th-edge border-t text-primary"},[e._l(e.instalments,(function(t){return s("li",{key:t.id,staticClass:"border-b border-l flex justify-between elevation-surface",class:t.paid?"success":"info"},[s("span",{staticClass:"p-2"},[t.date_clicked?e._e():s("span",{on:{click:function(s){return e.toggleDateEdition(t)}}},[e._v(e._s(t.date))]),e._v(" "),t.date_clicked?s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.date,expression:"instalment.date"}],ref:"date",refInFor:!0,staticClass:"border border-info-primary rounded",attrs:{type:"date"},domProps:{value:t.date},on:{blur:function(s){return e.toggleDateEdition(t)},input:function(s){s.target.composing||e.$set(t,"date",s.target.value)}}})]):e._e()]),e._v(" "),s("div",{staticClass:"flex items-center"},[s("div",{staticClass:"flex items-center px-2 h-full border-r"},[t.price_clicked?e._e():s("span",{on:{click:function(s){return e.togglePriceEdition(t)}}},[e._v(e._s(e._f("currency")(t.amount)))]),e._v(" "),t.price_clicked?s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"instalment.amount"}],ref:"amount",refInFor:!0,staticClass:"border border-info-primary p-1",attrs:{type:"text"},domProps:{value:t.amount},on:{blur:function(s){return e.togglePriceEdition(t)},input:function(s){s.target.composing||e.$set(t,"amount",s.target.value)}}})]):e._e()]),e._v(" "),!t.paid&&t.id?s("div",{staticClass:"w-36 justify-center flex items-center px-2 h-full border-r"},[s("div",{staticClass:"px-2"},[s("ns-icon-button",{attrs:{type:"success",className:"la-money-bill-wave-alt"},on:{click:function(s){return e.markAsPaid(t)}}})],1),e._v(" "),s("div",{staticClass:"px-2"},[s("ns-icon-button",{attrs:{type:"info",className:"la-save"},on:{click:function(s){return e.updateInstalment(t)}}})],1),e._v(" "),s("div",{staticClass:"px-2"},[s("ns-icon-button",{attrs:{type:"error",className:"la-trash-alt"},on:{click:function(s){return e.deleteInstalment(t)}}})],1)]):e._e(),e._v(" "),t.paid||t.id?e._e():s("div",{staticClass:"w-36 justify-center flex items-center px-2 h-full border-r"},[s("div",{staticClass:"px-2"},[s("div",{staticClass:"ns-button info"},[s("button",{staticClass:"px-3 py-1 rounded-full",on:{click:function(s){return e.createInstalment(t)}}},[s("i",{staticClass:"las la-plus"}),e._v("\n                                            "+e._s(e.__("Create"))+"\n                                        ")])])])]),e._v(" "),t.paid?s("div",{staticClass:"w-36 justify-center flex items-center px-2 h-full"},[s("div",{staticClass:"ns-button info"},[s("button",{staticClass:"px-3 text-xs py-1 rounded-full",on:{click:function(s){return e.showReceipt(t)}}},[s("i",{staticClass:"las la-print"}),e._v("\n                                        "+e._s(e.__("Receipt"))+"\n                                    ")])])]):e._e()])])})),e._v(" "),s("li",{staticClass:"flex justify-between p-2 border-r border-b border-l elevation-surface"},[s("div",{staticClass:"flex items-center justify-center"},[s("span",[e._v("\n                                "+e._s(e.__("Total :"))+" "+e._s(e._f("currency")(e.order.total))+"\n                            ")]),e._v(" "),s("span",{staticClass:"ml-1 text-sm"},[e._v("\n                                ("+e._s(e.__("Remaining :"))+" "+e._s(e._f("currency")(e.order.total-e.totalInstalments))+")\n                            ")])]),e._v(" "),s("div",{staticClass:"-mx-2 flex flex-wrap items-center"},[s("span",{staticClass:"px-2"},[e._v("\n                                "+e._s(e.__("Instalments:"))+" "+e._s(e._f("currency")(e.totalInstalments))+"\n                            ")]),e._v(" "),s("span",{staticClass:"px-2"},[s("div",{staticClass:"ns-button info"},[s("button",{staticClass:"rounded-full px-3 py-1",on:{click:function(t){return e.addInstalment()}}},[e._v(e._s(e.__("Add Instalment")))])])])])])],2)])])])])}),[],!1,null,null,null).exports;function W(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}function M(e){return function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){W(i,r,n,o,a,"next",e)}function a(e){W(i,r,n,o,a,"throw",e)}o(void 0)}))}}var z={filters:{nsCurrency:o.W},name:"ns-preview-popup",data:function(){return{active:"details",order:new Object,products:[],payments:[],options:null,settings:null}},components:{nsOrderRefund:$,nsOrderPayment:R,nsOrderDetails:X,nsOrderInstalments:Y},computed:{isVoidable:function(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble:function(){return["hold"].includes(this.order.payment_status)}},methods:{__:u.__,popupResolver:b.Z,popupCloser:l.Z,closePopup:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.popupResolver(e)},setActive:function(e){this.active=e},refresh:function(){this.$popupParams.component.$emit("updated"),this.loadOrderDetails(this.order.id)},printOrder:function(){if("default"===this.options.ns_pos_printing_gateway)this.processRegularPrinting(this.order.id);else this.processCustomPrinting(this.order.id,this.options.ns_pos_printing_gateway,!1)},processCustomPrinting:function(e,t){var s=arguments;return M(n().mark((function r(){var o;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=!(s.length>2&&void 0!==s[2])||s[2],!1===nsHooks.applyFilters(o?"ns-order-custom-print":"ns-order-custom-print-aloud",{printed:!1,order_id:e,gateway:t}).printed&&i.kX.error((0,u.__)("Unsupported print gateway.")).subscribe();case 3:case"end":return r.stop()}}),r)})))()},processRegularPrinting:function(e){var t=document.querySelector("printing-section");t&&t.remove();var s=document.createElement("iframe");s.id="printing-section",s.className="hidden",s.src=this.settings.sale_printing_url.replace("{reference_id}",e),document.body.appendChild(s)},loadOrderDetails:function(e){var t=this;(0,a.D)([i.ih.get("/api/nexopos/v4/orders/".concat(e)),i.ih.get("/api/nexopos/v4/orders/".concat(e,"/products")),i.ih.get("/api/nexopos/v4/orders/".concat(e,"/payments"))]).subscribe((function(e){t.order=e[0],t.products=e[1],t.payments=e[2]}))},deleteOrder:function(){var e=this;Popup.show(C.default,{title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("Would you like to delete this order"),onAction:function(t){t&&i.ih.delete("/api/nexopos/v4/orders/".concat(e.order.id)).subscribe({next:function(t){i.kX.success(t.message).subscribe(),e.refreshCrudTable(),e.closePopup(!0)},error:function(e){i.kX.error(e.message).subscribe()}})}})},voidOrder:function(){var e=this;try{new Promise((function(t,s){Popup.show(T.default,{resolve:t,reject:s,title:(0,u.__)("Confirm Your Action"),message:(0,u.__)("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:function(t){!1!==t&&i.ih.post("/api/nexopos/v4/orders/".concat(e.order.id,"/void"),{reason:t}).subscribe({next:function(t){i.kX.success(t.message).subscribe(),e.refreshCrudTable(),e.closePopup(!0)},error:function(e){i.kX.error(e.message).subscribe()}})}})}))}catch(e){console.log(e)}},refreshCrudTable:function(){this.$popupParams.component.$emit("updated",!0)}},watch:{active:function(){"details"===this.active&&this.loadOrderDetails(this.order.id)}},mounted:function(){this.order=this.$popupParams.order,this.options=systemOptions,this.settings=systemSettings,this.loadOrderDetails(this.order.id),this.popupCloser()}};window.nsOrderPreviewPopup=z;const B=z;const J=(0,v.Z)(B,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-95vh w-95vw md:h-6/7-screen md:w-6/7-screen overflow-hidden shadow-xl ns-box flex flex-col"},[s("div",{staticClass:"border-b ns-box-header p-3 flex items-center justify-between"},[s("div",[s("h3",[e._v(e._s(e.__("Order Options")))])]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup(!0)}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 overflow-scroll ns-box-body flex flex-auto"},[e.order.id?s("ns-tabs",{attrs:{active:e.active},on:{active:function(t){return e.setActive(t)}}},[s("ns-tabs-item",{staticClass:"overflow-y-auto",attrs:{label:e.__("Details"),identifier:"details"}},[s("ns-order-details",{attrs:{order:e.order}})],1),e._v(" "),["order_void","hold","refunded","partially_refunded"].includes(e.order.payment_status)?e._e():s("ns-tabs-item",{staticClass:"overflow-y-auto",attrs:{label:e.__("Payments"),identifier:"payments"}},[s("ns-order-payment",{attrs:{order:e.order},on:{changed:function(t){return e.refresh()}}})],1),e._v(" "),["order_void","hold","refunded"].includes(e.order.payment_status)?e._e():s("ns-tabs-item",{staticClass:"flex overflow-y-auto",attrs:{label:e.__("Refund & Return"),identifier:"refund"}},[s("ns-order-refund",{attrs:{order:e.order},on:{loadTab:function(t){return e.setActive(t)},changed:function(t){return e.refresh()}}})],1),e._v(" "),["partially_paid","unpaid"].includes(e.order.payment_status)&&e.order.support_instalments?s("ns-tabs-item",{staticClass:"flex overflow-y-auto",attrs:{label:e.__("Installments"),identifier:"instalments"}},[s("ns-order-instalments",{attrs:{order:e.order},on:{changed:function(t){return e.refresh()}}})],1):e._e()],1):e._e(),e._v(" "),e.order.id?e._e():s("div",{staticClass:"h-full w-full flex items-center justify-center"},[s("ns-spinner")],1)],1),e._v(" "),s("div",{staticClass:"p-2 flex justify-between border-t ns-box-footer"},[s("div",[e.isVoidable?s("ns-button",{attrs:{type:"error"},on:{click:function(t){return e.voidOrder()}}},[s("i",{staticClass:"las la-ban"}),e._v("\n                "+e._s(e.__("Void"))+"\n            ")]):e._e(),e._v(" "),e.isDeleteAble?s("ns-button",{attrs:{type:"error"},on:{click:function(t){return e.deleteOrder()}}},[s("i",{staticClass:"las la-trash"}),e._v("\n                "+e._s(e.__("Delete"))+"\n            ")]):e._e()],1),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.printOrder()}}},[s("i",{staticClass:"las la-print"}),e._v("\n                "+e._s(e.__("Print"))+"\n            ")])],1)])])}),[],!1,null,null,null).exports},3306:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(7389),n=s(8603),i=s(6386),o=s(9671),a=s(1703);const c={name:"ns-orders-refund-popup",data:function(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,settings:systemSettings,print:new a.Z({settings:systemSettings,options:systemOptions,type:"refund"})}},methods:{__:r.__,popupCloser:n.Z,popupResolver:i.Z,toggleProductView:function(e){this.view="details",this.previewed=e},loadOrderRefunds:function(){var e=this;nsHttpClient.get("/api/nexopos/v4/orders/".concat(this.order.id,"/refunds")).subscribe((function(t){e.loaded=!0,e.refunds=t.refunds}),(function(e){o.kX.error(e.message).subscribe()}))},close:function(){this.$popup.close()},printRefundReceipt:function(e){this.print.printOrder(e.id)}},mounted:function(){this.order=this.$popupParams.order,this.popupCloser(),this.loadOrderRefunds()}};const l=(0,s(1900).Z)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg w-95vw h-95vh md:w-3/5-screen md:h-3/5-screen ns-box flex flex-col overflow-hidden"},[s("div",{staticClass:"border-b p-2 flex items-center justify-between ns-box-header"},[s("h3",[e._v(e._s(e.__("Order Refunds")))]),e._v(" "),s("div",{staticClass:"flex"},["details"===e.view?s("div",{staticClass:"flex items-center justify-center cursor-pointer rounded-full px-3 border hover:bg-info-primary hover:text-white mr-1",on:{click:function(t){e.view="summary"}}},[e._v(e._s(e.__("Go Back")))]):e._e(),e._v(" "),s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"overflow-auto flex-auto ns-box-body"},["summary"===e.view?[e.loaded?e._e():s("div",{staticClass:"flex h-full w-full items-center justify-center"},[s("ns-spinner",{attrs:{size:"24"}})],1),e._v(" "),e.loaded&&0===e.refunds.length?s("div",{staticClass:"flex h-full w-full items-center justify-center"},[s("i",{staticClass:"lar la-frown-open"})]):e._e(),e._v(" "),e.loaded&&e.refunds.length>0?e._l(e.refunds,(function(t){return s("div",{key:t.id,staticClass:"border-b flex flex-col md:flex-row"},[s("div",{staticClass:"w-full md:flex-auto p-2"},[s("h3",{staticClass:"font-semibold mb-1"},[e._v(e._s(e.order.code))]),e._v(" "),s("div",[s("ul",{staticClass:"flex -mx-1 text-sm text-primary"},[s("li",{staticClass:"px-1"},[e._v(e._s(e.__("Total"))+" : "+e._s(e._f("currency")(t.total)))]),e._v(" "),s("li",{staticClass:"px-1"},[e._v(e._s(e.__("By"))+" : "+e._s(t.author.username))])])])]),e._v(" "),s("div",{staticClass:"w-full md:w-16 cursor-pointer hover:bg-info-primary hover:border-info-primary hover:text-white text-lg flex items-center justify-center md:border-l",on:{click:function(s){return e.toggleProductView(t)}}},[s("i",{staticClass:"las la-eye"})]),e._v(" "),s("div",{staticClass:"w-full md:w-16 cursor-pointer hover:bg-info-primary hover:border-info-primary hover:text-white text-lg flex items-center justify-center md:border-l",on:{click:function(s){return e.printRefundReceipt(t)}}},[s("i",{staticClass:"las la-print"})])])})):e._e()]:e._e(),e._v(" "),"details"===e.view?e._l(e.previewed.refunded_products,(function(t){return s("div",{key:t.id,staticClass:"border-b flex flex-col md:flex-row"},[s("div",{staticClass:"w-full md:flex-auto p-2"},[s("h3",{staticClass:"font-semibold mb-1"},[e._v(e._s(t.product.name))]),e._v(" "),s("div",[s("ul",{staticClass:"flex -mx-1 text-sm text-primary"},[s("li",{staticClass:"px-1"},[e._v(e._s(e.__("Condition"))+" : "+e._s(t.condition))]),e._v(" "),s("li",{staticClass:"px-1"},[e._v(e._s(e.__("Quantity"))+" : "+e._s(t.quantity))]),e._v(" "),s("li",{staticClass:"px-1"},[e._v(e._s(e.__("Total"))+" : "+e._s(e._f("currency")(t.total_price)))])])])])])})):e._e()],2)])}),[],!1,null,null,null).exports},241:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(8603),n=s(6386),i=s(9671),o=s(7389),a=s(9510);s(9624);const c={name:"ns-pos-coupons-load-popup",components:{nsNotice:s(1828).Z},data:function(){return{placeHolder:(0,o.__)("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,customerCoupon:null}},mounted:function(){var e=this;this.popupCloser(),this.$refs.coupon.select(),this.orderSubscriber=POS.order.subscribe((function(t){e.order=t,e.order.coupons.length>0&&(e.activeTab="active-coupons")})),this.$popupParams&&this.$popupParams.apply_coupon&&(this.couponCode=this.$popupParams.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:function(t){e.customerCoupon=t,e.apply()}}))},destroyed:function(){this.orderSubscriber.unsubscribe()},methods:{__:o.__,popupCloser:r.Z,popupResolver:n.Z,selectCustomer:function(){Popup.show(a.Z)},cancel:function(){this.customerCoupon=null,this.couponCode=null},removeCoupon:function(e){this.order.coupons.splice(e,1),POS.refreshCart()},apply:function(){var e=this;try{var t=this.customerCoupon;if(null!==this.customerCoupon.coupon.valid_hours_start&&!ns.date.moment.isAfter(this.customerCoupon.coupon.valid_hours_start)&&this.customerCoupon.coupon.valid_hours_start.length>0)return i.kX.error((0,o.__)("The coupon is out from validity date range.")).subscribe();if(null!==this.customerCoupon.coupon.valid_hours_end&&!ns.date.moment.isBefore(this.customerCoupon.coupon.valid_hours_end)&&this.customerCoupon.coupon.valid_hours_end.length>0)return i.kX.error((0,o.__)("The coupon is out from validity date range.")).subscribe();var s=this.customerCoupon.coupon.products;if(s.length>0){var r=s.map((function(e){return e.product_id}));if(0===this.order.products.filter((function(e){return r.includes(e.product_id)})).length)return i.kX.error((0,o.__)("This coupon requires products that aren't available on the cart at the moment.")).subscribe()}var n=this.customerCoupon.coupon.categories;if(n.length>0){var a=n.map((function(e){return e.category_id}));if(0===this.order.products.filter((function(e){return a.includes(e.$original().category_id)})).length)return i.kX.error((0,o.__)("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s")).subscribe()}this.cancel();var c={active:t.coupon.active,customer_coupon_id:t.id,minimum_cart_value:t.coupon.minimum_cart_value,maximum_cart_value:t.coupon.maximum_cart_value,name:t.coupon.name,type:t.coupon.type,value:0,limit_usage:t.coupon.limit_usage,code:t.coupon.code,discount_value:t.coupon.discount_value,categories:t.coupon.categories,products:t.coupon.products};POS.pushCoupon(c),this.activeTab="active-coupons",setTimeout((function(){e.popupResolver(c)}),500),i.kX.success((0,o.__)("The coupon has applied to the cart.")).subscribe()}catch(e){console.log(e)}},getCouponType:function(e){switch(e){case"percentage_discount":return(0,o.__)("Percentage");case"flat_discount":return(0,o.__)("Flat");default:return(0,o.__)("Unknown Type")}},getDiscountValue:function(e){switch(e.type){case"percentage_discount":return e.discount_value+"%";case"flat_discount":return this.$options.filters.currency(e.discount_value)}},closePopup:function(){this.popupResolver(!1)},setActiveTab:function(e){this.activeTab=e},getCoupon:function(e){return!this.order.customer_id>0?i.kX.error((0,o.__)("You must select a customer before applying a coupon.")).subscribe():i.ih.post("/api/nexopos/v4/customers/coupons/".concat(e),{customer_id:this.order.customer_id})},loadCoupon:function(){var e=this,t=this.couponCode;this.getCoupon(t).subscribe({next:function(t){e.customerCoupon=t,i.kX.success((0,o.__)("The coupon has been loaded.")).subscribe()},error:function(e){i.kX.error(e.message||(0,o.__)("An unexpected error occured.")).subscribe()}})}}};const l=(0,s(1900).Z)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-2/6-screen"},[s("div",{staticClass:"border-b ns-box-header p-2 flex justify-between items-center"},[s("h3",{staticClass:"font-bold"},[e._v(e._s(e.__("Load Coupon")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"p-1 ns-box-body"},[s("ns-tabs",{attrs:{active:e.activeTab},on:{changeTab:function(t){return e.setActiveTab(t)}}},[s("ns-tabs-item",{attrs:{label:e.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"}},[s("div",{staticClass:"border-2 input-group info rounded flex"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.couponCode,expression:"couponCode"}],ref:"coupon",staticClass:"w-full text-primary p-2 outline-none",attrs:{type:"text",placeholder:e.placeHolder},domProps:{value:e.couponCode},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadCoupon()},input:function(t){t.target.composing||(e.couponCode=t.target.value)}}}),e._v(" "),s("button",{staticClass:"px-3 py-2",on:{click:function(t){return e.loadCoupon()}}},[e._v(e._s(e.__("Load")))])]),e._v(" "),s("div",{staticClass:"pt-2"},[s("ns-notice",{attrs:{color:"info"},scopedSlots:e._u([{key:"description",fn:function(){return[e._v(e._s(e.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")))]},proxy:!0}])})],1),e._v(" "),e.order&&void 0===e.order.customer_id?s("div",{staticClass:"pt-2 flex"},[s("button",{staticClass:"w-full border p-2 outline-none ns-numpad-key info cursor-pointer text-center",on:{click:function(t){return e.selectCustomer()}}},[e._v(e._s(e.__("Click here to choose a customer.")))])]):e._e(),e._v(" "),e.order&&void 0!==e.order.customer_id?s("div",{staticClass:"pt-2"},[s("ns-notice",{attrs:{color:"success"},scopedSlots:e._u([{key:"description",fn:function(){return[e._v(e._s(e.__("Loading Coupon For : ")+e.order.customer.name+" "+e.order.customer.surname))]},proxy:!0}],null,!1,2531213351)})],1):e._e(),e._v(" "),s("div",{staticClass:"overflow-hidden"},[e.customerCoupon?s("div",{staticClass:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},[s("table",{staticClass:"w-full ns-table"},[s("tbody",[s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Coupon Name")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.customerCoupon.name))])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Discount"))+" ("+e._s(e.getCouponType(e.customerCoupon.coupon.type))+")")]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.getDiscountValue(e.customerCoupon.coupon)))])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Usage")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.customerCoupon.usage+"/"+(e.customerCoupon.limit_usage||e.__("Unlimited"))))])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Valid From")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.customerCoupon.coupon.valid_hours_start||e.__("N/A")))])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Valid Till")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.customerCoupon.coupon.valid_hours_end||e.__("N/A")))])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Categories")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[s("ul",[e._l(e.customerCoupon.coupon.categories,(function(t){return s("li",{key:t.id,staticClass:"rounded-full px-3 py-1 border"},[e._v(e._s(t.category.name))])})),e._v(" "),0===e.customerCoupon.coupon.categories.length?s("li",[e._v(e._s(e.__("Not applicable")))]):e._e()],2)])]),e._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 border"},[e._v(e._s(e.__("Products")))]),e._v(" "),s("td",{staticClass:"p-2 w-1/2 border"},[s("ul",[e._l(e.customerCoupon.coupon.products,(function(t){return s("li",{key:t.id,staticClass:"rounded-full px-3 py-1 border"},[e._v(e._s(t.product.name))])})),e._v(" "),0===e.customerCoupon.coupon.products.length?s("li",[e._v(e._s(e.__("Not applicable")))]):e._e()],2)])])])])]):e._e()])]),e._v(" "),s("ns-tabs-item",{attrs:{label:e.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"}},[e.order?s("ul",[e._l(e.order.coupons,(function(t,r){return s("li",{key:r,staticClass:"flex justify-between elevation-surface border items-center px-2 py-1"},[s("div",{staticClass:"flex-auto"},[s("h3",{staticClass:"font-semibold text-primary p-2 flex justify-between"},[s("span",[e._v(e._s(t.name))]),e._v(" "),s("span",[e._v(e._s(e.getDiscountValue(t)))])])]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.removeCoupon(r)}}})],1)])})),e._v(" "),0===e.order.coupons.length?s("li",{staticClass:"flex justify-between elevation-surface border items-center p-2"},[e._v("\n                        "+e._s(e.__("No coupons applies to the cart."))+"\n                    ")]):e._e()],2):e._e()])],1)],1),e._v(" "),e.customerCoupon?s("div",{staticClass:"flex"},[s("button",{staticClass:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold",on:{click:function(t){return e.apply()}}},[e._v("\n            "+e._s(e.__("Apply"))+"\n        ")]),e._v(" "),s("button",{staticClass:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold",on:{click:function(t){return e.cancel()}}},[e._v("\n            "+e._s(e.__("Cancel"))+"\n        ")])]):e._e()])}),[],!1,null,null,null).exports},9510:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(9671),n=s(6386),i=s(2242),o=s(1247);const a={data:function(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected:function(){return!1}},watch:{searchCustomerValue:function(e){var t=this;clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout((function(){t.searchCustomer(e)}),500)}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.resolveIfQueued(!1)})),this.orderSubscription=POS.order.subscribe((function(t){e.order=t})),this.getRecentCustomers(),this.$refs.searchField.focus()},destroyed:function(){this.orderSubscription.unsubscribe()},methods:{__:s(7389).__,resolveIfQueued:n.Z,attemptToChoose:function(){if(1===this.customers.length)return this.selectCustomer(this.customers[0]);r.kX.info("Too many result.").subscribe()},openCustomerHistory:function(e,t){t.stopImmediatePropagation(),this.$popup.close(),i.G.show(o.Z,{customer:e,activeTab:"account-payment"})},selectCustomer:function(e){var t=this;this.customers.forEach((function(e){return e.selected=!1})),e.selected=!0,this.isLoading=!0,POS.selectCustomer(e).then((function(s){t.isLoading=!1,t.resolveIfQueued(e)})).catch((function(e){t.isLoading=!1}))},searchCustomer:function(e){var t=this;r.ih.post("/api/nexopos/v4/customers/search",{search:e}).subscribe((function(e){e.forEach((function(e){return e.selected=!1})),t.customers=e}))},createCustomerWithMatch:function(e){this.resolveIfQueued(!1),i.G.show(o.Z,{name:e})},getRecentCustomers:function(){var e=this;this.isLoading=!0,r.ih.get("/api/nexopos/v4/customers/recently-active").subscribe({next:function(t){e.isLoading=!1,t.forEach((function(e){return e.selected=!1})),e.customers=t},error:function(t){e.isLoading=!1}})}}};const c=(0,s(1900).Z)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108",attrs:{id:"ns-pos-customer-select-popup"}},[s("div",{staticClass:"border-b ns-box-header text-center font-semibold text-2xl py-2",attrs:{id:"header"}},[s("h2",[e._v(e._s(e.__("Select Customer")))])]),e._v(" "),s("div",{staticClass:"relative"},[s("div",{staticClass:"p-2 border-b ns-box-body items-center flex justify-between"},[s("span",[e._v(e._s(e.__("Selected"))+" : ")]),e._v(" "),s("div",{staticClass:"flex items-center justify-between"},[s("span",[e._v(e._s(e.order.customer?e.order.customer.name:"N/A"))]),e._v(" "),e.order.customer?s("button",{staticClass:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent",on:{click:function(t){return e.openCustomerHistory(e.order.customer,t)}}},[s("i",{staticClass:"las la-eye"})]):e._e()])]),e._v(" "),s("div",{staticClass:"p-2 border-b ns-box-body flex justify-between text-primary"},[s("div",{staticClass:"input-group flex-auto border-2 rounded"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchCustomerValue,expression:"searchCustomerValue"}],ref:"searchField",staticClass:"outline-none w-full p-2",attrs:{placeholder:"Search Customer",type:"text"},domProps:{value:e.searchCustomerValue},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.attemptToChoose()},input:function(t){t.target.composing||(e.searchCustomerValue=t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"h-3/5-screen xl:h-2/5-screen overflow-y-auto ns-scrollbar"},[s("ul",{staticClass:"ns-vertical-menu"},[e.customers&&0===e.customers.length?s("li",{staticClass:"p-2 text-center text-primary"},[e._v("\n                    "+e._s(e.__("No customer match your query..."))+"\n                ")]):e._e(),e._v(" "),e.customers&&0===e.customers.length?s("li",{staticClass:"p-2 cursor-pointer text-center text-primary",on:{click:function(t){return e.createCustomerWithMatch(e.searchCustomerValue)}}},[s("span",{staticClass:"border-b border-dashed border-info-primary"},[e._v(e._s(e.__("Create a customer")))])]):e._e(),e._v(" "),e._l(e.customers,(function(t){return s("li",{key:t.id,staticClass:"cursor-pointer p-2 border-b text-primary flex justify-between items-center",on:{click:function(s){return e.selectCustomer(t)}}},[s("span",[e._v(e._s(t.name))]),e._v(" "),s("p",{staticClass:"flex items-center"},[t.owe_amount>0?s("span",{staticClass:"text-error-primary"},[e._v("-"+e._s(e._f("currency")(t.owe_amount)))]):e._e(),e._v(" "),t.owe_amount>0?s("span",[e._v("/")]):e._e(),e._v(" "),s("span",{staticClass:"purchase-amount"},[e._v(e._s(e._f("currency")(t.purchases_amount)))]),e._v(" "),s("button",{staticClass:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info",on:{click:function(s){return e.openCustomerHistory(t,s)}}},[s("i",{staticClass:"las la-eye"})])])])}))],2)]),e._v(" "),e.isLoading?s("div",{staticClass:"z-10 top-0 absolute w-full h-full flex items-center justify-center"},[s("ns-spinner",{attrs:{size:"24",border:"8"}})],1):e._e()])])}),[],!1,null,null,null).exports},1247:(e,t,s)=>{s.d(t,{Z:()=>w});var r=s(7757),n=s.n(r),i=s(8603),o=s(9671),a=s(2242),c=s(9510),l=s(7266),u=s(7389);const d={mounted:function(){this.closeWithOverlayClicked(),this.loadTransactionFields()},data:function(){return{fields:[],isSubmiting:!1,formValidation:new l.Z}},methods:{__:u.__,closeWithOverlayClicked:i.Z,proceed:function(){var e=this,t=this.$popupParams.customer,s=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,o.ih.post("/api/nexopos/v4/customers/".concat(t.id,"/account-history"),s).subscribe({next:function(t){e.isSubmiting=!1,o.kX.success(t.message).subscribe(),e.$popupParams.resolve(t),e.$popup.close()},error:function(t){e.isSubmiting=!1,o.kX.error(t.message).subscribe(),e.$popupParams.reject(t)}})},close:function(){this.$popup.close(),this.$popupParams.reject(!1)},loadTransactionFields:function(){var e=this;o.ih.get("/api/nexopos/v4/fields/ns.customers-account").subscribe({next:function(t){e.fields=e.formValidation.createFields(t)}})}}};var p=s(1900);const _=(0,p.Z)(d,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-6/7-screen md:h-5/7-screen lg:h-5/7-screen overflow-hidden shadow-lg ns-box flex flex-col relative"},[s("div",{staticClass:"p-2 border-b ns-box-header flex justify-between items-center"},[s("h2",{staticClass:"font-semibold"},[e._v(e._s(e.__("New Transaction")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"flex-auto overflow-y-auto"},[0===e.fields.length?s("div",{staticClass:"h-full w-full flex items-center justify-center"},[s("ns-spinner")],1):e._e(),e._v(" "),e.fields.length>0?s("div",{staticClass:"p-2"},e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1):e._e()]),e._v(" "),s("div",{staticClass:"p-2 ns-box-footer justify-between border-t flex"},[s("div"),e._v(" "),s("div",{staticClass:"px-1"},[s("div",{staticClass:"-mx-2 flex flex-wrap"},[s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"error"},on:{click:function(t){return e.close()}}},[e._v(e._s(e.__("Close")))])],1),e._v(" "),s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.proceed()}}},[e._v(e._s(e.__("Proceed")))])],1)])])]),e._v(" "),0===e.isSubmiting?s("div",{staticClass:"h-full w-full absolute flex items-center justify-center",staticStyle:{background:"rgb(0 98 171 / 45%)"}},[s("ns-spinner")],1):e._e()])}),[],!1,null,null,null).exports;var f=s(241),v=s(3601),m=s(6386),b=s(3506),h=s(3613);function y(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}const x={name:"ns-pos-customers",data:function(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:b.Z},destroyed:function(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted:function(){var e=this;this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe((function(t){e.options=t})),this.subscription=POS.order.subscribe((function(t){e.order=t,void 0!==e.$popupParams.customer?(e.activeTab="account-payment",e.customer=e.$popupParams.customer,e.loadCustomerOrders()):void 0!==t.customer&&(e.activeTab="account-payment",e.customer=t.customer,e.loadCustomerOrders())})),this.popupCloser()},methods:{__:u.__,reload:function(){this.loadCustomerOrders()},popupResolver:m.Z,popupCloser:i.Z,getWalletHistoryLabel:function(e){switch(e){case"add":return(0,u.__)("Crediting");case"deduct":return(0,u.__)("Removing");case"refund":return(0,u.__)("Refunding");case"payment":return(0,u.__)("Payment");default:return(0,u.__)("Unknow")}},getType:function(e){switch(e){case"percentage_discount":return(0,u.__)("Percentage Discount");case"flat_discount":return(0,u.__)("Flat Discount")}},closeWithOverlayClicked:i.Z,openOrderOptions:function(e){var t,s=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,s){a.G.show(h.Z,{order:e,resolve:t,reject:s})}));case 3:t.sent,s.reload(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),o.kX.error((0,u.__)("An error occured while opening the order options")).subscribe();case 10:case"end":return t.stop()}}),t,null,[[0,7]])})),function(){var e=this,s=arguments;return new Promise((function(r,n){var i=t.apply(e,s);function o(e){y(i,r,n,o,a,"next",e)}function a(e){y(i,r,n,o,a,"throw",e)}o(void 0)}))})()},doChangeTab:function(e){this.selectedTab=e,"coupons"===e&&this.loadCoupons(),"rewards"===e&&this.loadRewards(),"wallet-history"===e&&this.loadAccounHistory(),"orders"===e&&this.loadCustomerOrders()},loadAccounHistory:function(){var e=this;this.isLoadingHistory=!0,o.ih.get("/api/nexopos/v4/customers/".concat(this.customer.id,"/account-history")).subscribe({next:function(t){e.walletHistories=t.data,e.isLoadingHistory=!1},error:function(t){e.isLoadingHistory=!1}})},loadCoupons:function(){var e=this;this.isLoadingCoupons=!0,o.ih.get("/api/nexopos/v4/customers/".concat(this.customer.id,"/coupons")).subscribe({next:function(t){e.coupons=t,e.isLoadingCoupons=!1},error:function(t){e.isLoadingCoupons=!1}})},loadRewards:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/api/nexopos/v4/customers/".concat(this.customer.id,"/rewards");this.isLoadingRewards=!0,o.ih.get(t).subscribe({next:function(t){e.rewardsResponse=t,e.isLoadingRewards=!1},error:function(t){e.isLoadingRewards=!1}})},prefillForm:function(e){void 0!==this.$popupParams.name&&(e.main.value=this.$popupParams.name)},openCustomerSelection:function(){this.$popup.close(),a.G.show(c.Z)},loadCustomerOrders:function(){var e=this;this.isLoadingOrders=!0,o.ih.get("/api/nexopos/v4/customers/".concat(this.customer.id,"/orders")).subscribe({next:function(t){e.orders=t,e.isLoadingOrders=!1},error:function(t){e.isLoadingOrders=!1}})},newTransaction:function(e){new Promise((function(t,s){a.G.show(_,{customer:e,resolve:t,reject:s})})).then((function(t){POS.loadCustomer(e.id).subscribe((function(e){POS.selectCustomer(e)}))}))},applyCoupon:function(e){var t=this;void 0===this.order.customer?a.G.show(v.default,{title:(0,u.__)("Use Customer ?"),message:(0,u.__)("No customer is selected. Would you like to proceed with this customer ?"),onAction:function(s){s&&POS.selectCustomer(t.customer).then((function(s){t.proceedApplyingCoupon(e)}))}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(e):this.order.customer.id!==this.customer.id&&a.G.show(v.default,{title:(0,u.__)("Change Customer ?"),message:(0,u.__)("Would you like to assign this customer to the ongoing order ?"),onAction:function(s){s&&POS.selectCustomer(t.customer).then((function(s){t.proceedApplyingCoupon(e)}))}})},proceedApplyingCoupon:function(e){var t=this;new Promise((function(t,s){a.G.show(f.Z,{apply_coupon:e.code,resolve:t,reject:s})})).then((function(e){t.popupResolver(!1)})).catch((function(e){}))},handleSavedCustomer:function(e){o.kX.success(e.message).subscribe(),POS.selectCustomer(e.entry),this.$popup.close()}}};const w=(0,p.Z)(x,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg rounded w-95vw h-95vh lg:w-3/5-screen flex flex-col overflow-hidden",attrs:{id:"ns-pos-customers"}},[s("div",{staticClass:"ns-header p-2 flex justify-between items-center border-b"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.__("Customers")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.$popup.close()}}})],1)]),e._v(" "),s("div",{staticClass:"ns-body flex-auto flex p-2 overflow-y-auto"},[s("ns-tabs",{attrs:{active:e.activeTab},on:{active:function(t){e.activeTab=t}}},[s("ns-tabs-item",{attrs:{identifier:"create-customers",label:"New Customer"}},["yes"===e.options.ns_pos_customers_creation_enabled?s("ns-crud-form",{attrs:{"submit-url":"/api/nexopos/v4/crud/ns.customers",src:"/api/nexopos/v4/crud/ns.customers/form-config"},on:{updated:function(t){return e.prefillForm(t)},save:function(t){return e.handleSavedCustomer(t)}},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.__("Customer Name")))]},proxy:!0},{key:"save",fn:function(){return[e._v(e._s(e.__("Save Customer")))]},proxy:!0}],null,!1,2432171054)}):e._e(),e._v(" "),"yes"!==e.options.ns_pos_customers_creation_enabled?s("div",{staticClass:"h-full flex-col w-full flex items-center justify-center text-primary"},[s("i",{staticClass:"lar la-hand-paper ns-icon text-6xl"}),e._v(" "),s("h3",{staticClass:"font-medium text-2xl"},[e._v(e._s(e.__("Not Authorized")))]),e._v(" "),s("p",[e._v(e._s(e.__("Creating customers has been explicitly disabled from the settings.")))])]):e._e()],1),e._v(" "),s("ns-tabs-item",{staticClass:"flex",staticStyle:{padding:"0!important"},attrs:{identifier:"account-payment",label:e.__("Customer Account")}},[null===e.customer?s("div",{staticClass:"flex-auto w-full flex items-center justify-center flex-col p-4"},[s("i",{staticClass:"lar la-frown text-6xl"}),e._v(" "),s("h3",{staticClass:"font-medium text-2xl"},[e._v(e._s(e.__("No Customer Selected")))]),e._v(" "),s("p",[e._v(e._s(e.__("In order to see a customer account, you need to select one customer.")))]),e._v(" "),s("div",{staticClass:"my-2"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.openCustomerSelection()}}},[e._v(e._s(e.__("Select Customer")))])],1)]):e._e(),e._v(" "),e.customer?s("div",{staticClass:"flex flex-col flex-auto"},[s("div",{staticClass:"flex-auto p-2 flex flex-col"},[s("div",{staticClass:"-mx-4 flex flex-wrap ns-tab-cards"},[s("div",{staticClass:"px-4 mb-4 w-full"},[s("h2",{staticClass:"font-semibold"},[e._v(e._s(e.__("Summary For"))+" : "+e._s(e.customer.name))])]),e._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},[s("h3",{staticClass:"font-medium text-lg"},[e._v(e._s(e.__("Total Purchases")))]),e._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"font-bold"},[e._v(e._s(e._f("currency")(e.customer.purchases_amount)))])])])]),e._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[e._v(e._s(e.__("Total Owed")))]),e._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[e._v(e._s(e._f("currency")(e.customer.owed_amount)))])])])]),e._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[e._v(e._s(e.__("Wallet Amount")))]),e._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[e._v(e._s(e._f("currency")(e.customer.account_amount)))])])])]),e._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[e._v(e._s(e.__("Credit Limit")))]),e._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[e._v(e._s(e._f("currency")(e.customer.credit_limit_amount)))])])])])]),e._v(" "),s("div",{staticClass:"flex flex-auto flex-col overflow-hidden"},[s("ns-tabs",{attrs:{active:e.selectedTab},on:{changeTab:function(t){return e.doChangeTab(t)}}},[s("ns-tabs-item",{attrs:{identifier:"orders",label:e.__("Orders")}},[e.isLoadingOrders?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):e._e(),e._v(" "),e.isLoadingOrders?e._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[e._v(e._s(e.__("Last Purchases")))])]),e._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{colspan:"3",width:"150"}},[e._v(e._s(e.__("Order")))]),e._v(" "),s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"50"}},[e._v(e._s(e.__("Options")))])])]),e._v(" "),s("tbody",{staticClass:"text-primary"},[0===e.orders.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[e._v(e._s(e.__("No orders...")))])]):e._e(),e._v(" "),e._l(e.orders,(function(t){return s("tr",{key:t.id},[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"3"}},[s("div",{staticClass:"flex flex-col items-start"},[s("h3",{staticClass:"font-bold"},[e._v(e._s(e.__("Code"))+": "+e._s(t.code))]),e._v(" "),s("div",{staticClass:"md:-mx-2 w-full flex flex-col md:flex-row"},[s("div",{staticClass:"md:px-2 flex items-start w-full md:w-1/4"},[s("small",[e._v(e._s(e.__("Total"))+": "+e._s(e._f("currency")(t.total)))])]),e._v(" "),s("div",{staticClass:"md:px-2 flex items-start w-full md:w-1/4"},[s("small",[e._v(e._s(e.__("Status"))+": "+e._s(t.human_status))])]),e._v(" "),s("div",{staticClass:"md:px-2 flex items-start w-full md:w-1/4"},[s("small",[e._v(e._s(e.__("Delivery"))+": "+e._s(t.human_delivery_status))])])])])]),e._v(" "),s("td",{staticClass:"border p-2 text-center"},[s("button",{staticClass:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success",on:{click:function(s){return e.openOrderOptions(t)}}},[s("i",{staticClass:"las la-wallet"}),e._v(" "),s("span",{staticClass:"ml-1"},[e._v(e._s(e.__("Options")))])])])])}))],2)])])])]],2),e._v(" "),s("ns-tabs-item",{attrs:{identifier:"wallet-history",label:e.__("Wallet History")}},[e.isLoadingHistory?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):e._e(),e._v(" "),e.isLoadingHistory?e._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[e._v(e._s(e.__("Wallet History")))])]),e._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{colspan:"3",width:"150"}},[e._v(e._s(e.__("Transaction")))])])]),e._v(" "),s("tbody",{staticClass:"text-primary"},[0===e.walletHistories.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"3"}},[e._v(e._s(e.__("No History...")))])]):e._e(),e._v(" "),e._l(e.walletHistories,(function(t){return s("tr",{key:t.id},[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"3"}},[s("div",{staticClass:"flex flex-col items-start"},[s("h3",{staticClass:"font-bold"},[e._v(e._s(e.__("Transaction"))+": "+e._s(e.getWalletHistoryLabel(t.operation)))]),e._v(" "),s("div",{staticClass:"md:-mx-2 w-full flex flex-col md:flex-row"},[s("div",{staticClass:"md:px-2 flex items-start w-full md:w-1/3"},[s("small",[e._v(e._s(e.__("Amount"))+": "+e._s(e._f("currency")(t.amount)))])]),e._v(" "),s("div",{staticClass:"md:px-2 flex items-start w-full md:w-1/3"},[s("small",[e._v(e._s(e.__("Date"))+": "+e._s(t.created_at))])])])])])])}))],2)])])])]],2),e._v(" "),s("ns-tabs-item",{attrs:{identifier:"coupons",label:e.__("Coupons")}},[e.isLoadingCoupons?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):e._e(),e._v(" "),e.isLoadingCoupons?e._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[e._v(e._s(e.__("Coupons")))])]),e._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"150"}},[e._v(e._s(e.__("Name")))]),e._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[e._v(e._s(e.__("Type")))]),e._v(" "),s("th",{staticClass:"p-2 border font-semibold"})])]),e._v(" "),s("tbody",{staticClass:"text-primary text-sm"},[0===e.coupons.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[e._v(e._s(e.__("No coupons for the selected customer...")))])]):e._e(),e._v(" "),e._l(e.coupons,(function(t){return s("tr",{key:t.id},[s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",[e._v(e._s(t.name))]),e._v(" "),s("div",{},[s("ul",{staticClass:"-mx-2 flex"},[s("li",{staticClass:"text-xs text-primary px-2"},[e._v(e._s(e.__("Usage :"))+" "+e._s(t.usage)+"/"+e._s(t.limit_usage))]),e._v(" "),s("li",{staticClass:"text-xs text-primary px-2"},[e._v(e._s(e.__("Code :"))+" "+e._s(t.code))])])])]),e._v(" "),s("td",{staticClass:"border p-2 text-center"},[e._v(e._s(e.getType(t.coupon.type))+" \n                                                                "),"percentage_discount"===t.coupon.type?s("span",[e._v("\n                                                                    ("+e._s(t.coupon.discount_value)+"%)\n                                                                ")]):e._e(),e._v(" "),"flat_discount"===t.coupon.type?s("span",[e._v("\n                                                                    ("+e._s(e._f("currency")(t.coupon.discount_value))+")\n                                                                ")]):e._e()]),e._v(" "),s("td",{staticClass:"border p-2 text-right"},[s("ns-button",{attrs:{type:"info"},on:{click:function(s){return e.applyCoupon(t)}}},[e._v(e._s(e.__("Use Coupon")))])],1)])}))],2)])])])]],2),e._v(" "),s("ns-tabs-item",{attrs:{identifier:"rewards",label:e.__("Rewards")}},[e.isLoadingRewards?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):e._e(),e._v(" "),e.isLoadingRewards?e._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[e._v(e._s(e.__("Rewards")))])]),e._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"150"}},[e._v(e._s(e.__("Name")))]),e._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[e._v(e._s(e.__("Points")))]),e._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[e._v(e._s(e.__("Target")))])])]),e._v(" "),e.rewardsResponse.data?s("tbody",{staticClass:"text-primary text-sm"},[0===e.rewardsResponse.data.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[e._v(e._s(e.__("No rewards available the selected customer...")))])]):e._e(),e._v(" "),e._l(e.rewardsResponse.data,(function(t){return s("tr",{key:t.id},[s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[e._v(e._s(t.reward_name))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[e._v(e._s(t.points))])]),e._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[e._v(e._s(t.target))])])])}))],2):e._e()])])]),e._v(" "),s("div",{staticClass:"py-1 flex justify-end"},[s("ns-paginate",{attrs:{pagination:e.rewardsResponse},on:{load:function(t){return e.loadRewards(t)}}})],1)]],2)],1)],1)]),e._v(" "),s("div",{staticClass:"p-2 border-t border-box-edge flex justify-between"},[s("div"),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.newTransaction(e.customer)}}},[e._v(e._s(e.__("Account Transaction")))])],1)])]):e._e()])],1)],1)])}),[],!1,null,null,null).exports},2004:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const r={name:"ns-pos-loading-popup"};const n=(0,s(1900).Z)(r,(function(){var e=this.$createElement;return(this._self._c||e)("ns-spinner")}),[],!1,null,null,null).exports},664:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(7757),n=s.n(r),i=s(6386),o=s(7389),a=s(8603);function c(e,t,s,r,n,i,o){try{var a=e[i](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(r,n)}const l={data:function(){return{types:[],typeSubscription:null}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.resolveIfQueued(!1)})),this.typeSubscription=POS.types.subscribe((function(t){e.types=t,1===Object.values(e.types).length&&e.select(Object.keys(e.types)[0])})),this.popupCloser()},destroyed:function(){this.typeSubscription.unsubscribe()},methods:{__:o.__,popupCloser:a.Z,popupResolver:i.Z,resolveIfQueued:i.Z,select:function(e){var t,s=this;return(t=n().mark((function t(){var r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object.values(s.types).forEach((function(e){return e.selected=!1})),s.types[e].selected=!0,r=s.types[e],t.prev=3,t.next=6,POS.triggerOrderTypeSelection(r);case 6:t.sent,POS.types.next(s.types),s.resolveIfQueued(r),t.next=13;break;case 11:t.prev=11,t.t0=t.catch(3);case 13:case"end":return t.stop()}}),t,null,[[3,11]])})),function(){var e=this,s=arguments;return new Promise((function(r,n){var i=t.apply(e,s);function o(e){c(i,r,n,o,a,"next",e)}function a(e){c(i,r,n,o,a,"throw",e)}o(void 0)}))})()}}};const u=(0,s(1900).Z)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-full w-4/5-screen md:w-2/5-screen lg:w-2/5-screen xl:w-2/6-screen shadow-lg",attrs:{id:"ns-order-type"}},[s("div",{staticClass:"h-16 flex justify-center items-center",attrs:{id:"header"}},[s("h3",{staticClass:"font-bold"},[e._v(e._s(e.__("Define The Order Type")))])]),e._v(" "),0===Object.values(e.types).length?s("div",{staticClass:"ns-box-body grid grid-flow-row grid-cols-1 grid-rows-1"},[s("div",{staticClass:"h-full w-full flex items-center justify-center flex-col"},[s("i",{staticClass:"las la-frown text-7xl"}),e._v(" "),s("div",{staticClass:"p-4 md:w-2/3"},[s("p",{staticClass:"text-center "},[e._v(e._s(e.__("No payment type has been selected on the settings. Please check your POS features and choose the supported order type")))]),e._v(" "),s("div",{staticClass:"flex justify-center py-1"},[s("ns-link",{attrs:{target:"_blank",type:"info",href:"https://my.nexopos.com/en/documentation/components/order-types"}},[e._v(e._s(e.__("Read More")))])],1)])])]):e._e(),e._v(" "),Object.values(e.types).length>0?s("div",{staticClass:"ns-box-body grid grid-flow-row grid-cols-2 grid-rows-2"},e._l(e.types,(function(t){return s("div",{key:t.identifier,staticClass:"ns-numpad-key info h-56 flex items-center justify-center flex-col cursor-pointer border",class:t.selected?"active":"",on:{click:function(s){return e.select(t.identifier)}}},[s("img",{staticClass:"w-32 h-32",attrs:{src:t.icon,alt:""}}),e._v(" "),s("h4",{staticClass:"font-semibold text-xl my-2"},[e._v(e._s(t.label))])])})),0):e._e()])}),[],!1,null,null,null).exports},4492:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(9671),n=s(7389),i=s(8603),o=s(4864),a=s(3220);const c={components:{nsNumpad:o.Z,nsNumpadPlus:a.Z},data:function(){return{finalValue:1,virtualStock:null,options:{},optionsSubscription:null,allSelected:!0,isLoading:!1}},beforeDestroy:function(){this.optionsSubscription.unsubscribe()},mounted:function(){var e=this;this.optionsSubscription=POS.options.subscribe((function(t){e.options=t})),this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&(e.$popupParams.reject(!1),e.$popup.close())})),this.$popupParams.product.quantity&&(this.finalValue=this.$popupParams.product.quantity),this.popupCloser()},destroyed:function(){nsHotPress.destroy("pos-quantity-numpad"),nsHotPress.destroy("pos-quantity-backspace"),nsHotPress.destroy("pos-quantity-enter")},methods:{__:n.__,popupCloser:i.Z,closePopup:function(){this.$popupParams.reject(!1),this.$popup.close()},updateQuantity:function(e){this.finalValue=e},defineQuantity:function(e){var t=this.$popupParams,s=t.product,i=t.data;if(0===e)return r.kX.error((0,n.__)("Please provide a quantity")).subscribe();if("enabled"===s.$original().stock_management&&"materialized"===s.$original().type){var o=POS.getStockUsage(s.$original().id,i.unit_quantity_id)-(s.quantity||0);if(e>parseFloat(i.$quantities().quantity)-o)return r.kX.error((0,n.__)("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",i.$quantities().quantity-o)).subscribe()}this.resolve({quantity:e})},resolve:function(e){this.$popupParams.resolve(e),this.$popup.close()}}};const l=(0,s(1900).Z)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box shadow min-h-2/5-screen w-3/4-screen md:w-3/5-screen lg:w-2/5-screen xl:w-2/5-screen relative"},[e.isLoading?s("div",{staticClass:"flex w-full h-full absolute top-O left-0 items-center justify-center",staticStyle:{background:"rgb(202 202 202 / 49%)"},attrs:{id:"loading-overlay"}},[s("ns-spinner")],1):e._e(),e._v(" "),s("div",{staticClass:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},[s("div",[s("h1",{staticClass:"text-xl font-bold text-primary text-center"},[e._v(e._s(e.__("Define Quantity")))])]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"h-24 border-b primary ns-box-body flex items-center justify-center",attrs:{id:"screen"}},[s("h1",{staticClass:"font-bold text-3xl"},[e._v(e._s(e.finalValue))])]),e._v(" "),"default"===e.options.ns_pos_numpad?s("ns-numpad",{attrs:{floating:e.options.ns_pos_allow_decimal_quantities,value:e.finalValue},on:{changed:function(t){return e.updateQuantity(t)},next:function(t){return e.defineQuantity(t)}}}):e._e(),e._v(" "),"advanced"===e.options.ns_pos_numpad?s("ns-numpad-plus",{attrs:{value:e.finalValue},on:{changed:function(t){return e.updateQuantity(t)},next:function(t){return e.defineQuantity(t)}}}):e._e()],1)}),[],!1,null,null,null).exports},9702:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(9671),n=s(6386),i=s(7266);function o(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?o(Object(s),!0).forEach((function(t){c(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const l={name:"ns-pos-shipping-popup",computed:{activeTabFields:function(){if(null!==this.tabs)for(var e in this.tabs)if(this.tabs[e].active)return this.tabs[e].fields;return[]},useBillingInfo:function(){return null!==this.tabs?this.tabs.billing.fields[0].value:new Object},useShippingInfo:function(){return null!==this.tabs?this.tabs.shipping.fields[0].value:new Object}},destroyed:function(){this.orderSubscription.unsubscribe()},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.resolveIfQueued(!1)})),this.orderSubscription=POS.order.subscribe((function(t){return e.order=t})),this.loadForm()},data:function(){return{tabs:null,orderSubscription:null,order:null,formValidation:new i.Z}},watch:{useBillingInfo:function(e){var t=this;1===e&&this.tabs.billing.fields.forEach((function(e){"_use_customer_billing"!==e.name&&(e.value=t.order.customer.billing?t.order.customer.billing[e.name]:e.value)}))},useShippingInfo:function(e){var t=this;1===e&&this.tabs.shipping.fields.forEach((function(e){"_use_customer_shipping"!==e.name&&(e.value=t.order.customer.shipping?t.order.customer.shipping[e.name]:e.value)}))}},methods:{__,resolveIfQueued:n.Z,submitInformations:function(){var e=this.formValidation.extractForm({tabs:this.tabs});for(var t in e.general)["shipping","shipping_rate"].includes(t)&&(e.general[t]=parseFloat(e.general[t]));this.order=a(a({},this.order),e.general),delete e.general,delete e.shipping._use_customer_shipping,delete e.billing._use_customer_billing,this.order.addresses=e,POS.order.next(this.order),POS.refreshCart(),this.resolveIfQueued(!0)},closePopup:function(){this.resolveIfQueued(!1)},toggle:function(e){for(var t in this.tabs)this.tabs[t].active=!1;this.tabs[e].active=!0},loadForm:function(){var e=this;r.ih.get("/api/nexopos/v4/forms/ns.pos-addresses").subscribe((function(t){var s=t.tabs,r=function(t){"general"===t?s[t].fields.forEach((function(t){t.value=e.order[t.name]||""})):s[t].fields.forEach((function(s){s.value=e.order.addresses[t]?e.order.addresses[t][s.name]:""}))};for(var n in s)r(n);e.tabs=e.formValidation.initializeTabs(s)}))}}};const u=(0,s(1900).Z)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ns-box w-6/7-screen md:w-4/5-screen lg:w-3/5-screen h-6/7-screen md:h-4/5-screen shadow-lg flex flex-col overflow-hidden"},[s("div",{staticClass:"p-2 border-b ns-box-header flex justify-between items-center"},[s("h3",{staticClass:"font-bold text-primary"},[e._v(e._s(e.__("Shipping & Billing")))]),e._v(" "),s("div",{staticClass:"tools"},[s("button",{staticClass:"ns-close-button rounded-full h-8 w-8 border items-center justify-center",on:{click:function(t){return e.closePopup()}}},[s("i",{staticClass:"las la-times"})])])]),e._v(" "),s("div",{staticClass:"flex-auto ns-box-body p-2 overflow-y-auto ns-tab"},[s("div",{attrs:{id:"tabs-container"}},[s("div",{staticClass:"header flex",staticStyle:{"margin-bottom":"-1px"}},e._l(e.tabs,(function(t,r){return s("div",{key:r,staticClass:"tab rounded-tl rounded-tr border tab  px-3 py-2 text-primary cursor-pointer",class:t.active?"border-b-0 active":"inactive",staticStyle:{"margin-right":"-1px"},on:{click:function(t){return e.toggle(r)}}},[e._v(e._s(t.label))])})),0),e._v(" "),s("div",{staticClass:"border ns-tab-item"},[s("div",{staticClass:"px-4"},[s("div",{staticClass:"-mx-4 flex flex-wrap"},e._l(e.activeTabFields,(function(t,r){return s("div",{key:r,class:"p-4 w-full md:w-1/2 lg:w-1/3"},[s("ns-field",{attrs:{field:t},on:{blur:function(s){return e.formValidation.checkField(t)},change:function(s){return e.formValidation.checkField(t)}}})],1)})),0)])])])]),e._v(" "),s("div",{staticClass:"p-2 flex justify-between border-t ns-box-footer"},[s("div"),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.submitInformations()}}},[e._v(e._s(e.__("Save")))])],1)])])}),[],!1,null,null,null).exports},9089:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const r={data:function(){return{title:"",message:"",input:""}},computed:{size:function(){return this.$popupParams.size||"h-full w-full"}},mounted:function(){var e=this;this.input=this.$popupParams.input||"",this.title=this.$popupParams.title,this.message=this.$popupParams.message,this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&(e.$popupParams.reject(!1),e.$popup.close())}))},methods:{__:s(7389).__,emitAction:function(e){this.$popupParams.onAction(e?this.input:e),this.$popup.close()},reject:function(e){void 0!==this.$popupParams.reject&&this.$popupParams.reject(e),this.$popup.close()}}};const n=(0,s(1900).Z)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"w-5/7-screen md:w-3/7-screen flex flex-col shadow-lg",class:e.size,attrs:{id:"prompt-popup"}},[s("div",{staticClass:"flex items-center justify-center flex-col flex-auto p-2"},[s("h2",{staticClass:"text-3xl font-body"},[e._v(e._s(e.title))]),e._v(" "),s("p",{staticClass:"w-full md:mx-auto md:w-2/3 py-4 text-center"},[e._v(e._s(e.message))])]),e._v(" "),s("div",{staticClass:"p-2"},[s("div",{staticClass:"ns-input"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.input,expression:"input"}],staticClass:"w-full border-2 p-2",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.input},on:{input:function(t){t.target.composing||(e.input=t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"flex border-t action-buttons"},[s("button",{staticClass:"flex-auto w-1/2 h-16 flex items-center justify-center uppercase",on:{click:function(t){return e.emitAction(!0)}}},[e._v(e._s(e.__("Ok")))]),e._v(" "),s("hr",{staticClass:"border-r"}),e._v(" "),s("button",{staticClass:"flex-auto w-1/2 h-16 flex items-center justify-center uppercase",on:{click:function(t){return e.reject(!1)}}},[e._v(e._s(e.__("Cancel")))])])])}),[],!1,null,null,null).exports},3296:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(8603),n=s(7389);const i={data:function(){return{value:[],options:[],description:"",label:null,type:"select"}},computed:{},mounted:function(){this.popupCloser(),this.value=this.$popupParams.value||[],this.options=this.$popupParams.options,this.label=this.$popupParams.label,this.description=this.$popupParams.description||"",this.type=this.$popupParams.type||this.type},methods:{popupCloser:r.Z,__:n.__,toggle:function(e){var t=this.value.indexOf(e);-1===t?this.value.unshift(e):this.value.splice(t,1)},isSelected:function(e){return this.value.indexOf(e)>=0},close:function(){this.$popupParams.reject(!1),this.$popup.close()},select:function(e){void 0!==e&&(this.value=[e]),this.$popupParams.resolve(this.value),this.close()}}};const o=(0,s(1900).Z)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-xl ns-box w-6/7-screen md:w-4/7-screen lg:w-3/7-screen max-h-5/6-screen overflow-hidden flex flex-col"},[s("div",{staticClass:"p-2 flex justify-between border-b items-center ns-box-header"},[s("span",{staticClass:"text-semibold text-primary"},[e._v("\n            "+e._s(e.label)+"\n        ")]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"flex flex-col overflow-hidden"},[e.description.length>0?s("p",{staticClass:"p-2 text-center text-sm bg-info-primary"},[e._v(e._s(e.description))]):e._e(),e._v(" "),s("div",{staticClass:"overflow-y-auto"},[s("ul",{staticClass:"ns-vertical-menu"},["select"===e.type?e._l(e.options,(function(t){return s("li",{key:t.value,staticClass:"p-2 border-b border-box-edge text-primary cursor-pointer",on:{click:function(s){return e.select(t)}}},[e._v(e._s(t.label))])})):e._e(),e._v(" "),"multiselect"===e.type?e._l(e.options,(function(t){return s("li",{key:t.value,staticClass:"p-2 border-b text-primary cursor-pointer",class:e.isSelected(t)?"active":"",on:{click:function(s){return e.toggle(t)}}},[e._v(e._s(t.label))])})):e._e()],2)])]),e._v(" "),"multiselect"===e.type?s("div",{staticClass:"flex justify-between"},[s("div"),e._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.select()}}},[e._v(e._s(e.__("Select")))])],1)]):e._e()])}),[],!1,null,null,null).exports}}]);