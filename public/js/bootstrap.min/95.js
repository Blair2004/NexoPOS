"use strict";(self.webpackChunknexopos_4x=self.webpackChunknexopos_4x||[]).push([[95,37],{1037:(t,e,r)=>{r.r(e),r.d(e,{default:()=>h});var i=r(7266),s=r(9671),n=r(3601),a=r(7389),o=r(7757),u=r.n(o),l=r(2242),c=r(3296);function d(t,e,r,i,s,n,a){try{var o=t[n](a),u=o.value}catch(t){return void r(t)}o.done?e(u):Promise.resolve(u).then(i,s)}const p={name:"ns-product-group",props:["fields"],watch:{searchValue:function(){var t=this;clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){t.searchProducts(t.searchValue)}),1e3)},products:{deep:!0,handler:function(){this.$forceUpdate()}}},computed:{totalProducts:function(){return this.products.length>0?(this.$emit("update",this.products),this.products.map((function(t){return parseFloat(t.sale_price)*parseFloat(t.quantity)})).reduce((function(t,e){return t+e}))):0}},mounted:function(){var t=this.fields.filter((function(t){return"product_subitems"===t.name}));t.length>0&&void 0!==t[0].value&&t[0].value.length>0&&(this.products=t[0].value)},data:function(){return{searchValue:"",searchTimeout:null,results:[],products:[]}},methods:{__:a.__,setSalePrice:function(){this.$emit("updateSalePrice",this.totalProducts)},removeProduct:function(t){var e=this;l.G.show(n.default,{title:(0,a.__)("Delete Sub item"),message:(0,a.__)("Would you like to delete this sub item?"),onAction:function(r){r&&e.products.splice(t,1)}})},toggleUnitField:function(t){var e=this;t._unit_toggled||(t._unit_toggled=!t._unit_toggled),setTimeout((function(){t._unit_toggled&&e.$refs.unitField[0].addEventListener("blur",(function(){t._unit_toggled=!1,e.$forceUpdate()}))}),200)},toggleQuantityField:function(t){var e=this;t._quantity_toggled=!t._quantity_toggled,setTimeout((function(){t._quantity_toggled&&(e.$refs.quantityField[0].select(),e.$refs.quantityField[0].addEventListener("blur",(function(){e.toggleQuantityField(t),e.$forceUpdate()})))}),200)},togglePriceField:function(t){var e=this;t._price_toggled=!t._price_toggled,setTimeout((function(){t._price_toggled&&(e.$refs.priceField[0].select(),e.$refs.priceField[0].addEventListener("blur",(function(){e.togglePriceField(t),e.$forceUpdate()})))}),200)},redefineUnit:function(t){var e=t.unit_quantities.filter((function(e){return e.id===t.unit_quantity_id}));e.length>0&&(t.unit_quantity=e[0],t.unit_id=e[0].unit.id,t.unit=e[0].unit,t.sale_price=e[0].sale_price)},addResult:function(t){var e,r=this;return(e=u().mark((function e(){var i,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.searchValue="","grouped"!==t.type){e.next=3;break}return e.abrupt("return",s.kX.error((0,a.__)("Unable to add a grouped product.")).subscribe());case 3:return e.prev=3,e.next=6,new Promise((function(e,r){l.G.show(c.Z,{label:(0,a.__)("Choose The Unit"),options:t.unit_quantities.map((function(t){return{label:t.unit.name,value:t.id}})),resolve:e,reject:r})}));case 6:i=e.sent,n=t.unit_quantities.filter((function(t){return parseInt(t.id)===parseInt(i[0].value)})),r.products.push({name:t.name,unit_quantity_id:i[0].value,unit_quantity:n[0],unit_id:n[0].unit.id,unit:n[0].unit,product_id:n[0].product_id,quantity:1,_price_toggled:!1,_quantity_toggled:!1,_unit_toggled:!1,unit_quantities:t.unit_quantities,sale_price:n[0].sale_price}),r.$emit("update",r.products),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[3,12]])})),function(){var t=this,r=arguments;return new Promise((function(i,s){var n=e.apply(t,r);function a(t){d(n,i,s,a,o,"next",t)}function o(t){d(n,i,s,a,o,"throw",t)}a(void 0)}))})()},searchProducts:function(t){var e=this;s.ih.post("/api/nexopos/v4/products/search",{search:t,arguments:{type:{comparison:"<>",value:"grouped"}}}).subscribe({next:function(t){e.results=t},error:function(t){s.kX.error(t.message||(0,a.__)("An unexpected error occurred"),(0,a.__)("Ok"),{duration:3e3}).subscribe()}})}}};var f=r(1900);function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){_(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const b={components:{nsProductGroup:(0,f.Z)(p,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flex flex-col px-4 w-full"},[r("div",{staticClass:"md:-mx-4 flex flex-col md:flex-row"},[r("div",{staticClass:"md:px-4 w-full"},[r("div",{staticClass:"input-group border-2 rounded info flex w-full"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"flex-auto p-2 outline-none",attrs:{placeholder:t.__("Search products..."),type:"text"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}}),t._v(" "),r("button",{staticClass:"px-2",on:{click:function(e){return t.setSalePrice()}}},[t._v(t._s(t.__("Set Sale Price")))])]),t._v(" "),t.results.length>0&&t.searchValue.length>0?r("div",{staticClass:"h-0 relative"},[r("ul",{staticClass:"ns-vertical-menu absolute w-full"},t._l(t.results,(function(e){return r("li",{key:e.id,staticClass:"p-2 border-b cursor-pointer",on:{click:function(r){return t.addResult(e)}}},[t._v(t._s(e.name))])})),0)]):t._e(),t._v(" "),r("div",{staticClass:"my-2"},[r("table",{staticClass:"ns-table"},[r("thead",[r("tr",[r("th",{staticClass:"border",attrs:{colspan:"2"}},[t._v(t._s(t.__("Products")))])])]),t._v(" "),r("tbody",[t._l(t.products,(function(e,i){return r("tr",{key:i},[r("td",{staticClass:"border p-2",attrs:{colspan:"2"}},[r("div",{staticClass:"flex justify-between"},[r("h3",{staticClass:"font-bold"},[t._v(t._s(e.name))]),t._v(" "),r("span",{staticClass:"hover:underline text-error-secondary cursor-pointer",on:{click:function(e){return t.removeProduct(i)}}},[t._v(t._s(t.__("Remove")))])]),t._v(" "),r("ul",[r("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(r){return t.toggleUnitField(e)}}},[r("span",[t._v(t._s(t.__("Unit"))+":")]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.unit_quantity_id,expression:"product.unit_quantity_id"}],ref:"unitField",refInFor:!0,attrs:{type:"text"},on:{change:[function(r){var i=Array.prototype.filter.call(r.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(e,"unit_quantity_id",r.target.multiple?i:i[0])},function(r){return t.redefineUnit(e)}]}},t._l(e.unit_quantities,(function(e){return r("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.unit.name))])})),0)]),t._v(" "),r("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(r){return t.toggleQuantityField(e)}}},[r("span",[t._v(t._s(t.__("Quantity"))+":")]),t._v(" "),e._quantity_toggled?t._e():r("span",{staticClass:"cursor-pointer border-b border-dashed border-info-secondary"},[t._v(t._s(e.quantity))]),t._v(" "),e._quantity_toggled?r("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"product.quantity"}],ref:"quantityField",refInFor:!0,attrs:{type:"text"},domProps:{value:e.quantity},on:{input:function(r){r.target.composing||t.$set(e,"quantity",r.target.value)}}}):t._e()]),t._v(" "),r("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(r){return t.togglePriceField(e)}}},[r("span",[t._v(t._s(t.__("Price"))+":")]),t._v(" "),e._price_toggled?t._e():r("span",{staticClass:"cursor-pointer border-b border-dashed border-info-secondary"},[t._v(t._s(t._f("currency")(e.sale_price)))]),t._v(" "),e._price_toggled?r("input",{directives:[{name:"model",rawName:"v-model",value:e.sale_price,expression:"product.sale_price"}],ref:"priceField",refInFor:!0,attrs:{type:"text"},domProps:{value:e.sale_price},on:{input:function(r){r.target.composing||t.$set(e,"sale_price",r.target.value)}}}):t._e()])])])])})),t._v(" "),0===t.products.length?r("tr",[r("td",{staticClass:"border p-2 text-center",attrs:{colspan:"2"}},[t._v("\n                                "+t._s(t.__("No product are added to this group."))+"\n                            ")])]):t._e()],2),t._v(" "),t.products.length>0?r("tfoot",[r("tr",[r("td",{staticClass:"w-1/2 border p-2 text-left"},[t._v(t._s(t.__("Total")))]),t._v(" "),r("td",{staticClass:"w-1/2 border p-2 text-right"},[t._v(t._s(t._f("currency")(t.totalProducts)))])])]):t._e()])])])])])}),[],!1,null,null,null).exports},data:function(){return{formValidation:new i.Z,nsSnackBar:s.kX,nsHttpClient:s.ih,_sampleVariation:null,form:""}},watch:{form:{deep:!0,handler:function(t){var e=this;this.form.variations.forEach((function(t){if("grouped"===e.formValidation.extractFields(t.tabs.identification.fields).type){for(var r in t.tabs)["identification","groups","taxes","units"].includes(r)||e.$set(t.tabs[r],"visible",!1);t.tabs.groups&&e.$set(t.tabs.groups,"visible",!0)}else{for(var i in t.tabs)["identification","groups","taxes","units"].includes(i)||e.$set(t.tabs[i],"visible",!0);t.tabs.groups&&e.$set(t.tabs.groups,"visible",!1)}}))}}},computed:{defaultVariation:function(){var t=new Object;for(var e in this._sampleVariation.tabs)t[e]=new Object,t[e].label=this._sampleVariation.tabs[e].label,t[e].active=this._sampleVariation.tabs[e].active,t[e].fields=this._sampleVariation.tabs[e].fields.filter((function(t){return!["category_id","product_type","stock_management","expires"].includes(t.name)})).map((function(t){return("string"==typeof t.value&&0===t.value.length||null===t.value)&&(t.value=""),t}));return{id:"",tabs:t}}},props:["submit-method","submit-url","return-url","src","units-url"],methods:{__:a.__,getGroupProducts:function(t){if(t.groups){var e=t.groups.fields.filter((function(t){return"products_subitems"===t.name}));if(console.log(e),e.length>0)return e[0].value}return[]},setProducts:function(t,e){e.groups.fields.forEach((function(e){"product_subitems"===e.name&&(e.value=t)}))},triggerRecompute:function(t){console.log(this.form)},getUnitQuantity:function(t){var e=t.filter((function(t){return"quantity"===t.name})).map((function(t){return t.value}));return e.length>0?e[0]:0},removeUnitPriceGroup:function(t,e){var r=this,i=t.filter((function(t){return"id"===t.name&&void 0!==t.value}));Popup.show(n.default,{title:(0,a.__)("Confirm Your Action"),message:(0,a.__)("Would you like to delete this group ?"),onAction:function(s){if(s)if(i.length>0)r.confirmUnitQuantityDeletion({group_fields:t,group:e});else{var n=e.indexOf(t);e.splice(n,1)}}})},confirmUnitQuantityDeletion:function(t){var e=t.group_fields,r=t.group;Popup.show(n.default,{title:(0,a.__)("Your Attention Is Required"),size:"w-3/4-screen h-2/5-screen",message:(0,a.__)("The current unit you're about to delete has a reference on the database and it might have already procured stock. Deleting that reference will remove procured stock. Would you proceed ?"),onAction:function(t){if(t){var i=e.filter((function(t){return"id"===t.name})).map((function(t){return t.value}))[0];s.ih.delete("/api/nexopos/v4/products/units/quantity/".concat(i)).subscribe((function(t){var i=r.indexOf(e);r.splice(i,1),s.kX.success(t.message).subscribe()}),(function(t){nsSnackbar.error(t.message).subscribe()}))}}})},addUnitGroup:function(t){if(0===t.options.length)return s.kX.error((0,a.__)("Please select at least one unit group before you proceed.")).subscribe();t.options.length>t.groups.length?t.groups.push(JSON.parse(JSON.stringify(t.fields))):s.kX.error((0,a.__)("There shoulnd't be more option than there are units.")).subscribe()},loadAvailableUnits:function(t){var e=this;s.ih.get(this.unitsUrl.replace("{id}",t.fields.filter((function(t){return"unit_group"===t.name}))[0].value)).subscribe((function(r){t.fields.forEach((function(t){"group"===t.type&&(t.options=r,t.fields.forEach((function(t){"unit_id"===t.name&&(console.log(t),t.options=r.map((function(t){return{label:t.name,value:t.id}})))})))})),e.$forceUpdate()}))},loadOptionsFor:function(t,e,r){var i=this;s.ih.get(this.unitsUrl.replace("{id}",e)).subscribe((function(e){i.form.variations[r].tabs.units.fields.forEach((function(r){r.name===t&&(r.options=e.map((function(t){return{label:t.name,value:t.id,selected:!1}})))})),i.$forceUpdate()}))},submit:function(){var t=this;if(this.formValidation.validateFields([this.form.main]),this.form.variations.map((function(e){return t.formValidation.validateForm(e)})).filter((function(t){return t.length>0})).length>0||Object.values(this.form.main.errors).length>0)return s.kX.error(this.$slots["error-form-invalid"]?this.$slots["error-form-invalid"][0].text:(0,a.__)("Unable to proceed the form is not valid.")).subscribe();var e=this.form.variations.map((function(t,e){return t.tabs.images.groups.filter((function(t){return t.filter((function(t){return"featured"===t.name&&1===t.value})).length>0}))}));if(e[0]&&e[0].length>1)return s.kX.error(this.$slots["error-multiple-primary"]?this.$slots["error-multiple-primary"][0].text:(0,a.__)("Unable to proceed, more than one product is set as featured")).subscribe();var r=[];if(this.form.variations.map((function(e,i){return e.tabs.units.fields.filter((function(t){return"group"===t.type})).forEach((function(e){new Object;e.groups.forEach((function(e){r.push(t.formValidation.validateFields(e))}))}))})),0===r.length)return s.kX.error(this.$slots["error-no-units-groups"]?this.$slots["error-no-units-groups"][0].text:(0,a.__)("Either Selling or Purchase unit isn't defined. Unable to proceed.")).subscribe();if(r.filter((function(t){return!1===t})).length>0)return this.$forceUpdate(),s.kX.error(this.$slots["error-invalid-unit-group"]?this.$slots["error-invalid-unit-group"][0].text:(0,a.__)("Unable to proceed as one of the unit group field is invalid")).subscribe();var i=v(v({},this.formValidation.extractForm(this.form)),{},{variations:this.form.variations.map((function(e,r){var i=t.formValidation.extractForm(e);0===r&&(i.$primary=!0),i.images=e.tabs.images.groups.map((function(e){return t.formValidation.extractFields(e)}));var s=new Object;return e.tabs.units.fields.filter((function(t){return"group"===t.type})).forEach((function(e){s[e.name]=e.groups.map((function(e){return t.formValidation.extractFields(e)}))})),i.units=v(v({},i.units),s),i}))});this.formValidation.disableForm(this.form),s.ih[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,i).subscribe((function(e){if("success"===e.status){if("POST"===t.submitMethod&&!1!==t.returnUrl)return document.location=e.data.editUrl||t.returnUrl;s.kX.info(e.message,(0,a.__)("Okay"),{duration:3e3}).subscribe(),t.$emit("save")}t.formValidation.enableForm(t.form)}),(function(e){s.kX.error(e.message,void 0,{duration:5e3}).subscribe(),t.formValidation.enableForm(t.form),e.response&&t.formValidation.triggerError(t.form,e.response.data)}))},deleteVariation:function(t){confirm(this.$slots["delete-variation"]?this.$slots["delete-variation"][0].text:(0,a.__)("Would you like to delete this variation ?"))&&this.form.variations.splice(t,1)},setTabActive:function(t,e){for(var r in e)r!==t&&(e[r].active=!1);e[t].active=!0,"units"===t&&this.loadAvailableUnits(e[t])},duplicate:function(t){this.form.variations.push(Object.assign({},t))},newVariation:function(){this.form.variations.push(this.defaultVariation)},getActiveTab:function(t){for(var e in t)if(t[e].active)return t[e];return!1},getActiveTabKey:function(t){for(var e in t)if(t[e].active)return e;return!1},parseForm:function(t){var e=this;return t.main.value=void 0===t.main.value?"":t.main.value,t.main=this.formValidation.createFields([t.main])[0],t.variations.forEach((function(t,r){var i=0;for(var s in t.tabs)0===i&&void 0===t.tabs[s].active?(t.tabs[s].active=!0,e._sampleVariation=JSON.parse(JSON.stringify(t)),t.tabs[s].fields&&(t.tabs[s].fields=e.formValidation.createFields(t.tabs[s].fields.filter((function(t){return"name"!==t.name}))))):t.tabs[s].fields&&(t.tabs[s].fields=e.formValidation.createFields(t.tabs[s].fields)),t.tabs[s].active=void 0!==t.tabs[s].active&&t.tabs[s].active,t.tabs[s].visible=void 0===t.tabs[s].visible||t.tabs[s].visible,i++})),t},loadForm:function(){var t=this;s.ih.get("".concat(this.src)).subscribe((function(e){t.form=t.parseForm(e.form)}))},addImage:function(t){t.tabs.images.groups.push(this.formValidation.createFields(JSON.parse(JSON.stringify(t.tabs.images.fields))))},removeImage:function(t,e){var r=t.tabs.images.groups.indexOf(e);t.tabs.images.groups.splice(r,1)}},mounted:function(){this.loadForm()},name:"ns-manage-products"};const h=(0,f.Z)(b,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"form flex-auto",attrs:{id:"crud-form"}},[0===Object.values(t.form).length?r("div",{staticClass:"flex items-center h-full justify-center flex-auto"},[r("ns-spinner")],1):t._e(),t._v(" "),Object.values(t.form).length>0?[r("div",{staticClass:"flex flex-col"},[r("div",{staticClass:"flex justify-between items-center"},[r("label",{staticClass:"font-bold my-2 text-primary",attrs:{for:"title"}},[t._v(t._s(t.form.main.label))]),t._v(" "),r("div",{staticClass:"text-sm my-2 text-primary",attrs:{for:"title"}},[t.returnUrl?r("a",{staticClass:"rounded-full border ns-inset-button error hover:bg-error-tertiary  px-2 py-1",attrs:{href:t.returnUrl}},[t._v(t._s(t.__("Return")))]):t._e()])]),t._v(" "),r("div",{staticClass:"input-group info flex border-2 rounded overflow-hidden",class:t.form.main.disabled?"":t.form.main.errors.length>0?"border-error-tertiary":""},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.form.main.value,expression:"form.main.value"}],staticClass:"flex-auto text-primary outline-none h-10 px-2",class:(t.form.main.disabled,""),attrs:{disabled:t.form.main.disabled,type:"text"},domProps:{value:t.form.main.value},on:{blur:function(e){return t.formValidation.checkField(t.form.main)},change:function(e){return t.formValidation.checkField(t.form.main)},input:function(e){e.target.composing||t.$set(t.form.main,"value",e.target.value)}}}),t._v(" "),r("button",{staticClass:"outline-none px-4 h-10 rounded-none",class:t.form.main.disabled?"":t.form.main.errors.length>0?"bg-error-tertiary":"",attrs:{disabled:t.form.main.disabled},on:{click:function(e){return t.submit()}}},[t._t("save",(function(){return[t._v(t._s(t.__("Save")))]}))],2)]),t._v(" "),t.form.main.description&&0===t.form.main.errors.length?r("p",{staticClass:"text-xs text-primary py-1"},[t._v(t._s(t.form.main.description))]):t._e(),t._v(" "),t._l(t.form.main.errors,(function(e,i){return r("p",{key:i,staticClass:"text-xs py-1 text-error-tertiary"},[r("span",[t._t("error-required",(function(){return[t._v(t._s(e.identifier))]}))],2)])}))],2),t._v(" "),r("div",{staticClass:"-mx-4 flex flex-wrap mt-4",attrs:{id:"form-container"}},[r("div",{staticClass:"px-4 w-full"},t._l(t.form.variations,(function(e,i){return r("div",{key:i,staticClass:"mb-8",attrs:{id:"tabbed-card"}},[r("div",{staticClass:"flex flex-wrap justify-between ns-tab",attrs:{id:"card-header"}},[r("div",{staticClass:"flex flex-wrap"},[t._l(e.tabs,(function(i,s){return[i.visible?r("div",{key:s,staticClass:"tab cursor-pointer text-primary px-4 py-2 rounded-tl-lg rounded-tr-lg flex justify-between",class:i.active?"active":"inactive",on:{click:function(r){return t.setTabActive(s,e.tabs)}}},[r("span",{staticClass:"block mr-2"},[t._v(t._s(i.label))]),t._v(" "),i.errors&&i.errors.length>0?r("span",{staticClass:"rounded-full bg-error-secondary text-white h-6 w-6 flex font-semibold items-center justify-center"},[t._v(t._s(i.errors.length))]):t._e()]):t._e()]}))],2),t._v(" "),r("div",{staticClass:"flex items-center justify-center -mx-1"})]),t._v(" "),r("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2"},[["images","units","groups"].includes(t.getActiveTabKey(e.tabs))?t._e():r("div",{staticClass:"-mx-4 flex flex-wrap"},[t._l(t.getActiveTab(e.tabs).fields,(function(t,e){return[r("div",{key:e,staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},[r("ns-field",{attrs:{field:t}})],1)]}))],2),t._v(" "),"images"===t.getActiveTabKey(e.tabs)?r("div",{staticClass:"-mx-4 flex flex-wrap text-primary"},[r("div",{staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},[r("div",{staticClass:"rounded border border-box-elevation-edge bg-box-elevation-background flex justify-between p-2 items-center"},[r("span",[t._v(t._s(t.__("Add Images")))]),t._v(" "),r("button",{staticClass:"outline-none rounded-full border flex items-center justify-center w-8 h-8 ns-inset-button info",on:{click:function(r){return t.addImage(e)}}},[r("i",{staticClass:"las la-plus-circle"})])])]),t._v(" "),t._l(t.getActiveTab(e.tabs).groups,(function(i,s){return r("div",{key:s,staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3 mb-4"},[r("div",{staticClass:"rounded border border-box-elevation-edge flex flex-col overflow-hidden"},[r("div",{staticClass:"p-2"},t._l(i,(function(t,e){return r("ns-field",{key:e,attrs:{field:t}})})),1),t._v(" "),r("div",{staticClass:"text-center py-2 border-t border-box-elevation-edge text-sm cursor-pointer",on:{click:function(r){return t.removeImage(e,i)}}},[t._v("\n                                        "+t._s(t.__("Remove Image"))+"\n                                    ")])])])}))],2):t._e(),t._v(" "),"groups"===t.getActiveTabKey(e.tabs)?r("div",{staticClass:"-mx-4 flex flex-wrap text-primary"},[r("ns-product-group",{attrs:{fields:t.getActiveTab(e.tabs).fields},on:{update:function(r){return t.setProducts(r,e.tabs)},updateSalePrice:function(r){return t.triggerRecompute(r,e.tabs)}}})],1):t._e(),t._v(" "),"units"===t.getActiveTabKey(e.tabs)?r("div",{staticClass:"-mx-4 flex flex-wrap"},[r("div",{staticClass:"px-4 w-full md:w-1/2 lg:w-1/3"},[r("ns-field",{attrs:{field:t.getActiveTab(e.tabs).fields[0]},on:{change:function(r){t.loadAvailableUnits(t.getActiveTab(e.tabs))}}}),t._v(" "),r("ns-field",{attrs:{field:t.getActiveTab(e.tabs).fields[1]},on:{change:function(r){t.loadAvailableUnits(t.getActiveTab(e.tabs))}}})],1),t._v(" "),t._l(t.getActiveTab(e.tabs).fields,(function(e,i){return["group"===e.type?r("div",{key:i,staticClass:"px-4 w-full lg:w-2/3"},[r("div",{staticClass:"mb-2"},[r("label",{staticClass:"font-medium text-primary"},[t._v(t._s(e.label))]),t._v(" "),r("p",{staticClass:"py-1 text-sm text-primary"},[t._v(t._s(e.description))])]),t._v(" "),r("div",{staticClass:"mb-2"},[r("div",{staticClass:"border-dashed border-2 p-1 bg-box-elevation-background border-box-elevation-edge flex justify-between items-center text-primary cursor-pointer rounded-lg",on:{click:function(r){return t.addUnitGroup(e)}}},[t._m(0,!0),t._v(" "),r("span",[t._v(t._s(t.__("New Group")))])])]),t._v(" "),r("div",{staticClass:"-mx-4 flex flex-wrap"},t._l(e.groups,(function(i,s){return r("div",{key:s,staticClass:"px-4 w-full md:w-1/2 mb-4"},[r("div",{staticClass:"shadow rounded overflow-hidden bg-box-elevation-background text-primary"},[r("div",{staticClass:"border-b text-sm p-2 flex justify-between text-primary border-box-elevation-edge"},[r("span",[t._v(t._s(t.__("Available Quantity")))]),t._v(" "),r("span",[t._v(t._s(t.getUnitQuantity(i)))])]),t._v(" "),r("div",{staticClass:"p-2 mb-2"},t._l(i,(function(t,e){return r("ns-field",{key:e,attrs:{field:t}})})),1),t._v(" "),r("div",{staticClass:"p-1 hover:bg-error-primary border-t border-box-elevation-edge flex items-center justify-center cursor-pointer font-medium",on:{click:function(r){return t.removeUnitPriceGroup(i,e.groups)}}},[t._v("\n                                                    "+t._s(t.__("Delete"))+"\n                                                ")])])])})),0)]):t._e()]}))],2):t._e()])])})),0)])]:t._e()],2)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"rounded-full border-2 ns-inset-button info h-8 w-8 flex items-center justify-center"},[e("i",{staticClass:"las la-plus-circle"})])}],!1,null,null,null).exports},5095:(t,e,r)=>{r.r(e),r.d(e,{default:()=>b});var i=r(7266),s=r(2277),n=r(9671),a=r(1037);function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,i;return e=t,i=[{key:"compute",value:function(e,r,i){switch(e){case"inclusive":return t.computeInclusive(r,i);case"exclusive":return t.computeExclusive(r,i)}}},{key:"computeInclusive",value:function(t,e){return t/(e+100)*100}},{key:"computeExclusive",value:function(t,e){return t/100*(e+100)}},{key:"getTaxValue",value:function(e,r,i){switch(e){case"inclusive":return r-t.compute(e,r,i);case"exclusive":return t.compute(e,r,i)-r}return 0}}],(r=null)&&o(e.prototype,r),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),l=r(7389);const c={name:"ns-procurement-product-options",data:function(){return{validation:new i.Z,fields:[],rawFields:[{label:(0,l.__)("Expiration Date"),name:"expiration_date",description:(0,l.__)("Define when that specific product should expire."),type:"datetimepicker"},{label:(0,l.__)("Barcode"),name:"barcode",description:(0,l.__)("Renders the automatically generated barcode."),type:"text",disabled:!0},{label:(0,l.__)("Tax Type"),name:"tax_type",description:(0,l.__)("Adjust how tax is calculated on the item."),type:"select",options:[{label:(0,l.__)("Inclusive"),value:"inclusive"},{label:(0,l.__)("Exclusive"),value:"exclusive"}]}]}},methods:{__:l.__,applyChanges:function(){if(this.validation.validateFields(this.fields)){var t=this.validation.extractFields(this.fields);return this.$popupParams.resolve(t),this.$popup.close()}return n.kX.error((0,l.__)("Unable to proceed. The form is not valid.")).subscribe()}},mounted:function(){var t=this;this.$popup.event.subscribe((function(e){"click-overlay"===e.event&&t.$popup.close()}));var e=this.rawFields.map((function(e){return"expiration_date"===e.name&&(e.value=t.$popupParams.product.procurement.expiration_date),"tax_type"===e.name&&(e.value=t.$popupParams.product.procurement.tax_type),"barcode"===e.name&&(e.value=t.$popupParams.product.procurement.barcode),e}));this.fields=this.validation.createFields(e)}};var d=r(1900);const p=(0,d.Z)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"ns-box shadow-lg w-6/7-screen md:w-5/7-screen lg:w-3/7-screen"},[r("div",{staticClass:"p-2 border-b ns-box-header"},[r("h5",{staticClass:"font-semibold"},[t._v(t._s(t.__("Options")))])]),t._v(" "),r("div",{staticClass:"p-2 border-b ns-box-body"},t._l(t.fields,(function(t,e){return r("ns-field",{key:e,staticClass:"w-full",attrs:{field:t}})})),1),t._v(" "),r("div",{staticClass:"p-2 flex justify-end ns-box-body"},[r("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.applyChanges()}}},[t._v(t._s(t.__("Save")))])],1)])}),[],!1,null,null,null).exports;function f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?f(Object(r),!0).forEach((function(e){v(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function v(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const _={name:"ns-procurement",mounted:function(){this.reloadEntities()},computed:{activeTab:function(){return this.validTabs.filter((function(t){return t.active})).length>0&&this.validTabs.filter((function(t){return t.active}))[0]}},data:function(){return{totalTaxValues:0,totalPurchasePrice:0,formValidation:new i.Z,form:{},nsSnackBar:n.kX,fields:[],searchResult:[],searchValue:"",debounceSearch:null,nsHttpClient:n.ih,taxes:[],validTabs:[{label:(0,l.__)("Details"),identifier:"details",active:!0},{label:(0,l.__)("Products"),identifier:"products",active:!1}],reloading:!1}},watch:{searchValue:function(t){var e=this;t&&(clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout((function(){e.doSearch(t)}),500))}},components:{nsManageProducts:a.default},props:["submit-method","submit-url","return-url","src","rules"],methods:{__:l.__,computeTotal:function(){this.totalTaxValues=0,this.form.products.length>0&&(this.totalTaxValues=this.form.products.map((function(t){return t.procurement.tax_value})).reduce((function(t,e){return t+e}))),this.totalPurchasePrice=0,this.form.products.length>0&&(this.totalPurchasePrice=this.form.products.map((function(t){return parseFloat(t.procurement.total_purchase_price)})).reduce((function(t,e){return t+e})))},updateLine:function(t){var e=this.form.products[t],r=this.taxes.filter((function(t){return t.id===e.procurement.tax_group_id}));if(parseFloat(e.procurement.purchase_price_edit)>0&&parseFloat(e.procurement.quantity)>0){if(r.length>0){var i=r[0].taxes.map((function(t){return u.getTaxValue(e.procurement.tax_type,e.procurement.purchase_price_edit,parseFloat(t.rate))}));e.procurement.tax_value=i.reduce((function(t,e){return t+e})),"inclusive"===e.procurement.tax_type?(e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit)-e.procurement.tax_value,e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.gross_purchase_price)):(e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit)+e.procurement.tax_value,e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.gross_purchase_price))}else e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.tax_value=0;e.procurement.tax_value=e.procurement.tax_value*parseFloat(e.procurement.quantity),e.procurement.total_purchase_price=e.procurement.purchase_price*parseFloat(e.procurement.quantity)}this.computeTotal(),this.$forceUpdate()},fetchLastPurchasePrice:function(t){var e=this.form.products[t],r=e.unit_quantities.filter((function(t){return e.procurement.unit_id===t.unit_id}));r.length>0&&(e.procurement.purchase_price_edit=r[0].last_purchase_price||0),this.updateLine(t)},switchTaxType:function(t,e){t.procurement.tax_type="inclusive"===t.procurement.tax_type?"exclusive":"inclusive",this.updateLine(e)},doSearch:function(t){var e=this;n.ih.post("/api/nexopos/v4/procurements/products/search-product",{search:t}).subscribe((function(t){1===t.length?e.addProductList(t[0]):t.length>1?e.searchResult=t:n.kX.error((0,l.__)("No result match your query.")).subscribe()}))},reloadEntities:function(){var t=this;this.reloading=!0,(0,s.D)([n.ih.get("/api/nexopos/v4/categories"),n.ih.get("/api/nexopos/v4/products"),n.ih.get(this.src),n.ih.get("/api/nexopos/v4/taxes/groups")]).subscribe((function(e){t.reloading=!1,t.categories=e[0],t.products=e[1],t.taxes=e[3],t.form.general&&e[2].tabs.general.fieds.forEach((function(e,r){e.value=t.form.tabs.general.fields[r].value||""})),t.form=Object.assign(JSON.parse(JSON.stringify(e[2])),t.form),t.form=t.formValidation.createForm(t.form),t.form.tabs&&t.form.tabs.general.fields.forEach((function(t,r){t.options&&(t.options=e[2].tabs.general.fields[r].options)})),0===t.form.products.length&&(t.form.products=t.form.products.map((function(t){return["gross_purchase_price","purchase_price_edit","tax_value","net_purchase_price","purchase_price","total_price","total_purchase_price","quantity","tax_group_id"].forEach((function(e){void 0===t[e]&&(t[e]=void 0===t[e]?0:t[e])})),t.$invalid=t.$invalid||!1,t.purchase_price_edit=t.purchase_price,{name:t.name,purchase_units:t.purchase_units,procurement:t,unit_quantities:t.unit_quantities||[]}}))),t.$forceUpdate()}))},setTabActive:function(t){this.validTabs.forEach((function(t){return t.active=!1})),this.$forceUpdate(),this.$nextTick().then((function(){t.active=!0}))},addProductList:function(t){if(void 0===t.unit_quantities)return n.kX.error((0,l.__)("Unable to add product which doesn't unit quantities defined.")).subscribe();t.procurement=new Object,t.procurement.gross_purchase_price=0,t.procurement.purchase_price_edit=0,t.procurement.tax_value=0,t.procurement.net_purchase_price=0,t.procurement.purchase_price=0,t.procurement.total_price=0,t.procurement.total_purchase_price=0,t.procurement.quantity=1,t.procurement.expiration_date=null,t.procurement.tax_group_id=0,t.procurement.tax_type="inclusive",t.procurement.unit_id=0,t.procurement.product_id=t.id,t.procurement.procurement_id=null,t.procurement.$invalid=!1,this.searchResult=[],this.searchValue="",this.form.products.push(t)},submit:function(){var t=this;if(0===this.form.products.length)return n.kX.error(this.$slots["error-no-products"]?this.$slots["error-no-products"][0].text:(0,l.__)("Unable to proceed, no product were provided."),this.$slots.okay?this.$slots.okay[0].text:(0,l.__)("OK")).subscribe();if(this.form.products.forEach((function(t){!parseFloat(t.procurement.quantity)>=1||0===t.procurement.unit_id?t.procurement.$invalid=!0:t.procurement.$invalid=!1})),this.form.products.filter((function(t){return t.procurement.$invalid})).length>0)return n.kX.error(this.$slots["error-invalid-products"]?this.$slots["error-invalid-products"][0].text:(0,l.__)("Unable to proceed, one or more product has incorrect values."),this.$slots.okay?this.$slots.okay[0].text:(0,l.__)("OK")).subscribe();if(this.formValidation.validateForm(this.form).length>0)return this.setTabActive(this.activeTab),n.kX.error(this.$slots["error-invalid-form"]?this.$slots["error-invalid-form"][0].text:(0,l.__)("Unable to proceed, the procurement form is not valid."),this.$slots.okay?this.$slots.okay[0].text:(0,l.__)("OK")).subscribe();if(void 0===this.submitUrl)return n.kX.error(this.$slots["error-no-submit-url"]?this.$slots["error-no-submit-url"][0].text:(0,l.__)("Unable to submit, no valid submit URL were provided."),this.$slots.okay?this.$slots.okay[0].text:(0,l.__)("OK")).subscribe();this.formValidation.disableForm(this.form);var e=m(m({},this.formValidation.extractForm(this.form)),{products:this.form.products.map((function(t){return t.procurement}))});n.ih[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,e).subscribe((function(e){if("success"===e.status)return document.location=t.returnUrl;t.formValidation.enableForm(t.form)}),(function(e){n.kX.error(e.message,void 0,{duration:5e3}).subscribe(),t.formValidation.enableForm(t.form),e.errors&&t.formValidation.triggerError(t.form,e.errors)}))},deleteProduct:function(t){this.form.products.splice(t,1),this.$forceUpdate()},handleGlobalChange:function(t){this.globallyChecked=t,this.rows.forEach((function(e){return e.$checked=t}))},setProductOptions:function(t){var e=this;new Promise((function(r,i){Popup.show(p,{product:e.form.products[t],resolve:r,reject:i})})).then((function(r){for(var i in r)e.form.products[t].procurement[i]=r[i];e.updateLine(t)}))}}};const b=(0,d.Z)(_,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"form flex-auto flex flex-col",attrs:{id:"crud-form"}},[t.form.main?[r("div",{staticClass:"flex flex-col"},[r("div",{staticClass:"flex justify-between items-center"},[r("label",{staticClass:"font-bold my-2 text-primary",attrs:{for:"title"}},[t._v(t._s(t.form.main.label||t.__("No title is provided")))]),t._v(" "),r("div",{staticClass:"text-sm my-2 text-primary",attrs:{for:"title"}},[t.returnUrl?r("a",{staticClass:"rounded-full ns-inset-button border px-2 py-1",attrs:{href:t.returnUrl}},[t._v(t._s(t.__("Go Back")))]):t._e()])]),t._v(" "),r("div",{staticClass:"flex border-2 rounded input-group info overflow-hidden",class:t.form.main.disabled?"disabled":t.form.main.errors.length>0?"error":""},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.form.main.value,expression:"form.main.value"}],staticClass:"flex-auto outline-none h-10 px-2",class:(t.form.main.disabled,""),attrs:{disabled:t.form.main.disabled,type:"text"},domProps:{value:t.form.main.value},on:{blur:function(e){return t.formValidation.checkField(t.form.main)},change:function(e){return t.formValidation.checkField(t.form.main)},input:function(e){e.target.composing||t.$set(t.form.main,"value",e.target.value)}}}),t._v(" "),r("button",{staticClass:"outline-none px-4 h-10 border-l",attrs:{disabled:t.form.main.disabled},on:{click:function(e){return t.submit()}}},[t._t("save",(function(){return[t._v(t._s(t.__("Save")))]}))],2),t._v(" "),r("button",{staticClass:"outline-none px-4 h-10",on:{click:function(e){return t.reloadEntities()}}},[r("i",{staticClass:"las la-sync",class:t.reloading?"animate animate-spin":""})])]),t._v(" "),t.form.main.description&&0===t.form.main.errors.length?r("p",{staticClass:"text-xs text-primary py-1"},[t._v(t._s(t.form.main.description))]):t._e(),t._v(" "),t._l(t.form.main.errors,(function(e,i){return r("p",{key:i,staticClass:"text-xs py-1 text-error-primary"},[r("span",[t._t("error-required",(function(){return[t._v(t._s(e.identifier))]}))],2)])}))],2),t._v(" "),r("div",{staticClass:"-mx-4 flex flex-wrap mt-4",attrs:{id:"form-container"}},[r("div",{staticClass:"px-4 w-full"},[r("div",{staticClass:"ns-tab",attrs:{id:"tabbed-card"}},[r("div",{staticClass:"flex flex-wrap",attrs:{id:"card-header"}},t._l(t.validTabs,(function(e,i){return r("div",{key:i,staticClass:"tab cursor-pointer px-4 py-2 rounded-tl-lg rounded-tr-lg text-primary",class:e.active?"active":"inactive",on:{click:function(r){return t.setTabActive(e)}}},[t._v("\n                            "+t._s(e.label)+"\n                        ")])})),0),t._v(" "),"details"===t.activeTab.identifier?r("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2"},[t.form.tabs?r("div",{staticClass:"-mx-4 flex flex-wrap"},t._l(t.form.tabs.general.fields,(function(t,e){return r("div",{key:e,staticClass:"flex px-4 w-full md:w-1/2 lg:w-1/3"},[r("ns-field",{attrs:{field:t}})],1)})),0):t._e()]):t._e(),t._v(" "),"products"===t.activeTab.identifier?r("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2 "},[r("div",{staticClass:"mb-2"},[r("div",{staticClass:"input-group info flex border-2 rounded overflow-hidden"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"flex-auto text-primary outline-none h-10 px-2",attrs:{type:"text",placeholder:t.$slots["search-placeholder"]?t.$slots["search-placeholder"][0].text:"SKU, Barcode, Name"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}})]),t._v(" "),r("div",{staticClass:"h-0"},[r("div",{staticClass:"shadow bg-floating-menu relative z-10"},t._l(t.searchResult,(function(e,i){return r("div",{key:i,staticClass:"cursor-pointer border border-b hover:bg-floating-menu-hover border-floating-menu-edge p-2 text-primary",on:{click:function(r){return t.addProductList(e)}}},[r("span",{staticClass:"block font-bold text-primary"},[t._v(t._s(e.name))]),t._v(" "),r("span",{staticClass:"block text-sm text-priamry"},[t._v(t._s(t.__("SKU"))+" : "+t._s(e.sku))]),t._v(" "),r("span",{staticClass:"block text-sm text-primary"},[t._v(t._s(t.__("Barcode"))+" : "+t._s(e.barcode))])])})),0)])]),t._v(" "),r("div",{staticClass:"overflow-x-auto"},[r("table",{staticClass:"w-full ns-table"},[r("thead",[r("tr",t._l(t.form.columns,(function(e,i){return r("td",{key:i,staticClass:"text-primary p-2 border",attrs:{width:"200"}},[t._v(t._s(e.label))])})),0)]),t._v(" "),r("tbody",[t._l(t.form.products,(function(e,i){return r("tr",{key:i,class:e.procurement.$invalid?"error border-2 border-error-primary":""},[t._l(t.form.columns,(function(s,n){return["name"===s.type?r("td",{key:n,staticClass:"p-2 text-primary border"},[r("span",{staticClass:"font-semibold"},[t._v(t._s(e.name))]),t._v(" "),r("div",{staticClass:"flex justify-between"},[r("div",{staticClass:"flex -mx-1 flex-col"},[r("div",{staticClass:"px-1"},[r("span",{staticClass:"text-xs text-error-primary cursor-pointer underline px-1",on:{click:function(e){return t.deleteProduct(i)}}},[t._v(t._s(t.__("Delete")))])])]),t._v(" "),r("div",{staticClass:"flex -mx-1 flex-col"},[r("div",{staticClass:"px-1"},[r("span",{staticClass:"text-xs text-error-primary cursor-pointer underline px-1",on:{click:function(e){return t.setProductOptions(i)}}},[t._v(t._s(t.__("Options")))])])])])]):t._e(),t._v(" "),"text"===s.type?r("td",{key:n,staticClass:"p-2 w-3 text-primary border"},[r("div",{staticClass:"flex items-start"},[r("div",{staticClass:"input-group rounded border-2"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.procurement[n],expression:"product.procurement[ key ]"}],staticClass:"w-24 p-2",attrs:{type:"text"},domProps:{value:e.procurement[n]},on:{change:function(e){return t.updateLine(i)},input:function(r){r.target.composing||t.$set(e.procurement,n,r.target.value)}}})])])]):t._e(),t._v(" "),"tax_group_id"===s.type?r("td",{key:n,staticClass:"p-2 text-primary border"},[r("div",{staticClass:"flex items-start"},[r("div",{staticClass:"input-group rounded border-2"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.procurement.tax_group_id,expression:"product.procurement.tax_group_id"}],staticClass:"p-2",on:{change:[function(r){var i=Array.prototype.filter.call(r.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(e.procurement,"tax_group_id",r.target.multiple?i:i[0])},function(e){return t.updateLine(i)}]}},t._l(t.taxes,(function(e){return r("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})),0)])])]):t._e(),t._v(" "),"custom_select"===s.type?r("td",{key:n,staticClass:"p-2 text-primary border"},[r("div",{staticClass:"flex items-start"},[r("div",{staticClass:"input-group rounded border-2"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.procurement[n],expression:"product.procurement[ key ]"}],staticClass:"p-2",on:{change:[function(r){var i=Array.prototype.filter.call(r.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(e.procurement,n,r.target.multiple?i:i[0])},function(e){return t.updateLine(i)}]}},t._l(s.options,(function(e){return r("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.label))])})),0)])])]):t._e(),t._v(" "),"currency"===s.type?r("td",{key:n,staticClass:"p-2 text-primary border"},[r("div",{staticClass:"flex items-start flex-col justify-end"},[r("span",{staticClass:"text-sm text-primary"},[t._v(t._s(t._f("currency")(e.procurement[n])))])])]):t._e(),t._v(" "),"unit_quantities"===s.type?r("td",{key:n,staticClass:"p-2 text-primary border"},[r("div",{staticClass:"flex items-start"},[r("div",{staticClass:"input-group rounded border-2"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.procurement.unit_id,expression:"product.procurement.unit_id"}],staticClass:"p-2 w-32",on:{change:[function(r){var i=Array.prototype.filter.call(r.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(e.procurement,"unit_id",r.target.multiple?i:i[0])},function(e){return t.fetchLastPurchasePrice(i)}]}},t._l(e.unit_quantities,(function(e){return r("option",{key:e.id,domProps:{value:e.unit.id}},[t._v(t._s(e.unit.name))])})),0)])])]):t._e()]}))],2)})),t._v(" "),r("tr",{staticClass:"text-primary"},[r("td",{staticClass:"p-2 border",attrs:{colspan:Object.keys(t.form.columns).indexOf("tax_value")}}),t._v(" "),r("td",{staticClass:"p-2 border"},[t._v(t._s(t._f("currency")(t.totalTaxValues)))]),t._v(" "),r("td",{staticClass:"p-2 border",attrs:{colspan:Object.keys(t.form.columns).indexOf("total_purchase_price")-(Object.keys(t.form.columns).indexOf("tax_value")+1)}}),t._v(" "),r("td",{staticClass:"p-2 border"},[t._v(t._s(t._f("currency")(t.totalPurchasePrice)))])])],2)])])]):t._e()])])])]:t._e()],2)}),[],!1,null,null,null).exports},3296:(t,e,r)=>{r.d(e,{Z:()=>a});var i=r(8603),s=r(7389);const n={data:function(){return{value:[],options:[],description:"",label:null,type:"select"}},computed:{},mounted:function(){this.popupCloser(),this.value=this.$popupParams.value||[],this.options=this.$popupParams.options,this.label=this.$popupParams.label,this.description=this.$popupParams.description||"",this.type=this.$popupParams.type||this.type},methods:{popupCloser:i.Z,__:s.__,toggle:function(t){var e=this.value.indexOf(t);-1===e?this.value.unshift(t):this.value.splice(e,1)},isSelected:function(t){return this.value.indexOf(t)>=0},close:function(){this.$popupParams.reject(!1),this.$popup.close()},select:function(t){void 0!==t&&(this.value=[t]),this.$popupParams.resolve(this.value),this.close()}}};const a=(0,r(1900).Z)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"shadow-xl ns-box w-6/7-screen md:w-4/7-screen lg:w-3/7-screen max-h-5/6-screen overflow-hidden flex flex-col"},[r("div",{staticClass:"p-2 flex justify-between border-b items-center ns-box-header"},[r("span",{staticClass:"text-semibold text-primary"},[t._v("\n            "+t._s(t.label)+"\n        ")]),t._v(" "),r("div",[r("ns-close-button",{on:{click:function(e){return t.close()}}})],1)]),t._v(" "),r("div",{staticClass:"flex flex-col overflow-hidden"},[t.description.length>0?r("p",{staticClass:"p-2 text-center text-sm bg-info-primary"},[t._v(t._s(t.description))]):t._e(),t._v(" "),r("div",{staticClass:"overflow-y-auto"},[r("ul",{staticClass:"ns-vertical-menu"},["select"===t.type?t._l(t.options,(function(e){return r("li",{key:e.value,staticClass:"p-2 border-b border-box-edge text-primary cursor-pointer",on:{click:function(r){return t.select(e)}}},[t._v(t._s(e.label))])})):t._e(),t._v(" "),"multiselect"===t.type?t._l(t.options,(function(e){return r("li",{key:e.value,staticClass:"p-2 border-b text-primary cursor-pointer",class:t.isSelected(e)?"active":"",on:{click:function(r){return t.toggle(e)}}},[t._v(t._s(e.label))])})):t._e()],2)])]),t._v(" "),"multiselect"===t.type?r("div",{staticClass:"flex justify-between"},[r("div"),t._v(" "),r("div",[r("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.select()}}},[t._v(t._s(t.__("Select")))])],1)]):t._e()])}),[],!1,null,null,null).exports}}]);