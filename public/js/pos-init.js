(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{264:function(e,t,r){e.exports=r(275)},273:function(e,t,r){"use strict";r.r(t);var s=r(8),n=r.n(s),i=r(0),o=r(26),a=r(7),u=r(12),c=r(11),l={components:{nsNumpad:o.a},data:function(){return{amount:0,title:null,identifier:null,settingsSubscription:null,settings:null,action:null,loaded:!1,register_id:null,validation:new a.a,fields:[]}},mounted:function(){var e=this;this.title=this.$popupParams.title,this.identifier=this.$popupParams.identifier,this.action=this.$popupParams.action,this.register_id=this.$popupParams.register_id,this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t})),this.loadFields()},destroyed:function(){this.settingsSubscription.unsubscribe()},methods:{popupCloser:u.a,definedValue:function(e){this.amount=e},close:function(){this.$popup.close()},loadFields:function(){var e=this;this.loaded=!1,nsHttpClient.get("/api/nexopos/v4/fields/".concat(this.identifier)).subscribe((function(t){e.loaded=!0,e.fields=t}),(function(t){return e.loaded=!0,nsSnackBar.error(t.message,"OKAY",{duration:!1}).subscribe()}))},submit:function(e){var t=this;Popup.show(c.default,{title:"Confirm Your Action",message:this.$popupParams.confirmMessage||"Would you like to confirm your action.",onAction:function(e){e&&t.triggerSubmit()}})},triggerSubmit:function(){var e=this,t=this.validation.extractFields(this.fields);t.amount=this.amount,nsHttpClient.post("/api/nexopos/v4/cash-registers/".concat(this.action,"/").concat(this.register_id||this.settings.register.id),t).subscribe((function(t){e.$popupParams.resolve(t),e.$popup.close(),nsSnackBar.success(t.message).subscribe()}),(function(e){nsSnackBar.error(e.message).subscribe()}))}}},d=r(2),p=Object(d.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shadow-lg w-95vw md:w-2/5-screen bg-white"},[r("div",{staticClass:"border-b border-gray-200 p-2 text-gray-700 flex justify-between items-center"},[r("h3",{staticClass:"font-semibold"},[e._v(e._s(e.title))]),e._v(" "),r("div",[r("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),e.loaded?r("div",{staticClass:"p-2"},[null!==e.settings&&e.settings.register?r("div",{staticClass:"mb-2 p-3 bg-gray-400 font-bold text-white text-right flex justify-between"},[r("span",[e._v("Balance ")]),e._v(" "),r("span",[e._v(e._s(e._f("currency")(e.settings.register.balance)))])]):e._e(),e._v(" "),r("div",{staticClass:"mb-2 p-3 bg-green-400 font-bold text-white text-right flex justify-between"},[r("span",[e._v("Input")]),e._v(" "),r("span",[e._v(e._s(e._f("currency")(e.amount)))])]),e._v(" "),r("div",{staticClass:"mb-2"},[r("ns-numpad",{attrs:{value:e.amount},on:{next:function(t){return e.submit(t)},changed:function(t){return e.definedValue(t)}}})],1),e._v(" "),e._l(e.fields,(function(e,t){return r("ns-field",{key:t,attrs:{field:e}})}))],2):e._e(),e._v(" "),e.loaded?e._e():r("div",{staticClass:"flex items-center justify-center"},[r("ns-spinner")],1)])}),[],!1,null,null,null).exports,f=r(14);function h(e,t,r,s,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(s,n)}var v={components:{nsNumpad:o.a},data:function(){return{registers:[],priorVerification:!1,hasLoadedRegisters:!1,validation:new a.a,amount:0,settings:null,settingsSubscription:null}},mounted:function(){var e=this;this.checkUsedRegister(),this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t}))},beforeDestroy:function(){this.settingsSubscription.unsubscribe()},computed:{},methods:{popupResolver:f.a,selectRegister:function(e){var t,r=this;return(t=n.a.mark((function t(){var s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("closed"===e.status){t.next=2;break}return t.abrupt("return",i.nsSnackBar.error("Unable to open this register. Only closed register can be opened.").subscribe());case 2:return t.prev=2,t.next=5,new Promise((function(t,r){var s="Open Register : %s".replace("%s",e.name),n=e.id;Popup.show(p,{resolve:t,reject:r,title:s,identifier:"ns.cash-registers-opening",action:"open",register_id:n})}));case 5:s=t.sent,r.popupResolver(s),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})),function(){var e=this,r=arguments;return new Promise((function(s,n){var i=t.apply(e,r);function o(e){h(i,s,n,o,a,"next",e)}function a(e){h(i,s,n,o,a,"throw",e)}o(void 0)}))})()},checkUsedRegister:function(){var e=this;this.priorVerification=!1,i.nsHttpClient.get("/api/nexopos/v4/cash-registers/used").subscribe((function(t){e.$popupParams.resolve(t),e.$popup.close()}),(function(t){e.priorVerification=!0,i.nsSnackBar.error(t.message).subscribe(),e.loadRegisters()}))},loadRegisters:function(){var e=this;this.hasLoadedRegisters=!1,i.nsHttpClient.get("/api/nexopos/v4/cash-registers").subscribe((function(t){e.registers=t,e.hasLoadedRegisters=!0}))},getClass:function(e){switch(e.status){case"in-use":return"bg-teal-200 text-gray-800 cursor-not-allowed";case"disabled":return"bg-gray-200 text-gray-700 cursor-not-allowed";case"available":return"bg-green-100 text-gray-800"}return"border-gray-200 cursor-pointer hover:bg-blue-400 hover:text-white"}}},b=Object(d.a)(v,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"w-95vw md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen flex flex-col overflow-hidden",class:e.priorVerification?"shadow-lg bg-white":""},[e.priorVerification?[r("div",{staticClass:"title p-2 border-b border-gray-200 flex justify-between items-center"},[r("h3",{staticClass:"font-semibold"},[e._v("Open The Register")]),e._v(" "),e.settings?r("div",[r("a",{staticClass:"hover:bg-red-400 hover:border-red-500 hover:text-white rounded-full border border-gray-200 px-3 text-sm py-1",attrs:{href:e.settings.urls.orders_url}},[e._v("Exit To Orders")])]):e._e()]),e._v(" "),e.hasLoadedRegisters?e._e():r("div",{staticClass:"p-2 flex-auto overflow-y-auto flex items-center justify-center"},[r("ns-spinner",{attrs:{size:"16",border:"4"}})],1),e._v(" "),e.hasLoadedRegisters?r("div",{staticClass:"flex-auto overflow-y-auto"},[r("div",{staticClass:"grid grid-cols-3"},e._l(e.registers,(function(t,s){return r("div",{key:s,staticClass:"border-b border-r flex items-center justify-center flex-col p-3",class:e.getClass(t),on:{click:function(r){return e.selectRegister(t)}}},[r("i",{staticClass:"las la-cash-register text-6xl"}),e._v(" "),r("h3",{staticClass:"text-semibold text-center"},[e._v(e._s(t.name))]),e._v(" "),r("span",{staticClass:"text-sm"},[e._v("("+e._s(t.status_label)+")")])])})),0),e._v(" "),0===e.registers.length?r("div",{staticClass:"p-2 bg-red-400 text-white"},[e._v("\n                Looks like there is no registers. At least one register is required to proceed. — "),r("a",{staticClass:"font-bold hover:underline",attrs:{href:e.settings.urls.registers_url}},[e._v("Create Cash Register")])]):e._e()]):e._e()]:e._e(),e._v(" "),!1===e.priorVerification?r("div",{staticClass:"h-full w-full flex justify-center items-center"},[r("ns-spinner",{attrs:{size:"24",border:"8"}})],1):e._e()],2)}),[],!1,null,null,null).exports,g={data:function(){return{totalIn:0,totalOut:0,settings:null,settingsSubscription:null,histories:[]}},mounted:function(){var e=this;this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t})),this.getHistory()},destroyed:function(){this.settingsSubscription.unsubscribe()},methods:{popupResolver:f.a,closePopup:function(){this.popupResolver({status:"success"})},getHistory:function(){var e=this;i.nsHttpClient.get("/api/nexopos/v4/cash-registers/session-history/".concat(this.settings.register.id)).subscribe((function(t){e.histories=t,e.totalIn=e.histories.filter((function(e){return["register-opening","register-sale","register-cash-in"].includes(e.action)})).map((function(e){return parseFloat(e.value)})).reduce((function(e,t){return e+t}),0),e.totalOut=e.histories.filter((function(e){return["register-closing","register-refund","register-cash-out"].includes(e.action)})).map((function(e){return parseFloat(e.value)})).reduce((function(e,t){return e+t}),0),console.log(e.totalOut)}))}}},_=Object(d.a)(g,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"bg-white shadow-lg w-95vw md:w-4/6-screen lg:w-half overflow-hidden"},[r("div",{staticClass:"p-2 flex justify-between items-center",attrs:{id:"header"}},[r("h3",{staticClass:"font-bold"},[e._v("Register History")]),e._v(" "),r("div",[r("ns-close-button",{on:{click:e.closePopup}})],1)]),e._v(" "),r("div",{staticClass:"flex w-full"},[r("div",{staticClass:"flex flex-auto"},[r("div",{staticClass:"w-full md:w-1/2 text-right bg-green-400 text-white font-bold text-3xl p-3"},[e._v(e._s(e._f("currency")(e.totalIn)))]),e._v(" "),r("div",{staticClass:"w-full md:w-1/2 text-right bg-red-400 text-white font-bold text-3xl p-3"},[e._v(e._s(e._f("currency")(e.totalOut)))])])]),e._v(" "),r("div",{staticClass:"flex flex-col overflow-y-auto h-120"},[e._l(e.histories,(function(t){return[["register-sale","register-cash-in"].includes(t.action)?r("div",{key:t.id,staticClass:"flex border-b border-green-200 bg-green-100"},[r("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),r("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-opening"].includes(t.action)?r("div",{key:t.id,staticClass:"flex border-b border-blue-200 bg-blue-100"},[r("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),r("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-close"].includes(t.action)?r("div",{key:t.id,staticClass:"flex border-b border-teal-200 bg-teal-100"},[r("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),r("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-refund","register-cash-out"].includes(t.action)?r("div",{key:t.id,staticClass:"flex border-b border-red-200 bg-red-100"},[r("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),r("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e()]}))],2)])}),[],!1,null,null,null).exports;function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t,r,s,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(s,n)}function C(e){return function(){var t=this,r=arguments;return new Promise((function(s,n){var i=e.apply(t,r);function o(e){w(i,s,n,o,a,"next",e)}function a(e){w(i,s,n,o,a,"throw",e)}o(void 0)}))}}var O={mounted:function(){var e=this;this.settingsSubscriber=POS.settings.subscribe((function(t){e.settings=t})),this.popupCloser()},data:function(){return{settings:null,settingsSubscriber:null}},methods:{popupResolver:f.a,popupCloser:u.a,closePopup:function(){this.popupResolver({status:"failed",button:"close_popup"})},closeCashRegister:function(){var e=this;return C(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Close Register",action:"close",identifier:"ns.cash-registers-closing",resolve:e,reject:t})}));case 3:r=t.sent,e.popupResolver(x({button:"close_register"},r)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cashIn:function(){var e=this;return C(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Cash In",action:"register-cash-in",identifier:"ns.cash-registers-cashing",resolve:e,reject:t})}));case 3:r=t.sent,e.popupResolver(x({button:"close_register"},r)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cashOut:function(){var e=this;return C(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Cash Out",action:"register-cash-out",identifier:"ns.cash-registers-cashout",resolve:e,reject:t})}));case 3:r=t.sent,e.popupResolver(x({button:"close_register"},r)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},historyPopup:function(){return C(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,t){Popup.show(_,{resolve:e,reject:t})}));case 3:e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()}}},P=Object(d.a)(O,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shadow-lg w-95vw md:w-3/5-screen lg:w-1/3-screen bg-white"},[r("div",{staticClass:"p-2 border-b border-gray-200 flex items-center justify-between"},[r("h3",[e._v("Register Options")]),e._v(" "),r("div",[r("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),r("div",{staticClass:"grid grid-cols-2 text-gray-700"},[r("div",{staticClass:"hover:bg-teal-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.closeCashRegister()}}},[r("i",{staticClass:"las la-sign-out-alt text-6xl"}),e._v(" "),r("h3",{staticClass:"text-xl font-bold"},[e._v("Close")])]),e._v(" "),r("div",{staticClass:"hover:bg-green-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.cashIn()}}},[r("i",{staticClass:"las la-plus-circle text-6xl"}),e._v(" "),r("h3",{staticClass:"text-xl font-bold"},[e._v("Cash In")])]),e._v(" "),r("div",{staticClass:"hover:bg-red-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.cashOut()}}},[r("i",{staticClass:"las la-minus-circle text-6xl"}),e._v(" "),r("h3",{staticClass:"text-xl font-bold"},[e._v("Cash Out")])]),e._v(" "),r("div",{staticClass:"hover:bg-blue-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.historyPopup()}}},[r("i",{staticClass:"las la-history text-6xl"}),e._v(" "),r("h3",{staticClass:"text-xl font-bold"},[e._v("History")])])])])}),[],!1,null,null,null).exports;function k(e,t,r,s,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(s,n)}function j(e){return function(){var t=this,r=arguments;return new Promise((function(s,n){var i=e.apply(t,r);function o(e){k(i,s,n,o,a,"next",e)}function a(e){k(i,s,n,o,a,"throw",e)}o(void 0)}))}}var S={data:function(){return{order:null,name:"",selectedRegister:null,orderSubscriber:null,settingsSubscriber:null}},watch:{},methods:{openRegisterOptions:function(){var e=this;return j(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(P,{resolve:e,reject:t})}));case 3:"close_register"===t.sent.button&&(delete e.settings.register,POS.settings.next(e.settings),POS.reset()),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),Object.keys(t.t0).length>0&&i.nsSnackBar.error(t.t0.message).subscribe();case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},registerInitialQueue:function(){var e=this;POS.initialQueue.push(j(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,r){void 0===e.settings.register&&Popup.show(b,{resolve:t,reject:r})}));case 3:return r=t.sent,POS.set("register",r.data.register),t.abrupt("return",r);case 8:throw t.prev=8,t.t0=t.catch(0),t.t0;case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))))},setButtonName:function(){if(void 0===this.settings.register)return this.name="Cash Register";this.name="Cash Register : ".concat(this.settings.register.name)}},destroyed:function(){this.orderSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe()},mounted:function(){var e=this;this.registerInitialQueue(),this.orderSubscriber=POS.order.subscribe((function(t){e.order=t})),this.settingsSubscriber=POS.settings.subscribe((function(t){e.settings=t,e.setButtonName()}))}},$=Object(d.a)(S,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openRegisterOptions()}}},[r("i",{staticClass:"mr-1 text-xl las la-cash-register"}),e._v(" "),r("span",[e._v(e._s(e.name))])])}),[],!1,null,null,null);t.default=$.exports},274:function(e,t,r){"use strict";r.r(t);var s=r(6),n=r(0),i=r(11),o={data:function(){return{products:[],isLoading:!1}},computed:{order:function(){return this.$popupParams.order}},mounted:function(){this.loadProducts()},methods:{close:function(){this.$popupParams.reject(!1),this.$popup.close()},loadProducts:function(){var e=this;this.isLoading=!0;var t=this.$popupParams.order.id;n.nsHttpClient.get("/api/nexopos/v4/orders/".concat(t,"/products")).subscribe((function(t){e.isLoading=!1,e.products=t}))},openOrder:function(){this.$popup.close(),this.$popupParams.resolve(this.order)}}},a=r(2),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[r("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[r("h3",{staticClass:"font-semibold"},[e._v("Products — "+e._s(e.order.code)+" "),e.order.title?r("span",[e._v("("+e._s(e.order.title)+")")]):e._e()]),e._v(" "),r("div",[r("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),r("div",{staticClass:"flex-auto p-2 overflow-y-auto"},[e.isLoading?r("div",{staticClass:"flex-auto relative"},[r("div",{staticClass:"h-full w-full flex items-center justify-center"},[r("ns-spinner")],1)]):e._e(),e._v(" "),e.isLoading?e._e():e._l(e.products,(function(t){return r("div",{key:t.id,staticClass:"item"},[r("div",{staticClass:"flex-col border-b border-blue-400 py-2"},[r("div",{staticClass:"title font-semibold text-gray-700 flex justify-between"},[r("span",[e._v(e._s(t.name)+" (x"+e._s(t.quantity)+")")]),e._v(" "),r("span",[e._v(e._s(e._f("currency")(t.total_price)))])]),e._v(" "),r("div",{staticClass:"text-sm text-gray-600"},[r("ul",[r("li",[e._v("Unit : "+e._s(t.unit.name))])])])])])}))],2),e._v(" "),r("div",{staticClass:"flex justify-end p-2 border-t border-gray-400"},[r("div",{staticClass:"px-1"},[r("div",{staticClass:"-mx-2 flex"},[r("div",{staticClass:"px-1"},[r("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.openOrder()}}},[e._v("Open")])],1),e._v(" "),r("div",{staticClass:"px-1"},[r("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v("Close")])],1)])])])])}),[],!1,null,null,null).exports,c={props:["orders"],data:function(){return{searchField:""}},watch:{orders:function(){n.nsHooks.doAction("ns-pos-pending-orders-refreshed",this.orders)}},mounted:function(){},name:"ns-pos-pending-order",methods:{previewOrder:function(e){this.$emit("previewOrder",e)},proceedOpenOrder:function(e){this.$emit("proceedOpenOrder",e)},searchOrder:function(){this.$emit("searchOrder",this.searchField)}}},l={components:{nsPosPendingOrders:Object(a.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"flex flex-auto flex-col overflow-hidden"},[r("div",{staticClass:"p-1"},[r("div",{staticClass:"flex rounded border-2 border-blue-400"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.searchField,expression:"searchField"}],staticClass:"p-2 outline-none flex-auto",attrs:{type:"text"},domProps:{value:e.searchField},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchOrder()},input:function(t){t.target.composing||(e.searchField=t.target.value)}}}),e._v(" "),r("button",{staticClass:"w-16 md:w-24 bg-blue-400 text-white",on:{click:function(t){return e.searchOrder()}}},[r("i",{staticClass:"las la-search"}),e._v(" "),r("span",{staticClass:"mr-1 hidden md:visible"},[e._v("Search")])])])]),e._v(" "),r("div",{staticClass:"overflow-y-auto flex flex-auto"},[r("div",{staticClass:"flex p-2 flex-auto flex-col overflow-y-auto"},[e._l(e.orders,(function(t){return r("div",{key:t.id,staticClass:"border-b border-blue-400 w-full py-2",attrs:{"data-order-id":t.id}},[r("h3",{staticClass:"text-gray-700"},[e._v(e._s(t.title||"Untitled Order"))]),e._v(" "),r("div",{staticClass:"px-2"},[r("div",{staticClass:"flex flex-wrap -mx-4"},[r("div",{staticClass:"w-full md:w-1/2 px-2"},[r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Cashier")]),e._v(" : "+e._s(t.nexopos_users_username))]),e._v(" "),r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Register")]),e._v(" : "+e._s(e._f("currency")(t.total)))]),e._v(" "),r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Tendered")]),e._v(" : "+e._s(e._f("currency")(t.tendered)))])]),e._v(" "),r("div",{staticClass:"w-full md:w-1/2 px-2"},[r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Customer")]),e._v(" : "+e._s(t.nexopos_customers_name))]),e._v(" "),r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Date")]),e._v(" : "+e._s(t.created_at))]),e._v(" "),r("p",{staticClass:"text-sm text-gray-600"},[r("strong",[e._v("Type")]),e._v(" : "+e._s(t.type))])])])]),e._v(" "),r("div",{staticClass:"flex justify-end w-full mt-2"},[r("div",{staticClass:"flex rounded-lg overflow-hidden buttons-container"},[r("button",{staticClass:"text-white bg-green-400 outline-none px-2 py-1",on:{click:function(r){return e.proceedOpenOrder(t)}}},[r("i",{staticClass:"las la-lock-open"}),e._v(" Open")]),e._v(" "),r("button",{staticClass:"text-white bg-blue-400 outline-none px-2 py-1",on:{click:function(r){return e.previewOrder(t)}}},[r("i",{staticClass:"las la-eye"}),e._v(" Products")])])])])})),e._v(" "),0===e.orders.length?r("div",{staticClass:"h-full v-full items-center justify-center flex"},[r("h3",{staticClass:"text-semibold text-gray-700"},[e._v("Nothing to display...")])]):e._e()],2)])])}),[],!1,null,null,null).exports},methods:{searchOrder:function(e){var t=this;n.nsHttpClient.get("/api/nexopos/v4/crud/".concat(this.active,"?search=").concat(e)).subscribe((function(e){t.orders=e.data}))},setActiveTab:function(e){this.active=e,this.loadOrderFromType(e)},openOrder:function(e){POS.loadOrder(e.id),this.$popup.close()},loadOrderFromType:function(e){var t=this;n.nsHttpClient.get("/api/nexopos/v4/crud/".concat(e)).subscribe((function(e){t.orders=e.data}))},previewOrder:function(e){var t=this;new Promise((function(t,r){Popup.show(u,{order:e,resolve:t,reject:r})})).then((function(r){t.proceedOpenOrder(e)}),(function(e){return e}))},proceedOpenOrder:function(e){var t=this;if(POS.products.getValue().length>0)return Popup.show(i.default,{title:"Confirm Your Action",message:"The cart is not empty. Opening an order will clear your cart would you proceed ?",onAction:function(r){r&&t.openOrder(e)}});this.openOrder(e)}},data:function(){return{active:"ns.hold-orders",searchField:"",orders:[]}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.$popup.close()})),this.loadOrderFromType(this.active)}},d=Object(a.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[r("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[r("h3",{staticClass:"font-semibold"},[e._v("Orders")]),e._v(" "),r("div",[r("ns-close-button",{on:{click:function(t){return e.$popup.close()}}})],1)]),e._v(" "),r("div",{staticClass:"p-2 flex overflow-hidden flex-auto"},[r("ns-tabs",{attrs:{active:e.active},on:{changeTab:function(t){return e.setActiveTab(t)}}},[r("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.hold-orders",label:"On Hold",padding:"p-0"}},[r("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),r("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.unpaid-orders",label:"Unpaid",padding:"p-0"}},[r("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),r("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.partially-paid-orders",label:"Partially Paid",padding:"p-0"}},[r("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1)],1)],1),e._v(" "),r("div",{staticClass:"p-2 flex justify-between border-t bg-gray-200"},[r("div"),e._v(" "),r("div",[r("ns-button",[e._v("close")])],1)])])}),[],!1,null,null,null).exports,p={name:"ns-pos-pending-orders-button",methods:{openPendingOrdersPopup:function(){(new s.a).open(d)}}},f=Object(a.a)(p,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[r("i",{staticClass:"mr-1 text-xl lar la-hand-pointer"}),e._v(" "),r("span",[e._v("Orders")])])}),[],!1,null,null,null);t.default=f.exports},275:function(e,t,r){"use strict";r.r(t),r.d(t,"POS",(function(){return S})),r.d(t,"POSInit",(function(){return $}));var s=r(65),n=r(6),i=r(0),o={data:function(){return{unitsQuantities:[]}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&(e.$popupParams.reject(!1),e.$popup.close())})),this.loadUnits()},methods:{loadUnits:function(){var e=this;i.nsHttpClient.get("/api/nexopos/v4/products/".concat(this.$popupParams.product.$original().id,"/units/quantities")).subscribe((function(t){if(0===t.length)return e.$popup.close(),i.nsSnackBar.error("This product doesn't has any unit defined for selling.").subscribe();e.unitsQuantities=t,1===e.unitsQuantities.length&&e.selectUnit(e.unitsQuantities[0])}))},selectUnit:function(e){this.$popupParams.resolve({unit_quantity_id:e.id,unit_name:e.unit.name,$quantities:function(){return e}}),this.$popup.close()}}},a=r(2),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"bg-white w-2/3-screen lg:w-1/3-screen overflow-hidden flex flex-col"},[e._m(0),e._v(" "),e.unitsQuantities.length>0?r("div",{staticClass:"grid grid-flow-row grid-cols-2 overflow-y-auto"},e._l(e.unitsQuantities,(function(t){return r("div",{key:t.id,staticClass:"hover:bg-gray-200 cursor-pointer border flex-shrink-0 border-gray-200 flex flex-col items-center justify-center",on:{click:function(r){return e.selectUnit(t)}}},[r("div",{staticClass:"h-40 w-full flex items-center justify-center overflow-hidden"},[t.preview_url?r("img",{staticClass:"object-cover h-full",attrs:{src:t.preview_url,alt:t.unit.name}}):e._e(),e._v(" "),t.preview_url?e._e():r("div",{staticClass:"h-40 flex items-center justify-center"},[r("i",{staticClass:"las la-image text-gray-600 text-6xl"})])]),e._v(" "),r("div",{staticClass:"h-0 w-full"},[r("div",{staticClass:"relative w-full flex items-center justify-center -top-10 h-20 py-2 flex-col",staticStyle:{background:"rgb(255 255 255 / 73%)"}},[r("h3",{staticClass:"font-bold text-gray-700 py-2 text-center"},[e._v(e._s(t.unit.name)+" ("+e._s(t.quantity)+")")]),e._v(" "),r("p",{staticClass:"text-sm font-medium text-gray-600"},[e._v(e._s(e._f("currency")(t.sale_price)))])])])])})),0):e._e(),e._v(" "),0===e.unitsQuantities.length?r("div",{staticClass:"h-56 flex items-center justify-center"},[r("ns-spinner")],1):e._e()])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"h-16 flex justify-center items-center flex-shrink-0",attrs:{id:"header"}},[t("h3",{staticClass:"font-bold text-gray-700"},[this._v("Choose Selling Unit")])])}],!1,null,null,null).exports,c=function(){function e(e){this.product=e}return e.prototype.run=function(){var e=this;return new Promise((function(t,r){var s=new n.a({popupClass:"shadow-lg h-1/2-screen w-3/4 xl:w-1/4 bg-white"}),i=e.product;s.open(u,{resolve:t,reject:r,product:i})}))},e}(),l=r(42),d=r(3),p=r.n(d),f=function(){function e(){this.detect()}return e.prototype.detect=function(){window.innerWidth<544?this.screenIs="xs":window.innerWidth>=544&&window.innerWidth<768?this.screenIs="sm":window.innerWidth>=768&&window.innerWidth<992?this.screenIs="md":window.innerWidth>=992&&window.innerWidth<1200?this.screenIs="lg":window.innerWidth>=1200&&(this.screenIs="xg")},e.prototype.is=function(e){return void 0===e?this.screenIs:this.screenIs===e},e}(),h=r(13),v=function(){return(v=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},b=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))},g=function(e,t){var r,s,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,s&&(n=2&i[0]?s.return:i[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,s=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],s=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},_=window.NsPosDashboardButton=r(277).default,m=window.NsPosPendingOrderButton=r(274).default,x=window.NsPosOrderTypeButton=r(278).default,y=window.NsPosCustomersButton=r(279).default,w=window.NsPosResetButton=r(280).default,C=window.NsPosCashRegister=r(273).default,O=window.NsAlertPopup=r(54).default,P=window.NsConfirmPopup=r(11).default,k=window.NsPromptPopup=r(33).default,j=window.NsLayawayPopup=r(281).default,S=function(){function e(){var e=this;this._initialQueue=[],this._responsive=new f,this._isSubmitting=!1,this._processingAddQueue=!1,this.defaultOrder=function(){return{discount_type:null,title:"",discount:0,register_id:e.get("register")?e.get("register").id:void 0,discount_percentage:0,subtotal:0,total:0,coupons:[],total_coupons:0,tendered:0,note:"",note_visibility:"hidden",tax_group_id:void 0,tax_type:void 0,taxes:[],tax_groups:[],payment_status:void 0,customer_id:void 0,change:0,total_products:0,shipping:0,tax_value:0,shipping_rate:0,shipping_type:void 0,customer:void 0,type:void 0,products:[],payments:[],addresses:{shipping:void 0,billing:void 0}}},this.addToCartQueue=[c,s.a],this.initialize()}return Object.defineProperty(e.prototype,"screen",{get:function(){return this._screen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibleSection",{get:function(){return this._visibleSection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paymentsType",{get:function(){return this._paymentsType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"order",{get:function(){return this._order},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return this._types},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"products",{get:function(){return this._products},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customers",{get:function(){return this._customers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"breadcrumbs",{get:function(){return this._breadcrumbs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialQueue",{get:function(){return this._initialQueue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processingAddQueue",{get:function(){return this._processingAddQueue},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._isSubmitting=!1,this.order.next(this.defaultOrder()),this._products.next([]),this._customers.next([]),this._breadcrumbs.next([]),this.defineCurrentScreen(),this.processInitialQueue(),this.refreshCart()},e.prototype.initialize=function(){var e=this;this._products=new l.a([]),this._customers=new l.a([]),this._types=new l.a([]),this._breadcrumbs=new l.a([]),this._screen=new l.a(""),this._paymentsType=new l.a([]),this._visibleSection=new l.a("both"),this._options=new l.a({}),this._settings=new l.a({}),this._order=new l.a(this.defaultOrder()),this.initialQueue.push((function(){return new Promise((function(t,r){var s=e.options.getValue(),n=e.order.getValue();return!1!==s.ns_pos_tax_group&&(n.tax_group_id=s.ns_pos_tax_group,n.tax_type=s.ns_pos_tax_type,e.order.next(n)),t({status:"success",message:"tax group assignated"})}))})),this.products.subscribe((function(t){e.refreshCart()})),this.types.subscribe((function(t){var r=t.filter((function(e){return e.selected}));if(r.length>0){var s=e.order.getValue();s.type=r[0],e.order.next(s)}})),window.addEventListener("resize",(function(){e._responsive.detect(),e.defineCurrentScreen()})),this.defineCurrentScreen()},e.prototype.processInitialQueue=function(){return b(this,void 0,void 0,(function(){var e,t,r,s,n;return g(this,(function(o){switch(o.label){case 0:for(t in e=[],this._initialQueue)e.push(t);r=0,o.label=1;case 1:if(!(r<e.length))return[3,6];s=e[r],o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this._initialQueue[s]()];case 3:return o.sent(),[3,5];case 4:return n=o.sent(),i.nsSnackBar.error(n.message).subscribe(),[3,5];case 5:return r++,[3,1];case 6:return[2]}}))}))},e.prototype.removeCoupon=function(e){var t=this.order.getValue(),r=t.coupons,s=r.indexOf(e);r.splice(s,1),t.coupons=r,this.order.next(t)},e.prototype.pushCoupon=function(e){var t=this.order.getValue();t.coupons.forEach((function(t){if(t.code===e.code){var r=Object(h.a)("This coupon is already added to the cart");throw i.nsSnackBar.error(r).subscribe(),r}})),t.coupons.push(e),this.order.next(t),this.refreshCart()},Object.defineProperty(e.prototype,"header",{get:function(){var e={buttons:{NsPosDashboardButton:_,NsPosPendingOrderButton:m,NsPosOrderTypeButton:x,NsPosCustomersButton:y,NsPosResetButton:w}};return"yes"===this.options.getValue().ns_pos_registers_enabled&&(e.buttons.NsPosCashRegister=C),e},enumerable:!1,configurable:!0}),e.prototype.defineOptions=function(e){this._options.next(e)},e.prototype.defineCurrentScreen=function(){this._visibleSection.next(["xs","sm"].includes(this._responsive.is())?"grid":"both"),this._screen.next(this._responsive.is())},e.prototype.changeVisibleSection=function(e){["both","cart","grid"].includes(e)&&this._visibleSection.next(e)},e.prototype.addPayment=function(e){if(e.value>0){var t=this._order.getValue();return t.payments.push(e),this._order.next(t),this.computePaid()}return i.nsSnackBar.error("Invalid amount.").subscribe()},e.prototype.removePayment=function(e){if(void 0!==e.id)return i.nsSnackBar.error("Unable to delete a payment attached to the order").subscribe();var t=this._order.getValue(),r=t.payments.indexOf(e);t.payments.splice(r,1),this._order.next(t),i.nsEvent.emit({identifier:"ns.pos.remove-payment",value:e}),this.updateCustomerAccount(e),this.computePaid()},e.prototype.updateCustomerAccount=function(e){if("account-payment"===e.identifier){var t=this.order.getValue().customer;t.account_amount+=e.value,this.selectCustomer(t)}},e.prototype.getNetPrice=function(e,t,r){return"inclusive"===r?e/(t+100)*100:"exclusive"===r?e/100*(t+100):void 0},e.prototype.getVatValue=function(e,t,r){return"inclusive"===r?e-this.getNetPrice(e,t,r):"exclusive"===r?this.getNetPrice(e,t,r)-e:void 0},e.prototype.computeTaxes=function(){var e=this;return new Promise((function(t,r){var s=e.order.getValue();if(void 0===s.tax_group_id)return r(!1);var n=s.tax_groups;return n&&void 0!==n[s.tax_group_id]?(s.taxes=s.taxes.map((function(t){return t.tax_value=e.getVatValue(s.subtotal,t.rate,s.tax_type),t})),t({status:"success",data:{tax:n[s.tax_group_id],order:s}})):null===s.tax_group_id?r({status:"failed",message:Object(h.a)("No tax group assigned to the order")}):void i.nsHttpClient.get("/api/nexopos/v4/taxes/groups/"+s.tax_group_id).subscribe((function(r){return s.tax_groups=s.tax_groups||[],s.taxes=r.taxes.map((function(t){return{tax_id:t.id,tax_name:t.name,rate:parseFloat(t.rate),tax_value:e.getVatValue(s.subtotal,t.rate,s.tax_type)}})),s.tax_groups[r.id]=r,t({status:"success",data:{tax:r,order:s}})}),(function(e){return r(e)}))}))},e.prototype.canProceedAsLaidAway=function(e){var t=this;return new Promise((function(r,s){return b(t,void 0,void 0,(function(){var t,i,o,a;return g(this,(function(u){switch(u.label){case 0:if(t=e.customer.group.minimal_credit_payment,i=e.total*t/100,void 0!==e.expected_payment_date)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,new Promise((function(t,r){n.a.show(j,{order:e,reject:r,resolve:t})}))];case 2:return u.sent(),[3,4];case 3:return o=u.sent(),[2,s(o)];case 4:return e.tendered<i?(a="Before saving the order as laid away, a minimum payment of "+p.a.filter("currency")(i)+" is required",n.a.show(O,{title:"Unable to proceed",message:a}),[2,s({status:"failed",message:a})]):[2,r({status:"success",message:"Can Proceed as layaway"})]}}))}))}))},e.prototype.submitOrder=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(r,s){return b(t,void 0,void 0,(function(){var t,n,o,a,u,c=this;return g(this,(function(l){switch(l.label){case 0:return t=v(v({},this.order.getValue()),e),n=t.customer.group.minimal_credit_payment,"hold"===t.payment_status?[3,10]:0!==t.payments.length?[3,5]:"no"!==this.options.getValue().ns_orders_allow_unpaid?[3,1]:[2,s({status:"failed",message:"Please provide a payment before proceeding."})];case 1:if(!(n>0))return[3,5];l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this.canProceedAsLaidAway(t)];case 3:return l.sent(),[3,5];case 4:return o=l.sent(),[2,s(o)];case 5:return t.total>t.tendered?"no"!==this.options.getValue().ns_orders_allow_partial?[3,6]:[2,s({status:"failed",message:"Partially paid orders are disabled."})]:[3,10];case 6:if(!(n>0))return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,this.canProceedAsLaidAway(t)];case 8:return l.sent(),[3,10];case 9:return a=l.sent(),[2,s(a)];case 10:return this._isSubmitting?[2,s({status:"failed",message:"An order is currently being processed."})]:(u=void 0!==t.id?"put":"post",this._isSubmitting=!0,[2,i.nsHttpClient[u]("/api/nexopos/v4/orders"+(void 0!==t.id?"/"+t.id:""),t).subscribe((function(e){r(e),c.reset(),i.nsHooks.doAction("ns-order-submit-successful",e),c._isSubmitting=!1}),(function(e){c._isSubmitting=!1,s(e),i.nsHooks.doAction("ns-order-submit-failed",e)}))])}}))}))}))},e.prototype.loadOrder=function(e){var t=this;i.nsHttpClient.get("/api/nexopos/v4/orders/"+e+"/pos").subscribe((function(e){var r=(e=v(v({},t.defaultOrder()),e)).products.map((function(e){return e.$original=function(){return e.product},e.$quantities=function(){return e.product.unit_quantities.filter((function(t){return t.id===e.unit_quantity_id}))[0]},e}));e.type=t.types.getValue().filter((function(t){return t.identifier===e.type}))[0],e.addresses={shipping:e.shipping_address,billing:e.billing_address},delete e.shipping_address,delete e.billing_address,t.buildOrder(e),t.buildProducts(r),t.selectCustomer(e.customer)}))},e.prototype.buildOrder=function(e){this.order.next(e)},e.prototype.buildProducts=function(e){this.products.next(e)},e.prototype.printOrder=function(e){if("disabled"===this.options.getValue().ns_pos_printing_enabled_for)return!1;var t=document.createElement("iframe");t.id="printing-section",t.className="hidden",t.src=this.settings.getValue().urls.printing_url.replace("{id}",e),document.body.appendChild(t)},e.prototype.computePaid=function(){var e=this._order.getValue();e.tendered=0,e.payments.length>0&&(e.tendered=e.payments.map((function(e){return e.value})).reduce((function(e,t){return t+e}))),e.tendered>=e.total?e.payment_status="paid":e.tendered>0&&e.tendered<e.total&&(e.payment_status="partially_paid"),e.change=e.tendered-e.total,this._order.next(e)},e.prototype.setPaymentActive=function(e){var t=this._paymentsType.getValue(),r=t.indexOf(e);t.forEach((function(e){return e.selected=!1})),t[r].selected=!0,this._paymentsType.next(t)},e.prototype.definedPaymentsType=function(e){this._paymentsType.next(e)},e.prototype.selectCustomer=function(e){var t=this;return new Promise((function(r,s){var n=t.order.getValue();n.customer=e,n.customer_id=e.id,t.order.next(n),void 0!==e.group&&null!==e.group||i.nsHttpClient.get("/api/nexopos/v4/customers/"+e.id+"/group").subscribe((function(e){n.customer.group=e,t.order.next(n),r(n)}),(function(e){s(e)}))}))},e.prototype.updateCart=function(e,t){for(var r in t)void 0!==t[r]&&p.a.set(e,r,t[r]);this.order.next(e),this.refreshCart()},e.prototype.checkCart=function(){var e=this,t=this.order.getValue(),r=[];t.coupons.forEach((function(e){e.products.length>0&&(t.products.filter((function(t){return e.products.map((function(e){return e.product_id})).includes(t.product_id)})).length>0||-1!==r.indexOf(e)||r.push(e));e.categories.length>0&&(t.products.filter((function(t){return e.categories.map((function(e){return e.category_id})).includes(t.$original().category_id)})).length>0||-1!==r.indexOf(e)||r.push(e))})),r.forEach((function(t){i.nsSnackBar.error(Object(h.a)('The coupons "%s" has been removed from the cart, as it\'s required conditions are no more meet.').replace("%s",t.name),Object(h.a)("Okay"),{duration:6e3}).subscribe(),e.removeCoupon(t)}))},e.prototype.refreshCart=function(){return b(this,void 0,void 0,(function(){var e,t,r,s,n,o,a,u;return g(this,(function(c){switch(c.label){case 0:this.checkCart(),e=this.products.getValue(),t=this.order.getValue(),(r=e.map((function(e){return e.total_price}))).length>0?t.subtotal=r.reduce((function(e,t){return e+t})):t.subtotal=0,s=t.coupons.map((function(e){return"percentage_discount"===e.type?(e.value=t.subtotal*e.discount_value/100,e.value):(e.value=e.discount_value,e.value)})),t.total_coupons=0,s.length>0&&(t.total_coupons=s.reduce((function(e,t){return e+t}))),"percentage"===t.discount_type&&(t.discount=t.discount_percentage*t.subtotal/100),t.discount>t.subtotal&&0===t.total_coupons&&(t.discount=t.subtotal,i.nsSnackBar.info("The discount has been set to the cart subtotal").subscribe()),this.order.next(t),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.computeTaxes()];case 2:return n=c.sent(),t=n.data.order,[3,4];case 3:if(!1!==(o=c.sent())&&void 0!==o.message)throw o.message;return[3,4];case 4:return a=e.map((function(e){return e.tax_value})),t.tax_value=0,u=this.options.getValue().ns_pos_vat,["products_vat","products_flat_vat","products_variable_vat"].includes(u)&&a.length>0&&(t.tax_value+=a.reduce((function(e,t){return e+t}))),["flat_vat","variable_vat","products_variable_vat"].includes(u)&&t.taxes&&t.taxes.length>0&&(t.tax_value+=t.taxes.map((function(e){return e.tax_value})).reduce((function(e,t){return e+t}))),t.total=t.subtotal+t.shipping+t.tax_value-t.discount-t.total_coupons,t.products=e,t.total_products=e.length,this.order.next(t),[2]}}))}))},e.prototype.getStockUsage=function(e,t){var r=this._products.getValue().filter((function(r){return r.product_id===e&&r.unit_quantity_id===t})).map((function(e){return e.quantity}));return r.length>0?r.reduce((function(e,t){return e+t})):0},e.prototype.addToCart=function(e){return b(this,void 0,void 0,(function(){var t,r,s,n,i,o,a,u;return g(this,(function(c){switch(c.label){case 0:for(n in t=new Object,r={product_id:e.id,name:e.name,discount_type:"percentage",discount:0,discount_percentage:0,quantity:0,tax_group_id:e.tax_group_id,tax_value:0,unit_price:0,total_price:0,mode:"normal",$original:function(){return e}},this._processingAddQueue=!0,s=[],this.addToCartQueue)s.push(n);i=0,c.label=1;case 1:if(!(i<s.length))return[3,6];o=s[i],c.label=2;case 2:return c.trys.push([2,4,,5]),[4,new this.addToCartQueue[o](r).run(t)];case 3:return a=c.sent(),t=v(v({},t),a),[3,5];case 4:return!1===c.sent()?(this._processingAddQueue=!1,[2,!1]):[3,5];case 5:return i++,[3,1];case 6:return this._processingAddQueue=!1,r=v(v({},r),t),(u=this._products.getValue()).unshift(r),this.refreshProducts(u),this._products.next(u),[2]}}))}))},e.prototype.defineTypes=function(e){this._types.next(e)},e.prototype.removeProduct=function(e){var t=this._products.getValue(),r=t.indexOf(e);t.splice(r,1),this._products.next(t)},e.prototype.updateProduct=function(e,t){var r=this._products.getValue(),s=r.indexOf(e);p.a.set(r,s,v(v({},e),t)),this.refreshProducts(r),this._products.next(r)},e.prototype.refreshProducts=function(e){var t=this;e.forEach((function(e){t.computeProduct(e)}))},e.prototype.computeProduct=function(e){"normal"===e.mode?(e.unit_price=e.$quantities().sale_price,e.tax_value=e.$quantities().sale_price_tax*e.quantity):(e.unit_price=e.$quantities().wholesale_price,e.tax_value=e.$quantities().wholesale_price_tax*e.quantity),["flat","percentage"].includes(e.discount_type)&&"percentage"===e.discount_type&&(e.discount=e.unit_price*e.discount_percentage/100*e.quantity),e.total_price=e.unit_price*e.quantity-e.discount},e.prototype.loadCustomer=function(e){return i.nsHttpClient.get("/api/nexopos/v4/customers/"+e)},e.prototype.defineSettings=function(e){this._settings.next(e)},e.prototype.voidOrder=function(e){var t=this;void 0!==e.id?["hold"].includes(e.payment_status)?n.a.show(P,{title:"Order Deletion",message:"The current order will be deleted as no payment has been made so far.",onAction:function(r){r&&i.nsHttpClient.delete("/api/nexopos/v4/orders/"+e.id).subscribe((function(e){i.nsSnackBar.success(e.message).subscribe(),t.reset()}),(function(e){return i.nsSnackBar.error(e.message).subscribe()}))}}):n.a.show(k,{title:"Void The Order",message:"The current order will be void. This will cancel the transaction, but the order won't be deleted. Further details about the operation will be tracked on the report. Consider providing the reason of this operation.",onAction:function(r){!1!==r&&i.nsHttpClient.post("/api/nexopos/v4/orders/"+e.id+"/void",{reason:r}).subscribe((function(e){i.nsSnackBar.success(e.message).subscribe(),t.reset()}),(function(e){return i.nsSnackBar.error(e.message).subscribe()}))}}):i.nsSnackBar.error("Unable to void an unpaid order.").subscribe()},e.prototype.set=function(e,t){var r=this.settings.getValue();r[e]=t,this.settings.next(r)},e.prototype.get=function(e){return this.settings.getValue()[e]},e.prototype.destroy=function(){this._products.unsubscribe(),this._customers.unsubscribe(),this._types.unsubscribe(),this._breadcrumbs.unsubscribe(),this._paymentsType.unsubscribe(),this._screen.unsubscribe(),this._order.unsubscribe(),this._settings.unsubscribe()},e}();window.POS=new S;var $=window.POS},277:function(e,t,r){"use strict";r.r(t);var s={name:"ns-pos-dashboard-button",methods:{goToDashboard:function(){return document.location=POS.settings.getValue().urls.dashboard_url}}},n=r(2),i=Object(n.a)(s,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.goToDashboard()}}},[r("i",{staticClass:"mr-1 text-xl las la-tachometer-alt"}),e._v(" "),r("span",[e._v("Dashboard")])])}),[],!1,null,null,null);t.default=i.exports},278:function(e,t,r){"use strict";r.r(t);var s=r(6),n=r(55),i={name:"ns-pos-delivery-button",methods:{openPendingOrdersPopup:function(){new s.a({primarySelector:"#pos-app",popupClass:"shadow-lg bg-white w-3/5 md:w-2/3 lg:w-2/5 xl:w-2/4"}).open(n.default)}}},o=r(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[r("i",{staticClass:"mr-1 text-xl las la-truck"}),e._v(" "),r("span",[e._v("Order Type")])])}),[],!1,null,null,null);t.default=a.exports},279:function(e,t,r){"use strict";r.r(t);var s=r(6),n=r(53),i={name:"ns-pos-customers-button",methods:{openPendingOrdersPopup:function(){(new s.a).open(n.a)}}},o=r(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[r("i",{staticClass:"mr-1 text-xl lar la-user-circle"}),e._v(" "),r("span",[e._v("Customers")])])}),[],!1,null,null,null);t.default=a.exports},280:function(e,t,r){"use strict";r.r(t);var s=r(6),n=(r(53),r(11)),i={name:"ns-pos-customers-button",mounted:function(){this.popupCloser()},methods:{popupCloser:r(12).a,reset:function(){s.a.show(n.default,{title:"Confirm Your Action",message:"The current order will be cleared. But not deleted if it's persistent. Would you like to proceed ?",onAction:function(e){e&&POS.reset()}})}}},o=r(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.reset()}}},[r("i",{staticClass:"mr-1 text-xl  las la-eraser"}),e._v(" "),r("span",[e._v("Reset")])])}),[],!1,null,null,null);t.default=a.exports},281:function(e,t,r){"use strict";r.r(t);var s=r(7),n=r(0);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u={name:"ns-pos-layaway-popup",data:function(){return{fields:[],formValidation:new s.a,subscription:null}},mounted:function(){var e=this;this.loadFields(),this.subscription=this.$popup.event.subscribe((function(t){["click-overlay","press-esc"].includes(t.event)&&e.close()}))},destroyed:function(){this.subscription.unsubscribe()},methods:{close:function(){this.$popupParams.reject({status:"faield",message:"You must define layaway settings before proceeding."}),this.$popup.close()},updateOrder:function(){var e=this;if(this.fields.forEach((function(t){return e.formValidation.validateField(t)})),!this.formValidation.fieldsValid(this.fields))return n.nsSnackBar.error("Unable to procee the form is not valid").subscribe();var t=this.formValidation.extractFields(this.fields),r=o(o({},this.$popupParams.order),t),s=this.$popupParams,i=s.resolve;s.reject;return POS.order.next(r),this.$popup.close(),i(r)},loadFields:function(){var e=this;n.nsHttpClient.get("/api/nexopos/v4/fields/ns.layaway").subscribe((function(t){e.fields=e.formValidation.createFields(t)}))}}},c=r(2),l=Object(c.a)(u,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shadow-lg h-95vh md:h-4/6-screen lg:h-3/6-screen w-95vw md:w-4/6-screen lg:w-3/6-screen bg-white flex flex-col"},[r("div",{staticClass:"p-2 border-b flex justify-between items-center"},[r("h3",{staticClass:"font-semibold"},[e._v("Layaway Parameters")]),e._v(" "),r("div",[r("ns-close-button")],1)]),e._v(" "),r("div",{staticClass:"p-2 flex-auto relative"},[0===e.fields.length?r("div",{staticClass:"absolute h-full w-full flex items-center justify-center"},[r("ns-spinner")],1):e._e(),e._v(" "),e._l(e.fields,(function(e,t){return r("ns-field",{key:t,attrs:{field:e}})}))],2),e._v(" "),r("div",{staticClass:"p-2 flex border-t justify-between"},[r("div"),e._v(" "),r("div",{staticClass:"-mx-1 flex"},[r("div",{staticClass:"px-1"},[r("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v("Cancel")])],1),e._v(" "),r("div",{staticClass:"px-1"},[r("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.updateOrder()}}},[e._v("Save")])],1)])])])}),[],!1,null,null,null);t.default=l.exports}},[[264,0,1]]]);
//# sourceMappingURL=pos-init.js.map