(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{262:function(e,t,s){e.exports=s(273)},271:function(e,t,s){"use strict";s.r(t);var r=s(9),n=s.n(r),i=s(0),o=s(20),a=s(8),u=s(13),c=s(10),l={components:{nsNumpad:o.a},data:function(){return{amount:0,title:null,identifier:null,settingsSubscription:null,settings:null,action:null,loaded:!1,register_id:null,validation:new a.a,fields:[]}},mounted:function(){var e=this;this.title=this.$popupParams.title,this.identifier=this.$popupParams.identifier,this.action=this.$popupParams.action,this.register_id=this.$popupParams.register_id,this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t})),this.loadFields()},destroyed:function(){this.settingsSubscription.unsubscribe()},methods:{popupCloser:u.a,definedValue:function(e){this.amount=e},close:function(){this.$popup.close()},loadFields:function(){var e=this;this.loaded=!1,nsHttpClient.get("/api/nexopos/v4/fields/".concat(this.identifier)).subscribe((function(t){e.loaded=!0,e.fields=t}),(function(t){return e.loaded=!0,nsSnackBar.error(t.message,"OKAY",{duration:!1}).subscribe()}))},submit:function(e){var t=this;Popup.show(c.default,{title:"Confirm Your Action",message:this.$popupParams.confirmMessage||"Would you like to confirm your action.",onAction:function(e){e&&t.triggerSubmit()}})},triggerSubmit:function(){var e=this,t=this.validation.extractFields(this.fields);t.amount=this.amount,nsHttpClient.post("/api/nexopos/v4/cash-registers/".concat(this.action,"/").concat(this.register_id||this.settings.register.id),t).subscribe((function(t){e.$popupParams.resolve(t),e.$popup.close(),nsSnackBar.success(t.message).subscribe()}),(function(e){nsSnackBar.error(e.message).subscribe()}))}}},d=s(1),p=Object(d.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg w-95vw md:w-2/5-screen bg-white"},[s("div",{staticClass:"border-b border-gray-200 p-2 text-gray-700 flex justify-between items-center"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.title))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),e.loaded?s("div",{staticClass:"p-2"},[null!==e.settings&&e.settings.register?s("div",{staticClass:"mb-2 p-3 bg-gray-400 font-bold text-white text-right flex justify-between"},[s("span",[e._v("Balance ")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.settings.register.balance)))])]):e._e(),e._v(" "),s("div",{staticClass:"mb-2 p-3 bg-green-400 font-bold text-white text-right flex justify-between"},[s("span",[e._v("Input")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.amount)))])]),e._v(" "),s("div",{staticClass:"mb-2"},[s("ns-numpad",{attrs:{value:e.amount},on:{next:function(t){return e.submit(t)},changed:function(t){return e.definedValue(t)}}})],1),e._v(" "),e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})}))],2):e._e(),e._v(" "),e.loaded?e._e():s("div",{staticClass:"flex items-center justify-center"},[s("ns-spinner")],1)])}),[],!1,null,null,null).exports,h=s(14);function f(e,t,s,r,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void s(e)}a.done?t(u):Promise.resolve(u).then(r,n)}var v={components:{nsNumpad:o.a},data:function(){return{registers:[],priorVerification:!1,hasLoadedRegisters:!1,validation:new a.a,amount:0,settings:null,settingsSubscription:null}},mounted:function(){var e=this;this.checkUsedRegister(),this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t}))},beforeDestroy:function(){this.settingsSubscription.unsubscribe()},computed:{},methods:{popupResolver:h.a,selectRegister:function(e){var t,s=this;return(t=n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("closed"===e.status){t.next=2;break}return t.abrupt("return",i.nsSnackBar.error("Unable to open this register. Only closed register can be opened.").subscribe());case 2:return t.prev=2,t.next=5,new Promise((function(t,s){var r="Open Register : %s".replace("%s",e.name),n=e.id;Popup.show(p,{resolve:t,reject:s,title:r,identifier:"ns.cash-registers-opening",action:"open",register_id:n})}));case 5:r=t.sent,s.popupResolver(r),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})),function(){var e=this,s=arguments;return new Promise((function(r,n){var i=t.apply(e,s);function o(e){f(i,r,n,o,a,"next",e)}function a(e){f(i,r,n,o,a,"throw",e)}o(void 0)}))})()},checkUsedRegister:function(){var e=this;this.priorVerification=!1,i.nsHttpClient.get("/api/nexopos/v4/cash-registers/used").subscribe((function(t){e.$popupParams.resolve(t),e.$popup.close()}),(function(t){e.priorVerification=!0,i.nsSnackBar.error(t.message).subscribe(),e.loadRegisters()}))},loadRegisters:function(){var e=this;this.hasLoadedRegisters=!1,i.nsHttpClient.get("/api/nexopos/v4/cash-registers").subscribe((function(t){e.registers=t,e.hasLoadedRegisters=!0}))},getClass:function(e){switch(e.status){case"in-use":return"bg-teal-200 text-gray-800 cursor-not-allowed";case"disabled":return"bg-gray-200 text-gray-700 cursor-not-allowed";case"available":return"bg-green-100 text-gray-800"}return"border-gray-200 cursor-pointer hover:bg-blue-400 hover:text-white"}}},g=Object(d.a)(v,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"w-95vw md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen flex flex-col overflow-hidden",class:e.priorVerification?"shadow-lg bg-white":""},[e.priorVerification?[s("div",{staticClass:"title p-2 border-b border-gray-200 flex justify-between items-center"},[s("h3",{staticClass:"font-semibold"},[e._v("Open The Register")]),e._v(" "),e.settings?s("div",[s("a",{staticClass:"hover:bg-red-400 hover:border-red-500 hover:text-white rounded-full border border-gray-200 px-3 text-sm py-1",attrs:{href:e.settings.urls.orders_url}},[e._v("Exit To Orders")])]):e._e()]),e._v(" "),e.hasLoadedRegisters?e._e():s("div",{staticClass:"p-2 flex-auto overflow-y-auto flex items-center justify-center"},[s("ns-spinner",{attrs:{size:"16",border:"4"}})],1),e._v(" "),e.hasLoadedRegisters?s("div",{staticClass:"flex-auto overflow-y-auto"},[s("div",{staticClass:"grid grid-cols-3"},e._l(e.registers,(function(t,r){return s("div",{key:r,staticClass:"border-b border-r flex items-center justify-center flex-col p-3",class:e.getClass(t),on:{click:function(s){return e.selectRegister(t)}}},[s("i",{staticClass:"las la-cash-register text-6xl"}),e._v(" "),s("h3",{staticClass:"text-semibold text-center"},[e._v(e._s(t.name))]),e._v(" "),s("span",{staticClass:"text-sm"},[e._v("("+e._s(t.status_label)+")")])])})),0),e._v(" "),0===e.registers.length?s("div",{staticClass:"p-2 bg-red-400 text-white"},[e._v("\n                Looks like there is no registers. At least one register is required to proceed. — "),s("a",{staticClass:"font-bold hover:underline",attrs:{href:e.settings.urls.registers_url}},[e._v("Create Cash Register")])]):e._e()]):e._e()]:e._e(),e._v(" "),!1===e.priorVerification?s("div",{staticClass:"h-full w-full flex justify-center items-center"},[s("ns-spinner",{attrs:{size:"24",border:"8"}})],1):e._e()],2)}),[],!1,null,null,null).exports,b={data:function(){return{totalIn:0,totalOut:0,settings:null,settingsSubscription:null,histories:[]}},mounted:function(){var e=this;this.settingsSubscription=POS.settings.subscribe((function(t){e.settings=t})),this.getHistory()},destroyed:function(){this.settingsSubscription.unsubscribe()},methods:{popupResolver:h.a,closePopup:function(){this.popupResolver({status:"success"})},getHistory:function(){var e=this;i.nsHttpClient.get("/api/nexopos/v4/cash-registers/session-history/".concat(this.settings.register.id)).subscribe((function(t){e.histories=t,e.totalIn=e.histories.filter((function(e){return["register-opening","register-sale","register-cash-in"].includes(e.action)})).map((function(e){return parseFloat(e.value)})).reduce((function(e,t){return e+t}),0),e.totalOut=e.histories.filter((function(e){return["register-closing","register-refund","register-cash-out"].includes(e.action)})).map((function(e){return parseFloat(e.value)})).reduce((function(e,t){return e+t}),0),console.log(e.totalOut)}))}}},m=Object(d.a)(b,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg-white shadow-lg w-95vw md:w-4/6-screen lg:w-half overflow-hidden"},[s("div",{staticClass:"p-2 flex justify-between items-center",attrs:{id:"header"}},[s("h3",{staticClass:"font-bold"},[e._v("Register History")]),e._v(" "),s("div",[s("ns-close-button",{on:{click:e.closePopup}})],1)]),e._v(" "),s("div",{staticClass:"flex w-full"},[s("div",{staticClass:"flex flex-auto"},[s("div",{staticClass:"w-full md:w-1/2 text-right bg-green-400 text-white font-bold text-3xl p-3"},[e._v(e._s(e._f("currency")(e.totalIn)))]),e._v(" "),s("div",{staticClass:"w-full md:w-1/2 text-right bg-red-400 text-white font-bold text-3xl p-3"},[e._v(e._s(e._f("currency")(e.totalOut)))])])]),e._v(" "),s("div",{staticClass:"flex flex-col overflow-y-auto h-120"},[e._l(e.histories,(function(t){return[["register-sale","register-cash-in"].includes(t.action)?s("div",{key:t.id,staticClass:"flex border-b border-green-200 bg-green-100"},[s("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),s("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-opening"].includes(t.action)?s("div",{key:t.id,staticClass:"flex border-b border-blue-200 bg-blue-100"},[s("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),s("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-close"].includes(t.action)?s("div",{key:t.id,staticClass:"flex border-b border-teal-200 bg-teal-100"},[s("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),s("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e(),e._v(" "),["register-refund","register-cash-out"].includes(t.action)?s("div",{key:t.id,staticClass:"flex border-b border-red-200 bg-red-100"},[s("div",{staticClass:"p-2 flex-auto"},[e._v(e._s(t.label))]),e._v(" "),s("div",{staticClass:"flex-auto text-right p-2"},[e._v(e._s(e._f("currency")(t.value)))])]):e._e()]}))],2)])}),[],!1,null,null,null).exports;function _(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function x(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?_(Object(s),!0).forEach((function(t){y(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function y(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function w(e,t,s,r,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void s(e)}a.done?t(u):Promise.resolve(u).then(r,n)}function C(e){return function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){w(i,r,n,o,a,"next",e)}function a(e){w(i,r,n,o,a,"throw",e)}o(void 0)}))}}var O={mounted:function(){var e=this;this.settingsSubscriber=POS.settings.subscribe((function(t){e.settings=t})),this.popupCloser()},data:function(){return{settings:null,settingsSubscriber:null}},methods:{popupResolver:h.a,popupCloser:u.a,closePopup:function(){this.popupResolver({status:"failed",button:"close_popup"})},closeCashRegister:function(){var e=this;return C(n.a.mark((function t(){var s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Close Register",action:"close",identifier:"ns.cash-registers-closing",resolve:e,reject:t})}));case 3:s=t.sent,e.popupResolver(x({button:"close_register"},s)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cashIn:function(){var e=this;return C(n.a.mark((function t(){var s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Cash In",action:"register-cash-in",identifier:"ns.cash-registers-cashing",resolve:e,reject:t})}));case 3:s=t.sent,e.popupResolver(x({button:"close_register"},s)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cashOut:function(){var e=this;return C(n.a.mark((function t(){var s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(p,{title:"Cash Out",action:"register-cash-out",identifier:"ns.cash-registers-cashout",resolve:e,reject:t})}));case 3:s=t.sent,e.popupResolver(x({button:"close_register"},s)),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},historyPopup:function(){return C(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,t){Popup.show(m,{resolve:e,reject:t})}));case 3:e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()}}},P=Object(d.a)(O,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg w-95vw md:w-3/5-screen lg:w-1/3-screen bg-white"},[s("div",{staticClass:"p-2 border-b border-gray-200 flex items-center justify-between"},[s("h3",[e._v("Register Options")]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.closePopup()}}})],1)]),e._v(" "),s("div",{staticClass:"grid grid-cols-2 text-gray-700"},[s("div",{staticClass:"hover:bg-teal-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.closeCashRegister()}}},[s("i",{staticClass:"las la-sign-out-alt text-6xl"}),e._v(" "),s("h3",{staticClass:"text-xl font-bold"},[e._v("Close")])]),e._v(" "),s("div",{staticClass:"hover:bg-green-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.cashIn()}}},[s("i",{staticClass:"las la-plus-circle text-6xl"}),e._v(" "),s("h3",{staticClass:"text-xl font-bold"},[e._v("Cash In")])]),e._v(" "),s("div",{staticClass:"hover:bg-red-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.cashOut()}}},[s("i",{staticClass:"las la-minus-circle text-6xl"}),e._v(" "),s("h3",{staticClass:"text-xl font-bold"},[e._v("Cash Out")])]),e._v(" "),s("div",{staticClass:"hover:bg-blue-100 border-gray-200 border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col",on:{click:function(t){return e.historyPopup()}}},[s("i",{staticClass:"las la-history text-6xl"}),e._v(" "),s("h3",{staticClass:"text-xl font-bold"},[e._v("History")])])])])}),[],!1,null,null,null).exports;function j(e,t,s,r,n,i,o){try{var a=e[i](o),u=a.value}catch(e){return void s(e)}a.done?t(u):Promise.resolve(u).then(r,n)}function k(e){return function(){var t=this,s=arguments;return new Promise((function(r,n){var i=e.apply(t,s);function o(e){j(i,r,n,o,a,"next",e)}function a(e){j(i,r,n,o,a,"throw",e)}o(void 0)}))}}var S={data:function(){return{order:null,name:"",selectedRegister:null,orderSubscriber:null,settingsSubscriber:null}},watch:{},methods:{openRegisterOptions:function(){var e=this;return k(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){Popup.show(P,{resolve:e,reject:t})}));case 3:"close_register"===t.sent.button&&(delete e.settings.register,POS.settings.next(e.settings),POS.reset()),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),Object.keys(t.t0).length>0&&i.nsSnackBar.error(t.t0.message).subscribe();case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},registerInitialQueue:function(){var e=this;POS.initialQueue.push(k(n.a.mark((function t(){var s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,s){void 0===e.settings.register&&Popup.show(g,{resolve:t,reject:s})}));case 3:return s=t.sent,POS.set("register",s.data.register),t.abrupt("return",s);case 8:throw t.prev=8,t.t0=t.catch(0),t.t0;case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))))},setButtonName:function(){if(void 0===this.settings.register)return this.name="Cash Register";this.name="Cash Register : ".concat(this.settings.register.name)}},destroyed:function(){this.orderSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe()},mounted:function(){var e=this;this.registerInitialQueue(),this.orderSubscriber=POS.order.subscribe((function(t){e.order=t})),this.settingsSubscriber=POS.settings.subscribe((function(t){e.settings=t,e.setButtonName()}))}},$=Object(d.a)(S,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openRegisterOptions()}}},[s("i",{staticClass:"mr-1 text-xl las la-cash-register"}),e._v(" "),s("span",[e._v(e._s(e.name))])])}),[],!1,null,null,null);t.default=$.exports},272:function(e,t,s){"use strict";s.r(t);var r=s(7),n=s(0),i=s(10),o={data:function(){return{products:[],isLoading:!1}},computed:{order:function(){return this.$popupParams.order}},mounted:function(){this.loadProducts()},methods:{close:function(){this.$popupParams.reject(!1),this.$popup.close()},loadProducts:function(){var e=this;this.isLoading=!0;var t=this.$popupParams.order.id;n.nsHttpClient.get("/api/nexopos/v4/orders/".concat(t,"/products")).subscribe((function(t){e.isLoading=!1,e.products=t}))},openOrder:function(){this.$popup.close(),this.$popupParams.resolve(this.order)}}},a=s(1),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[s("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[s("h3",{staticClass:"font-semibold"},[e._v("Products — "+e._s(e.order.code)+" "),e.order.title?s("span",[e._v("("+e._s(e.order.title)+")")]):e._e()]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"flex-auto p-2 overflow-y-auto"},[e.isLoading?s("div",{staticClass:"flex-auto relative"},[s("div",{staticClass:"h-full w-full flex items-center justify-center"},[s("ns-spinner")],1)]):e._e(),e._v(" "),e.isLoading?e._e():e._l(e.products,(function(t){return s("div",{key:t.id,staticClass:"item"},[s("div",{staticClass:"flex-col border-b border-blue-400 py-2"},[s("div",{staticClass:"title font-semibold text-gray-700 flex justify-between"},[s("span",[e._v(e._s(t.name)+" (x"+e._s(t.quantity)+")")]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(t.total_price)))])]),e._v(" "),s("div",{staticClass:"text-sm text-gray-600"},[s("ul",[s("li",[e._v("Unit : "+e._s(t.unit.name))])])])])])}))],2),e._v(" "),s("div",{staticClass:"flex justify-end p-2 border-t border-gray-400"},[s("div",{staticClass:"px-1"},[s("div",{staticClass:"-mx-2 flex"},[s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.openOrder()}}},[e._v("Open")])],1),e._v(" "),s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v("Close")])],1)])])])])}),[],!1,null,null,null).exports,c={props:["orders"],data:function(){return{searchField:""}},watch:{orders:function(){n.nsHooks.doAction("ns-pos-pending-orders-refreshed",this.orders)}},mounted:function(){},name:"ns-pos-pending-order",methods:{previewOrder:function(e){this.$emit("previewOrder",e)},proceedOpenOrder:function(e){this.$emit("proceedOpenOrder",e)},searchOrder:function(){this.$emit("searchOrder",this.searchField)}}},l={components:{nsPosPendingOrders:Object(a.a)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flex flex-auto flex-col overflow-hidden"},[s("div",{staticClass:"p-1"},[s("div",{staticClass:"flex rounded border-2 border-blue-400"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchField,expression:"searchField"}],staticClass:"p-2 outline-none flex-auto",attrs:{type:"text"},domProps:{value:e.searchField},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchOrder()},input:function(t){t.target.composing||(e.searchField=t.target.value)}}}),e._v(" "),s("button",{staticClass:"w-16 md:w-24 bg-blue-400 text-white",on:{click:function(t){return e.searchOrder()}}},[s("i",{staticClass:"las la-search"}),e._v(" "),s("span",{staticClass:"mr-1 hidden md:visible"},[e._v("Search")])])])]),e._v(" "),s("div",{staticClass:"overflow-y-auto flex flex-auto"},[s("div",{staticClass:"flex p-2 flex-auto flex-col overflow-y-auto"},[e._l(e.orders,(function(t){return s("div",{key:t.id,staticClass:"border-b border-blue-400 w-full py-2",attrs:{"data-order-id":t.id}},[s("h3",{staticClass:"text-gray-700"},[e._v(e._s(t.title||"Untitled Order"))]),e._v(" "),s("div",{staticClass:"px-2"},[s("div",{staticClass:"flex flex-wrap -mx-4"},[s("div",{staticClass:"w-full md:w-1/2 px-2"},[s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Cashier")]),e._v(" : "+e._s(t.nexopos_users_username))]),e._v(" "),s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Register")]),e._v(" : "+e._s(e._f("currency")(t.total)))]),e._v(" "),s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Tendered")]),e._v(" : "+e._s(e._f("currency")(t.tendered)))])]),e._v(" "),s("div",{staticClass:"w-full md:w-1/2 px-2"},[s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Customer")]),e._v(" : "+e._s(t.nexopos_customers_name))]),e._v(" "),s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Date")]),e._v(" : "+e._s(t.created_at))]),e._v(" "),s("p",{staticClass:"text-sm text-gray-600"},[s("strong",[e._v("Type")]),e._v(" : "+e._s(t.type))])])])]),e._v(" "),s("div",{staticClass:"flex justify-end w-full mt-2"},[s("div",{staticClass:"flex rounded-lg overflow-hidden buttons-container"},[s("button",{staticClass:"text-white bg-green-400 outline-none px-2 py-1",on:{click:function(s){return e.proceedOpenOrder(t)}}},[s("i",{staticClass:"las la-lock-open"}),e._v(" Open")]),e._v(" "),s("button",{staticClass:"text-white bg-blue-400 outline-none px-2 py-1",on:{click:function(s){return e.previewOrder(t)}}},[s("i",{staticClass:"las la-eye"}),e._v(" Products")])])])])})),e._v(" "),0===e.orders.length?s("div",{staticClass:"h-full v-full items-center justify-center flex"},[s("h3",{staticClass:"text-semibold text-gray-700"},[e._v("Nothing to display...")])]):e._e()],2)])])}),[],!1,null,null,null).exports},methods:{searchOrder:function(e){var t=this;n.nsHttpClient.get("/api/nexopos/v4/crud/".concat(this.active,"?search=").concat(e)).subscribe((function(e){t.orders=e.data}))},setActiveTab:function(e){this.active=e,this.loadOrderFromType(e)},openOrder:function(e){POS.loadOrder(e.id),this.$popup.close()},loadOrderFromType:function(e){var t=this;n.nsHttpClient.get("/api/nexopos/v4/crud/".concat(e)).subscribe((function(e){t.orders=e.data}))},previewOrder:function(e){var t=this;new Promise((function(t,s){Popup.show(u,{order:e,resolve:t,reject:s})})).then((function(s){t.proceedOpenOrder(e)}),(function(e){return e}))},proceedOpenOrder:function(e){var t=this;if(POS.products.getValue().length>0)return Popup.show(i.default,{title:"Confirm Your Action",message:"The cart is not empty. Opening an order will clear your cart would you proceed ?",onAction:function(s){s&&t.openOrder(e)}});this.openOrder(e)}},data:function(){return{active:"ns.hold-orders",searchField:"",orders:[]}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.$popup.close()})),this.loadOrderFromType(this.active)}},d=Object(a.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[s("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[s("h3",{staticClass:"font-semibold"},[e._v("Orders")]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.$popup.close()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 flex overflow-hidden flex-auto"},[s("ns-tabs",{attrs:{active:e.active},on:{changeTab:function(t){return e.setActiveTab(t)}}},[s("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.hold-orders",label:"On Hold",padding:"p-0"}},[s("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),s("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.unpaid-orders",label:"Unpaid",padding:"p-0"}},[s("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),s("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.partially-paid-orders",label:"Partially Paid",padding:"p-0"}},[s("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1)],1)],1),e._v(" "),s("div",{staticClass:"p-2 flex justify-between border-t bg-gray-200"},[s("div"),e._v(" "),s("div",[s("ns-button",[e._v("close")])],1)])])}),[],!1,null,null,null).exports,p={name:"ns-pos-pending-orders-button",methods:{openPendingOrdersPopup:function(){(new r.a).open(d)}}},h=Object(a.a)(p,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[s("i",{staticClass:"mr-1 text-xl lar la-hand-pointer"}),e._v(" "),s("span",[e._v("Orders")])])}),[],!1,null,null,null);t.default=h.exports},273:function(e,t,s){"use strict";s.r(t),s.d(t,"POS",(function(){return k})),s.d(t,"POSInit",(function(){return S}));var r=s(66),n=s(7),i=s(0),o={data:function(){return{unitsQuantities:[],loadsUnits:!1}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&(e.$popupParams.reject(!1),e.$popup.close())})),void 0!==this.$popupParams.product.$original().selectedUnitQuantity?this.selectUnit(this.$popupParams.product.$original().selectedUnitQuantity):(this.loadsUnits=!0,this.loadUnits())},methods:{loadUnits:function(){var e=this;i.nsHttpClient.get("/api/nexopos/v4/products/".concat(this.$popupParams.product.$original().id,"/units/quantities")).subscribe((function(t){if(0===t.length)return e.$popup.close(),i.nsSnackBar.error("This product doesn't has any unit defined for selling.").subscribe();e.unitsQuantities=t,1===e.unitsQuantities.length&&e.selectUnit(e.unitsQuantities[0])}))},selectUnit:function(e){this.$popupParams.resolve({unit_quantity_id:e.id,unit_name:e.unit.name,$quantities:function(){return e}}),this.$popup.close()}}},a=s(1),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.loadsUnits?s("div",{staticClass:"bg-white w-2/3-screen lg:w-1/3-screen overflow-hidden flex flex-col"},[e._m(0),e._v(" "),e.unitsQuantities.length>0?s("div",{staticClass:"grid grid-flow-row grid-cols-2 overflow-y-auto"},e._l(e.unitsQuantities,(function(t){return s("div",{key:t.id,staticClass:"hover:bg-gray-200 cursor-pointer border flex-shrink-0 border-gray-200 flex flex-col items-center justify-center",on:{click:function(s){return e.selectUnit(t)}}},[s("div",{staticClass:"h-40 w-full flex items-center justify-center overflow-hidden"},[t.preview_url?s("img",{staticClass:"object-cover h-full",attrs:{src:t.preview_url,alt:t.unit.name}}):e._e(),e._v(" "),t.preview_url?e._e():s("div",{staticClass:"h-40 flex items-center justify-center"},[s("i",{staticClass:"las la-image text-gray-600 text-6xl"})])]),e._v(" "),s("div",{staticClass:"h-0 w-full"},[s("div",{staticClass:"relative w-full flex items-center justify-center -top-10 h-20 py-2 flex-col",staticStyle:{background:"rgb(255 255 255 / 73%)"}},[s("h3",{staticClass:"font-bold text-gray-700 py-2 text-center"},[e._v(e._s(t.unit.name)+" ("+e._s(t.quantity)+")")]),e._v(" "),s("p",{staticClass:"text-sm font-medium text-gray-600"},[e._v(e._s(e._f("currency")(t.sale_price)))])])])])})),0):e._e(),e._v(" "),0===e.unitsQuantities.length?s("div",{staticClass:"h-56 flex items-center justify-center"},[s("ns-spinner")],1):e._e()]):e._e()}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"h-16 flex justify-center items-center flex-shrink-0",attrs:{id:"header"}},[t("h3",{staticClass:"font-bold text-gray-700"},[this._v("Choose Selling Unit")])])}],!1,null,null,null).exports;class c{constructor(e){this.product=e}run(){return new Promise((e,t)=>{const s=new n.a({popupClass:"shadow-lg h-1/2-screen w-3/4 xl:w-1/4 bg-white"}),r=this.product;s.open(u,{resolve:e,reject:t,product:r})})}}var l=s(42),d=s(3),p=s.n(d);class h{constructor(){this.detect()}detect(){window.innerWidth<544?this.screenIs="xs":window.innerWidth>=544&&window.innerWidth<768?this.screenIs="sm":window.innerWidth>=768&&window.innerWidth<992?this.screenIs="md":window.innerWidth>=992&&window.innerWidth<1200?this.screenIs="lg":window.innerWidth>=1200&&(this.screenIs="xl")}is(e){return void 0===e?this.screenIs:this.screenIs===e}}var f=s(5),v=function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))};const g=window.NsPosDashboardButton=s(275).default,b=window.NsPosPendingOrderButton=s(272).default,m=window.NsPosOrderTypeButton=s(276).default,_=window.NsPosCustomersButton=s(277).default,x=window.NsPosResetButton=s(278).default,y=window.NsPosCashRegister=s(271).default,w=window.NsAlertPopup=s(54).default,C=window.NsConfirmPopup=s(10).default,O=window.NsPromptPopup=s(34).default,P=window.NsLayawayPopup=s(279).default,j=window.NsLayawayPopup=s(61).default;class k{constructor(){this._orderTypeProcessQueue=[],this._initialQueue=[],this._responsive=new h,this._isSubmitting=!1,this._processingAddQueue=!1,this.defaultOrder=()=>({discount_type:null,title:"",discount:0,register_id:this.get("register")?this.get("register").id:void 0,discount_percentage:0,subtotal:0,total:0,coupons:[],total_coupons:0,tendered:0,note:"",note_visibility:"hidden",tax_group_id:void 0,tax_type:void 0,taxes:[],tax_groups:[],payment_status:void 0,customer_id:void 0,change:0,total_products:0,shipping:0,tax_value:0,shipping_rate:0,shipping_type:void 0,customer:void 0,type:void 0,products:[],instalments:[],payments:[],addresses:{shipping:void 0,billing:void 0}}),this.addToCartQueue=[c,r.a],this.initialize()}get screen(){return this._screen}get visibleSection(){return this._visibleSection}get paymentsType(){return this._paymentsType}get order(){return this._order}get types(){return this._types}get products(){return this._products}get customers(){return this._customers}get options(){return this._options}get orderTypeQueue(){return this._orderTypeProcessQueue}get settings(){return this._settings}get breadcrumbs(){return this._breadcrumbs}get initialQueue(){return this._initialQueue}get responsive(){return this._responsive}get processingAddQueue(){return this._processingAddQueue}reset(){this._isSubmitting=!1,this.order.next(this.defaultOrder()),this._products.next([]),this._customers.next([]),this._breadcrumbs.next([]),this.defineCurrentScreen(),this.processInitialQueue(),this.refreshCart()}initialize(){this._products=new l.a([]),this._customers=new l.a([]),this._types=new l.a([]),this._breadcrumbs=new l.a([]),this._screen=new l.a(""),this._paymentsType=new l.a([]),this._visibleSection=new l.a("both"),this._options=new l.a({}),this._settings=new l.a({}),this._order=new l.a(this.defaultOrder()),this._orderTypeProcessQueue=[{identifier:"handle.delivery-order",promise:e=>new Promise((t,s)=>{if("delivery"===e.identifier)return n.a.show(j,{resolve:t,reject:s});s(!1)})}],this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue(),r=this.order.getValue();return!1!==s.ns_pos_tax_group&&(r.tax_group_id=s.ns_pos_tax_group,r.tax_type=s.ns_pos_tax_type,this.order.next(r)),e({status:"success",message:"tax group assignated"})})),this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue();this.order.getValue();return!1!==s.ns_customers_default&&i.nsHttpClient.get("/api/nexopos/v4/customers/"+s.ns_customers_default).subscribe(t=>{this.selectCustomer(t),e({status:"success",message:Object(f.a)("The customer has been loaded")})},e=>{t(e)}),e({status:"success",message:"tax group assignated"})})),this.products.subscribe(e=>{this.refreshCart()}),this.types.subscribe(e=>{const t=e.filter(e=>e.selected);if(t.length>0){const e=this.order.getValue();e.type=t[0],this.order.next(e)}}),window.addEventListener("resize",()=>{this._responsive.detect(),this.defineCurrentScreen()}),this.defineCurrentScreen()}processInitialQueue(){return v(this,void 0,void 0,(function*(){for(let e in this._initialQueue)try{yield this._initialQueue[e]()}catch(e){i.nsSnackBar.error(e.message).subscribe()}}))}removeCoupon(e){const t=this.order.getValue(),s=t.coupons,r=s.indexOf(e);s.splice(r,1),t.coupons=s,this.order.next(t)}pushCoupon(e){const t=this.order.getValue();t.coupons.forEach(t=>{if(t.code===e.code){const e=Object(f.a)("This coupon is already added to the cart");throw i.nsSnackBar.error(e).subscribe(),e}}),t.coupons.push(e),this.order.next(t),this.refreshCart()}get header(){const e={buttons:{NsPosDashboardButton:g,NsPosPendingOrderButton:b,NsPosOrderTypeButton:m,NsPosCustomersButton:_,NsPosResetButton:x}};return"yes"===this.options.getValue().ns_pos_registers_enabled&&(e.buttons.NsPosCashRegister=y),i.nsHooks.doAction("ns-pos-header",e),e}defineOptions(e){this._options.next(e)}defineCurrentScreen(){this._visibleSection.next(["xs","sm"].includes(this._responsive.is())?"grid":"both"),this._screen.next(this._responsive.is())}changeVisibleSection(e){["both","cart","grid"].includes(e)&&(["cart","both"].includes(e)&&this.refreshCart(),this._visibleSection.next(e))}addPayment(e){if(e.value>0){const t=this._order.getValue();return t.payments.push(e),this._order.next(t),this.computePaid()}return i.nsSnackBar.error("Invalid amount.").subscribe()}removePayment(e){if(void 0!==e.id)return i.nsSnackBar.error("Unable to delete a payment attached to the order").subscribe();const t=this._order.getValue(),s=t.payments.indexOf(e);t.payments.splice(s,1),this._order.next(t),i.nsEvent.emit({identifier:"ns.pos.remove-payment",value:e}),this.updateCustomerAccount(e),this.computePaid()}updateCustomerAccount(e){if("account-payment"===e.identifier){const t=this.order.getValue().customer;t.account_amount+=e.value,this.selectCustomer(t)}}getNetPrice(e,t,s){return"inclusive"===s?e/(t+100)*100:"exclusive"===s?e/100*(t+100):void 0}getVatValue(e,t,s){return"inclusive"===s?e-this.getNetPrice(e,t,s):"exclusive"===s?this.getNetPrice(e,t,s)-e:void 0}computeTaxes(){return new Promise((e,t)=>{const s=this.order.getValue();if(void 0===s.tax_group_id||null===s.tax_group_id)return t(!1);const r=s.tax_groups;return r&&void 0!==r[s.tax_group_id]?(s.taxes=s.taxes.map(e=>(e.tax_value=this.getVatValue(s.subtotal,e.rate,s.tax_type),e)),e({status:"success",data:{tax:r[s.tax_group_id],order:s}})):null===s.tax_group_id?t({status:"failed",message:Object(f.a)("No tax group assigned to the order")}):void i.nsHttpClient.get("/api/nexopos/v4/taxes/groups/"+s.tax_group_id).subscribe(t=>(s.tax_groups=s.tax_groups||[],s.taxes=t.taxes.map(e=>({tax_id:e.id,tax_name:e.name,rate:parseFloat(e.rate),tax_value:this.getVatValue(s.subtotal,e.rate,s.tax_type)})),s.tax_groups[t.id]=t,e({status:"success",data:{tax:t,order:s}})),e=>t(e))})}canProceedAsLaidAway(e){return new Promise((t,s)=>v(this,void 0,void 0,(function*(){const r=e.customer.group.minimal_credit_payment,i=e.total*r/100;try{const r=yield new Promise((t,s)=>{n.a.show(P,{order:e,reject:s,resolve:t})});if(r.tendered<i){const e=`Before saving the order as laid away, a minimum payment of ${p.a.filter("currency")(i)} is required`;return n.a.show(w,{title:"Unable to proceed",message:e}),s({status:"failed",message:e})}return t({status:"success",message:Object(f.a)("Layaway defined"),data:{order:r}})}catch(e){return s(e)}})))}submitOrder(e={}){return new Promise((t,s)=>v(this,void 0,void 0,(function*(){var r=Object.assign(Object.assign({},this.order.getValue()),e);const n=r.customer.group.minimal_credit_payment;if("hold"!==r.payment_status&&(0===r.payments.length||r.total>r.tendered)){if("no"===this.options.getValue().ns_orders_allow_partial){return s({status:"failed",message:"Partially paid orders are disabled."})}if(n>=0)try{r=(yield this.canProceedAsLaidAway(r)).data.order}catch(e){return s(e)}}if(!this._isSubmitting){const e=void 0!==r.id?"put":"post";return this._isSubmitting=!0,i.nsHttpClient[e]("/api/nexopos/v4/orders"+(void 0!==r.id?"/"+r.id:""),r).subscribe(e=>{t(e),this.reset(),i.nsHooks.doAction("ns-order-submit-successful",e),this._isSubmitting=!1},e=>{this._isSubmitting=!1,s(e),i.nsHooks.doAction("ns-order-submit-failed",e)})}return s({status:"failed",message:"An order is currently being processed."})})))}loadOrder(e){i.nsHttpClient.get(`/api/nexopos/v4/orders/${e}/pos`).subscribe(e=>{const t=(e=Object.assign(Object.assign({},this.defaultOrder()),e)).products.map(e=>(e.$original=()=>e.product,e.$quantities=()=>e.product.unit_quantities.filter(t=>t.id===e.unit_quantity_id)[0],e));e.type=this.types.getValue().filter(t=>t.identifier===e.type)[0],e.addresses={shipping:e.shipping_address,billing:e.billing_address},delete e.shipping_address,delete e.billing_address,this.buildOrder(e),this.buildProducts(t),this.selectCustomer(e.customer)})}buildOrder(e){this.order.next(e)}buildProducts(e){this.refreshProducts(e),this.products.next(e)}printOrder(e){if("disabled"===this.options.getValue().ns_pos_printing_enabled_for)return!1;const t=document.createElement("iframe");t.id="printing-section",t.className="hidden",t.src=this.settings.getValue().urls.printing_url.replace("{id}",e),document.body.appendChild(t)}computePaid(){const e=this._order.getValue();e.tendered=0,e.payments.length>0&&(e.tendered=e.payments.map(e=>e.value).reduce((e,t)=>t+e)),e.tendered>=e.total?e.payment_status="paid":e.tendered>0&&e.tendered<e.total&&(e.payment_status="partially_paid"),e.change=e.tendered-e.total,this._order.next(e)}setPaymentActive(e){const t=this._paymentsType.getValue(),s=t.indexOf(e);t.forEach(e=>e.selected=!1),t[s].selected=!0,this._paymentsType.next(t)}definedPaymentsType(e){this._paymentsType.next(e)}selectCustomer(e){return new Promise((t,s)=>{const r=this.order.getValue();r.customer=e,r.customer_id=e.id,this.order.next(r),void 0!==e.group&&null!==e.group||i.nsHttpClient.get(`/api/nexopos/v4/customers/${e.id}/group`).subscribe(e=>{r.customer.group=e,this.order.next(r),t(r)},e=>{s(e)})})}updateCart(e,t){for(let s in t)void 0!==t[s]&&p.a.set(e,s,t[s]);this.order.next(e),this.refreshCart()}checkCart(){const e=this.order.getValue(),t=[];e.coupons.forEach(s=>{let r=!0;s.products.length>0&&(r=e.products.filter(e=>s.products.map(e=>e.product_id).includes(e.product_id)).length>0,r||-1!==t.indexOf(s)||t.push(s));let n=!0;s.categories.length>0&&(n=e.products.filter(e=>s.categories.map(e=>e.category_id).includes(e.$original().category_id)).length>0,n||-1!==t.indexOf(s)||t.push(s))}),t.forEach(e=>{i.nsSnackBar.error(Object(f.a)('The coupons "%s" has been removed from the cart, as it\'s required conditions are no more meet.').replace("%s",e.name),Object(f.a)("Okay"),{duration:6e3}).subscribe(),this.removeCoupon(e)})}refreshCart(){return v(this,void 0,void 0,(function*(){this.checkCart();const e=this.products.getValue();let t=this.order.getValue();const s=e.map(e=>e.total_price);s.length>0?t.subtotal=s.reduce((e,t)=>e+t):t.subtotal=0;const r=t.coupons.map(e=>"percentage_discount"===e.type?(e.value=t.subtotal*e.discount_value/100,e.value):(e.value=e.discount_value,e.value));t.total_coupons=0,r.length>0&&(t.total_coupons=r.reduce((e,t)=>e+t)),"percentage"===t.discount_type&&(t.discount=t.discount_percentage*t.subtotal/100),t.discount>t.subtotal&&0===t.total_coupons&&(t.discount=t.subtotal,i.nsSnackBar.info("The discount has been set to the cart subtotal").subscribe()),this.order.next(t);try{const e=yield this.computeTaxes();t=e.data.order}catch(e){if(!1!==e&&void 0!==e.message)throw e.message}const n=e.map(e=>e.tax_value);t.tax_value=0;const o=this.options.getValue().ns_pos_vat;["products_vat","products_flat_vat","products_variable_vat"].includes(o)&&n.length>0&&(t.tax_value+=n.reduce((e,t)=>e+t)),["flat_vat","variable_vat","products_variable_vat"].includes(o)&&t.taxes&&t.taxes.length>0&&(t.tax_value+=t.taxes.map(e=>e.tax_value).reduce((e,t)=>e+t)),t.total=t.subtotal+t.shipping+t.tax_value-t.discount-t.total_coupons,t.products=e,t.total_products=e.length,this.order.next(t),i.nsHooks.doAction("ns-cart-after-refreshed",t)}))}getStockUsage(e,t){const s=this._products.getValue().filter(s=>s.product_id===e&&s.unit_quantity_id===t).map(e=>e.quantity);return s.length>0?s.reduce((e,t)=>e+t):0}addToCart(e){return v(this,void 0,void 0,(function*(){let t=new Object,s={product_id:e.id,name:e.name,discount_type:"percentage",discount:0,discount_percentage:0,quantity:0,tax_group_id:e.tax_group_id,tax_value:0,unit_price:0,total_price:0,mode:"normal",$original:()=>e};this._processingAddQueue=!0;for(let e in this.addToCartQueue)try{const r=new this.addToCartQueue[e](s),n=yield r.run(t);t=Object.assign(Object.assign({},t),n)}catch(e){if(!1===e)return this._processingAddQueue=!1,!1}this._processingAddQueue=!1,s=Object.assign(Object.assign({},s),t);const r=this._products.getValue();r.unshift(s),this.refreshProducts(r),this._products.next(r)}))}defineTypes(e){this._types.next(e)}removeProduct(e){const t=this._products.getValue(),s=t.indexOf(e);t.splice(s,1),this._products.next(t)}updateProduct(e,t,s=null){const r=this._products.getValue();s=null===s?r.indexOf(e):s,p.a.set(r,s,Object.assign(Object.assign({},e),t)),this.refreshProducts(r),this._products.next(r)}refreshProducts(e){e.forEach(e=>{this.computeProduct(e)})}computeProduct(e){"normal"===e.mode?(e.unit_price=e.$quantities().sale_price,e.tax_value=e.$quantities().sale_price_tax*e.quantity):(e.unit_price=e.$quantities().wholesale_price,e.tax_value=e.$quantities().wholesale_price_tax*e.quantity),["flat","percentage"].includes(e.discount_type)&&"percentage"===e.discount_type&&(e.discount=e.unit_price*e.discount_percentage/100*e.quantity),e.total_price=e.unit_price*e.quantity-e.discount,i.nsHooks.doAction("ns-after-product-computed",e)}loadCustomer(e){return i.nsHttpClient.get("/api/nexopos/v4/customers/"+e)}defineSettings(e){this._settings.next(e)}voidOrder(e){void 0!==e.id?["hold"].includes(e.payment_status)?n.a.show(C,{title:"Order Deletion",message:"The current order will be deleted as no payment has been made so far.",onAction:t=>{t&&i.nsHttpClient.delete("/api/nexopos/v4/orders/"+e.id).subscribe(e=>{i.nsSnackBar.success(e.message).subscribe(),this.reset()},e=>i.nsSnackBar.error(e.message).subscribe())}}):n.a.show(O,{title:"Void The Order",message:"The current order will be void. This will cancel the transaction, but the order won't be deleted. Further details about the operation will be tracked on the report. Consider providing the reason of this operation.",onAction:t=>{!1!==t&&i.nsHttpClient.post(`/api/nexopos/v4/orders/${e.id}/void`,{reason:t}).subscribe(e=>{i.nsSnackBar.success(e.message).subscribe(),this.reset()},e=>i.nsSnackBar.error(e.message).subscribe())}}):i.nsSnackBar.error("Unable to void an unpaid order.").subscribe()}triggerOrderTypeSelection(e){return v(this,void 0,void 0,(function*(){for(let t=0;t<this.orderTypeQueue.length;t++)try{const s=yield this.orderTypeQueue[t].promise(e);console.log(s)}catch(e){console.log(e)}}))}set(e,t){const s=this.settings.getValue();s[e]=t,this.settings.next(s)}get(e){return this.settings.getValue()[e]}destroy(){this._products.unsubscribe(),this._customers.unsubscribe(),this._types.unsubscribe(),this._breadcrumbs.unsubscribe(),this._paymentsType.unsubscribe(),this._screen.unsubscribe(),this._order.unsubscribe(),this._settings.unsubscribe()}}window.POS=new k;const S=window.POS},275:function(e,t,s){"use strict";s.r(t);var r={name:"ns-pos-dashboard-button",methods:{goToDashboard:function(){return document.location=POS.settings.getValue().urls.dashboard_url}}},n=s(1),i=Object(n.a)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.goToDashboard()}}},[s("i",{staticClass:"mr-1 text-xl las la-tachometer-alt"}),e._v(" "),s("span",[e._v("Dashboard")])])}),[],!1,null,null,null);t.default=i.exports},276:function(e,t,s){"use strict";s.r(t);var r=s(7),n=s(55),i={name:"ns-pos-delivery-button",methods:{openPendingOrdersPopup:function(){new r.a({primarySelector:"#pos-app",popupClass:"shadow-lg bg-white w-3/5 md:w-2/3 lg:w-2/5 xl:w-2/4"}).open(n.default)}}},o=s(1),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[s("i",{staticClass:"mr-1 text-xl las la-truck"}),e._v(" "),s("span",[e._v("Order Type")])])}),[],!1,null,null,null);t.default=a.exports},277:function(e,t,s){"use strict";s.r(t);var r=s(7),n=s(53),i={name:"ns-pos-customers-button",methods:{openPendingOrdersPopup:function(){(new r.a).open(n.a)}}},o=s(1),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[s("i",{staticClass:"mr-1 text-xl lar la-user-circle"}),e._v(" "),s("span",[e._v("Customers")])])}),[],!1,null,null,null);t.default=a.exports},278:function(e,t,s){"use strict";s.r(t);var r=s(7),n=(s(53),s(10)),i={name:"ns-pos-customers-button",mounted:function(){this.popupCloser()},methods:{popupCloser:s(13).a,reset:function(){r.a.show(n.default,{title:"Confirm Your Action",message:"The current order will be cleared. But not deleted if it's persistent. Would you like to proceed ?",onAction:function(e){e&&POS.reset()}})}}},o=s(1),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.reset()}}},[s("i",{staticClass:"mr-1 text-xl  las la-eraser"}),e._v(" "),s("span",[e._v("Reset")])])}),[],!1,null,null,null);t.default=a.exports},279:function(e,t,s){"use strict";s.r(t);var r=s(8),n=s(0),i=s(5);function o(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?o(Object(s),!0).forEach((function(t){u(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function u(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l={name:"ns-pos-layaway-popup",data:function(){return{fields:[],instalments:[],formValidation:new r.a,subscription:null,totalPayments:0}},mounted:function(){var e=this;this.loadFields(),this.subscription=this.$popup.event.subscribe((function(t){["click-overlay","press-esc"].includes(t.event)&&e.close()}))},updated:function(){var e=this;setTimeout((function(){document.querySelector(".is-popup #total_instalments").addEventListener("change",(function(){var t=e.formValidation.extractFields(e.fields).total_instalments;e.generatePaymentFields(t)})),document.querySelector(".is-popup #total_instalments").addEventListener("focus",(function(){document.querySelector(".is-popup #total_instalments").select()}))}),200)},computed:{expectedPayment:function(){var e=this.order.customer.group.minimal_credit_payment;return this.order.total*e/100},order:function(){return this.$popupParams.order.instalments=this.$popupParams.order.instalments.map((function(e){for(var t in e)if("object"!==c(e[t]))if("date"===t){var s={type:"date",name:t,label:Object(i.a)("Date"),disabled:1===e.paid,value:moment(e.date).format("YYYY-MM-DD")};e[t]=s}else if("amount"===t){var r={type:"number",name:t,label:Object(i.a)("Amount"),disabled:1===e.paid,value:e.amount};e[t]=r}else if(!["paid","id"].includes(t)){var n={type:"hidden",name:t,value:e[t]};e[t]=n}return e})),this.$popupParams.order}},destroyed:function(){this.subscription.unsubscribe()},methods:{__:i.a,refreshTotalPayments:function(){if(this.order.instalments.length>0){var e=this.order.instalments.map((function(e){return e.amount.value||0})).reduce((function(e,t){return parseFloat(e)+parseFloat(t)}));this.totalPayments=this.order.total-e}else this.totalPayments=0},generatePaymentFields:function(e){var t=this;this.order.instalments=new Array(parseInt(e)).fill("").map((function(e,s){return{date:{type:"date",name:"date",label:"Date",disabled:t.expectedPayment>0&&0===s,value:0===s?ns.date.moment.format("YYYY-MM-DD"):""},amount:{type:"number",name:"amount",label:"Amount",disabled:t.expectedPayment>0&&0===s,value:0===s?t.expectedPayment:0}}})),this.$forceUpdate(),this.refreshTotalPayments()},close:function(){this.$popupParams.reject({status:"failed",message:Object(i.a)("You must define layaway settings before proceeding.")}),this.$popup.close()},updateOrder:function(){var e=this;if(0===this.order.instalments.length)return n.nsSnackBar.error(Object(i.a)("Please provide instalments before proceeding.")).subscribe();if(this.fields.forEach((function(t){return e.formValidation.validateField(t)})),!this.formValidation.fieldsValid(this.fields))return n.nsSnackBar.error(Object(i.a)("Unable to procee the form is not valid")).subscribe();this.$forceUpdate();var t=this.order.instalments.map((function(e){return{amount:parseFloat(e.amount.value),date:e.date.value}})),s=t.map((function(e){return e.amount})).reduce((function(e,t){return parseFloat(e)+parseFloat(t)}));if(t.filter((function(e){return void 0===e.date||""===e.date})).length>0)return n.nsSnackBar.error(Object(i.a)("One or more instalments has an invalid date.")).subscribe();if(t.filter((function(e){return!(e.amount>0)})).length>0)return n.nsSnackBar.error(Object(i.a)("One or more instalments has an invalid amount.")).subscribe();if(t.filter((function(e){return moment(e.date).isBefore(ns.date.moment.startOf("day"))})).length>0)return n.nsSnackBar.error(Object(i.a)("One or more instalments has a date prior to the current date.")).subscribe();if(console.log(t,s,this.order),s!=this.order.total)return n.nsSnackBar.error(Object(i.a)("Total instalments must be equal to the order total.")).subscribe();t.sort((function(e,t){var s=moment(e.date),r=moment(t.date);return s.isBefore(r)?-1:s.isAfter(r)?1:0}));var r=this.formValidation.extractFields(this.fields);r.final_payment_date=t.reverse()[0].date,r.total_instalments=t.length;var o=a(a(a({},this.$popupParams.order),r),{},{instalments:t}),u=this.$popupParams,c=u.resolve;u.reject;return this.$popup.close(),POS.order.next(o),c(o)},loadFields:function(){var e=this;n.nsHttpClient.get("/api/nexopos/v4/fields/ns.layaway").subscribe((function(t){e.fields=e.formValidation.createFields(t),e.fields.forEach((function(t){"total_instalments"===t.name&&(t.value=e.order.total_instalments||0)}))}))}}},d=s(1),p=Object(d.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shadow-lg h-95vh md:h-5/6-screen lg:h-5/6-screen w-95vw md:w-4/6-screen lg:w-3/6-screen bg-white flex flex-col"},[s("div",{staticClass:"p-2 border-b flex justify-between items-center"},[s("h3",{staticClass:"font-semibold"},[e._v(e._s(e.__("Layaway Parameters")))]),e._v(" "),s("div",[s("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),s("div",{staticClass:"p-2 flex-auto flex flex-col relative overflow-y-auto"},[0===e.fields.length?s("div",{staticClass:"absolute h-full w-full flex items-center justify-center"},[s("ns-spinner")],1):e._e(),e._v(" "),s("div",{staticClass:"p-2 text-white bg-blue-400 mb-2 text-center text-2xl font-bold flex justify-between"},[s("span",[e._v(e._s(e.__("Minimum Payment")))]),e._v(" "),s("span",[e._v(e._s(e._f("currency")(e.expectedPayment)))])]),e._v(" "),s("div",e._l(e.fields,(function(e,t){return s("ns-field",{key:t,attrs:{field:e}})})),1),e._v(" "),s("div",{staticClass:"flex flex-col flex-auto overflow-hidden"},[s("div",{staticClass:"border-b border-gray-200"},[s("h3",{staticClass:"text-2xl flex justify-between py-2 text-gray-700"},[s("span",[e._v(e._s(e.__("Instalments & Payments")))]),e._v(" "),s("p",[s("span",{staticClass:"text-sm"},[e._v("("+e._s(e._f("currency")(e.totalPayments))+")")]),e._v(" "),s("span",[e._v("\n                        "+e._s(e._f("currency")(e.order.total))+"\n                        ")])])]),e._v(" "),s("p",{staticClass:"p-2 mb-2 text-center bg-green-200 text-green-700"},[e._v("\n                    "+e._s(e.__("The final payment date must be the last within the instalments."))+"\n                ")])]),e._v(" "),s("div",{staticClass:"flex-auto overflow-y-auto"},[e._l(e.order.instalments,(function(t,r){return s("div",{key:r,staticClass:"flex w-full -mx-1 py-2"},[s("div",{staticClass:"flex flex-auto"},[s("div",{staticClass:"px-1 w-full md:w-1/2"},[s("ns-field",{attrs:{field:t.date},on:{change:function(t){return e.refreshTotalPayments()}}})],1),e._v(" "),s("div",{staticClass:"px-1 w-full md:w-1/2"},[s("ns-field",{attrs:{field:t.amount},on:{change:function(t){return e.refreshTotalPayments()}}})],1)]),e._v(" "),e._m(0,!0)])})),e._v(" "),0===e.order.instalments.length?s("div",{staticClass:"my-2"},[s("p",{staticClass:"p-2 bg-gray-200 text-gray-700 text-center"},[e._v(e._s(e.__("There is not instalment defined. Please set how many instalments are allowed for this order")))])]):e._e()],2)])]),e._v(" "),s("div",{staticClass:"p-2 flex border-t justify-between flex-shrink-0"},[s("div"),e._v(" "),s("div",{staticClass:"-mx-1 flex"},[s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v(e._s(e.__("Cancel")))])],1),e._v(" "),s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.updateOrder()}}},[e._v(e._s(e.__("Proceed")))])],1)])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"flex items-center"},[t("button",{staticClass:"items-center flex justify-center h-8 w-8 rounded border border-gray-200 hover:bg-red-400 hover:border-red-400 hover:text-white"},[t("i",{staticClass:"las la-times"})])])}],!1,null,null,null);t.default=p.exports}},[[262,0,1]]]);
//# sourceMappingURL=pos-init.js.map