import{P as N,d as y,b as U,v as A,i as K,F as J}from"./bootstrap-DrcjF3bc.js";import{n as L,N as R}from"./ns-prompt-popup-D8lO1yew.js";import{_ as p,n as I}from"./currency-Dtag6qPd.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as l,c as o,a as s,B as C,t as u,F as _,b as v,e as m,p as G,r as w,f as k,w as S,i as P,n as V,A as $,g as T}from"./runtime-core.esm-bundler-VrNrzzXC.js";import"./chart-CAYz1qzV.js";const W={name:"ns-product-group",props:["fields"],watch:{searchValue(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.searchProducts(this.searchValue)},1e3)},products:{deep:!0,handler(){this.$forceUpdate()}}},computed:{totalProducts(){return this.products.length>0?(this.$emit("update",this.products),this.products.map(e=>parseFloat(e.sale_price)*parseFloat(e.quantity)).reduce((e,t)=>e+t)):0}},mounted(){const e=this.fields.filter(t=>t.name==="product_subitems");e.length>0&&e[0].value!==void 0&&e[0].value.length>0&&(this.products=e[0].value)},data(){return{searchValue:"",searchTimeout:null,results:[],products:[]}},methods:{__:p,nsCurrency:I,setSalePrice(){this.$emit("updateSalePrice",this.totalProducts)},removeProduct(e){N.show(L,{title:p("Delete Sub item"),message:p("Would you like to delete this sub item?"),onAction:t=>{t&&this.products.splice(e,1)}})},toggleUnitField(e){e._unit_toggled||(e._unit_toggled=!e._unit_toggled),setTimeout(()=>{e._unit_toggled&&this.$refs.unitField[0].addEventListener("blur",()=>{e._unit_toggled=!1,this.$forceUpdate()})},200)},toggleQuantityField(e){e._quantity_toggled=!e._quantity_toggled,setTimeout(()=>{e._quantity_toggled&&(this.$refs.quantityField[0].select(),this.$refs.quantityField[0].addEventListener("blur",()=>{this.toggleQuantityField(e),this.$forceUpdate()}))},200)},togglePriceField(e){e._price_toggled=!e._price_toggled,setTimeout(()=>{e._price_toggled&&(this.$refs.priceField[0].select(),this.$refs.priceField[0].addEventListener("blur",()=>{this.togglePriceField(e),this.$forceUpdate()}))},200)},redefineUnit(e){const t=e.unit_quantities.filter(r=>r.id===e.unit_quantity_id);t.length>0&&(e.unit_quantity=t[0],e.unit_id=t[0].unit.id,e.unit=t[0].unit,e.sale_price=t[0].sale_price)},async addResult(e){if(this.searchValue="",e.type==="grouped")return y.error(p("Unable to add a grouped product.")).subscribe();try{const t=await new Promise((a,n)=>{N.show(R,{label:p("Choose The Unit"),options:e.unit_quantities.map(i=>({label:i.unit.name,value:i.id})),resolve:a,reject:n})}),r=e.unit_quantities.filter(a=>parseInt(a.id)===parseInt(t));this.products.push({name:e.name,unit_quantity_id:t,unit_quantity:r[0],unit_id:r[0].unit.id,unit:r[0].unit,product_id:r[0].product_id,quantity:1,_price_toggled:!1,_quantity_toggled:!1,_unit_toggled:!1,unit_quantities:e.unit_quantities,sale_price:r[0].sale_price}),this.$emit("update",this.products)}catch(t){console.log(t)}},searchProducts(e){if(e.length===0)return null;U.post("/api/products/search",{search:e,arguments:{type:{comparison:"<>",value:"grouped"},searchable:{comparison:"in",value:[0,1]}}}).subscribe({next:t=>{this.results=t},error:t=>{y.error(t.message||p("An unexpected error occurred"),p("Ok"),{duration:3e3}).subscribe()}})}}},z={class:"flex flex-col px-4 w-full"},H={class:"md:-mx-4 flex flex-col md:flex-row"},Y={class:"md:px-4 w-full"},X={class:"input-group border-2 rounded info flex w-full"},Z=["placeholder"],ee={key:0,class:"h-0 relative"},te={class:"ns-vertical-menu absolute w-full"},se=["onClick"],ie={class:"my-2"},re={class:"ns-table"},ne={colspan:"2",class:"border"},le={colspan:"2",class:"border p-2"},ae={class:"flex justify-between"},oe={class:"font-bold"},de=["onClick"],ue=["onClick"],ce={class:"input-group"},fe=["onChange","onUpdate:modelValue"],he=["value"],me=["onClick"],pe={key:0,class:"cursor-pointer border-b border-dashed border-info-secondary"},be=["onUpdate:modelValue"],_e=["onClick"],ge={key:0,class:"cursor-pointer border-b border-dashed border-info-secondary"},ve=["onUpdate:modelValue"],ye={key:0},xe={colspan:"2",class:"border p-2 text-center"},we={key:0},ke={class:"w-1/2 border p-2 text-left"},Ue={class:"w-1/2 border p-2 text-right"};function Fe(e,t,r,a,n,i){return l(),o("div",z,[s("div",H,[s("div",Y,[s("div",X,[C(s("input",{placeholder:i.__("Search products..."),"onUpdate:modelValue":t[0]||(t[0]=d=>n.searchValue=d),type:"text",class:"flex-auto p-2 outline-none"},null,8,Z),[[A,n.searchValue]]),s("button",{onClick:t[1]||(t[1]=d=>i.setSalePrice()),class:"px-2"},u(i.__("Set Sale Price")),1)]),n.results.length>0&&n.searchValue.length>0?(l(),o("div",ee,[s("ul",te,[(l(!0),o(_,null,v(n.results,d=>(l(),o("li",{key:d.id,onClick:b=>i.addResult(d),class:"p-2 border-b cursor-pointer"},u(d.name),9,se))),128))])])):m("",!0),s("div",ie,[s("table",re,[s("thead",null,[s("tr",null,[s("th",ne,u(i.__("Products")),1)])]),s("tbody",null,[(l(!0),o(_,null,v(n.products,(d,b)=>(l(),o("tr",{key:b},[s("td",le,[s("div",ae,[s("h3",oe,u(d.name),1),s("span",{onClick:f=>i.removeProduct(b),class:"hover:underline text-error-secondary cursor-pointer"},u(i.__("Remove")),9,de)]),s("ul",null,[s("li",{onClick:f=>i.toggleUnitField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[s("span",null,u(i.__("Unit"))+":",1),s("div",ce,[C(s("select",{onChange:f=>i.redefineUnit(d),ref_for:!0,ref:"unitField",type:"text","onUpdate:modelValue":f=>d.unit_quantity_id=f},[(l(!0),o(_,null,v(d.unit_quantities,f=>(l(),o("option",{key:f.id,value:f.id},u(f.unit.name)+" ("+u(f.quantity)+")",9,he))),128))],40,fe),[[K,d.unit_quantity_id]])])],8,ue),s("li",{onClick:f=>i.toggleQuantityField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[s("span",null,u(i.__("Quantity"))+":",1),d._quantity_toggled?m("",!0):(l(),o("span",pe,u(d.quantity),1)),d._quantity_toggled?C((l(),o("input",{key:1,ref_for:!0,ref:"quantityField",type:"text","onUpdate:modelValue":f=>d.quantity=f},null,8,be)),[[A,d.quantity]]):m("",!0)],8,me),s("li",{onClick:f=>i.togglePriceField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[s("span",null,u(i.__("Price"))+":",1),d._price_toggled?m("",!0):(l(),o("span",ge,u(i.nsCurrency(d.sale_price)),1)),d._price_toggled?C((l(),o("input",{key:1,ref_for:!0,ref:"priceField",type:"text","onUpdate:modelValue":f=>d.sale_price=f},null,8,ve)),[[A,d.sale_price]]):m("",!0)],8,_e)])])]))),128)),n.products.length===0?(l(),o("tr",ye,[s("td",xe,u(i.__("No product are added to this group.")),1)])):m("",!0)]),n.products.length>0?(l(),o("tfoot",we,[s("tr",null,[s("td",ke,u(i.__("Total")),1),s("td",Ue,u(i.nsCurrency(i.totalProducts)),1)])])):m("",!0)])])])])])}const Ve=M(W,[["render",Fe]]),Ce={components:{nsProductGroup:Ve},data:()=>({formValidation:new J,nsSnackBar:y,nsHttpClient:U,_sampleVariation:null,unitLoaded:!1,unitLoadError:!1,form:G({}),hasLoaded:!1,hasError:!1}),watch:{form:{deep:!0,handler(e){this.form.variations.forEach(t=>{if(this.formValidation.extractFields(t.tabs.identification.fields).type==="grouped"){for(let a in t.tabs)["identification","groups","taxes","units"].includes(a)||(t.tabs[a].visible=!1);t.tabs.groups&&(t.tabs.groups.visible=!0)}else{for(let a in t.tabs)["identification","groups","taxes","units"].includes(a)||(t.tabs[a].visible=!0);t.tabs.groups&&(t.tabs.groups.visible=!1)}})}}},computed:{defaultVariation(){const e=new Object;for(let t in this._sampleVariation.tabs)e[t]=new Object,e[t].label=this._sampleVariation.tabs[t].label,e[t].active=this._sampleVariation.tabs[t].active,e[t].fields=this._sampleVariation.tabs[t].fields.filter(r=>!["category_id","product_type","stock_management","expires"].includes(r.name)).map(r=>((typeof r.value=="string"&&r.value.length===0||r.value===null)&&(r.value=""),r));return{id:"",tabs:e}}},props:["submitMethod","submitUrl","returnUrl","src","units-url"],methods:{__:p,nsCurrency:I,handleUnitGroupFieldChanged(e,t){e.name==="unit_id"&&(t.label=this.getFirstSelectedUnit(t.fields))},async handleSaved(e,t,r,a){e.data.entry&&(a.options.push({label:e.data.entry[a.props.optionAttributes.label],value:e.data.entry[a.props.optionAttributes.value]}),a.value=e.data.entry[a.props.optionAttributes.value])},getGroupProducts(e){if(e.groups){const t=e.groups.fields.filter(r=>r.name==="products_subitems");if(t.length>0)return t[0].value}return[]},setProducts(e,t){t.groups.fields.forEach(r=>{r.name==="product_subitems"&&(r.value=e)})},getUnitQuantity(e){const t=e.filter(r=>r.name==="quantity").map(r=>r.value);return t.length>0?t[0]:0},removeUnitPriceGroup(e,t){const r=e.fields.filter(a=>a.name==="id"&&a.value!==void 0);Popup.show(L,{title:p("Confirm Your Action"),message:p("Would you like to delete this group ?"),onAction:a=>{if(a)if(r.length>0)this.confirmUnitQuantityDeletion({group:e,groups:t});else{const n=t.indexOf(e);t.splice(n,1)}}})},confirmUnitQuantityDeletion({group:e,groups:t}){Popup.show(L,{title:p("Your Attention Is Required"),size:"w-3/4-screen h-2/5-screen",message:p("The current unit you're about to delete has a reference on the database and it might have already procured stock. Deleting that reference will remove procured stock. Would you proceed ?"),onAction:r=>{if(r){const a=e.fields.filter(n=>n.name==="id").map(n=>n.value)[0];U.delete(`/api/products/units/quantity/${a}`).subscribe({next:n=>{const i=t.indexOf(e);t.splice(i,1),y.success(n.message).subscribe()},error:n=>{nsSnackbar.error(n.message).subscribe()}})}}})},addUnitGroup(e,t){if(e.options.length===0)return y.error(p("Please select at least one unit group before you proceed.")).subscribe();if(e.options.length>e.groups.length){const r=e.groups;e.groups=[],setTimeout(()=>{e.groups=[...r,{label:this.getFirstSelectedUnit(e.fields),fields:JSON.parse(JSON.stringify(e.fields))}]},1)}else y.error(p("There shoulnd't be more option than there are units.")).subscribe()},handleSaveEvent(e,t,r){const{variation_index:a}=r;t.options.push({label:e.data.entry[t.props.optionAttributes.label],value:e.data.entry[t.props.optionAttributes.value]}),t.value=e.data.entry[t.props.optionAttributes.value];try{this.loadUnits(this.getActiveTab(this.form.variations[a].tabs),t.value)}catch(n){console.log({exception:n})}},loadUnits(e,t){return new Promise((r,a)=>{U.get(this.unitsUrl.replace("{id}",t)).subscribe({next:n=>{e.fields.forEach(i=>{i.type==="group"&&(i.options=n,i.fields.forEach(d=>{["unit_id","convert_unit_id"].includes(d.name)&&(d.options=n.map(b=>({label:b.name,value:b.id})))}))}),this.unitLoaded=!0,r(!0)},error:n=>{a(!1),this.unitLoadError=!0}})})},async loadAvailableUnits(e,t){if(t.name!=="unit_group")return;this.unitLoaded=!1,this.unitLoadError=!1;const r=e.fields.filter(a=>a.name==="unit_group")[0].value;try{await this.loadUnits(e,r)}catch(a){console.log({exception:a})}},submit(){if(this.formValidation.validateFields([this.form.main]),this.form.variations.map(n=>this.formValidation.validateForm(n)).filter(n=>n.length>0).length>0||Object.values(this.form.main.errors).length>0)return y.error(p("Unable to proceed the form is not valid.")).subscribe();const t=this.form.variations.map((n,i)=>n.tabs.images.groups.filter(d=>d.filter(b=>b.name==="featured"&&b.value===1).length>0));if(t[0]&&t[0].length>1)return y.error(p("Unable to proceed, more than one product is set as featured")).subscribe();const r=[];if(this.form.variations.map((n,i)=>n.tabs.units.fields.filter(d=>d.type==="group").forEach(d=>{d.groups.forEach(b=>{r.push(this.formValidation.validateFields(b.fields))})})),r.length===0)return y.error(p("Either Selling or Purchase unit isn't defined. Unable to proceed.")).subscribe();if(r.filter(n=>n===!1).length>0)return this.$forceUpdate(),y.error(p("Unable to proceed as one of the unit group field is invalid")).subscribe();const a={...this.formValidation.extractForm(this.form),variations:this.form.variations.map((n,i)=>{const d=this.formValidation.extractForm(n);i===0&&(d.$primary=!0),d.images=n.tabs.images.groups.map(f=>this.formValidation.extractFields(f));const b=new Object;return n.tabs.units.fields.filter(f=>f.type==="group").forEach(f=>{b[f.name]=f.groups.map(q=>this.formValidation.extractFields(q.fields))}),d.units={...d.units,...b},d})};this.formValidation.disableForm(this.form),U[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,a).subscribe(n=>{if(n.status==="success"){if(this.submitMethod==="POST"&&this.returnUrl!==!1)return document.location=n.data.editUrl||this.returnUrl;y.info(n.message,p("Okay"),{duration:3e3}).subscribe(),this.$emit("saved")}this.formValidation.enableForm(this.form)},n=>{y.error(n.message,void 0,{duration:5e3}).subscribe(),this.formValidation.enableForm(this.form),n.response&&this.formValidation.triggerError(this.form,n.response.data)})},deleteVariation(e){confirm(p("Would you like to delete this variation ?"))&&this.form.variations.splice(e,1)},setTabActive(e,t){for(let r in t)r!==e&&(t[r].active=!1);if(t[e].active=!0,e==="units"){const r=t[e].fields.filter(a=>a.name==="unit_group");r.length>0&&this.loadAvailableUnits(t[e],r[0])}},duplicate(e){this.form.variations.push(Object.assign({},e))},newVariation(){this.form.variations.push(this.defaultVariation)},getActiveTab(e){for(let t in e)if(e[t].active)return e[t];return!1},getActiveTabKey(e){for(let t in e)if(e[t].active)return t;return!1},parseForm(e){return e.main.value=e.main.value===void 0?"":e.main.value,e.main=this.formValidation.createFields([e.main])[0],e.variations.forEach((t,r)=>{let a=0;for(let n in t.tabs)a===0&&t.tabs[n].active===void 0?(t.tabs[n].active=!0,this._sampleVariation=JSON.parse(JSON.stringify(t)),t.tabs[n].fields&&(t.tabs[n].fields=this.formValidation.createFields(t.tabs[n].fields.filter(i=>i.name!=="name")))):t.tabs[n].fields&&(t.tabs[n].fields=this.formValidation.createFields(t.tabs[n].fields)),t.tabs[n].active=t.tabs[n].active===void 0?!1:t.tabs[n].active,t.tabs[n].visible=t.tabs[n].visible===void 0?!0:t.tabs[n].visible,a++}),e},loadForm(){return new Promise((e,t)=>{const r=U.get(`${this.src}`);this.hasLoaded=!1,this.hasError=!1,r.subscribe({next:a=>{e(a),this.hasLoaded=!0,this.form=G(this.parseForm(a.form))},error:a=>{t(a),this.hasError=!0}})})},addImage(e){e.tabs.images.groups.push(this.formValidation.createFields(JSON.parse(JSON.stringify(e.tabs.images.fields))))},removeImage(e,t){const r=e.tabs.images.groups.indexOf(t);e.tabs.images.groups.splice(r,1)},handleSavedUnitGroupFields(e,t){e.data&&(t.options.push({label:e.data.entry.name,value:e.data.entry.id}),t.value=e.data.entry.id)},getGroupId(e){const t=e.filter(r=>r.name==="id");return t.length>0?t[0].value:!1},getFirstSelectedUnit(e){const t=e.filter(r=>r.name==="unit_id");if(t.length>0){const r=t[0].options.filter(a=>a.value===t[0].value);if(r.length>0)return r[0].label}return p("No Unit Selected")}},async mounted(){await this.loadForm()},name:"ns-manage-products"},Se={class:"form flex-auto",id:"crud-form"},Pe={key:0,class:"flex items-center h-full justify-center flex-auto"},Te={key:1},Ae={class:"flex flex-col"},qe={class:"flex justify-between items-center"},je={for:"title",class:"font-bold my-2 text-primary"},Ee={for:"title",class:"text-sm my-2 text-primary"},Oe=["href"],Le=["disabled"],Ne=["disabled"],Ge={key:0,class:"text-xs text-primary py-1"},$e={id:"form-container",class:"-mx-4 flex flex-wrap mt-4"},Ie={class:"px-4 w-full"},Me={id:"card-header",class:"flex flex-wrap justify-between ns-tab ml-4"},Qe={class:"flex flex-wrap"},Be=["onClick"],De={key:0,class:"rounded-full bg-error-secondary text-white h-6 w-6 flex font-semibold items-center justify-center"},Ke={class:"card-body ns-tab-item"},Je={class:"rounded shadow p-2"},Re={key:0,class:"-mx-4 flex flex-wrap"},We={key:1,class:"-mx-4 flex flex-wrap text-primary"},ze={class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},He={class:"rounded border border-box-elevation-edge bg-box-elevation-background flex justify-between p-2 items-center"},Ye=["onClick"],Xe={class:"rounded border border-box-elevation-edge flex flex-col overflow-hidden"},Ze={class:"p-2"},et=["onClick"],tt={key:2,class:"-mx-4 flex flex-wrap text-primary"},st={key:3,class:"-mx-4 flex flex-wrap"},it={class:"px-4 w-full md:w-1/2 lg:w-1/3"},rt={class:"mb-2"},nt={class:"font-medium text-primary"},lt={class:"py-1 text-sm text-primary"},at={class:"mb-2"},ot=["onClick"],dt={class:"shadow rounded overflow-hidden bg-box-elevation-background text-primary"},ut={class:"border-b text-sm p-2 flex justify-between text-primary border-box-elevation-edge"},ct={class:"p-2 mb-2"},ft={class:"md:-mx-2 flex flex-wrap"},ht=["onClick"],mt={key:1,class:"px-4 w-full lg:w-2/3 flex justify-center items-center"},pt={key:2,class:"px-4 w-full md:w-1/2 lg:w-2/3 flex flex-col justify-center items-center"},bt={class:"w-full md:w-1/3 py-3 text-center text-sm text-primary"};function _t(e,t,r,a,n,i){const d=w("ns-spinner"),b=w("ns-notice"),f=w("ns-field"),q=w("ns-product-group"),Q=w("ns-tabs-item"),B=w("ns-tabs");return l(),o("div",Se,[Object.values(e.form).length===0&&e.hasLoaded?(l(),o("div",Pe,[k(d)])):m("",!0),Object.values(e.form).length===0&&e.hasError?(l(),o("div",Te,[k(b,{color:"error"},{title:S(()=>[P(u(i.__("An Error Has Occured")),1)]),description:S(()=>[P(u(i.__("An unexpected error has occured while loading the form. Please check the log or contact the support.")),1)]),_:1})])):m("",!0),Object.values(e.form).length>0?(l(),o(_,{key:2},[s("div",Ae,[s("div",qe,[s("label",je,u(e.form.main.label),1),s("div",Ee,[r.returnUrl?(l(),o("a",{key:0,href:r.returnUrl,class:"rounded-full border ns-inset-button error hover:bg-error-tertiary px-2 py-1"},u(i.__("Return")),9,Oe)):m("",!0)])]),s("div",{class:V([e.form.main.disabled?"":e.form.main.errors.length>0?"border-error-tertiary":"","input-group info flex border-2 rounded overflow-hidden"])},[C(s("input",{"onUpdate:modelValue":t[0]||(t[0]=h=>e.form.main.value=h),onBlur:t[1]||(t[1]=h=>e.formValidation.checkField(e.form.main)),onChange:t[2]||(t[2]=h=>e.formValidation.checkField(e.form.main)),disabled:e.form.main.disabled,type:"text",class:V([(e.form.main.disabled,""),"flex-auto text-primary outline-none h-10 px-2"])},null,42,Le),[[A,e.form.main.value]]),s("button",{disabled:e.form.main.disabled,class:V([e.form.main.disabled?"":e.form.main.errors.length>0?"bg-error-tertiary":"","outline-none px-4 h-10 rounded-none"]),onClick:t[3]||(t[3]=h=>i.submit())},[$(e.$slots,"save",{},()=>[P(u(i.__("Save")),1)])],10,Ne)],2),e.form.main.description&&e.form.main.errors.length===0?(l(),o("p",Ge,u(e.form.main.description),1)):m("",!0),(l(!0),o(_,null,v(e.form.main.errors,(h,F)=>(l(),o("p",{class:"text-xs py-1 text-error-tertiary",key:F},[s("span",null,[$(e.$slots,"error-required",{},()=>[P(u(h.identifier),1)])])]))),128))]),s("div",$e,[s("div",Ie,[(l(!0),o(_,null,v(e.form.variations,(h,F)=>(l(),o("div",{id:"tabbed-card",class:"mb-8",key:F},[s("div",Me,[s("div",Qe,[(l(!0),o(_,null,v(h.tabs,(c,x)=>(l(),o(_,null,[c.visible?(l(),o("div",{onClick:g=>i.setTabActive(x,h.tabs),class:V([c.active?"active":"inactive","tab cursor-pointer text-primary px-4 py-2 rounded-tl-lg rounded-tr-lg flex justify-between"]),key:x},[s("span",{class:V(["block",c.errors&&c.errors.length>0?"mr-2":""])},u(c.label),3),c.errors&&c.errors.length>0?(l(),o("span",De,u(c.errors.length),1)):m("",!0)],10,Be)):m("",!0)],64))),256))]),t[4]||(t[4]=s("div",{class:"flex items-center justify-center -mx-1"},null,-1))]),s("div",Ke,[s("div",Je,[["images","units","groups"].includes(i.getActiveTabKey(h.tabs))?m("",!0):(l(),o("div",Re,[(l(!0),o(_,null,v(i.getActiveTab(h.tabs).fields,(c,x)=>(l(),o("div",{key:x,class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},[k(f,{onSaved:g=>i.handleSaved(g,i.getActiveTabKey(h.tabs),F,c),field:c},null,8,["onSaved","field"])]))),128))])),i.getActiveTabKey(h.tabs)==="images"?(l(),o("div",We,[s("div",ze,[s("div",He,[s("span",null,u(i.__("Add Images")),1),s("button",{onClick:c=>i.addImage(h),class:"outline-none rounded-full border flex items-center justify-center w-8 h-8 ns-inset-button info"},t[5]||(t[5]=[s("i",{class:"las la-plus-circle"},null,-1)]),8,Ye)])]),(l(!0),o(_,null,v(i.getActiveTab(h.tabs).groups,(c,x)=>(l(),o("div",{key:x,class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3 mb-4"},[s("div",Xe,[s("div",Ze,[(l(!0),o(_,null,v(c,(g,j)=>(l(),T(f,{key:j,field:g},null,8,["field"]))),128))]),s("div",{onClick:g=>i.removeImage(h,c),class:"text-center py-2 border-t border-box-elevation-edge text-sm cursor-pointer"},u(i.__("Remove Image")),9,et)])]))),128))])):m("",!0),i.getActiveTabKey(h.tabs)==="groups"?(l(),o("div",tt,[k(q,{onUpdate:c=>i.setProducts(c,h.tabs),fields:i.getActiveTab(h.tabs).fields},null,8,["onUpdate","fields"])])):m("",!0),i.getActiveTabKey(h.tabs)==="units"?(l(),o("div",st,[s("div",it,[(l(!0),o(_,null,v(i.getActiveTab(h.tabs).fields.filter(c=>c.name!=="selling_group"),c=>(l(),T(f,{onSaved:x=>i.handleSaveEvent(x,c,{variation_index:F}),onChange:x=>i.loadAvailableUnits(i.getActiveTab(h.tabs),c),field:c},null,8,["onSaved","onChange","field"]))),256))]),e.unitLoaded?(l(!0),o(_,{key:0},v(i.getActiveTab(h.tabs).fields,(c,x)=>(l(),o(_,null,[c.type==="group"?(l(),o("div",{class:"px-4 w-full lg:w-2/3",key:x},[s("div",rt,[s("label",nt,u(c.label),1),s("p",lt,u(c.description),1)]),s("div",at,[s("div",{onClick:g=>i.addUnitGroup(c,h.tabs),class:"border-dashed border-2 p-1 bg-box-elevation-background border-box-elevation-edge flex justify-between items-center text-primary cursor-pointer rounded-lg"},[t[6]||(t[6]=s("span",{class:"rounded-full border-2 ns-inset-button info h-8 w-8 flex items-center justify-center"},[s("i",{class:"las la-plus-circle"})],-1)),s("span",null,u(i.__("New Group")),1)],8,ot)]),c.groups.length>0?(l(),T(B,{key:0,onChangeTab:g=>h.activeUnitTab=g,active:h.activeUnitTab||"tab-0"},{default:S(()=>[(l(!0),o(_,null,v(c.groups,(g,j)=>(l(),T(Q,{padding:"p-2",identifier:"tab-"+j,label:g.label},{default:S(()=>[s("div",dt,[s("div",ut,[s("span",null,u(i.__("Available Quantity")),1),s("span",null,u(i.getUnitQuantity(g.fields)),1)]),s("div",ct,[s("div",ft,[(l(!0),o(_,null,v(g.fields,(E,D)=>(l(),o("div",{class:"w-full md:w-1/2 p-2",key:D},[k(f,{onChange:O=>i.handleUnitGroupFieldChanged(O,g),onSaved:O=>i.handleSavedUnitGroupFields(O,E),field:E},null,8,["onChange","onSaved","field"])]))),128))])]),s("div",{onClick:E=>i.removeUnitPriceGroup(g,c.groups),class:"p-1 hover:bg-error-primary border-t border-box-elevation-edge flex items-center justify-center cursor-pointer font-medium"},u(i.__("Delete")),9,ht)])]),_:2},1032,["identifier","label"]))),256))]),_:2},1032,["onChangeTab","active"])):m("",!0)])):m("",!0)],64))),256)):m("",!0),!e.unitLoaded&&!e.unitLoadError?(l(),o("div",mt,[k(d)])):m("",!0),e.unitLoadError&&!e.unitLoaded?(l(),o("div",pt,[t[7]||(t[7]=s("i",{class:"las la-frown text-7xl"},null,-1)),s("p",bt,u(i.__("We were not able to load the units. Make sure there are units attached on the unit group selected.")),1)])):m("",!0)])):m("",!0)])])]))),128))])])],64)):m("",!0)])}const Ut=M(Ce,[["render",_t]]);export{Ut as default};
