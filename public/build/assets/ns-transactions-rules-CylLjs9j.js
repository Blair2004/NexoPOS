import{I as v,d as u,f}from"./bootstrap-BsWQM_6D.js";import{N as p,n as g}from"./ns-prompt-popup-CwRKP6Ip.js";import{i as x}from"./components-DUSFgsKA.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as b,c as _,F as h,b as C,a as o,t as a,i as m}from"./runtime-core.esm-bundler-VrNrzzXC.js";import"./currency-Dtag6qPd.js";import"./chart-CAYz1qzV.js";import"./ns-avatar-image-Pigdi04i.js";const k={data(){return{rules:[],accounts:[],actions:[]}},mounted(){v([this.loadAccounts(),this.loadActions(),this.loadRules()]).subscribe({next:t=>{this.accounts=t[0],this.actions=t[1],this.rules=t[2]},error:t=>{u.error(t.message).subscribe()}})},methods:{__,loadRules(){return nsHttpClient.get("/api/transactions/rules")},addNewRule(){this.rules.push({on:"",action:"increase",account_id:"",do:"decrease",offset_account_id:""})},getActionName(t){return this.actions[t]||__("Not Defined")},async setRuleAction(t,e){if(this.actions.length===0)return u.error(__("No actions available").subscribe());try{t[e]=await new Promise((n,c)=>{const i=Object.keys(this.actions);Popup.show(p,{label:__("Choose Action"),description:__("Choose the action you want to perform."),options:Object.values(this.actions).map((s,r)=>({label:s,value:i[r]})),resolve:n,reject:c})})}catch{}},saveRule(t){nsHttpClient.post("/api/transactions/rules",{rule:t}).subscribe({next:e=>{e.status==="success"&&(t.id=e.data.id,f.success(__("Save Completed"),__("The rule has been saved successfully")))},error:e=>{u.error(e.message).subscribe()}})},getAccountName(t){var e;return((e=this.accounts.find(n=>n.id===t))==null?void 0:e.name)||__("Not Defined")},loadActions(){return nsHttpClient.get("/api/transactions-accounts/actions")},loadAccounts(){return nsHttpClient.get("/api/transactions-accounts")},async changeTransactionType(t,e){try{t[e]=await new Promise((n,c)=>{Popup.show(p,{label:__("Transaction Type"),description:__("Choose the transaction type you want to perform"),options:[{label:__("Increase"),value:"increase"},{label:__("Decrease"),value:"decrease"}],resolve:n,reject:c})})}catch(n){console.error(n)}},selectAccount(t,e){const n=Popup.show(x);nsHttpClient.get("/api/transactions-accounts").subscribe({next:async c=>{n.close();try{const i=await new Promise((s,r)=>{Popup.show(p,{label:__("Choose Account"),description:__("Choose the account you want to use"),options:c.map(d=>({label:d.name,value:d.id})),resolve:s,reject:r})});t[e]=i,console.log({rule:t})}catch{}}})},deleteRule(t){if(t.id)return Popup.show(g,{title:__("Delete Rule"),message:__("Are you sure you want to delete this rule?"),onAction:e=>{e&&this.deleteRemoteRule(t)}});this.rules=this.rules.filter(e=>e!==t)},deleteRemoteRule(t){nsHttpClient.delete(`/transactions/rules/${t.id}`).then(e=>{e.status==="success"&&(this.rules=this.rules.filter(n=>n.id!==t.id))}).catch(e=>{console.error(e)})}}},w={class:"flex"},A=["onClick"],R=["onClick"],N={class:"flex"},P=["onClick"],T=["onClick"],D=["onClick"],j={class:"flex flex-auto justify-end"},H=["onClick"],S=["onClick"];function I(t,e,n,c,i,s){return b(),_(h,null,[(b(!0),_(h,null,C(i.rules,(r,d)=>(b(),_("div",{key:d,class:"rounded shadow text-primary overflow-hidden bg-box-background flex mb-2"},[o("div",w,[o("div",{onClick:l=>s.setRuleAction(r,"on"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},a(s.__("On : {action}").replace("{action}",s.getActionName(r.on))),9,A),e[1]||(e[1]=o("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[o("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[o("i",{class:"las la-angle-double-right"})])],-1)),o("div",{onClick:l=>s.changeTransactionType(r,"action"),class:"hover:bg-numpad-hover border-r border-box-edge cursor-pointer p-2 pl-4"},a(r.action==="increase"?s.__("Increase"):s.__("Decrease")),9,R)]),o("div",N,[o("div",{onClick:l=>s.selectAccount(r,"account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},a(s.getAccountName(r.account_id)),9,P),e[2]||(e[2]=o("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[o("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[o("i",{class:"las la-angle-double-right"})])],-1)),o("div",{onClick:l=>s.changeTransactionType(r,"do"),class:"border-r hover:bg-numpad-hover cursor-pointer border-box-edge p-2 pl-4"},a(r.do==="increase"?s.__("Increase"):s.__("Decrease")),9,T),o("div",{onClick:l=>s.selectAccount(r,"offset_account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2"},a(s.getAccountName(r.offset_account_id)),9,D)]),o("div",j,[o("div",{onClick:l=>s.saveRule(r),class:"p-2 border-l-box-edge border-l hover:bg-info-secondary hover:border-info-secondary cursor-pointer text-primary"},[e[3]||(e[3]=o("i",{class:"las la-save"},null,-1)),m(" "+a(s.__("Save")),1)],8,H),o("div",{onClick:l=>s.deleteRule(r),class:"p-2 border-l-box-edge border-l hover:bg-error-secondary hover:border-error-secondary cursor-pointer text-primary"},e[4]||(e[4]=[o("i",{class:"lar la-times-circle"},null,-1)]),8,S)])]))),128)),o("div",{onClick:e[0]||(e[0]=r=>s.addNewRule()),class:"rounded bg-box-background p-2 cursor-pointer text-primary flex text-center justify-center"},[o("span",null,[e[5]||(e[5]=o("i",{class:"las la-plus"},null,-1)),m(" "+a(s.__("Create a new rule")),1)])])],64)}const q=y(k,[["render",I]]);export{q as default};
