import{b as u,e as v,j as f}from"./bootstrap-sz2eKFsW.js";import{n as g,N as p}from"./ns-prompt-popup-IaNplttS.js";import{i as x}from"./components-CZpKhr9i.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as b,o as _,b as s,F as h,e as C,t as a,i as m}from"./runtime-core.esm-bundler-1O6SuJ5P.js";import"./currency-BIpHMLzL.js";import"./chart-CFvJmF2u.js";import"./runtime-dom.esm-bundler-BpKa6iGo.js";import"./lang-BINodpp-.js";import"./ns-avatar-0iWK8npH.js";import"./ns-avatar-image-Bp-d6whW.js";const k={data(){return{rules:[],accounts:[],actions:[]}},mounted(){f([this.loadAccounts(),this.loadActions(),this.loadRules()]).subscribe({next:t=>{this.accounts=t[0],this.actions=t[1],this.rules=t[2]},error:t=>{u.error(t.message).subscribe()}})},methods:{__,loadRules(){return nsHttpClient.get("/api/transactions/rules")},addNewRule(){this.rules.push({on:"",action:"increase",account_id:"",do:"decrease",offset_account_id:""})},getActionName(t){return this.actions[t]||__("Not Defined")},async setRuleAction(t,e){if(this.actions.length===0)return u.error(__("No actions available").subscribe());try{t[e]=await new Promise((n,c)=>{const i=Object.keys(this.actions);Popup.show(p,{label:__("Choose Action"),description:__("Choose the action you want to perform."),options:Object.values(this.actions).map((o,r)=>({label:o,value:i[r]})),resolve:n,reject:c})})}catch{}},saveRule(t){nsHttpClient.post("/api/transactions/rules",{rule:t}).subscribe({next:e=>{e.status==="success"&&(t.id=e.data.id,v.success(__("Save Completed"),__("The rule has been saved successfully")))},error:e=>{u.error(e.message).subscribe()}})},getAccountName(t){var e;return((e=this.accounts.find(n=>n.id===t))==null?void 0:e.name)||__("Not Defined")},loadActions(){return nsHttpClient.get("/api/transactions-accounts/actions")},loadAccounts(){return nsHttpClient.get("/api/transactions-accounts")},async changeTransactionType(t,e){try{t[e]=await new Promise((n,c)=>{Popup.show(p,{label:__("Transaction Type"),description:__("Choose the transaction type you want to perform"),options:[{label:__("Increase"),value:"increase"},{label:__("Decrease"),value:"decrease"}],resolve:n,reject:c})})}catch(n){console.error(n)}},selectAccount(t,e){const n=Popup.show(x);nsHttpClient.get("/api/transactions-accounts").subscribe({next:async c=>{n.close();try{const i=await new Promise((o,r)=>{Popup.show(p,{label:__("Choose Account"),description:__("Choose the account you want to use"),options:c.map(d=>({label:d.name,value:d.id})),resolve:o,reject:r})});t[e]=i,console.log({rule:t})}catch{}}})},deleteRule(t){if(t.id)return Popup.show(g,{title:__("Delete Rule"),message:__("Are you sure you want to delete this rule?"),onAction:e=>{e&&this.deleteRemoteRule(t)}});this.rules=this.rules.filter(e=>e!==t)},deleteRemoteRule(t){nsHttpClient.delete(`/transactions/rules/${t.id}`).then(e=>{e.status==="success"&&(this.rules=this.rules.filter(n=>n.id!==t.id))}).catch(e=>{console.error(e)})}}},w={class:"flex"},A=["onClick"],R=["onClick"],N={class:"flex"},P=["onClick"],T=["onClick"],j=["onClick"],D={class:"flex flex-auto justify-end"},H=["onClick"],S=["onClick"];function B(t,e,n,c,i,o){return _(),b(h,null,[(_(!0),b(h,null,C(i.rules,(r,d)=>(_(),b("div",{key:d,class:"rounded shadow text-fontcolor overflow-hidden bg-box-background flex mb-2"},[s("div",w,[s("div",{onClick:l=>o.setRuleAction(r,"on"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},a(o.__("On : {action}").replace("{action}",o.getActionName(r.on))),9,A),e[1]||(e[1]=s("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[s("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[s("i",{class:"las la-angle-double-right"})])],-1)),s("div",{onClick:l=>o.changeTransactionType(r,"action"),class:"hover:bg-numpad-hover border-r border-box-edge cursor-pointer p-2 pl-4"},a(r.action==="increase"?o.__("Increase"):o.__("Decrease")),9,R)]),s("div",N,[s("div",{onClick:l=>o.selectAccount(r,"account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},a(o.getAccountName(r.account_id)),9,P),e[2]||(e[2]=s("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[s("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[s("i",{class:"las la-angle-double-right"})])],-1)),s("div",{onClick:l=>o.changeTransactionType(r,"do"),class:"border-r hover:bg-numpad-hover cursor-pointer border-box-edge p-2 pl-4"},a(r.do==="increase"?o.__("Increase"):o.__("Decrease")),9,T),s("div",{onClick:l=>o.selectAccount(r,"offset_account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2"},a(o.getAccountName(r.offset_account_id)),9,j)]),s("div",D,[s("div",{onClick:l=>o.saveRule(r),class:"p-2 border-l-box-edge border-l hover:bg-info-secondary hover:border-info-secondary cursor-pointer text-font"},[e[3]||(e[3]=s("i",{class:"las la-save"},null,-1)),m(" "+a(o.__("Save")),1)],8,H),s("div",{onClick:l=>o.deleteRule(r),class:"p-2 border-l-box-edge border-l hover:bg-error-secondary hover:border-error-secondary cursor-pointer text-font"},e[4]||(e[4]=[s("i",{class:"lar la-times-circle"},null,-1)]),8,S)])]))),128)),s("div",{onClick:e[0]||(e[0]=r=>o.addNewRule()),class:"rounded bg-box-background p-2 cursor-pointer text-fontcolor flex text-center justify-center"},[s("span",null,[e[5]||(e[5]=s("i",{class:"las la-plus"},null,-1)),m(" "+a(o.__("Create a new rule")),1)])])],64)}const M=y(k,[["render",B]]);export{M as default};
