import{F as O,g as V,p as C,b as y,a as w}from"./bootstrap-CZq7-ikA.js";import{n as $,a as B}from"./ns-prompt-popup-Ds8JknSD.js";import{n as k,_ as p}from"./currency-lOMYG1Wf.js";import{_ as m}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,o as c,c as a,a as s,t as n,f,e as d,F as v,b as S,g as I,n as R,i as F}from"./runtime-core.esm-bundler-RT2b-_3S.js";const H={components:{},props:["popup"],data(){return{amount:0,title:null,identifier:null,settingsSubscription:null,settings:null,action:null,register:null,loaded:!1,register_id:null,validation:new O,fields:[],isSubmitting:!1}},mounted(){this.title=this.popup.params.title,this.identifier=this.popup.params.identifier,this.register=this.popup.params.register,this.action=this.popup.params.action,this.register_id=this.popup.params.register_id,this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t}),this.loadFields(),this.popupCloser()},unmounted(){this.settingsSubscription.unsubscribe()},methods:{popupCloser:V,nsCurrency:k,__:p,definedValue(t){this.amount=t},close(){this.popup.close()},loadFields(){this.loaded=!1,nsHttpClient.get(`/api/fields/${this.identifier}`).subscribe(t=>{this.loaded=!0,this.fields=t},t=>(this.loaded=!0,nsSnackBar.error(t.message,"OKAY",{duration:!1}).subscribe()))},submit(t){Popup.show($,{title:"Confirm Your Action",message:this.popup.params.confirmMessage||"Would you like to confirm your action.",onAction:e=>{e&&this.triggerSubmit()}})},triggerSubmit(){if(this.isSubmitting)return;this.isSubmitting=!0;const t=this.validation.extractFields(this.fields);t.amount=this.amount===""?0:this.amount,nsHttpClient.post(`/api/cash-registers/${this.action}/${this.register_id||this.settings.register.id}`,t).subscribe({next:e=>{this.popup.params.resolve(e),this.popup.close(),nsSnackBar.success(e.message).subscribe(),this.isSubmitting=!1},error:e=>{nsSnackBar.error(e.message).subscribe(),this.isSubmitting=!1}})}}},N={key:0,class:"shadow-lg w-95vw md:w-3/5-screen ns-box"},L={class:"border-b ns-box-header p-2 text-primary flex justify-between items-center"},A={class:"font-semibold"},z={class:"p-2"},D={key:0,class:"mb-2 p-3 elevation-surface font-bold border text-right flex justify-between"},Q={class:"mb-2 p-3 elevation-surface success border font-bold text-right flex justify-between"},T={class:"flex flex-col md:flex-row md:-mx-2"},U={class:"md:px-2 md:w-1/2 w-full"},Y={class:"md:px-2 md:w-1/2 w-full"},E={key:1,class:"h-full w-full flex items-center justify-center"};function q(t,e,o,u,r,i){const h=_("ns-close-button"),l=_("ns-numpad"),g=_("ns-field"),P=_("ns-spinner");return c(),a("div",null,[r.loaded?(c(),a("div",N,[s("div",L,[s("h3",A,n(r.title),1),s("div",null,[f(h,{onClick:e[0]||(e[0]=b=>i.close())})])]),s("div",z,[s("div",null,[r.register!==null?(c(),a("div",D,[s("span",null,n(i.__("Balance")),1),s("span",null,n(i.nsCurrency(r.register.balance)),1)])):d("",!0),s("div",Q,[s("span",null,n(i.__("Input")),1),s("span",null,n(i.nsCurrency(r.amount)),1)])]),s("div",T,[s("div",U,[f(l,{floating:!0,onNext:e[1]||(e[1]=b=>i.submit(b)),value:r.amount,onChanged:e[2]||(e[2]=b=>i.definedValue(b))},null,8,["value"])]),s("div",Y,[(c(!0),a(v,null,S(r.fields,(b,j)=>(c(),I(g,{field:b,key:j},null,8,["field"]))),128))])])])])):d("",!0),r.loaded?d("",!0):(c(),a("div",E,[f(P)]))])}const x=m(H,[["render",q]]),K={name:"ns-pos-cash-registers-popup",props:["popup"],components:{nsNumpad:B},data(){return{registers:[],priorVerification:!1,hasLoadedRegisters:!1,validation:new O,amount:0,settings:null,settingsSubscription:null}},mounted(){this.checkUsedRegister(),this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t})},beforeDestroy(){this.settingsSubscription.unsubscribe()},computed:{},methods:{__:p,popupResolver:C,async selectRegister(t){if(t.status!=="closed")return y.error(p("Unable to open this register. Only closed register can be opened.")).subscribe();try{const e=await new Promise((o,u)=>{const r=p("Open Register : %s").replace("%s",t.name),i="open",h=t.id;Popup.show(x,{resolve:o,reject:u,title:r,identifier:"ns.cash-registers-opening",register:t,action:i,register_id:h})});this.popupResolver(e)}catch(e){this.popup.reject(e)}},checkUsedRegister(){this.priorVerification=!1,w.get("/api/cash-registers/used").subscribe({next:t=>{this.popup.params.resolve(t),this.popup.close()},error:t=>{this.priorVerification=!0,y.error(t.message).subscribe(),this.loadRegisters()}})},loadRegisters(){this.hasLoadedRegisters=!1,w.get("/api/cash-registers").subscribe(t=>{this.registers=t,this.hasLoadedRegisters=!0})},getClass(t){switch(t.status){case"in-use":return"elevation-surface warning cursor-not-allowed";case"disabled":return"elevation-surface cursor-not-allowed";case"available":return"elevation-surface success"}return"elevation-surface hoverable cursor-pointer"}}},M={key:0,class:"h-full w-full py-10 flex justify-center items-center"},W={class:"title p-2 border-b ns-box-header flex justify-between items-center"},G={class:"font-semibold"},J={key:0},X=["href"],Z={key:0,class:"py-10 flex-auto overflow-y-auto flex items-center justify-center"},ee={key:1,class:"flex-auto overflow-y-auto"},se={class:"grid grid-cols-3"},te=["onClick"],ie=s("i",{class:"las la-cash-register text-6xl"},null,-1),re={class:"text-semibold text-center"},ne={class:"text-sm"},oe={key:0,class:"p-2 alert text-white"},le=["href"];function ce(t,e,o,u,r,i){const h=_("ns-spinner");return c(),a("div",null,[r.priorVerification===!1?(c(),a("div",M,[f(h,{size:"24",border:"8"})])):d("",!0),r.priorVerification?(c(),a("div",{key:1,id:"ns-pos-cash-registers-popup",class:R(["w-95vw md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen flex flex-col overflow-hidden",r.priorVerification?"shadow-lg ns-box":""])},[s("div",W,[s("h3",G,n(i.__("Open The Cash Register")),1),r.settings?(c(),a("div",J,[s("a",{href:r.settings.urls.orders_url,class:"rounded-full border ns-close-button px-3 text-sm py-1"},n(i.__("Exit To Orders")),9,X)])):d("",!0)]),r.hasLoadedRegisters?d("",!0):(c(),a("div",Z,[f(h,{size:"16",border:"4"})])),r.hasLoadedRegisters?(c(),a("div",ee,[s("div",se,[(c(!0),a(v,null,S(r.registers,(l,g)=>(c(),a("div",{onClick:P=>i.selectRegister(l),class:R([i.getClass(l),"border flex items-center justify-center flex-col p-3"]),key:g},[ie,s("h3",re,n(l.name),1),s("span",ne,"("+n(l.status_label)+")",1)],10,te))),128))]),r.registers.length===0?(c(),a("div",oe,[F(n(i.__("Looks like there is no registers. At least one register is required to proceed."))+" â€” ",1),s("a",{class:"font-bold hover:underline",href:r.settings.urls.registers_url},n(i.__("Create Cash Register")),9,le)])):d("",!0)])):d("",!0)],2)):d("",!0)])}const ae=m(K,[["render",ce]]),ue={props:["popup"],data(){return{totalIn:0,totalOut:0,settings:null,settingsSubscription:null,histories:[]}},mounted(){this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t}),this.getHistory()},unmounted(){this.settingsSubscription.unsubscribe()},methods:{__:p,nsCurrency:k,popupResolver:C,closePopup(){this.popupResolver({status:"success"})},getHistory(){w.get(`/api/cash-registers/session-history/${this.settings.register.id}`).subscribe(t=>{this.histories=t,this.totalIn=this.histories.filter(e=>["register-opening","register-sale","register-cash-in"].includes(e.action)).map(e=>parseFloat(e.value)).reduce((e,o)=>e+o,0),this.totalOut=this.histories.filter(e=>["register-closing","register-refund","register-cash-out"].includes(e.action)).map(e=>parseFloat(e.value)).reduce((e,o)=>e+o,0)})}}},de={class:"ns-box shadow-lg w-95vw md:w-4/6-screen lg:w-half overflow-hidden"},pe={id:"header",class:"p-2 flex justify-between items-center ns-box-header"},he={class:"font-bold"},ge={class:"flex w-full ns-box-body"},_e={class:"flex flex-auto"},fe={class:"w-full md:w-1/2 text-right bg-success-secondary text-white font-bold text-3xl p-3"},be={class:"w-full md:w-1/2 text-right bg-error-secondary text-white font-bold text-3xl p-3"},me={class:"flex flex-col overflow-y-auto h-120"},xe={class:"p-2 flex-auto"},ve={class:"flex-auto text-right p-2"},ye={class:"p-2 flex-auto"},we={class:"flex-auto text-right p-2"},Ce={class:"p-2 flex-auto"},ke={class:"flex-auto text-right p-2"},Se={class:"p-2 flex-auto"},Pe={class:"flex-auto text-right p-2"};function Re(t,e,o,u,r,i){const h=_("ns-close-button");return c(),a("div",de,[s("div",pe,[s("h3",he,n(i.__("Register History")),1),s("div",null,[f(h,{onClick:i.closePopup},null,8,["onClick"])])]),s("div",ge,[s("div",_e,[s("div",fe,n(i.nsCurrency(r.totalIn)),1),s("div",be,n(i.nsCurrency(r.totalOut)),1)])]),s("div",me,[(c(!0),a(v,null,S(r.histories,l=>(c(),a(v,null,[["register-sale","register-cash-in"].includes(l.action)?(c(),a("div",{key:l.id,class:"flex border-b elevation-surface success"},[s("div",xe,n(l.label),1),s("div",ve,n(i.nsCurrency(l.value)),1)])):d("",!0),["register-opening"].includes(l.action)?(c(),a("div",{key:l.id,class:"flex border-b elevation-surface"},[s("div",ye,n(l.label),1),s("div",we,n(i.nsCurrency(l.value)),1)])):d("",!0),["register-close"].includes(l.action)?(c(),a("div",{key:l.id,class:"flex border-b elevation-surface info"},[s("div",Ce,n(l.label),1),s("div",ke,n(i.nsCurrency(l.value)),1)])):d("",!0),["register-refund","register-cash-out"].includes(l.action)?(c(),a("div",{key:l.id,class:"flex border-b elevation-surface error"},[s("div",Se,n(l.label),1),s("div",Pe,n(i.nsCurrency(l.value)),1)])):d("",!0)],64))),256))])])}const Oe=m(ue,[["render",Re]]),Ve={props:["popup"],mounted(){this.settingsSubscriber=POS.settings.subscribe(t=>{this.settings=t}),this.popupCloser(),this.loadRegisterSummary()},beforeDestroy(){this.settingsSubscriber.unsubscribe()},data(){return{settings:null,settingsSubscriber:null,register:{}}},methods:{__:p,nsCurrency:k,popupResolver:C,popupCloser:V,loadRegisterSummary(){nsHttpClient.get(`/api/cash-registers/${this.settings.register.id}`).subscribe(t=>{this.register=t})},closePopup(){this.popupResolver({status:"error",button:"close_popup"})},async closeCashRegister(t){try{const e=await new Promise((o,u)=>{Popup.show(x,{title:p("Close Register"),action:"close",identifier:"ns.cash-registers-closing",register:t,resolve:o,reject:u})});POS.unset("register"),this.popupResolver({button:"close_register",...e})}catch(e){throw e}},async cashIn(t){try{const e=await new Promise((o,u)=>{Popup.show(x,{title:p("Cash In"),action:"register-cash-in",register:t,identifier:"ns.cash-registers-cashing",resolve:o,reject:u})});this.popupResolver({button:"close_register",...e})}catch(e){console.log({exception:e})}},async cashOut(t){try{const e=await new Promise((o,u)=>{Popup.show(x,{title:p("Cash Out"),action:"register-cash-out",register:t,identifier:"ns.cash-registers-cashout",resolve:o,reject:u})});this.popupResolver({button:"close_register",...e})}catch(e){throw e}},async historyPopup(t){try{const e=await new Promise((o,u)=>{Popup.show(Oe,{resolve:o,reject:u,register:t})})}catch(e){throw e}}}},je={class:"shadow-lg w-95vw md:w-3/5-screen lg:w-2/4-screen ns-box"},$e={class:"p-2 border-b ns-box-header flex items-center justify-between"},Be={key:0},Ie={class:"h-16 text-3xl elevation-surface info flex items-center justify-between px-3"},Fe={class:""},He={class:"font-bold"},Ne={class:"h-16 text-3xl elevation-surface success flex items-center justify-between px-3"},Le={class:""},Ae={class:"font-bold"},ze={key:1,class:"h-32 ns-box-body border-b py-1 flex items-center justify-center"},De={class:"grid grid-cols-2 text-primary"},Qe=s("i",{class:"las la-sign-out-alt text-6xl"},null,-1),Te={class:"text-xl font-bold"},Ue=s("i",{class:"las la-plus-circle text-6xl"},null,-1),Ye={class:"text-xl font-bold"},Ee=s("i",{class:"las la-minus-circle text-6xl"},null,-1),qe={class:"text-xl font-bold"},Ke=s("i",{class:"las la-history text-6xl"},null,-1),Me={class:"text-xl font-bold"};function We(t,e,o,u,r,i){const h=_("ns-close-button"),l=_("ns-spinner");return c(),a("div",je,[s("div",$e,[s("h3",null,n(i.__("Register Options")),1),s("div",null,[f(h,{onClick:e[0]||(e[0]=g=>i.closePopup())})])]),r.register.total_sale_amount!==void 0&&r.register.balance!==void 0?(c(),a("div",Be,[s("div",Ie,[s("span",Fe,n(i.__("Sales")),1),s("span",He,n(i.nsCurrency(r.register.total_sale_amount)),1)]),s("div",Ne,[s("span",Le,n(i.__("Balance")),1),s("span",Ae,n(i.nsCurrency(r.register.balance)),1)])])):d("",!0),r.register.total_sale_amount===void 0&&r.register.balance===void 0?(c(),a("div",ze,[s("div",null,[f(l,{border:"4",size:"16"})])])):d("",!0),s("div",De,[s("div",{onClick:e[1]||(e[1]=g=>i.closeCashRegister(r.register)),class:"border-r border-b py-4 ns-numpad-key info cursor-pointer px-2 flex items-center justify-center flex-col"},[Qe,s("h3",Te,n(i.__("Close")),1)]),s("div",{onClick:e[2]||(e[2]=g=>i.cashIn(r.register)),class:"ns-numpad-key success border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[Ue,s("h3",Ye,n(i.__("Cash In")),1)]),s("div",{onClick:e[3]||(e[3]=g=>i.cashOut(r.register)),class:"ns-numpad-key error border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[Ee,s("h3",qe,n(i.__("Cash Out")),1)]),s("div",{onClick:e[4]||(e[4]=g=>i.historyPopup(r.register)),class:"ns-numpad-key info border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[Ke,s("h3",Me,n(i.__("History")),1)])])])}const Ge=m(Ve,[["render",We]]),Je={data(){return{order:null,name:"",selectedRegister:null,orderSubscriber:null,settingsSubscriber:null}},watch:{},methods:{__:p,async openRegisterOptions(){try{(await new Promise((e,o)=>{Popup.show(Ge,{resolve:e,reject:o})})).button==="close_register"&&(delete this.settings.register,POS.settings.next(this.settings),POS.reset())}catch(t){Object.keys(t).length>0&&y.error(t.message).subscribe()}},registerInitialQueue(){POS.initialQueue.push(()=>new Promise(async(t,e)=>{try{const o=await new Promise((u,r)=>{if(this.settings.register===void 0)return Popup.show(ae,{resolve:u,reject:r});u({data:{register:this.settings.register}})});POS.set("register",o.data.register),this.setRegister(o.data.register),t(o)}catch(o){if(o===!1)return e({status:"error",message:p("You must choose a register before proceeding.")});e(o)}}))},setButtonName(){if(this.settings.register===void 0)return this.name=p("Cash Register");this.name=p("Cash Register : {register}").replace("{register}",this.settings.register.name)},setRegister(t){if(t!==void 0){const e=POS.order.getValue();e.register_id=t.id,POS.order.next(e)}}},unmounted(){this.orderSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe()},mounted(){this.registerInitialQueue(),this.orderSubscriber=POS.order.subscribe(t=>{this.order=t}),this.settingsSubscriber=POS.settings.subscribe(t=>{this.settings=t,this.setRegister(this.settings.register),this.setButtonName()})}},Xe={class:"ns-button default"},Ze=s("i",{class:"mr-1 text-xl las la-cash-register"},null,-1);function es(t,e,o,u,r,i){return c(),a("div",Xe,[s("button",{onClick:e[0]||(e[0]=h=>i.openRegisterOptions()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[Ze,s("span",null,n(r.name),1)])])}const os=m(Je,[["render",es]]);export{os as default};
