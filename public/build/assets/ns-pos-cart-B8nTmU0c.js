import{a as B,p as H,n as v,F,b as M,i as U,P as w}from"./bootstrap-Da_Fq5yP.js";import{n as V}from"./currency-COpKd-rX.js";import{_ as u}from"./lang-BINodpp-.js";import{s as I}from"./pos-section-switch-DmfccXVX.js";import{a as A,c as Y,b as G,P as z,n as L,d as W}from"./ns-pos-shipping-popup-BCjlC4nd.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as d,o as i,b as s,t as r,r as m,f as x,B as J,k as K,h as k,E as $,D as X,z as Z,a as p,F as g,e as S,g as O,w as C,i as j,a3 as N,n as D,j as ee}from"./runtime-core.esm-bundler-D4l6Snf1.js";import{v as te,w as se}from"./runtime-dom.esm-bundler-DaZ-XdMB.js";import{b as oe,g as re,a as ne,n as R}from"./ns-prompt-popup-B0CBamrP.js";import{Q as ie}from"./browser-DSrjAcO4.js";import"./chart-CFvJmF2u.js";import"./ns-orders-preview-popup-DEkLa1O_.js";const de={props:["order"],methods:{__,async payOrder(){POS.runPaymentQueue()}},mounted(){for(let e in nsShortcuts)["ns_pos_keyboard_payment"].includes(e)&&nsHotPress.create("ns_pos_keyboard_payment").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[e]!==null?nsShortcuts[e].join("+"):null,t=>{t.preventDefault(),this.payOrder()})},unmounted(){nsHotPress.destroy("ns_pos_keyboard_payment")}},le={class:"text-lg hidden md:inline lg:text-2xl"};function ae(e,t,c,l,a,o){return i(),d("div",{onClick:t[0]||(t[0]=n=>o.payOrder()),id:"pay-button",class:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-green-500 text-white hover:bg-green-600 border-r border-green-600 flex-auto"},[t[1]||(t[1]=s("i",{class:"mr-2 text-2xl lg:text-xl las la-cash-register"},null,-1)),s("span",le,r(o.__("Pay")),1)])}const ue=P(de,[["render",ae]]),ce={name:"ns-pos-hold-orders",props:["popup"],data(){return{order:{},title:"",show:!0}},mounted(){this.popupCloser(),this.show=POS.getHoldPopupEnabled(),this.show||this.popup.params.resolve({title:this.title}),this.$refs.reference.focus(),this.$refs.reference.select(),this.order=this.popup.params.order,this.title=this.popup.params.order.title||""},methods:{__:u,nsCurrency:V,popupCloser:B,submitHold(){this.popup.close(),this.popup.params.resolve({title:this.title})}}},pe={class:"ns-box shadow-lg w-6/7-screen md:w-3/7-screen lg:w-1/3-screen"},_e={class:"p-2 flex ns-box-header justify-between border-b items-center"},he={class:"font-semibold"},be={class:"flex-auto ns-box-body"},me={class:"border-b h-16 flex items-center justify-center"},fe={class:"text-5xl text-font"},ye={class:"p-2"},ve={class:"input-group border-2 info"},xe=["placeholder"],we={class:"p-2"},ge={class:"text-fontcolor-soft"},Pe={class:"flex ns-box-footer"};function ke(e,t,c,l,a,o){const n=m("ns-close-button");return i(),d("div",pe,[s("div",_e,[s("h3",he,r(o.__("Hold Order")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=_=>c.popup.close())})])]),s("div",be,[s("div",me,[s("span",fe,r(o.nsCurrency(a.order.total)),1)]),s("div",ye,[s("div",ve,[J(s("input",{onKeyup:t[1]||(t[1]=se(_=>o.submitHold(),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=_=>a.title=_),ref:"reference",type:"text",placeholder:o.__("Order Reference"),class:"outline-hidden rounded border-2 p-2 w-full"},null,40,xe),[[te,a.title]])])]),s("div",we,[s("p",ge,r(o.__("The current order will be set on hold. You can retrieve this order from the pending order button. Providing a reference to it might help you to identify the order more quickly.")),1)])]),s("div",Pe,[s("div",{onClick:t[3]||(t[3]=_=>o.submitHold()),class:"cursor-pointer w-1/2 py-3 flex justify-center items-center bg-green-500 text-white font-semibold"},r(o.__("Confirm")),1),s("div",{onClick:t[4]||(t[4]=_=>c.popup.close()),class:"cursor-pointer w-1/2 py-3 flex justify-center items-center bg-error-secondary text-white font-semibold"},r(o.__("Cancel")),1)])])}const Ce=P(ce,[["render",ke]]),Se={props:["order"],methods:{__,async holdOrder(){if(this.order.payment_status!=="hold"&&this.order.payments.length>0)return nsSnackBar.error(__("Unable to hold an order which payment status has been updated already."));const e=nsHooks.applyFilters("ns-hold-queue",[ProductsQueue,CustomerQueue,TypeQueue]);for(let c in e)try{const a=await new e[c](this.order).run()}catch{return!1}nsHooks.applyFilters("ns-override-hold-popup",()=>{new Promise((l,a)=>{Popup.show(Ce,{resolve:l,reject:a,order:this.order})}).then(l=>{this.order.title=l.title,this.order.payment_status="hold",POS.order.next(this.order);const a=Popup.show(oe);POS.submitOrder().then(o=>{a.close(),nsSnackBar.success(o.message)},o=>{a.close(),nsSnackBar.error(o.message)})}).catch(l=>{console.log(l)})})()}},mounted(){for(let e in nsShortcuts)["ns_pos_keyboard_hold_order"].includes(e)&&nsHotPress.create("ns_pos_keyboard_hold_order").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[e]!==null?nsShortcuts[e].join("+"):null,t=>{t.preventDefault(),this.holdOrder()})},unmounted(){nsHotPress.destroy("ns_pos_keyboard_hold_order")}},Te={class:"text-lg hidden md:inline lg:text-2xl"};function Oe(e,t,c,l,a,o){return i(),d("div",{onClick:t[0]||(t[0]=n=>o.holdOrder()),id:"hold-button",class:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-blue-500 text-white border-r hover:bg-blue-600 border-blue-600 flex-auto"},[t[1]||(t[1]=s("i",{class:"mr-2 text-2xl lg:text-xl las la-pause"},null,-1)),s("span",Te,r(o.__("Hold")),1)])}const je=P(Se,[["render",Oe]]),qe=K({name:"NsPosPermissionsPopup",props:["permission","popup","access_id","reject","resolve"],emits:["close","granted"],setup(e,{emit:t}){const c=k(!1),l=k(!1),a=k(),o=k(""),n=k({}),_=async()=>new Promise(async(b,q)=>{try{if(o.value=JSON.stringify({permission:e.permission,access_id:e.access_id}),a.value){const T=await ie.toCanvas(a.value,o.value,{width:240,margin:1,color:{dark:"#1f2937",light:"#ffffff"}});l.value=!0,console.log({result:T}),b(!0)}}catch(T){console.error("Failed to generate QR code:",T),nsSnackBar.error(__("Failed to generate QR code")),q(T)}}),h=()=>{e.popup.close(),e.reject(!1)},y=async()=>{try{const b=await new Promise((q,T)=>{nsHttpClient.get(`/api/user/access/${e.access_id}`).subscribe({next:Q=>{Q.status==="granted"?nsHttpClient.post(`/api/access/${e.access_id}/use`).subscribe({next:()=>{q(!0)},error:Mo=>{T(!1)}}):console.log("Permission not granted yet, will check again...")},error:Q=>{T(!1)}})});e.popup.close(),e.resolve(!0)}catch(b){console.error("Failed to check permission status:",b),h()}};$(()=>{f&&(console.log("Clearing permission status polling interval"),clearInterval(f))});let f=null;return X(async()=>{await Z(),await _(),f=window.setInterval(y,2e3),nsHttpClient.get(`/api/permissions/${e.permission}`).subscribe({next:b=>{n.value=b},error:b=>{h(),nsSnackBar.error(__("Failed to load permission data"))}})}),{isLoading:c,qrCodeGenerated:l,permissionData:n,qrCanvas:a,close:h,onUnmounted:$,__,popupCloser,popupResolver}}}),Ne={class:"bg-white rounded-lg shadow-xl w-[95vw] md:w-[60vw] lg:w-[40vw] w-full max-w-md mx-auto md:max-w-sm lg:max-w-md"},De={class:"flex items-center justify-between p-4 border-b border-gray-200"},Be={class:"text-lg font-semibold text-gray-900"},Fe={class:"p-6 text-center"},Ve={class:"mb-6"},Re={class:"text-lg font-medium text-gray-900 mb-2"},He={class:"text-sm text-gray-600 mb-4"},Qe={class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},$e={class:"mb-6"},Ae={class:"bg-gray-50 rounded-lg p-4 mb-4"},Ee={class:"w-[240px] h-[240px] mx-auto bg-white rounded-lg p-2 shadow-inner flex items-center justify-center"},Me={class:"w-full h-full bg-gray-100 rounded flex items-center justify-center",ref:"qrCodeContainer"},Ue={ref:"qrCanvas",class:"max-w-full max-h-full"},Ie={key:0,class:"text-xs text-gray-500"},Ye={class:"text-xs text-gray-500 mt-2"};function Ge(e,t,c,l,a,o){return i(),d("div",Ne,[s("div",De,[s("h3",Be,r(e.__("Permission Required")),1),s("button",{onClick:t[0]||(t[0]=(...n)=>e.close&&e.close(...n)),class:"text-gray-400 hover:text-gray-600 transition-colors"},t[1]||(t[1]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",Fe,[s("div",Ve,[t[2]||(t[2]=s("div",{class:"w-12 h-12 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center"},[s("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),s("h4",Re,r(e.__("Temporary Permission Required")),1),s("p",He,r(e.__("Access to this feature requires temporary permission from an administrator. Scan the QR code to proceed.")),1),s("div",Qe,r(e.permissionData.name||e.__("Unknown Permission")),1)]),s("div",$e,[s("div",Ae,[s("div",Ee,[s("div",Me,[s("canvas",Ue,null,512),e.qrCodeGenerated?p("",!0):(i(),d("div",Ie,r(e.__("Generating QR...")),1))],512)]),s("p",Ye,r(e.__("Scan with administrator device")),1)])])])])}const ze=P(qe,[["render",Ge],["__scopeId","data-v-aee1fcef"]]);class E{static async canProceed(t){return new Promise((c,l)=>{const a=POS.options.getValue();if(a.ns_pos_action_permission_enabled==="yes"){const n=a.ns_pos_action_permission_restricted_features;a.ns_pos_action_permission_duration,n.includes(t)&&nsHttpClient.post("/api/users/check-permission/",{permission:t}).subscribe({next:_=>{c(!0)},error:_=>{_.type&&["permission_denied","permission_pending"].includes(_.type)&&Popup.show(ze,{permission:t,access_id:_.data.access.id,resolve:c,reject:l})}})}})}}const Le={props:["order","settings"],methods:{__,async openDiscountPopup(e,t,c=null){if(!this.settings.products_discount&&t==="product")return nsSnackBar.error(__("You're not allowed to add a discount on the product."));if(!this.settings.cart_discount&&t==="cart")return nsSnackBar.error(__("You're not allowed to add a discount on the cart."));const l={product:"nexopos.cart.product-discount",cart:"nexopos.cart.discount"};try{await E.canProceed(l[t])}catch{return nsSnackBar.error(__("Your action were'nt granted."))}Popup.show(A,{reference:e,type:t,onSubmit(a){t==="product"?POS.updateProduct(e,a,c):t==="cart"&&POS.updateCart(e,a)}},{popupClass:"bg-white h:2/3 shadow-lg xl:w-1/4 lg:w-2/5 md:w-2/3 w-full"})}}},We={class:"text-lg hidden md:inline lg:text-2xl"};function Je(e,t,c,l,a,o){return i(),d("div",{onClick:t[0]||(t[0]=n=>o.openDiscountPopup(c.order,"cart")),id:"discount-button",class:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center border-r border-box-edge flex-auto"},[t[1]||(t[1]=s("i",{class:"mr-2 text-2xl lg:text-xl las la-percent"},null,-1)),s("span",We,r(o.__("Discount")),1)])}const Ke=P(Le,[["render",Je]]),Xe={props:["order","settings"],methods:{__,voidOngoingOrder(){POS.voidOrder(this.order)}}},Ze={class:"text-lg hidden md:inline lg:text-2xl"};function et(e,t,c,l,a,o){return i(),d("div",{onClick:t[0]||(t[0]=n=>o.voidOngoingOrder(c.order)),id:"void-button",class:"flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center bg-red-500 text-white border-box-edge hover:bg-red-600 flex-auto"},[t[1]||(t[1]=s("i",{class:"mr-2 text-2xl lg:text-xl las la-trash"},null,-1)),s("span",Ze,r(o.__("Void")),1)])}const tt=P(Xe,[["render",et]]),st={name:"ns-pos-note-popup",props:["popup"],data(){return{validation:new F,fields:[{label:u("Note"),name:"note",value:"",description:u("More details about this order"),type:"textarea"},{label:u("Display On Receipt"),name:"note_visibility",value:"",options:[{label:u("Yes"),value:"visible"},{label:u("No"),value:"hidden"}],description:u("Will display the note on the receipt"),type:"switch"}]}},mounted(){this.popupCloser(),this.fields.forEach(e=>{e.name==="note"?e.value=this.popup.params.note:e.name==="note_visibility"&&(e.value=this.popup.params.note_visibility)})},methods:{__:u,popupResolver:H,popupCloser:B,closePopup(){this.popupResolver(!1)},saveNote(){if(!this.validation.validateFields(this.fields)){const e=this.validation.validateFieldsErrors(this.fields);return this.validation.triggerFieldsErrors(this.fields,e),this.$forceUpdate(),v.error(u("Unable to proceed the form is not valid."))}return this.popupResolver(this.validation.extractFields(this.fields))}}},ot={class:"shadow-lg ns-box w-95vw md:w-3/5-screen lg:w-2/5-screen"},rt={class:"p-2 flex justify-between items-center border-b ns-box-header"},nt={class:"font-bold"},it={class:"p-2"},dt={class:"p-2 flex justify-end border-t ns-box-footer"};function lt(e,t,c,l,a,o){const n=m("ns-close-button"),_=m("ns-field"),h=m("ns-button");return i(),d("div",ot,[s("div",rt,[s("h3",nt,r(o.__("Order Note")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=y=>o.closePopup())})])]),s("div",it,[(i(!0),d(g,null,S(a.fields,(y,f)=>(i(),O(_,{key:f,field:y},null,8,["field"]))),128))]),s("div",dt,[x(h,{type:"info",onClick:t[1]||(t[1]=y=>o.saveNote())},{default:C(()=>[j(r(o.__("Save")),1)]),_:1})])])}const at=P(st,[["render",lt]]),ut={name:"ns-pos-tax-popup",props:["popup"],data(){return{validation:new F,tax_group:[],order:null,orderSubscriber:null,optionsSubscriber:null,options:{},tax_group:[],activeTab:"",group_fields:[{label:u("Select Tax"),name:"tax_group_id",description:u("Define the tax that apply to the sale."),type:"select",disabled:!0,value:"",validation:"required",options:[]},{label:u("Type"),name:"tax_type",disabled:!0,value:"",description:u("Define how the tax is computed"),type:"select",validation:"required",options:[{label:u("Exclusive"),value:"exclusive"},{label:u("Inclusive"),value:"inclusive"}]}]}},mounted(){this.loadGroups(),this.popupCloser(),this.activeTab=this.popup.params.activeTab||"settings",this.group_fields.forEach(e=>{e.value=this.popup.params[e.name]||void 0}),this.orderSubscriber=POS.order.subscribe(e=>{this.order=e}),this.optionsSubscriber=POS.options.subscribe(e=>{this.options=e,["variable_vat","products_variable_vat"].includes(this.options.ns_pos_vat)&&this.group_fields.forEach(t=>t.disabled=!1)})},unmounted(){this.orderSubscriber.unsubscribe(),this.optionsSubscriber.unsubscribe()},methods:{__:u,nsCurrency:V,popupCloser:B,popupResolver:H,changeActive(e){this.activeTab=e},closePopup(){this.popupResolver(!1)},saveTax(){if(!this.validation.validateFields(this.group_fields))return v.error(u("Unable to proceed the form is not valid."));const e=this.validation.extractFields(this.group_fields);e.tax_group={},this.popupResolver(e)},loadGroups(){M.get("/api/taxes/groups").subscribe(e=>{this.groups=e,this.group_fields.forEach(t=>{t.name==="tax_group_id"&&(t.options=this.groups.map(c=>({label:c.name,value:c.id})))})})}}},ct={class:"ns-box shadow-lg w-95vw md:w-3/5-screen lg:w-2/5-screen"},pt={class:"p-2 flex justify-between items-center border-b ns-box-header"},_t={class:"text-blog"},ht={class:"p-2 ns-box-body"},bt={class:"p-2 border-b ns-box-body"},mt={class:"flex justify-end p-2"},ft={key:0,class:"p-2"},yt={key:0,class:"p-2 text-center text-font"},vt={key:0,class:"p-2"},xt={class:"border shadow p-2 w-full flex justify-between items-center elevation-surface"};function wt(e,t,c,l,a,o){const n=m("ns-close-button"),_=m("ns-field"),h=m("ns-button"),y=m("ns-tabs-item"),f=m("ns-tabs");return i(),d("div",ct,[s("div",pt,[s("h3",_t,r(o.__("Tax & Summary")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=b=>o.closePopup())})])]),s("div",ht,[Object.keys(a.options).length>0?(i(),O(f,{key:0,active:a.activeTab,onChangeTab:t[2]||(t[2]=b=>o.changeActive(b))},{default:C(()=>[x(y,{padding:"0",label:o.__("Settings"),identifier:"settings",active:!0},{default:C(()=>[s("div",bt,[(i(!0),d(g,null,S(a.group_fields,(b,q)=>(i(),O(_,{field:b,key:q},null,8,["field"]))),128))]),s("div",mt,[x(h,{onClick:t[1]||(t[1]=b=>o.saveTax()),type:"info"},{default:C(()=>[j(r(o.__("Save")),1)]),_:1})])]),_:1},8,["label"]),x(y,{padding:"0",label:o.__("Summary"),identifier:"summary",active:!1},{default:C(()=>[a.order?(i(),d("div",ft,[(i(!0),d(g,null,S(a.order.taxes,b=>(i(),d("div",{key:b.id,class:"mb-2 border shadow p-2 w-full flex justify-between items-center elevation-surface"},[s("span",null,r(b.name),1),s("span",null,r(o.nsCurrency(b.tax_value)),1)]))),128)),a.order.taxes.length===0?(i(),d("div",yt,r(o.__("No tax is active")),1)):p("",!0)])):p("",!0)]),_:1},8,["label"]),["products_vat"].includes(a.options.ns_pos_vat)?(i(),O(y,{key:0,padding:"0",label:o.__("Product Taxes"),identifier:"product_taxes",active:!1},{default:C(()=>[a.order?(i(),d("div",vt,[s("div",xt,[s("span",null,r(o.__("Product Taxes")),1),s("span",null,r(o.nsCurrency(a.order.products_tax_value)),1)])])):p("",!0)]),_:1},8,["label"])):p("",!0)]),_:1},8,["active"])):p("",!0)])])}const gt=P(ut,[["render",wt]]),Pt={name:"ns-pos-order-settings",props:["popup"],mounted(){nsHttpClient.get("/api/fields/ns.pos-order-settings").subscribe(e=>{e.forEach(t=>{t.value=this.popup.params.order[t.name]||""}),this.fields=this.validation.createFields(e)},e=>{}),this.popupCloser()},data(){return{fields:[],validation:new F}},methods:{__,popupCloser,popupResolver,closePopup(){this.popupResolver(!1)},saveSettings(){const e=this.validation.extractFields(this.fields);this.popupResolver(e)}}},kt={class:"shadow-lg flex flex-col ns-box w-95vw h-95vh md:w-3/5-screen md:h-[60vh] lg:w-2/5-screen"},Ct={class:"p-2 border-b ns-box-header items-center flex justify-between"},St={class:"text-semibold"},Tt={class:"p-2 flex-auto border-b ns-box-body overflow-y-auto"},Ot={class:"p-2 flex justify-end ns-box-footer"};function jt(e,t,c,l,a,o){const n=m("ns-close-button"),_=m("ns-field"),h=m("ns-button");return i(),d("div",kt,[s("div",Ct,[s("h3",St,r(o.__("Order Settings")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=y=>o.closePopup())})])]),s("div",Tt,[(i(!0),d(g,null,S(a.fields,(y,f)=>(i(),O(_,{field:y,key:f},null,8,["field"]))),128))]),s("div",Ot,[x(h,{onClick:t[1]||(t[1]=y=>o.saveSettings()),type:"info"},{default:C(()=>[j(r(o.__("Save")),1)]),_:1})])])}const qt=P(Pt,[["render",jt]]),Nt={name:"ns-pos-product-price-product",props:["popup"],components:{nsNumpad:ne,nsNumpadPlus:re},computed:{},data(){return{product:{},optionsSubscription:null,options:{},price:0}},mounted(){this.popupCloser(),this.product=this.popup.params.product,this.optionsSubscription=POS.options.subscribe(e=>{this.options=k(e)})},beforeDestroy(){this.optionsSubscription.unsubscribe()},methods:{popupResolver,popupCloser,nsCurrency:V,__,updateProductPrice(e){this.product.unit_price=e},resolveProductPrice(e){this.popupResolver(this.product.unit_price)}}},Dt={class:"ns-box shadow-lg w-95vw md:w-3/5-screen lg:w-2/5-screen"},Bt={class:"popup-heading ns-box-header"},Ft={class:"flex flex-col ns-box-body"},Vt={class:"h-16 flex items-center justify-center elevation-surface info font-bold"},Rt={class:"text-2xl"};function Ht(e,t,c,l,a,o){const n=m("ns-close-button"),_=m("ns-numpad");return i(),d("div",Dt,[s("div",Bt,[s("h3",null,r(o.__("Product Price")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=h=>o.popupResolver(!1))})])]),s("div",Ft,[s("div",Vt,[s("h2",Rt,r(o.nsCurrency(a.product.unit_price)),1)]),x(_,{floating:!0,onChanged:t[1]||(t[1]=h=>o.updateProductPrice(h)),onNext:t[2]||(t[2]=h=>o.resolveProductPrice(h)),value:a.product.unit_price},null,8,["value"])])])}const Qt=P(Nt,[["render",Ht]]),$t={name:"ns-pos-quick-product-popup",props:["popup"],methods:{__:u,popupCloser:B,popupResolver:H,close(){this.popupResolver(!1)},async addProduct(){const e=this.validation.extractFields(this.fields),t=this.fields.filter(o=>typeof o.show>"u"||typeof o.show=="function"&&o.show(e));if(!this.validation.validateFields(t))return v.error(u("Unable to proceed. The form is not valid."));let l=this.validation.extractFields(t);l.$original=()=>({stock_management:"disabled",category_id:0,tax_group:this.tax_groups.filter(o=>parseInt(o.id)===parseInt(l.tax_group_id))[0],tax_group_id:l.tax_group_id,tax_type:l.tax_type}),l.product_type==="product"?(l.unit_name=this.units.filter(o=>o.id===l.unit_id)[0].name,l.quantity=parseFloat(l.quantity),l.unit_price=parseFloat(l.unit_price),l.mode="custom",l.price_with_tax=l.unit_price,l.price_without_tax=l.unit_price,l.tax_value=0):(l.unit_name=u("N/A"),l.unit_price=0,l.quantity=1);const a=await POS.defineQuantities(l,this.units);l.$quantities=()=>a,l=POS.computeProductTax(l),POS.addToCart(l),this.close()},loadData(){this.loaded=!1,U(nsHttpClient.get("/api/units"),nsHttpClient.get("/api/taxes/groups")).subscribe({next:e=>{this.units=e[0],this.tax_groups=e[1],this.fields.filter(t=>{t.name==="tax_group_id"&&(t.options=e[1].map(c=>({label:c.name,value:c.id})),e[1].length>0&&e[1][0].id!==void 0&&(t.value=e[1][0].id||this.options.ns_pos_tax_group)),t.name==="tax_type"&&(t.value=this.options.tax_type||"inclusive"),t.name==="unit_id"&&(t.value=this.options.ns_pos_quick_product_default_unit,t.options=e[0].map(c=>({label:c.name,value:c.id})))}),this.buildForm()},error:e=>{}})},buildForm(){this.fields=this.validation.createFields(this.fields),this.loaded=!0,setTimeout(()=>{this.$el.querySelector("#name").select()},100)}},computed:{form(){return this.validation.extractFields(this.fields)}},data(){return{units:[],options:POS.options.getValue(),tax_group:{},loaded:!1,validation:new F,fields:[{label:u("Name"),name:"name",type:"text",description:u("Provide a unique name for the product."),validation:"required"},{label:u("Product Type"),name:"product_type",type:"select",description:u("Define the product type."),options:[{label:u("Normal"),value:"product"},{label:u("Dynamic"),value:"dynamic"}],value:"product",validation:"required"},{label:u("Rate"),name:"rate",type:"text",description:u("In case the product is computed based on a percentage, define the rate here."),validation:"required",show(e){return e.product_type==="dynamic"}},{label:u("Unit Price"),name:"unit_price",type:"text",description:u("Define what is the sale price of the item."),validation:"",value:0,show(e){return e.product_type==="product"}},{label:u("Quantity"),name:"quantity",type:"text",value:1,description:u("Set the quantity of the product."),validation:"",show(e){return e.product_type==="product"}},{label:u("Unit"),name:"unit_id",type:"select",options:[],description:u("Assign a unit to the product."),validation:"",show(e){return e.product_type==="product"}},{label:u("Tax Type"),name:"tax_type",type:"select",options:[{label:u("Disabled"),value:""},{label:u("Inclusive"),value:"inclusive"},{label:u("Exclusive"),value:"exclusive"}],description:u("Define what is tax type of the item."),show(e){return e.product_type==="product"}},{label:u("Tax Group"),name:"tax_group_id",type:"select",options:[],description:u("Choose the tax group that should apply to the item."),show(e){return e.product_type==="product"}}]}},mounted(){this.popupCloser(),this.loadData()}},At={class:"w-95vw flex flex-col h-95vh shadow-lg md:w-3/5-screen lg:w-2/5-screen md:h-[60vh] ns-box"},Et={class:"header ns-box-header border-b flex justify-between p-2 items-center"},Mt={class:"ns-box-body p-2 flex-auto overflow-y-auto"},Ut={key:0,class:"h-full w-full flex justify-center items-center"},It={class:"ns-box-footer border-t flex justify-between p-2"};function Yt(e,t,c,l,a,o){const n=m("ns-close-button"),_=m("ns-spinner"),h=m("ns-field"),y=m("ns-button");return i(),d("div",At,[s("div",Et,[s("h3",null,r(o.__("Product / Service")),1),s("div",null,[x(n,{onClick:t[0]||(t[0]=f=>o.close())})])]),s("div",Mt,[a.loaded?p("",!0):(i(),d("div",Ut,[x(_)])),a.loaded?(i(!0),d(g,{key:1},S(a.fields,(f,b)=>(i(),d(g,null,[f.show&&f.show(o.form)||!f.show?(i(),O(h,{key:b,field:f},null,8,["field"])):p("",!0)],64))),256)):p("",!0)]),s("div",It,[t[2]||(t[2]=s("div",null,null,-1)),s("div",null,[x(y,{onClick:t[1]||(t[1]=f=>o.addProduct()),type:"info"},{default:C(()=>[j(r(o.__("Create")),1)]),_:1})])])])}const Gt=P($t,[["render",Yt]]),zt={name:"ns-pos-cart",data:()=>({popup:null,cartButtons:{},products:[],defaultCartButtons:{nsPosPayButton:N(ue),nsPosHoldButton:N(je),nsPosDiscountButton:N(Ke),nsPosVoidButton:N(tt)},visibleSection:null,visibleSectionSubscriber:null,cartButtonsSubscriber:null,optionsSubscriber:null,options:{},typeSubscribe:null,orderSubscribe:null,productSubscribe:null,settingsSubscribe:null,settings:{},types:[],order:k({})}),computed:{selectedType(){return this.order.type?this.order.type.label:"N/A"},isVisible(){return this.visibleSection==="cart"},customerName(){return this.order.customer?`${this.order.customer.first_name||this.order.customer.last_name?this.getFirstName():this.getUserName()}`:"N/A"},couponName(){return u("Apply Coupon")}},mounted(){this.cartButtonsSubscriber=POS.cartButtons.subscribe(e=>{this.cartButtons=e}),this.optionsSubscriber=POS.options.subscribe(e=>{this.options=e}),this.typeSubscribe=POS.types.subscribe(e=>this.types=e),this.orderSubscribe=POS.order.subscribe(e=>{this.order=k(e)}),this.productSubscribe=POS.products.subscribe(e=>{this.products=k(e)}),this.settingsSubscribe=POS.settings.subscribe(e=>{this.settings=k(e)}),this.visibleSectionSubscriber=POS.visibleSection.subscribe(e=>{this.visibleSection=k(e)}),nsHooks.addAction("ns-before-cart-reset","ns-pos-cart-buttons",()=>{POS.cartButtons.next(this.defaultCartButtons)});for(let e in nsShortcuts)["ns_pos_keyboard_shipping"].includes(e)&&nsHotPress.create("ns_pos_keyboard_shipping").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[e]!==null?nsShortcuts[e].join("+"):null,t=>{t.preventDefault(),this.openShippingPopup()}),["ns_pos_keyboard_note"].includes(e)&&nsHotPress.create("ns_pos_keyboard_note").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[e]!==null?nsShortcuts[e].join("+"):null,t=>{t.preventDefault(),this.openNotePopup()})},unmounted(){this.visibleSectionSubscriber.unsubscribe(),this.typeSubscribe.unsubscribe(),this.orderSubscribe.unsubscribe(),this.productSubscribe.unsubscribe(),this.settingsSubscribe.unsubscribe(),this.optionsSubscriber.unsubscribe(),this.cartButtonsSubscriber.unsubscribe(),nsHotPress.destroy("ns_pos_keyboard_shipping"),nsHotPress.destroy("ns_pos_keyboard_note")},methods:{__:u,nsCurrency:V,switchTo:I,getFirstName(){return`${this.order.customer.first_name||""} ${this.order.customer.last_name||""}`},getUserName(){return this.order.customer.username},takeRandomClass(){return"border-gray-500 bg-gray-400 text-white hover:bg-gray-500"},openAddQuickProduct(){new Promise((t,c)=>{w.show(Gt,{resolve:t,reject:c})}).then(t=>{}).catch(t=>{})},summarizeCoupons(){const e=this.order.coupons.map(t=>t.value);return e.length>0?e.reduce((t,c)=>t+c):0},async changeProductPrice(e){if(!this.settings.edit_purchase_price)return v.error(u("You don't have the right to edit the purchase price."));if(e.product_type==="dynamic")return v.error(u("Dynamic product can't have their price updated."));if(this.settings.unit_price_editable)try{const t=await new Promise((l,a)=>w.show(Qt,{product:Object.assign({},e),resolve:l,reject:a})),c={...e.$quantities(),custom_price_edit:t,custom_price_with_tax:t,custom_price_without_tax:t};return e.$quantities=()=>c,e.mode="custom",POS.recomputeProducts(POS.products.getValue()),POS.refreshCart(),v.success(u("The product price has been updated."))}catch(t){if(t!==!1)throw v.error(t),t}else return v.error(u("The editable price feature is disabled."))},async selectCoupon(){try{const e=await new Promise((t,c)=>{w.show(W,{resolve:t,reject:c})})}catch{}},async defineOrderSettings(){if(!this.settings.edit_settings)return v.error(u("You're not allowed to edit the order settings."));try{const e=await new Promise((t,c)=>{w.show(qt,{resolve:t,reject:c,order:this.order})});POS.order.next({...this.order,...e})}catch{}},async openNotePopup(){try{const e=await new Promise((c,l)=>{const a=this.order.note,o=this.order.note_visibility;w.show(at,{resolve:c,reject:l,note:a,note_visibility:o})}),t={...this.order,...e};POS.order.next(t)}catch(e){e!==!1&&v.error(e.message)}},async selectTaxGroup(e="settings"){try{const t=await new Promise((l,a)=>{const o=this.order.taxes,n=this.order.tax_group_id,_=this.order.tax_type;w.show(gt,{resolve:l,reject:a,taxes:o,tax_group_id:n,tax_type:_,activeTab:e})}),c={...this.order,...t};POS.order.next(c),POS.refreshCart()}catch{}},openTaxSummary(){this.selectTaxGroup("summary")},selectCustomer(){w.show(L)},async openDiscountPopup(e,t,c=null){if(!this.settings.products_discount&&t==="product")return v.error(u("You're not allowed to add a discount on the product."));if(!this.settings.cart_discount&&t==="cart")return v.error(u("You're not allowed to add a discount on the cart."));t==="product"&&(e.disable_flat=!0),E.canProceed(t==="product"?"nexopos.cart.product-discount":"nexopos.cart.discount");try{const l=await new Promise((a,o)=>{w.show(A,{reference:e,resolve:a,reject:o,type:t,onSubmit(n){if(n.discount_type==="flat"&&n.discount>e.total_price)return v.error(u("The discount amount can't exceed the total price of the product."));t==="product"?POS.updateProduct(e,n,c):t==="cart"&&POS.updateCart(e,n)}},{popupClass:"bg-white h:2/3 shadow-lg xl:w-1/4 lg:w-2/5 md:w-2/3 w-full"})})}catch{}},toggleMode(e,t){if(!this.options.ns_pos_allow_wholesale_price)return v.error(u("Unable to change the price mode. This feature has been disabled."));e.mode==="normal"?w.show(R,{title:u("Enable WholeSale Price"),message:u("Would you like to switch to wholesale price ?"),onAction(c){c&&POS.updateProduct(e,{mode:"wholesale"},t)}}):w.show(R,{title:u("Enable Normal Price"),message:u("Would you like to switch to normal price ?"),onAction(c){c&&POS.updateProduct(e,{mode:"normal"},t)}})},removeUsingIndex(e){w.show(R,{title:u("Confirm Your Action"),message:u("Would you like to delete this product ?"),onAction(t){t&&POS.removeProductUsingIndex(e)}})},allowQuantityModification(e){return e.product_type==="product"},changeQuantity(e,t){this.allowQuantityModification(e)&&new z(e).run({unit_quantity_id:e.unit_quantity_id,unit_name:e.unit_name,$quantities:e.$quantities}).then(l=>{POS.updateProduct(e,l,t)})},openOrderType(){w.show(G)},openShippingPopup(){w.show(Y)}}},Lt={id:"pos-cart",class:"flex-auto flex flex-col"},Wt={key:0,id:"tools",class:"flex pl-2 ns-tab"},Jt={key:0,class:"flex items-center justify-center text-sm rounded-full h-6 w-6 bg-green-500 text-white ml-1"},Kt={class:"rounded shadow ns-tab-item flex-auto flex overflow-hidden"},Xt={class:"cart-table flex flex-auto flex-col overflow-hidden"},Zt={id:"cart-toolbox",class:"w-full p-2 border-b"},es={class:"border rounded overflow-hidden"},ts={class:"flex flex-wrap"},ss={class:"ns-button"},os={class:"ml-1 hidden md:inline-block"},rs={class:"ns-button"},ns={class:"ml-1 hidden md:inline-block"},is={key:0,class:"ml-1 rounded-full flex items-center justify-center h-6 w-6 bg-info-secondary text-white"},ds={class:"ns-button"},ls={class:"ml-1 hidden md:inline-block"},as={key:0,class:"ml-1 rounded-full flex items-center justify-center h-6 w-6 bg-info-secondary text-white"},us={class:"ns-button"},cs={class:"ml-1 hidden md:inline-block"},ps={key:0,class:"ns-button"},_s={class:"ml-1 hidden md:inline-block"},hs={id:"cart-table-header",class:"w-full text-fontcolor font-semibold flex"},bs={class:"w-full lg:w-4/6 p-2 border border-l-0 border-t-0"},ms={class:"hidden lg:flex lg:w-1/6 p-2 border-b border-t-0"},fs={class:"hidden lg:flex lg:w-1/6 p-2 border border-r-0 border-t-0"},ys={id:"cart-products-table",class:"flex flex-auto flex-col overflow-auto"},vs={key:0,class:"text-fontcolor flex"},xs={class:"w-full text-center py-4 border-b"},ws=["product-index"],gs={class:"w-full lg:w-4/6 p-2 border border-l-0 border-t-0"},Ps={class:"flex justify-between product-details mb-1"},ks={class:"font-semibold"},Cs={class:"-mx-1 flex product-options"},Ss={class:"px-1"},Ts=["onClick"],Os={key:0,class:"px-1"},js=["onClick"],qs={class:"flex justify-between product-controls"},Ns={class:"-mx-1 flex flex-wrap"},Ds={class:"px-1 w-1/2 md:w-auto mb-1"},Bs=["onClick"],Fs={class:"px-1 w-1/2 md:w-auto mb-1"},Vs=["onClick"],Rs={key:0},Hs={class:"px-1 w-1/2 md:w-auto mb-1 lg:hidden"},Qs=["onClick"],$s={class:"px-1 w-1/2 md:w-auto mb-1 lg:hidden"},As={class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},Es=["onClick"],Ms={key:0,class:"border-b border-dashed border-secondary p-2"},Us={class:"hidden lg:flex w-1/6 p-2 border border-r-0 border-t-0 items-center justify-center"},Is={id:"cart-products-summary",class:"flex"},Ys={key:0,class:"table ns-table w-full text-sm"},Gs={key:0},zs={width:"200",class:"border p-2",colspan:"2"},Ls={key:0,class:"py-1"},Ws={key:1,class:"py-1"},Js={width:"200",class:"border p-2 text-right"},Ks={width:"200",class:"border p-2"},Xs={width:"200",class:"border p-2"},Zs={width:"200",class:"border p-2 text-right"},eo={key:1},to={width:"200",class:"border p-2"},so={width:"200",class:"border p-2 text-right"},oo={width:"200",class:"border p-2"},ro={width:"200",class:"border p-2"},no={key:0},io={key:1},lo={width:"200",class:"border p-2 text-right"},ao={key:2},uo={width:"200",class:"border p-2"},co={width:"200",class:"border p-2 text-right"},po={class:"success"},_o={key:0,width:"200",class:"border p-2"},ho={key:1,width:"200",class:"border p-2"},bo={width:"200",class:"border p-2"},mo={width:"200",class:"border p-2 text-right"},fo={key:1,class:"table ns-table w-full text-sm"},yo={key:0},vo={width:"200",class:"border p-2"},xo={key:0,class:"py-1"},wo={key:1,class:"py-1"},go={width:"200",class:"border p-2 text-right"},Po={width:"200",class:"border p-2"},ko={width:"200",class:"border p-2"},Co={class:"flex justify-between"},So={key:1},To={width:"200",class:"border p-2"},Oo={width:"200",class:"border p-2 text-right"},jo={width:"200",class:"border p-2"},qo={width:"200",class:"border p-2"},No={class:"flex justify-between items-center"},Do={key:0},Bo={key:1},Fo={key:2},Vo={width:"200",class:"border p-2"},Ro={class:"success"},Ho={width:"200",class:"border p-2"},Qo={width:"200",class:"border p-2"},$o={class:"flex justify-between w-full"},Ao={class:"h-16 flex flex-shrink-0 border-t border-box-edge",id:"cart-bottom-buttons"};function Eo(e,t,c,l,a,o){return i(),d("div",Lt,[e.visibleSection==="cart"?(i(),d("div",Wt,[s("div",{onClick:t[0]||(t[0]=n=>o.switchTo("cart")),class:"flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold active tab"},[s("span",null,r(o.__("Cart")),1),e.order?(i(),d("span",Jt,r(e.products.length),1)):p("",!0)]),s("div",{onClick:t[1]||(t[1]=n=>o.switchTo("grid")),class:"cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l inactive tab"},r(o.__("Products")),1)])):p("",!0),s("div",Kt,[s("div",Xt,[s("div",Zt,[s("div",es,[s("div",ts,[s("div",ss,[s("button",{onClick:t[2]||(t[2]=n=>o.openNotePopup()),class:"w-full h-10 px-3 outline-hidden"},[t[22]||(t[22]=s("i",{class:"las la-comment"},null,-1)),s("span",os,r(o.__("Comments")),1)])]),s("div",rs,[s("button",{onClick:t[3]||(t[3]=n=>o.selectTaxGroup()),class:"w-full h-10 px-3 outline-hidden flex items-center"},[t[23]||(t[23]=s("i",{class:"las la-balance-scale-left"},null,-1)),s("span",ns,r(o.__("Taxes")),1),e.order.taxes&&e.order.taxes.length>0?(i(),d("span",is,r(e.order.taxes.length),1)):p("",!0)])]),s("div",ds,[s("button",{onClick:t[4]||(t[4]=n=>o.selectCoupon()),class:"w-full h-10 px-3 outline-hidden flex items-center"},[t[24]||(t[24]=s("i",{class:"las la-tags"},null,-1)),s("span",ls,r(o.__("Coupons")),1),e.order.coupons&&e.order.coupons.length>0?(i(),d("span",as,r(e.order.coupons.length),1)):p("",!0)])]),s("div",us,[s("button",{onClick:t[5]||(t[5]=n=>o.defineOrderSettings()),class:"w-full h-10 px-3 outline-hidden flex items-center"},[t[25]||(t[25]=s("i",{class:"las la-tools"},null,-1)),s("span",cs,r(o.__("Settings")),1)])]),e.options.ns_pos_quick_product==="yes"?(i(),d("div",ps,[s("button",{onClick:t[6]||(t[6]=n=>o.openAddQuickProduct()),class:"w-full h-10 px-3 outline-hidden flex items-center"},[t[26]||(t[26]=s("i",{class:"las la-plus"},null,-1)),s("span",_s,r(o.__("Product")),1)])])):p("",!0)])])]),s("div",hs,[s("div",bs,r(o.__("Product")),1),s("div",ms,r(o.__("Quantity")),1),s("div",fs,r(o.__("Total")),1)]),s("div",ys,[e.products.length===0?(i(),d("div",vs,[s("div",xs,[s("h3",null,r(o.__("No products added...")),1)])])):p("",!0),(i(!0),d(g,null,S(e.products,(n,_)=>(i(),d("div",{"product-index":_,key:n.barcode,class:"product-item flex"},[s("div",gs,[s("div",Ps,[s("h3",ks,r(n.name)+" — "+r(n.unit_name),1),s("div",Cs,[s("div",Ss,[s("a",{onClick:h=>o.removeUsingIndex(_),class:"hover:text-error-secondary cursor-pointer outline-hidden border-dashed py-1 border-b border-error-secondary text-sm"},t[27]||(t[27]=[s("i",{class:"las la-trash text-xl"},null,-1)]),8,Ts)]),e.options.ns_pos_allow_wholesale_price&&o.allowQuantityModification(n)?(i(),d("div",Os,[s("a",{class:D([n.mode==="wholesale"?"text-success-secondary border-success-secondary":"border-secondary","cursor-pointer outline-hidden border-dashed py-1 border-b text-sm"]),onClick:h=>o.toggleMode(n,_)},t[28]||(t[28]=[s("i",{class:"las la-award text-xl"},null,-1)]),10,js)])):p("",!0)])]),s("div",qs,[s("div",Ns,[s("div",Ds,[s("a",{onClick:h=>o.changeProductPrice(n),class:D([n.mode==="wholesale"?"text-success-secondary hover:text-success-secondary border-success-secondary":"border-secondary","cursor-pointer outline-hidden border-dashed py-1 border-b text-sm"])},r(o.__("Price"))+" : "+r(o.nsCurrency(n.unit_price)),11,Bs)]),s("div",Fs,[o.allowQuantityModification(n)?(i(),d("a",{key:0,onClick:h=>o.openDiscountPopup(n,"product",_),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},[j(r(o.__("Discount"))+" ",1),n.discount_type==="percentage"?(i(),d("span",Rs,r(n.discount_percentage)+"%",1)):p("",!0),j(" : "+r(o.nsCurrency(n.discount)),1)],8,Vs)):p("",!0)]),s("div",Hs,[o.allowQuantityModification(n)?(i(),d("a",{key:0,onClick:h=>o.changeQuantity(n,_),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Quantity"))+": "+r(n.quantity),9,Qs)):p("",!0)]),s("div",$s,[s("span",As,r(o.__("Total :"))+" "+r(o.nsCurrency(n.total_price)),1)])])])]),s("div",{onClick:h=>o.changeQuantity(n,_),class:D([o.allowQuantityModification(n)?"cursor-pointer ns-numpad-key":"","hidden lg:flex w-1/6 p-2 border-b items-center justify-center"])},[o.allowQuantityModification(n)?(i(),d("span",Ms,r(n.quantity),1)):p("",!0)],10,Es),s("div",Us,r(o.nsCurrency(n.total_price)),1)],8,ws))),128))]),s("div",Is,[e.visibleSection==="both"?(i(),d("table",Ys,[s("tbody",null,[["products_vat"].includes(e.options.ns_pos_vat)?(i(),d("tr",Gs,[s("td",zs,[e.options.ns_pos_price_with_tax==="yes"?(i(),d("span",Ls,r(o.__("Product Taxes (included)")),1)):(i(),d("span",Ws,r(o.__("Product Taxes")),1))]),s("td",Js,r(o.nsCurrency(e.order.products_tax_value)),1)])):p("",!0),s("tr",null,[s("td",Ks,[s("a",{onClick:t[7]||(t[7]=n=>o.selectCustomer()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Customer"))+": "+r(o.customerName),1)]),s("td",Xs,r(o.__("Sub Total")),1),s("td",Zs,r(o.nsCurrency(e.order.subtotal)),1)]),e.order.coupons.length>0?(i(),d("tr",eo,[t[29]||(t[29]=s("td",{width:"200",class:"border p-2"},null,-1)),s("td",to,[s("a",{onClick:t[8]||(t[8]=n=>o.selectCoupon()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Coupons")),1)]),s("td",so,r(o.nsCurrency(o.summarizeCoupons())),1)])):p("",!0),s("tr",null,[s("td",oo,[s("a",{onClick:t[9]||(t[9]=n=>o.openOrderType()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Type"))+": "+r(o.selectedType),1)]),s("td",ro,[s("span",null,r(o.__("Discount")),1),e.order.discount_type==="percentage"?(i(),d("span",no,"("+r(e.order.discount_percentage)+"%)",1)):p("",!0),e.order.discount_type==="flat"?(i(),d("span",io,"("+r(o.__("Flat"))+")",1)):p("",!0)]),s("td",lo,[s("a",{onClick:t[10]||(t[10]=n=>o.openDiscountPopup(e.order,"cart")),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.nsCurrency(e.order.discount)),1)])]),e.order.type&&e.order.type.identifier==="delivery"?(i(),d("tr",ao,[t[30]||(t[30]=s("td",{width:"200",class:"border p-2"},null,-1)),s("td",uo,[s("a",{onClick:t[11]||(t[11]=n=>o.openShippingPopup()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Shipping")),1)]),s("td",co,r(o.nsCurrency(e.order.shipping)),1)])):p("",!0),s("tr",po,[["flat_vat","variable_vat"].includes(e.options.ns_pos_vat)?(i(),d("td",_o,[s("a",{onClick:t[12]||(t[12]=n=>o.openTaxSummary()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(e.order.tax_group.name?e.order.tax_group.name:o.__("Tax"))+": "+r(o.nsCurrency(e.order.tax_value)),1)])):(i(),d("td",ho)),s("td",bo,r(o.__("Total")),1),s("td",mo,r(o.nsCurrency(e.order.total)),1)])])])):p("",!0),e.visibleSection==="cart"?(i(),d("table",fo,[s("tbody",null,[["products_vat"].includes(e.options.ns_pos_vat)?(i(),d("tr",yo,[s("td",vo,[e.options.ns_pos_price_with_tax==="yes"?(i(),d("span",xo,r(o.__("Product Taxes (included)")),1)):(i(),d("span",wo,r(o.__("Product Taxes")),1))]),s("td",go,r(o.nsCurrency(e.order.products_tax_value)),1)])):p("",!0),s("tr",null,[s("td",Po,[s("a",{onClick:t[13]||(t[13]=n=>o.selectCustomer()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Customer"))+": "+r(o.customerName),1)]),s("td",ko,[s("div",Co,[s("span",null,r(o.__("Sub Total")),1),s("span",null,r(o.nsCurrency(e.order.subtotal)),1)])])]),e.order.coupons.length>0?(i(),d("tr",So,[t[31]||(t[31]=s("td",{width:"200",class:"border p-2"},null,-1)),s("td",To,[s("a",{onClick:t[14]||(t[14]=n=>o.selectCoupon()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Coupons")),1)]),s("td",Oo,r(o.nsCurrency(o.summarizeCoupons())),1)])):p("",!0),s("tr",null,[s("td",jo,[s("a",{onClick:t[15]||(t[15]=n=>o.openOrderType()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Type"))+": "+r(o.selectedType),1)]),s("td",qo,[s("div",No,[s("p",null,[s("span",null,r(o.__("Discount")),1),e.order.discount_type==="percentage"?(i(),d("span",Do,"("+r(e.order.discount_percentage)+"%)",1)):p("",!0),e.order.discount_type==="flat"?(i(),d("span",Bo,"("+r(o.__("Flat"))+")",1)):p("",!0)]),s("a",{onClick:t[16]||(t[16]=n=>o.openDiscountPopup(e.order,"cart")),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.nsCurrency(e.order.discount)),1)])])]),e.order.type&&e.order.type.identifier==="delivery"?(i(),d("tr",Fo,[t[33]||(t[33]=s("td",{width:"200",class:"border p-2"},null,-1)),s("td",Vo,[s("a",{onClick:t[17]||(t[17]=n=>o.openShippingPopup()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Shipping")),1),t[32]||(t[32]=s("span",null,null,-1))])])):p("",!0),s("tr",Ro,[s("td",Ho,[e.options.ns_pos_vat!=="disabled"?(i(),d(g,{key:0},[e.order&&e.options.ns_pos_tax_type==="exclusive"?(i(),d(g,{key:0},[e.options.ns_pos_price_with_tax==="yes"?(i(),d("a",{key:0,onClick:t[18]||(t[18]=n=>o.openTaxSummary()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Tax"))+": "+r(o.nsCurrency(e.order.tax_value)),1)):e.options.ns_pos_price_with_tax==="no"?(i(),d("a",{key:1,onClick:t[19]||(t[19]=n=>o.openTaxSummary()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Tax Inclusive"))+": "+r(o.nsCurrency(e.order.tax_value)),1)):p("",!0)],64)):e.order&&e.options.ns_pos_tax_type==="inclusive"?(i(),d(g,{key:1},[e.options.ns_pos_price_with_tax==="yes"?(i(),d("a",{key:0,onClick:t[20]||(t[20]=n=>o.openTaxSummary()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Tax Included"))+": "+r(o.nsCurrency(e.order.tax_value)),1)):e.options.ns_pos_price_with_tax==="no"?(i(),d("a",{key:1,onClick:t[21]||(t[21]=n=>o.openTaxSummary()),class:"cursor-pointer outline-hidden border-dashed py-1 border-b border-secondary text-sm"},r(o.__("Tax Included"))+": "+r(o.nsCurrency(e.order.tax_value)),1)):p("",!0)],64)):p("",!0)],64)):p("",!0)]),s("td",Qo,[s("div",$o,[s("span",null,r(o.__("Total")),1),s("span",null,r(o.nsCurrency(e.order.total)),1)])])])])])):p("",!0)]),s("div",Ao,[Object.keys(e.cartButtons).length===0?(i(!0),d(g,{key:0},S(new Array(4).fill(),n=>(i(),d("div",{class:D([o.takeRandomClass(),"animate-pulse flex-shrink-0 w-1/4 flex items-center font-bold cursor-pointer justify-center border-r flex-auto"])},t[34]||(t[34]=[s("i",{class:"mx-4 rounded-full bg-slate-300 h-5 w-5"},null,-1),s("div",{class:"text-lg mr-4 hidden md:flex md:flex-auto lg:text-2xl"},[s("div",{class:"h-2 flex-auto bg-slate-200 rounded"})],-1)]),2))),256)):p("",!0),(i(!0),d(g,null,S(e.cartButtons,n=>(i(),O(ee(n),{order:e.order,settings:e.settings},null,8,["order","settings"]))),256))])])])])}const tr=P(zt,[["render",Eo]]);export{tr as default};
