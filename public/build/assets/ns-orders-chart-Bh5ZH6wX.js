import{_ as k}from"./lang-BINodpp-.js";import{a as L,n as N}from"./currency-BCJk0SN4.js";import{a as O,B as F,r as M}from"./chart-BXKSDqJb.js";import{k as S,s as B,v as C,bR as V,h as q,D as K,E as U,y as z,at as D,z as H,b8 as j,r as W,c as J,o as P,b as o,t as i,f as R,g as G,a as Q}from"./runtime-core.esm-bundler-DUdZl5j1.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},Y={ariaLabel:{type:String},ariaDescribedby:{type:String}},Z={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...E,...Y},$=V[0]==="2"?(t,s)=>Object.assign(t,{attrs:s}):(t,s)=>Object.assign(t,s);function p(t){return j(t)?D(t):t}function ee(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return j(s)?new Proxy(t,{}):t}function te(t,s){const r=t.options;r&&s&&Object.assign(r,s)}function I(t,s){t.labels=s}function T(t,s,r){const l=[];t.datasets=s.map(a=>{const e=t.datasets.find(n=>n[r]===a[r]);return!e||!a.data||l.includes(e)?{...a}:(l.push(e),Object.assign(e,a),e)})}function se(t,s){const r={labels:[],datasets:[]};return I(r,t.labels),T(r,t.datasets,s),r}const ae=S({props:Z,setup(t,s){let{expose:r,slots:l}=s;const a=q(null),e=B(null);r({chart:e});const n=()=>{if(!a.value)return;const{type:c,data:x,options:_,plugins:h,datasetIdKey:v}=t,b=se(x,v),d=ee(b,x);e.value=new O(a.value,{type:c,data:d,options:{..._},plugins:h})},f=()=>{const c=D(e.value);c&&(t.destroyDelay>0?setTimeout(()=>{c.destroy(),e.value=null},t.destroyDelay):(c.destroy(),e.value=null))},m=c=>{c.update(t.updateMode)};return K(n),U(f),z([()=>t.options,()=>t.data],(c,x)=>{let[_,h]=c,[v,b]=x;const d=D(e.value);if(!d)return;let y=!1;if(_){const u=p(_),g=p(v);u&&u!==g&&(te(d,u),y=!0)}if(h){const u=p(h.labels),g=p(b.labels),w=p(h.datasets),A=p(b.datasets);u!==g&&(I(d.config.data,u),y=!0),w&&w!==A&&(T(d.config.data,w,t.datasetIdKey),y=!0)}y&&H(()=>{m(d)})},{deep:!0}),()=>C("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:a},[C("p",{},[l.default?l.default():""])])}});function oe(t,s){return O.register(s),S({props:E,setup(r,l){let{expose:a}=l;const e=B(null),n=f=>{e.value=f?.chart};return a({chart:e}),()=>C(ae,$({ref:n},{type:t,...r}))}})}const re=oe("bar",F);O.register(...M);const ne={name:"ns-orders-chart",components:{Bar:re},data(){return{totalWeeklySales:0,totalWeekTaxes:0,totalWeekExpenses:0,totalWeekIncome:0,chartData:{labels:["January","February","March"],datasets:[{data:[40,20,12]}]},chartOptions:{theme:{mode:window.ns.theme},chart:{id:"vuechart-example",width:"100%",height:"100%"},stroke:{curve:"smooth",dashArray:[0,8]},xaxis:{categories:[]},colors:["#5f83f3","#AAA"]},series:[{label:k("Current Week"),data:[]},{label:k("Previous Week"),data:[]}],reportSubscription:null,report:null}},methods:{__:k,nsCurrency:N,nsRawCurrency:L,loadReport(){nsHttpClient.get("/api/dashboard/weeks").subscribe({next:t=>{t.result!==void 0&&(this.chartOptions.xaxis.categories=t.result.map(s=>s.label),this.report=t,this.totalWeeklySales=0,this.totalWeekIncome=0,this.totalWeekExpenses=0,this.totalWeekTaxes=0,this.report.result.forEach((s,r)=>{if(s.current!==void 0){const l=s.current.entries.map(e=>e.day_paid_orders);let a=0;l.length>0&&(a=l.reduce((e,n)=>e+n)),this.totalWeekExpenses+=s.current.entries.map(e=>parseFloat(e.day_expenses)).reduce((e,n)=>e+n),this.totalWeekTaxes+=s.current.entries.map(e=>parseFloat(e.day_taxes)).reduce((e,n)=>e+n),this.totalWeekIncome+=s.current.entries.map(e=>parseFloat(e.day_income)).reduce((e,n)=>e+n),this.series[0].data.push(a)}else this.series[0].data.push(0);if(s.previous!==void 0){const l=s.previous.entries.map(e=>e.day_paid_orders);let a=0;l.length>0&&(a=l.reduce((e,n)=>e+n)),this.series[1].data.push(a)}else this.series[1].data.push(0)}),this.totalWeeklySales=this.series[0].data.reduce((s,r)=>s+r),this.chartData.labels=this.report.result.map(s=>s.label),this.chartData.datasets=this.series)}})}},mounted(){this.loadReport()}},le={id:"ns-orders-chart",class:"flex flex-auto flex-col shadow ns-box rounded-lg overflow-hidden"},ce={class:"p-2 flex ns-box-header items-center justify-between border-b"},ie={class:"font-semibold"},de={class:"flex justify-between"},ue={class:"px-1"},pe={class:"px-1"},fe={class:"p-2 ns-box-body border-b"},he={class:"foot -mx-4 flex flex-wrap"},xe={class:"flex w-full lg:w-full py-1 border-b ns-box-body"},_e={class:"px-4 w-1/2 lg:w-1/2 flex flex-col items-center justify-center"},be={class:"text-xs"},ye={class:"text-lg xl:text-xl font-bold"},me={class:"px-4 w-1/2 lg:w-1/2 flex flex-col items-center justify-center"},ve={class:"text-xs"},ge={class:"text-lg xl:text-xl font-bold"},we={class:"flex w-full lg:w-full py-1"},ke={class:"px-4 w-full lg:w-1/2 flex flex-col items-center justify-center"},We={class:"text-xs"},Ce={class:"text-lg xl:text-xl font-bold"},De={class:"px-4 w-full lg:w-1/2 flex flex-col items-center justify-center"},Oe={class:"text-xs"},Pe={class:"text-lg xl:text-xl font-bold"};function Re(t,s,r,l,a,e){const n=W("ns-icon-button"),f=W("ns-close-button"),m=W("Bar");return P(),J("div",le,[o("div",ce,[o("h3",ie,i(e.__("Recents Orders")),1),o("div",de,[o("div",ue,[R(n,{class:"widget-handle",className:"la-expand-arrows-alt"})]),o("div",pe,[R(f,{onClick:s[0]||(s[0]=c=>t.$emit("onRemove"))})])])]),o("div",fe,[a.report?(P(),G(m,{key:0,id:"chart",options:a.chartOptions,data:a.chartData},null,8,["options","data"])):Q("",!0)]),o("div",he,[o("div",xe,[o("div",_e,[o("span",be,i(e.__("Weekly Sales")),1),o("h2",ye,i(e.nsCurrency(a.totalWeeklySales,"abbreviate")),1)]),o("div",me,[o("span",ve,i(e.__("Week Taxes")),1),o("h2",ge,i(e.nsCurrency(a.totalWeekTaxes,"abbreviate")),1)])]),o("div",we,[o("div",ke,[o("span",We,i(e.__("Net Income")),1),o("h2",Ce,i(e.nsCurrency(a.totalWeekIncome,"abbreviate")),1)]),o("div",De,[o("span",Oe,i(e.__("Week Expenses")),1),o("h2",Pe,i(e.nsCurrency(a.totalWeekExpenses,"abbreviate")),1)])])])])}const Te=X(ne,[["render",Re]]);export{Te as default};
