import{b as A,f as N}from"./components-DwXNgVHt.js";import{c as T}from"./runtime-dom.esm-bundler-BXIQQKg6.js";import{n as w,c as B,d as D,N as H,b as R}from"./ns-prompt-popup-Bc23cHDk.js";import{n as z,a as W}from"./ns-orders-preview-popup-DdsBXzCn.js";import{n as $}from"./ns-procurement-quantity-6oMd2GSl.js";import{n as E}from"./currency-DQAAGb0G.js";import{b as y,P as S,d as U,n as Y,p as V,a as M,F as O}from"./bootstrap-BLifOXMN.js";import{_ as a}from"./lang-BINodpp-.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,o as u,c as d,F as x,a as i,t as l,f,n as F,b as q,g as C,w as g,e as h,i as Q,s as I}from"./runtime-core.esm-bundler-CZ21d09l.js";import"./ns-avatar-CZBz4-xP.js";import"./ns-avatar-image-Ckt0xsAT.js";import"./chart-XFVd3zf7.js";const G={name:"ns-products-convertion",props:["popup","unitQuantity","product"],data(){return{unitQuantities:[],isLoading:!1,unitPair:{from:{unit:{},unitQuantity:{},selected:!0,quantity:0,realQuantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]},to:{unit:{},unitQuantity:{},selected:!1,quantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]}},selected:""}},mounted(){this.loadProductQuantities(),console.log(this)},methods:{__:a,async submitConvertion(){if(this.unitPair.from.quantity===0)return y.error(a("The quantity should be greater than 0"));if(Math.floor(this.unitPair.to.quantity)===0)return y.error(a(`The provided quantity can't result in any convertion for unit "{destination}"`).replace("{destination}",this.unitPair.to.unit.name)).subscribe();if(this.unitPair.from.quantity!==this.unitPair.from.realQuantity)try{const e=await new Promise((t,o)=>{S.show(w,{title:a("Conversion Warning"),message:a("Only {quantity}({source}) can be converted to {destinationCount}({destination}). Would you like to proceed ?").replace("{quantity}",this.unitPair.from.realQuantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:p=>{p?t(!0):o(!1)}})});return this.proceedConversionSubmissions()}catch{return}try{const e=await new Promise((t,o)=>{S.show(w,{title:a("Confirm Conversion"),message:a("You're about to convert {quantity}({source}) to {destinationCount}({destination}). Would you like to proceed?").replace("{quantity}",this.unitPair.from.quantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:p=>{p?t(!0):o(!1)}})});return this.proceedConversionSubmissions()}catch{return}},proceedConversionSubmissions(){this.isLoading=!0,nsHttpClient.post(`/api/products/${this.unitQuantity.product_id}/units/conversion`,{from:this.unitPair.from.unit.id,to:this.unitPair.to.unit.id,quantity:this.unitPair.from.realQuantity}).subscribe({next:e=>(this.isLoading=!1,this.popup.close(),this.popup.params.resolve(e),U.success(a("Conversion Successful"),a("The product {product} has been converted successfully.").replace("{product}",this.product.name))),error:e=>(this.isLoading=!1,this.popup.params.reject(e),U.error(a("An error occured"),e.message||a("An error occured while converting the product {product}").replace("{product}",this.product.name)))})},handlePairUnitUpdated(e){const t=this.selectedUnitPair();t.unitQuantity=this.unitQuantities.filter(p=>p.unit.id===e.value)[0],t.unit=t.unitQuantity.unit,t.fields[0].value=e.value;const o=t===this.unitPair.from?this.unitPair.to:this.unitPair.from;o.unit.id===t.unit.id&&(o.unitQuantity=this.unitQuantities.filter(p=>p.unit.id!==t.unit.id)[0],o.unit=o.unitQuantity.unit,o.fields[0].value=o.unit.id),this.updateFromPairQuantity(this.unitPair.from.quantity)},updateFromPairQuantity(e){e.length===0&&(e=0),e>this.unitPair.from.unitQuantity.quantity&&(e=this.unitPair.from.unitQuantity.quantity,y.info(a("The quantity has been set to the maximum available"))),this.unitPair.from.quantity=parseFloat(e);const t=this.unitQuantities.filter(n=>n.unit.base_unit)[0];if(t.length===0)return U.error(a("An error occured"),a("The product {product} has no base unit").replace("{product}",this.product.name));const p=this.unitPair.from.quantity*this.unitPair.from.unit.value*t.unit.value/this.unitPair.to.unit.value;this.unitPair.from.unit.value<this.unitPair.to.unit.value?this.unitPair.from.realQuantity=Math.floor(p)*this.unitPair.to.unit.value:this.unitPair.from.realQuantity=this.unitPair.from.quantity,this.unitPair.to.quantity=p},switchPair(){const e=this.unitPair.from.unit,t=this.unitPair.to.unit;this.unitPair.from.unit=t,this.unitPair.from.unitQuantity=this.unitQuantities.filter(o=>o.unit.id===t.id)[0],this.unitPair.from.quantity=Math.floor(this.unitPair.to.quantity),this.unitPair.to.unit=e,this.unitPair.to.unitQuantity=this.unitQuantities.filter(o=>o.unit.id===e.id)[0],this.updateFromPairQuantity(this.unitPair.from.quantity)},selectedUnitPair(){return this.unitPair[this.unitPair.from.selected?"from":"to"]},setVisible(e,t){const o=t==="from"?"to":"from";e[t].selected=!0,e[o].selected=!1},loadProductQuantities(){nsHttpClient.get("/api/products/"+this.unitQuantity.product_id+"/units/quantities").subscribe({next:e=>{this.unitQuantities=e,this.unitPair.from.unit=this.unitQuantity.unit,this.unitPair.from.unitQuantity=this.unitQuantity,this.unitPair.from.fields[0].value=this.unitQuantity.unit.id,this.unitPair.from.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id})),this.unitPair.to.unit=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0].unit,this.unitPair.to.unitQuantity=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0],this.unitPair.to.fields[0].value=this.unitPair.to.unit.id,this.unitPair.to.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id}))}})}}},J={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},K={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},X={class:"relative"},Z={class:"border-b border-box-edge"},tt={class:"flex"},et={class:"font-bold text-3xl"},it={class:"border-r border-box-edge relative"},st={class:"font-bold text-3xl"},nt={class:"p-2 border-b border-box-edge"},ot={class:""},rt={key:0,class:"top-0 left-0 absolute h-full w-full flex items-center justify-center",style:{background:"rgb(121 121 121 / 20%)"}},at={key:1,class:"flex items-center h-full justify-center"};function ut(e,t,o,p,n,s){const _=c("ns-close-button"),v=c("ns-field"),b=c("ns-numpad"),m=c("ns-spinner");return u(),d("div",J,[n.unitQuantities.length>0?(u(),d(x,{key:0},[i("div",K,[i("div",null,l(s.__("Unit Conversion : {product}").replace("{product}",o.product.name)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>o.popup.close())})])]),i("div",X,[i("div",Z,[i("div",tt,[i("div",{class:F(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",n.unitPair.from.selected?"bg-info-primary text-white":""]),onClick:t[1]||(t[1]=r=>s.setVisible(n.unitPair,"from"))},[i("span",null,l(n.unitPair.from.unit.name),1),i("h3",et,l(n.unitPair.from.quantity),1)],2),i("div",it,[i("div",{class:"rounded-full h-12 w-12 flex items-center justify-center absolute shadow bg-input-button p-2",onClick:t[2]||(t[2]=r=>s.switchPair()),style:{position:"absolute",left:"-22px",top:"14px"}},t[8]||(t[8]=[i("i",{class:"las la-exchange-alt text-3xl"},null,-1)]))]),i("div",{class:F(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",n.unitPair.to.selected?"bg-info-primary text-white":""]),onClick:t[3]||(t[3]=r=>s.setVisible(n.unitPair,"to"))},[i("span",null,l(n.unitPair.to.unit.name),1),i("h3",st,l(Math.floor(n.unitPair.to.quantity)),1)],2)])]),i("div",nt,[(u(!0),d(x,null,q(s.selectedUnitPair().fields,r=>(u(),C(v,{onChange:t[4]||(t[4]=P=>s.handlePairUnitUpdated(P)),field:r},null,8,["field"]))),256))]),i("div",ot,[f(b,{onNext:t[6]||(t[6]=r=>s.submitConvertion()),value:n.unitPair.from.quantity,onChanged:t[7]||(t[7]=r=>s.updateFromPairQuantity(r))},{"numpad-footer":g(()=>[i("div",{onClick:t[5]||(t[5]=r=>s.updateFromPairQuantity(n.unitPair.from.unitQuantity.quantity)),class:"w-full ns-numpad-key h-24 font-bold flex items-center justify-center cursor-pointer col-span-3"},l(s.__("Convert {quantity} available").replace("{quantity}",n.unitPair.from.unitQuantity.quantity)),1)]),_:1},8,["value"])]),n.isLoading?(u(),d("div",rt,[f(m,{size:"24"})])):h("",!0)])],64)):h("",!0),n.unitQuantities.length===0?(u(),d("div",at,[f(m)])):h("",!0)])}const lt=k(G,[["render",ut]]),dt={name:"ns-products-preview",props:["popup","product"],computed:{product(){return this.popup.params.product}},methods:{__:a,nsCurrency:E,changeActiveTab(e){this.active=e,this.active==="units-quantities"&&this.loadProductQuantities()},loadProductQuantities(){console.log("is loadinfg"),this.hasLoadedUnitQuantities=!1,Y.get(`/api/products/${this.product.id}/units/quantities`).subscribe({next:e=>{this.unitQuantities=e,this.hasLoadedUnitQuantities=!0}})},async convert(e,t){try{const o=await new Promise((p,n)=>{Popup.show(lt,{unitQuantity:e,product:t,resolve:p,reject:n})});this.loadProductQuantities()}catch(o){console.log({exception:o})}}},data(){return{active:"units-quantities",unitQuantities:[],hasLoadedUnitQuantities:!1}},mounted(){this.loadProductQuantities()}},ct={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},pt={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},ft={class:"flex-auto overflow-y-auto ns-box-body"},ht={class:"p-2"},mt={key:0,class:"table ns-table w-full"},_t={class:"p-1 border"},vt={width:"150",class:"text-right p-1 border"},bt={width:"150",class:"text-right p-1 border"},yt={width:"150",class:"text-right p-1 border"},Pt={class:"p-1 border text-left"},xt=["onClick"],gt={class:"p-1 border text-right"},wt={class:"p-1 border text-right"},Ct={class:"p-1 border text-right"};function Qt(e,t,o,p,n,s){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-tabs-item"),m=c("ns-tabs");return u(),d("div",ct,[i("div",pt,[i("div",null,l(s.__("Previewing :"))+" "+l(s.product.name),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>o.popup.close())})])]),i("div",ft,[i("div",ht,[f(m,{active:n.active,onActive:t[1]||(t[1]=r=>s.changeActiveTab(r))},{default:g(()=>[f(b,{label:s.__("Units & Quantities"),identifier:"units-quantities"},{default:g(()=>[n.hasLoadedUnitQuantities?(u(),d("table",mt,[i("thead",null,[i("tr",null,[i("th",_t,l(s.__("Unit")),1),i("th",vt,l(s.__("Sale Price")),1),i("th",bt,l(s.__("Wholesale Price")),1),i("th",yt,l(s.__("Quantity")),1)])]),i("tbody",null,[(u(!0),d(x,null,q(n.unitQuantities,r=>(u(),d("tr",{key:r.id},[i("td",Pt,[Q(l(r.unit.name)+" ",1),s.product.rawType==="materialized"&&s.product.rawStockManagement==="enabled"?(u(),d(x,{key:0},[t[2]||(t[2]=Q(" — ")),i("a",{onClick:P=>s.convert(r,s.product),class:"text-sm text-info-secondary hover:underline border-dashed",href:"javascript:void(0)"},l(s.__("Convert")),9,xt)],64)):h("",!0)]),i("td",gt,l(s.nsCurrency(r.sale_price)),1),i("td",wt,l(s.nsCurrency(r.wholesale_price)),1),i("td",Ct,l(r.quantity),1)]))),128))])])):h("",!0),n.hasLoadedUnitQuantities?h("",!0):(u(),C(v,{key:1,size:"16",border:"4"}))]),_:1},8,["label"])]),_:1},8,["active"])])])])}const kt=k(dt,[["render",Qt]]),qt={name:"ns-drivers-status-popup",props:["popup","row","component"],methods:{__:a,popupCloser:V,popupResolver:M,loadDriverStatusFields(){nsHttpClient.get("/api/fields/driver-status-fields").subscribe({next:e=>{this.loaded=!0,this.fields=this.validation.createFields(e)},error:e=>{this.loaded=!0,y.error(e.message),this.errorMessage=e.message}})},changeStatus(){this.validation.validateFields(this.fields)?Popup.show(w,{title:a("Confirm Your Action"),message:a("Are you sure you want to change the status of the driver?"),onAction:e=>{nsHttpClient.post(`/api/drivers/${this.row.id}/status`,this.validation.extractFields(this.fields)).subscribe({next:t=>{y.success(t.message),this.popupResolver(!0),this.component.$emit("reload")},error:t=>y.error(t.message)})}}):y.error(a("Make sure to choose a status for the driver."))}},data(){return{loaded:!1,validation:new O,fields:[],errorMessage:""}},mounted(){console.log(this.row),this.popupCloser(),this.loadDriverStatusFields()}},Ut={class:"shadow ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw]"},St={class:"p-2 flex justify-between items-center ns-box-header border-b"},jt={class:"ns-box-body"},At={key:0,class:"py-4 flex justify-center items-center"},Ft={key:2,class:"p-2"},Lt={class:"border-t ns-box-footer p-2 flex justify-end"};function Vt(e,t,o,p,n,s){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-notice"),m=c("ns-field"),r=c("ns-button");return u(),d("div",Ut,[i("div",St,[i("h3",null,l(s.__("Driver: {name}").replace("{name}",o.row.username)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=P=>s.popupResolver(!1))})])]),i("div",jt,[n.loaded?h("",!0):(u(),d("div",At,[f(v)])),n.errorMessage?(u(),C(b,{key:1,color:"error"},{description:g(()=>[Q(l(n.errorMessage),1)]),_:1})):(u(),d("div",Ft,[(u(!0),d(x,null,q(n.fields,P=>(u(),C(m,{field:P},null,8,["field"]))),256))]))]),i("div",Lt,[f(r,{onClick:t[1]||(t[1]=P=>s.changeStatus())},{default:g(()=>[Q(l(s.__("Change Status")),1)]),_:1})])])}const Mt=k(qt,[["render",Vt]]),Ot={name:"foo-bar",methods:{__:a,popupResolver:M,popupCloser:V,updateOrder(){S.show(w,{title:a("Are you sure?"),message:a("Are you sure you want to update the order?"),onAction:()=>{nsHttpClient.post(`/api/drivers/order/${this.order.id}`,{order:this.order}).subscribe({next:e=>{this.loaded=!0,nsSnackBar.success(a("Order updated successfully")),this.popupResolver(!1)},error:e=>{this.loaded=!0,nsSnackBar.error(e.message)}})}})},loadFields(){this.loaded=!1,nsHttpClient.get("/api/fields/ns.order-delivery-proof").subscribe({next:e=>{this.loaded=!0,this.fields=this.validation.createFields(e)},error:e=>{this.loaded=!0,nsSnackBar.error(e.message)}})}},data(){return{fields:[],validation:new O,loaded:!1}},mounted(){this.loadFields()},props:["order","popup"]},Nt={class:"ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw] h-[95vh] md:h-[80vh] shadow flex flex-col"},Tt={class:"p-2 flex justify-between items-center ns-box-header border-b"},Bt={class:"box-body overflow-y-auto flex-auto"},Dt={key:0,class:"py-4 flex justify-center items-center"},Ht={key:1,class:"p-2"},Rt={class:"border-t ns-box-footer p-2 flex justify-end"};function zt(e,t,o,p,n,s){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-field"),m=c("ns-button");return u(),d("div",Nt,[i("div",Tt,[i("h3",null,l(s.__("Order: {name}").replace("{name}",o.order.code)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>s.popupResolver(!1))})])]),i("div",Bt,[n.loaded?h("",!0):(u(),d("div",Dt,[f(v)])),n.fields.length>0?(u(),d("div",Ht,[(u(!0),d(x,null,q(n.fields,r=>(u(),C(b,{field:r},null,8,["field"]))),256))])):h("",!0)]),i("div",Rt,[f(m,{onClick:t[1]||(t[1]=r=>s.updateOrder())},{default:g(()=>[Q(l(s.__("Save")),1)]),_:1})])])}const Wt=k(Ot,[["render",zt]]),L={nsOrderPreview:z,nsProductPreview:kt,nsAlertPopup:B,nsConfirmPopup:w,nsPromptPopup:D,nsMediaPopup:N,nsProcurementQuantity:$,nsOrdersRefund:W,nsSelectPopup:H,nsPOSLoadingPopup:R,nsDriversStatusPopup:Mt,NsDriversOrdersPopup:Wt};for(let e in L)window[e]=L[e];const j=T({data(){return{popups:[],defaultClass:"absolute top-0 left-0 w-full h-full items-center flex overflow-y-auto justify-center is-popup"}},mounted(){nsState.subscribe(e=>{e.popups!==void 0&&(document.body.focus(),this.popups=I(e.popups),this.$forceUpdate())})},methods:{closePopup(e,t){(Object.values(t.target.classList).includes("is-popup")&&e.config!==void 0&&[void 0,!0].includes(e.config.closeOnOverlayClick)||Object.keys(e.config).length===0)&&(e.params&&typeof e.params.reject=="function"?(e.params.reject(!1),typeof e.close=="function"&&e.close(),t.stopPropagation()):e.close())},preventPropagation(e){e.stopImmediatePropagation()}}});for(let e in A)j.component(e,A[e]);document.addEventListener("DOMContentLoaded",()=>{j.mount("#dashboard-popups"),window.nsPopups=j});
