import{p as P,a as T,b as x,n as f}from"./bootstrap-DvrUD7Mb.js";import{s as j}from"./pos-section-switch-DmfccXVX.js";import{_ as p}from"./lang-BINodpp-.js";import{n as q}from"./ns-reorder-popup.vue_vue_type_style_index_0_scoped_9fc0b535_lang-Cphpi6v3.js";import{v as k,w as I}from"./runtime-dom.esm-bundler-hZM9novS.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as y,c as n,o as l,b as t,t as d,f as w,B as S,a as h,F as _,e as g,n as b,i as v,w as O}from"./runtime-core.esm-bundler-_WxxsGY5.js";import{n as V}from"./currency-D3_TCvZd.js";import"./chart--HL2-LwL.js";const L={name:"ns-pos-search-product",props:["popup"],data(){return{searchValue:"",products:[],isLoading:!1,debounce:null}},watch:{searchValue(){clearTimeout(this.debounce),this.debounce=setTimeout(()=>{this.search()},500)}},mounted(){this.$refs.searchField.focus(),this.$refs.searchField.addEventListener("keydown",i=>{i.keyCode===27&&this.popupResolver(!1)}),this.popupCloser()},methods:{__:p,popupCloser:T,popupResolver:P,addToCart(i){if(this.popup.close(),parseInt(i.accurate_tracking)===1)return Popup.show(q,{title:p("Unable to add the product"),message:p(`The product "{product}" can't be added from a search field, as "Accurate Tracking" is enabled. Would you like to learn more ?`).replace("{product}",i.name),onAction:e=>{e&&window.open("https://my.nexopos.com/en/documentation/troubleshooting/accurate-tracking","_blank")}});POS.addToCart(i)},search(){this.isLoading=!0,x.post("/api/products/search",{search:this.searchValue}).subscribe({next:i=>{if(this.isLoading=!1,this.products=i,this.products.length===1&&this.addToCart(this.products[0]),this.products.length===0)return f.info(p("No result to result match the search value provided."))},error:i=>{this.isLoading=!1,f.error(i.message)}})}}},H={id:"product-search",class:"ns-box shadow-lg w-95vw h-95vh md:h-[60vh] md:w-half flex flex-col overflow-hidden"},N={class:"p-2 border-b ns-box-header flex justify-between items-center"},F={class:"text-fontcolor"},W={class:"flex-auto overflow-hidden flex flex-col"},U={class:"p-2 border-b ns-box-body"},B={class:"flex input-group info border-2 rounded overflow-hidden"},z={class:"overflow-y-auto ns-scrollbar flex-auto relative"},A={class:"ns-vertical-menu"},D=["onClick"],E={class:""},M={class:"text-fontcolor"},Q={class:"text-soft-secondary text-xs"},G={key:0},J={class:"text-fontcolor text-center p-2"},K={key:1,class:"absolute h-full w-full flex items-center justify-center z-10 top-0",style:{background:"rgb(187 203 214 / 29%)"}};function R(i,e,c,a,o,r){const m=y("ns-close-button"),s=y("ns-spinner");return l(),n("div",H,[t("div",N,[t("h3",F,d(r.__("Search Product")),1),t("div",null,[w(m,{onClick:e[0]||(e[0]=u=>c.popup.close())})])]),t("div",W,[t("div",U,[t("div",B,[S(t("input",{onKeyup:e[1]||(e[1]=I(u=>r.search(),["enter"])),"onUpdate:modelValue":e[2]||(e[2]=u=>o.searchValue=u),ref:"searchField",type:"text",class:"p-2 outline-hidden flex-auto text-font"},null,544),[[k,o.searchValue]]),t("button",{onClick:e[3]||(e[3]=u=>r.search()),class:"px-2"},d(r.__("Search")),1)])]),t("div",z,[t("ul",A,[(l(!0),n(_,null,g(o.products,u=>(l(),n("li",{key:u.id,onClick:Xe=>r.addToCart(u),class:"cursor-pointer p-2 flex justify-between border-b"},[t("div",E,[t("h2",M,d(u.name),1),t("small",Q,d(u.category.name),1)]),e[4]||(e[4]=t("div",null,null,-1))],8,D))),128))]),o.products.length===0?(l(),n("ul",G,[t("li",J,d(r.__("There is nothing to display. Have you started the search ?")),1)])):h("",!0),o.isLoading?(l(),n("div",K,[w(s)])):h("",!0)])])])}const X=C(L,[["render",R]]),Y={name:"ns-pos-grid",data(){return{items:Array.from({length:1e3},(i,e)=>({data:"#"+e})),products:[],pinnedProducts:[],cartProductsSubscribe:null,cartProducts:[],categories:[],breadcrumbs:[],barcode:"",previousCategory:null,order:null,visibleSection:null,breadcrumbsSubsribe:null,orderSubscription:null,visibleSectionSubscriber:null,currentCategory:null,settings:{},settingsSubscriber:null,options:!1,optionsSubscriber:null,interval:null,searchTimeout:null,gridItemsWidth:0,gridItemsHeight:0,isLoading:!1}},computed:{hasCategories(){return this.categories.length>0},hasProducts(){return this.products.length>0},createCategoryUrl(){return POS.settings.getValue().urls.categories_url}},watch:{options:{handler(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))},deep:!0},barcode(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))}},mounted(){this.loadCategories(),this.settingsSubscriber=POS.settings.subscribe(i=>{this.settings=i,this.$forceUpdate()}),this.optionsSubscriber=POS.options.subscribe(i=>{this.options=i,this.$forceUpdate()}),this.breadcrumbsSubsribe=POS.breadcrumbs.subscribe(i=>{this.breadcrumbs=i,this.$forceUpdate()}),this.visibleSectionSubscriber=POS.visibleSection.subscribe(i=>{this.visibleSection=i,this.$forceUpdate()}),this.cartProductsSubscribe=POS.products.subscribe(i=>{this.cartProducts=i,this.$forceUpdate()}),this.orderSubscription=POS.order.subscribe(i=>this.order=i),this.interval=setInterval(()=>this.checkFocus(),500);for(let i in nsShortcuts)["ns_pos_keyboard_quick_search"].includes(i)&&nsHotPress.create("search-popup").whenNotVisible([".is-popup","#product-search"]).whenPressed(nsShortcuts[i]!==null?nsShortcuts[i].join("+"):null,e=>{e.preventDefault(),this.openSearchPopup()}),["ns_pos_keyboard_toggle_merge"].includes(i)&&nsHotPress.create("toggle-merge").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[i]!==null?nsShortcuts[i].join("+"):null,e=>{e.preventDefault(),this.posToggleMerge()})},unmounted(){this.orderSubscription.unsubscribe(),this.breadcrumbsSubsribe.unsubscribe(),this.visibleSectionSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe(),this.optionsSubscriber.unsubscribe(),this.cartProductsSubscribe.unsubscribe(),clearInterval(this.interval),nsHotPress.destroy("search-popup"),nsHotPress.destroy("toggle-merge")},methods:{__:p,nsCurrency:V,switchTo:j,posToggleMerge(){POS.set("ns_pos_items_merge",!this.settings.ns_pos_items_merge)},computeGridWidth(){document.getElementById("grid-items")!==null&&(this.gridItemsWidth=document.getElementById("grid-items").offsetWidth,this.gridItemsHeight=document.getElementById("grid-items").offsetHeight)},cellSizeAndPositionGetter(i,e){const c={xs:{width:this.gridItemsWidth/2,items:2,height:200},sm:{width:this.gridItemsWidth/2,items:2,height:200},md:{width:this.gridItemsWidth/3,items:3,height:150},lg:{width:this.gridItemsWidth/4,items:4,height:150},xl:{width:this.gridItemsWidth/6,items:6,height:150}},a=c[POS.responsive.screenIs].width,o=c[POS.responsive.screenIs].height,r=0;return{width:a-r,height:o,x:e%c[POS.responsive.screenIs].items*a-r,y:parseInt(e/c[POS.responsive.screenIs].items)*o}},openSearchPopup(){Popup.show(X)},hasNoFeatured(i){return i.galleries&&i.galleries.length>0&&i.galleries.filter(e=>e.featured).length===0},submitSearch(i){if(i.length>0){const e=nsHooks.applyFilters("ns-pos-submit-search-url",`/api/products/search/using-barcode/${i}`,i);x.get(e).subscribe({next:c=>{this.barcode="";const a={};if(a.name=c.product.name,a.id=c.product.id,a.product_type=c.product.product_type,a.rate=c.product.rate,a.tax_group_id=c.product.tax_group_id,a.tax_type=c.product.tax_type,a.unit_id=c.unit.id,a.unit_price=c.unitQuantity.sale_price,a.price_with_tax=c.unitQuantity.sale_price_with_tax,a.price_without_tax=c.unitQuantity.sale_price_without_tax,a.unit_name=c.unit.name,c.scale){const o=c.scale;if(o.type==="weight"){a.quantity=o.value;const r=o.unit?.name||"kg";f.info(p("Scale barcode detected: {weight} {unit}").replace("{weight}",o.value.toFixed(3)).replace("{unit}",r))}else if(o.type==="price"){const r=c.product.selectedUnitQuantity?.sale_price||c.product.unit_quantities[0]?.sale_price||0;r>0&&(a.quantity=o.value/r),f.info(p("Scale barcode detected: {price}").replace("{price}",this.nsCurrency(o.value)))}}console.log(JSON.parse(JSON.stringify(a))),POS.addToCart(a)},error:c=>{this.barcode="",f.error(c.message)}})}},checkFocus(){this.options.ns_pos_force_autofocus&&document.querySelectorAll(".is-popup").length===0&&this.$refs.search.focus()},loadCategories(i){this.isLoading=!0,x.get(`/api/categories/pos/${i?i.id:""}`).subscribe({next:e=>{this.categories=e.categories,this.products=e.products,this.pinnedProducts=e.pinnedProducts||[],this.previousCategory=e.previousCategory,this.currentCategory=e.currentCategory,this.updateBreadCrumb(this.currentCategory),this.isLoading=!1},error:e=>(this.isLoading=!1,f.error(p("An unexpected error occurred.")))})},updateBreadCrumb(i){if(i){const e=this.breadcrumb.filter(c=>c.id===i.id);if(e.length>0){let c=!0;const a=this.breadcrumb.filter(o=>o.id===e[0].id&&c?(c=!1,!0):c);this.breadcrumb=a}else this.breadcrumb.push(i)}else this.breadcrumb=[];POS.breadcrumbs.next(this.breadcrumb)},addToTheCart(i){POS.addToCart(i)}}},Z={id:"pos-grid",class:"flex-auto flex flex-col overflow-hidden"},$={key:0,id:"tools",class:"flex pl-2"},ee={key:0,class:"products-count flex items-center justify-center text-sm rounded-full h-6 w-6 ml-1"},se={id:"grid-container",class:"rounded shadow overflow-hidden flex-auto flex flex-col"},te={id:"grid-header",class:"p-2 border-b"},ie={class:"border rounded flex overflow-hidden"},re=["title"],oe=["title"],ne=["title"],le={style:{height:"0px"}},ce={key:0,class:"fade-in-entrance ns-loader"},ae={id:"grid-breadcrumb",class:"p-2"},ue={class:"flex"},de=["onClick"],he={key:0,id:"pinned-products"},_e={class:"overflow-x-hidden pinned-wrapper"},pe={class:"shadow-sm grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 divide-x-1 divide-y-1 divide-solid divide-pos-button-edge flex-nowrap flex items-center"},fe=["onClick"],ge={key:0,class:"h-full w-full flex items-center justify-center overflow-hidden"},me=["src","alt"],be=["src","alt"],ve={key:2,class:"las la-image text-6xl"},xe={class:"w-full absolute z-10 -bottom-10"},ye={class:"cell-item-label relative w-full flex flex-col items-center justify-center -top-10 h-20 p-2"},we={class:"text-sm text-center w-full"},ke={key:0,class:"text-sm"},Ce={key:0,class:"text-sm"},Se={key:0,class:"text-sm"},Pe={id:"grid-items",class:"overflow-y-auto h-full flex-col flex"},Te={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},je=["onClick"],qe={class:"h-full w-full flex items-center justify-center"},Ie=["src","alt"],Oe={key:1,class:"las la-image text-6xl"},Ve={class:"w-full absolute z-10 -bottom-10"},Le={class:"cell-item-label relative w-full flex items-center justify-center -top-10 h-20 py-2"},He={class:"text-sm font-bold py-2 text-center"},Ne={key:1,class:"h-full w-full flex flex-col items-center justify-center"},Fe={class:"w-1/2 md:w-2/3 text-center text-font"},We={key:2,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Ue=["onClick"],Be={class:"h-full w-full flex items-center justify-center overflow-hidden"},ze=["src","alt"],Ae=["src","alt"],De={key:2,class:"las la-image text-6xl"},Ee={class:"w-full absolute z-10 -bottom-10"},Me={class:"cell-item-label relative w-full flex flex-col items-center justify-center -top-10 h-20 p-2"},Qe={class:"text-sm text-center w-full"},Ge={key:0,class:"text-sm"},Je={key:0,class:"text-sm"},Ke={key:0,class:"text-sm"};function Re(i,e,c,a,o,r){const m=y("ns-link");return l(),n("div",Z,[o.visibleSection==="grid"?(l(),n("div",$,[t("div",{onClick:e[0]||(e[0]=s=>r.switchTo("cart")),class:"switch-cart flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l"},[t("span",null,d(r.__("Cart")),1),o.order?(l(),n("span",ee,d(o.cartProducts.length),1)):h("",!0)]),t("div",{onClick:e[1]||(e[1]=s=>r.switchTo("grid")),class:"switch-grid cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold"},d(r.__("Products")),1)])):h("",!0),t("div",se,[t("div",te,[t("div",ie,[t("button",{title:r.__("Search for products."),onClick:e[2]||(e[2]=s=>r.openSearchPopup()),class:"w-10 h-10 border-r outline-hidden"},[...e[7]||(e[7]=[t("i",{class:"las la-search"},null,-1)])],8,re),t("button",{title:r.__("Toggle merging similar products."),onClick:e[3]||(e[3]=s=>r.posToggleMerge()),class:b([o.settings.ns_pos_items_merge?"pos-button-clicked":"","outline-hidden w-10 h-10 border-r"])},[...e[8]||(e[8]=[t("i",{class:"las la-compress-arrows-alt"},null,-1)])],10,oe),t("button",{title:r.__("Toggle auto focus."),onClick:e[4]||(e[4]=s=>o.options.ns_pos_force_autofocus=!o.options.ns_pos_force_autofocus),class:b([o.options.ns_pos_force_autofocus?"pos-button-clicked":"","outline-hidden w-10 h-10 border-r"])},[...e[9]||(e[9]=[t("i",{class:"las la-barcode"},null,-1)])],10,ne),S(t("input",{ref:"search","onUpdate:modelValue":e[5]||(e[5]=s=>o.barcode=s),type:"text",class:"flex-auto outline-hidden px-2"},null,512),[[k,o.barcode]])])]),t("div",le,[o.isLoading?(l(),n("div",ce,[...e[10]||(e[10]=[t("div",{class:"bar"},null,-1)])])):h("",!0)]),t("div",ae,[t("ul",ue,[t("li",null,[t("a",{onClick:e[6]||(e[6]=s=>r.loadCategories()),href:"javascript:void(0)",class:"px-3"},d(r.__("Home")),1),e[11]||(e[11]=v()),e[12]||(e[12]=t("i",{class:"las la-angle-right"},null,-1))]),t("li",null,[(l(!0),n(_,null,g(o.breadcrumbs,s=>(l(),n("a",{onClick:u=>r.loadCategories(s),key:s.id,href:"javascript:void(0)",class:"px-3"},[v(d(s.name)+" ",1),e[13]||(e[13]=t("i",{class:"las la-angle-right"},null,-1))],8,de))),128))])])]),o.options.ns_pos_enable_pinned_products&&o.pinnedProducts.length>0?(l(),n("div",he,[t("div",_e,[t("div",pe,[(l(!0),n(_,null,g(o.pinnedProducts,s=>(l(),n("div",{onClick:u=>r.addToTheCart(s),key:s.id,class:b([o.options.ns_pos_show_preview_pinned_products?"h-36":"h-20 small-pinned-product","cursor-pointer flex flex-col items-center relativ justify-center overflow-hidden relative flex-shrink-0"])},[o.options.ns_pos_show_preview_pinned_products?(l(),n("div",ge,[s.galleries&&s.galleries.filter(u=>u.featured).length>0?(l(),n("img",{key:0,src:s.galleries.filter(u=>u.featured)[0].url,class:"object-cover h-full",alt:s.name},null,8,me)):r.hasNoFeatured(s)?(l(),n("img",{key:1,src:s.galleries[0].url,class:"object-cover h-full",alt:s.name},null,8,be)):(l(),n("i",ve))])):h("",!0),t("div",xe,[t("div",ye,[t("h3",we,d(s.name),1),o.options.ns_pos_vat==="disabled"?(l(),n(_,{key:0},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",ke,d(r.nsCurrency(s.unit_quantities[0].sale_price_with_tax)),1)):h("",!0)],64)):o.options.ns_pos_gross_price_used?(l(),n(_,{key:1},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",Ce,d(r.nsCurrency(s.unit_quantities[0].sale_price_without_tax)),1)):h("",!0)],64)):o.options.ns_pos_gross_price_used==="no"?(l(),n(_,{key:2},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",Se,d(r.nsCurrency(s.unit_quantities[0].sale_price_with_tax)),1)):h("",!0)],64)):h("",!0)])])],10,fe))),128))])])])):h("",!0),t("div",Pe,[r.hasCategories?(l(),n("div",Te,[(l(!0),n(_,null,g(o.categories,s=>(l(),n("div",{onClick:u=>r.loadCategories(s),key:s.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[t("div",qe,[s.preview_url?(l(),n("img",{key:0,src:s.preview_url,class:"object-cover h-full",alt:s.name},null,8,Ie)):h("",!0),s.preview_url?h("",!0):(l(),n("i",Oe))]),t("div",Ve,[t("div",Le,[t("h3",He,d(s.name),1)])])],8,je))),128))])):h("",!0),!r.hasCategories&&!r.hasProducts&&!o.isLoading?(l(),n("div",Ne,[e[14]||(e[14]=t("i",{class:"las la-frown-open text-8xl text-font"},null,-1)),t("p",Fe,d(r.__("Looks like there is either no products and no categories. How about creating those first to get started ?")),1),e[15]||(e[15]=t("br",null,null,-1)),w(m,{target:"blank",type:"info",href:r.createCategoryUrl},{default:O(()=>[v(d(r.__("Create Categories")),1)]),_:1},8,["href"])])):h("",!0),r.hasCategories?h("",!0):(l(),n("div",We,[(l(!0),n(_,null,g(o.products,s=>(l(),n("div",{onClick:u=>r.addToTheCart(s),key:s.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[t("div",Be,[s.galleries&&s.galleries.filter(u=>u.featured).length>0?(l(),n("img",{key:0,src:s.galleries.filter(u=>u.featured)[0].url,class:"object-cover h-full",alt:s.name},null,8,ze)):r.hasNoFeatured(s)?(l(),n("img",{key:1,src:s.galleries[0].url,class:"object-cover h-full",alt:s.name},null,8,Ae)):(l(),n("i",De))]),t("div",Ee,[t("div",Me,[t("h3",Qe,d(s.name),1),o.options.ns_pos_vat==="disabled"?(l(),n(_,{key:0},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",Ge,d(r.nsCurrency(s.unit_quantities[0].sale_price_with_tax)),1)):h("",!0)],64)):o.options.ns_pos_gross_price_used?(l(),n(_,{key:1},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",Je,d(r.nsCurrency(s.unit_quantities[0].sale_price_without_tax)),1)):h("",!0)],64)):o.options.ns_pos_gross_price_used==="no"?(l(),n(_,{key:2},[s.unit_quantities&&s.unit_quantities.length===1?(l(),n("span",Ke,d(r.nsCurrency(s.unit_quantities[0].sale_price_with_tax)),1)):h("",!0)],64)):h("",!0)])])],8,Ue))),128))]))])])])}const ns=C(Y,[["render",Re]]);export{ns as default};
