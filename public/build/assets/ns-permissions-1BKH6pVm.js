import{g as _,i as k,b as m,n as v}from"./bootstrap-JIFfECv7.js";import{_ as p}from"./lang-BINodpp-.js";import{v as y}from"./runtime-dom.esm-bundler-DaZ-XdMB.js";import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as w,c as o,o as a,b as t,B as P,F as f,e as h,f as x,t as u}from"./runtime-core.esm-bundler-D4l6Snf1.js";import"./currency-COpKd-rX.js";import"./chart-CFvJmF2u.js";const j={name:"ns-permissions",filters:[_],data(){return{permissions:[],roles:[],searchText:"",showRoleSelector:!1}},computed:{filteredPermissions(){return this.searchText.length!==0?this.permissions.filter(e=>{const s=new RegExp(this.searchText,"i");return s.test(e.name)||s.test(e.namespace)}):this.permissions},visibleRoles(){return this.roles.filter(e=>e.visible)}},mounted(){this.loadPermissionsAndRoles(),nsHotPress.create("ns-permissions").whenPressed("shift+/",e=>{this.searchText="",setTimeout(()=>{this.$refs.search.focus()},5)}).whenPressed("/",e=>{this.searchText="",setTimeout(()=>{this.$refs.search.focus()},5)})},methods:{__:p,copyPermisson(e){navigator.clipboard.writeText(e).then(function(){v.success(p("Copied to clipboard"),null,{duration:3e3})},function(s){console.error("Could not copy text: ",s)})},async selectAllPermissions(e){const s=new Object;s[e.namespace]=new Object;let r=!1;if(e.locked&&(r=await new Promise((c,l)=>{Popup.show(nsConfirmPopup,{title:p("Confirm Your Action"),message:p("Would you like to bulk edit a system role ?"),onAction:n=>c(!!n)})})),!e.locked||e.locked&&r){const c=this.filterObjectByKeys(e.fields,this.filteredPermissions.map(l=>l.namespace));for(let l in c)e.fields[l].value=e.field.value,s[e.namespace][l]=e.field.value;this.arrayToObject(this.filteredPermissions,"namespace",l=>s[e.namespace][l.namespace]),m.put("/api/users/roles",s).subscribe(l=>{v.success(l.message,null,{duration:3e3})})}else e.field.value=!e.field.value},filterObjectByKeys(e,s){return Object.fromEntries(Object.entries(e).filter(([r])=>s.includes(r)))},arrayToObject(e,s,r){return Object.assign({},...e.map(c=>({[c[s]]:r(c)})))},submitPermissions(e,s){const r=new Object;r[e.namespace]=new Object,r[e.namespace][s.name]=s.value,m.put("/api/users/roles",r).subscribe(c=>{v.success(c.message,null,{duration:3e3})})},selectAllRoles(){this.roles.forEach(e=>{e.visible=!0})},unselectAllRoles(){this.roles.forEach(e=>{e.visible=!1})},loadPermissionsAndRoles(){return k([m.get("/api/users/roles"),m.get("/api/users/permissions")]).subscribe(e=>{this.permissions=e[1],this.roles=e[0].map(s=>(s.fields={},s.visible=!0,s.field={type:"checkbox",name:s.namespace,value:!1},this.permissions.forEach(r=>{s.fields[r.namespace]={type:"checkbox",value:s.permissions.filter(c=>c.namespace===r.namespace).length>0,name:r.namespace,label:null}}),s))})}}},C={id:"permission-wrapper"},R={class:"my-2"},T=["placeholder"],A={class:"ns-box mb-2 rounded"},O={class:"ns-box-body p-1 flex flex-wrap"},S=["label"],B=["onClick"],E={class:"flex justify-end p-2 text-xs"},H={class:"-mx-2 flex"},V={class:"px-2"},D={class:"px-2"},F={class:"px-2"},K={key:1},N={class:"p-2 text-xs"},U={class:"rounded shadow ns-box flex"},J={id:"permissions",class:"w-54 bg-gray-800 flex-shrink-0"},L={class:"h-[50px] pl-[10px] border-b border-gray-700 text-fontcolor flex justify-between items-center"},M=["onClick","title"],W={class:"text-xs"},Y={class:"flex flex-auto overflow-hidden"},q={class:"overflow-y-auto"},z={class:"text-gray-700 flex h-[50px]"},G={class:"mx-1 text-center"},I={class:"mx-1"};function Q(e,s,r,c,l,n){const b=w("ns-checkbox");return a(),o("div",C,[t("div",R,[P(t("input",{ref:"search","onUpdate:modelValue":s[0]||(s[0]=i=>l.searchText=i),type:"text",placeholder:n.__('Press "/" to search permissions'),class:"border-2 p-2 w-full outline-hidden bg-input-background border-secondary text-fontcolor"},null,8,T),[[y,l.searchText]])]),t("div",A,[l.showRoleSelector?(a(),o(f,{key:0},[t("div",O,[(a(!0),o(f,null,h(l.roles,i=>(a(),o("div",{label:i.name,class:"mr-4 mb-2 flex"},[t("label",{onClick:d=>i.visible=!i.visible,class:"mr-1"},u(i.name),9,B),x(b,{onChange:d=>i.visible=d,checked:i.visible},null,8,["onChange","checked"])],8,S))),256))]),t("div",E,[t("div",H,[t("div",V,[t("a",{href:"javascript:void(0)",class:"hover:underline",onClick:s[1]||(s[1]=i=>n.selectAllRoles())},u(n.__("Select All")),1)]),t("div",D,[t("a",{href:"javascript:void(0)",class:"hover:underline",onClick:s[2]||(s[2]=i=>n.unselectAllRoles())},u(n.__("Unselect All")),1)]),t("div",F,[t("a",{href:"javascript:void(0)",onClick:s[3]||(s[3]=i=>l.showRoleSelector=!1),class:"hover:underline ns-link"},u(n.__("Hide Roles")),1)])])])],64)):(a(),o("div",K,[t("div",N,[t("a",{href:"javascript:void(0)",class:"hover:underline ns-link",onClick:s[4]||(s[4]=i=>l.showRoleSelector=!0)},u(n.__("Show Roles")),1)])]))]),t("div",U,[t("div",J,[t("div",L,[t("span",null,u(n.__("Permissions")),1)]),(a(!0),o(f,null,h(n.filteredPermissions,i=>(a(),o("div",{key:i.id,class:"w-54 h-[40px] flex items-center pl-[10px] border-b border-table-th-edge text-fontcolor"},[t("a",{onClick:d=>n.copyPermisson(i.namespace),href:"javascript:void(0)",title:i.namespace},[t("span",W,u(i.name),1)],8,M)]))),128))]),t("div",Y,[t("div",q,[t("div",z,[(a(!0),o(f,null,h(n.visibleRoles,i=>(a(),o("div",{key:i.id,class:"w-32 shrink-0 items-center border-b justify-center flex flex-col role text-xs border-r border-table-th-edge text-fontcolor"},[t("p",G,[t("span",null,u(i.name),1)]),t("span",I,[x(b,{onChange:d=>n.selectAllPermissions(i),field:i.field},null,8,["onChange","field"])])]))),128))]),(a(!0),o(f,null,h(n.filteredPermissions,i=>(a(),o("div",{key:i.id,class:"permission flex h-[40px]"},[(a(!0),o(f,null,h(n.visibleRoles,d=>(a(),o("div",{key:d.id,class:"border-b border-table-th-edge shrink-0 w-32 text-xs flex items-center justify-center border-r"},[x(b,{onChange:X=>n.submitPermissions(d,d.fields[i.namespace]),field:d.fields[i.namespace]},null,8,["onChange","field"])]))),128))]))),128))])])])])}const le=g(j,[["render",Q]]);export{le as default};
