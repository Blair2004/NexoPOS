import{p as O,d as w,P,F as H,b as S,a as T,v as I,w as Q}from"./bootstrap-ffaf6d09.js";import{_ as h,n as q}from"./currency-feccde3d.js";import{a as z,k as B,j as E,l as M,n as R}from"./ns-prompt-popup-24cc8d6f.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";import{r as m,o as i,c as l,f as p,e as u,a as e,t as n,g as N,F as v,b as k,w as b,i as C,h as K,B as D,n as L}from"./runtime-core.esm-bundler-414a078a.js";import{n as G}from"./ns-orders-preview-popup-3c654295.js";const Y={name:"ns-pos-quantity-popup",props:["popup"],components:{nsNumpad:z,nsNumpadPlus:B},data(){return{finalValue:1,virtualStock:null,options:{},optionsSubscription:null,allSelected:!0,isLoading:!1}},beforeDestroy(){this.optionsSubscription.unsubscribe()},mounted(){this.optionsSubscription=POS.options.subscribe(s=>{this.options=s}),this.popup.params.product.quantity&&(this.finalValue=this.popup.params.product.quantity),this.popupCloser()},unmounted(){nsHotPress.destroy("pos-quantity-numpad"),nsHotPress.destroy("pos-quantity-backspace"),nsHotPress.destroy("pos-quantity-enter")},methods:{__:h,popupCloser:O,closePopup(){this.popup.params.reject(!1),this.popup.close()},updateQuantity(s){this.finalValue=s},defineQuantity(s){const{product:o,data:a}=this.popup.params;if(s===0)return w.error(h("Please provide a quantity")).subscribe();if(o.$original().stock_management==="enabled"&&o.$original().type==="materialized"){const y=POS.getStockUsage(o.$original().id,a.unit_quantity_id)-(o.quantity||0);if(s>parseFloat(a.$quantities().quantity)-y)return w.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",a.$quantities().quantity-y)).subscribe()}this.resolve({quantity:s})},resolve(s){this.popup.params.resolve(s),this.popup.close()}}},J={class:"ns-box shadow min-h-2/5-screen w-3/4-screen md:w-3/5-screen lg:w-2/5-screen xl:w-2/5-screen relative"},X={key:0,id:"loading-overlay",style:{background:"rgb(202 202 202 / 49%)"},class:"flex w-full h-full absolute top-O left-0 items-center justify-center"},Z={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},$={class:"text-xl font-bold text-primary text-center"},ee={id:"screen",class:"h-24 primary ns-box-body flex items-center justify-center"},se={class:"font-bold text-3xl"};function te(s,o,a,y,r,t){const x=m("ns-spinner"),c=m("ns-close-button"),f=m("ns-numpad"),g=m("ns-numpad-plus");return i(),l("div",J,[r.isLoading?(i(),l("div",X,[p(x)])):u("",!0),e("div",Z,[e("div",null,[e("h1",$,n(t.__("Define Quantity")),1)]),e("div",null,[p(c,{onClick:o[0]||(o[0]=d=>t.closePopup())})])]),e("div",ee,[e("h1",se,n(r.finalValue),1)]),r.options.ns_pos_numpad==="default"?(i(),N(f,{key:1,floating:r.options.ns_pos_allow_decimal_quantities,onChanged:o[1]||(o[1]=d=>t.updateQuantity(d)),onNext:o[2]||(o[2]=d=>t.defineQuantity(d)),value:r.finalValue},null,8,["floating","value"])):u("",!0),r.options.ns_pos_numpad==="advanced"?(i(),N(g,{key:2,onChanged:o[3]||(o[3]=d=>t.updateQuantity(d)),onNext:o[4]||(o[4]=d=>t.defineQuantity(d)),value:r.finalValue},null,8,["value"])):u("",!0)])}const oe=V(Y,[["render",te]]);class Yn{constructor(o){this.product=o}run(o){return new Promise((a,y)=>{const r=this.product;if(POS.options.getValue().ns_pos_show_quantity!==!1||!POS.processingAddQueue)P.show(oe,{resolve:a,reject:y,product:r,data:o});else{if(r.$original().stock_management==="enabled"&&r.$original().type==="materialized"){const c=POS.getStockUsage(r.$original().id,o.unit_quantity_id)-(r.quantity||0);if(1>parseFloat(o.$quantities().quantity)-c)return w.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",(o.$quantities().quantity-c).toString())).subscribe()}a({quantity:1})}})}}const ne={mounted(){this.closeWithOverlayClicked(),this.loadTransactionFields()},props:["popup"],data(){return{fields:[],isSubmiting:!1,formValidation:new H}},methods:{__:h,closeWithOverlayClicked:O,proceed(){const s=this.popup.params.customer,o=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,S.post(`/api/customers/${s.id}/account-history`,o).subscribe({next:a=>{this.isSubmiting=!1,w.success(a.message).subscribe(),this.popup.params.resolve(a),this.popup.close()},error:a=>{this.isSubmiting=!1,w.error(a.message).subscribe(),this.popup.params.reject(a)}})},close(){this.popup.close(),this.popup.params.reject(!1)},loadTransactionFields(){S.get("/api/fields/ns.customers-account").subscribe({next:s=>{this.fields=this.formValidation.createFields(s)}})}}},re={class:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-6/7-screen md:h-5/7-screen lg:h-5/7-screen overflow-hidden shadow-lg ns-box flex flex-col relative"},ie={class:"p-2 border-b ns-box-header flex justify-between items-center"},le={class:"font-semibold"},ce={class:"flex-auto overflow-y-auto"},ue={key:0,class:"h-full w-full flex items-center justify-center"},ae={key:1,class:"p-2"},de={class:"p-2 ns-box-footer justify-between border-t flex"},_e=e("div",null,null,-1),pe={class:"px-1"},he={class:"-mx-2 flex flex-wrap"},fe={class:"px-1"},me={class:"px-1"},be={key:0,class:"h-full w-full absolute flex items-center justify-center",style:{background:"rgb(0 98 171 / 45%)"}};function ye(s,o,a,y,r,t){const x=m("ns-close-button"),c=m("ns-spinner"),f=m("ns-field"),g=m("ns-button");return i(),l("div",re,[e("div",ie,[e("h2",le,n(t.__("New Transaction")),1),e("div",null,[p(x,{onClick:o[0]||(o[0]=d=>t.close())})])]),e("div",ce,[r.fields.length===0?(i(),l("div",ue,[p(c)])):u("",!0),r.fields.length>0?(i(),l("div",ae,[(i(!0),l(v,null,k(r.fields,(d,j)=>(i(),N(f,{field:d,key:j},null,8,["field"]))),128))])):u("",!0)]),e("div",de,[_e,e("div",pe,[e("div",he,[e("div",fe,[p(g,{type:"error",onClick:o[1]||(o[1]=d=>t.close())},{default:b(()=>[C(n(t.__("Close")),1)]),_:1})]),e("div",me,[p(g,{type:"info",onClick:o[2]||(o[2]=d=>t.proceed())},{default:b(()=>[C(n(t.__("Proceed")),1)]),_:1})])])])]),r.isSubmiting===0?(i(),l("div",be,[p(c)])):u("",!0)])}const xe=V(ne,[["render",ye]]),ve={name:"ns-pos-coupons-load-popup",props:["popup"],components:{nsNotice:E},data(){return{placeHolder:h("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,coupon:null}},mounted(){this.popupCloser(),this.orderSubscriber=POS.order.subscribe(s=>{this.order=K(s),this.order.coupons.length>0&&(this.activeTab="active-coupons")}),this.popup.params&&this.popup.params.apply_coupon&&(this.couponCode=this.popup.params.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:s=>{this.coupon=s,this.apply()}}))},unmounted(){this.orderSubscriber.unsubscribe()},methods:{__:h,popupCloser:O,popupResolver:T,selectCustomer(){Popup.show(U)},cancel(){this.coupon=null,this.couponCode=null},removeCoupon(s){this.order.coupons.splice(s,1),POS.refreshCart()},apply(){try{if(this.coupon.valid_hours_start!==null&&!ns.date.moment.isAfter(this.coupon.valid_hours_start)&&this.coupon.valid_hours_start.length>0)return w.error(h("The coupon is out from validity date range.")).subscribe();if(this.coupon.valid_hours_end!==null&&!ns.date.moment.isBefore(this.coupon.valid_hours_end)&&this.coupon.valid_hours_end.length>0)return w.error(h("The coupon is out from validity date range.")).subscribe();const s=this.coupon.products;if(s.length>0){const y=s.map(r=>r.product_id);if(this.order.products.filter(r=>y.includes(r.product_id)).length===0)return w.error(h("This coupon requires products that aren't available on the cart at the moment.")).subscribe()}const o=this.coupon.categories;if(o.length>0){const y=o.map(r=>r.category_id);if(this.order.products.filter(r=>y.includes(r.$original().category_id)).length===0)return w.error(h("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s")).subscribe()}let a={customer_coupon_id:this.coupon.customer_coupon.length>0?this.coupon.customer_coupon[0].id:0,minimum_cart_value:this.coupon.minimum_cart_value,maximum_cart_value:this.coupon.maximum_cart_value,name:this.coupon.name,type:this.coupon.type,value:0,coupon_id:this.coupon.id,limit_usage:this.coupon.limit_usage,code:this.coupon.code,discount_value:this.coupon.discount_value,categories:this.coupon.categories,products:this.coupon.products};this.cancel(),POS.pushCoupon(a),this.activeTab="active-coupons",setTimeout(()=>{this.popupResolver(a)},500),w.success(h("The coupon has applied to the cart.")).subscribe()}catch(s){console.log(s)}},getCouponType(s){switch(s){case"percentage_discount":return h("Percentage");case"flat_discount":return h("Flat");default:return h("Unknown Type")}},getDiscountValue(s){switch(s.type){case"percentage_discount":return s.discount_value+"%";case"flat_discount":return this.$options.filters.currency(s.discount_value)}},closePopup(){this.popupResolver(!1)},setActiveTab(s){this.activeTab=s,s==="apply-coupon"&&setTimeout(()=>{document.querySelector(".coupon-field").select()},10)},getCoupon(s){return!this.order.customer_id>0?w.error(h("You must select a customer before applying a coupon.")):S.post(`/api/customers/coupons/${s}`,{customer_id:this.order.customer_id})},loadCoupon(){const s=this.couponCode;this.getCoupon(s).subscribe({next:o=>{this.coupon=o,w.success(h("The coupon has been loaded.")).subscribe()},error:o=>{w.error(o.message||h("An unexpected error occurred.")).subscribe()}})}}},ge={class:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-2/6-screen"},we={class:"border-b ns-box-header p-2 flex justify-between items-center"},Ce={class:"font-bold"},ke={class:"p-1 ns-box-body"},Se={class:"border-2 input-group info rounded flex"},Pe=["placeholder"],Oe={class:"pt-2"},Ve={key:0,class:"pt-2 flex"},Te={key:1,class:"pt-2"},je={class:"overflow-hidden"},Le={key:0,class:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},Ne={class:"w-full ns-table"},Fe={class:"p-2 w-1/2 border"},Ae={class:"p-2 w-1/2 border"},qe={class:"p-2 w-1/2 border"},Re={class:"p-2 w-1/2 border"},He={class:"p-2 w-1/2 border"},Ie={class:"p-2 w-1/2 border"},Qe={class:"p-2 w-1/2 border"},De={class:"p-2 w-1/2 border"},Ue={class:"p-2 w-1/2 border"},We={class:"p-2 w-1/2 border"},ze={class:"p-2 w-1/2 border"},Be={class:"p-2 w-1/2 border"},Ee={key:0},Me={class:"p-2 w-1/2 border"},Ke={class:"p-2 w-1/2 border"},Ge={key:0},Ye={key:0},Je={class:"flex-auto"},Xe={class:"font-semibold text-primary p-2 flex justify-between"},Ze={key:0,class:"flex justify-between elevation-surface border items-center p-2"},$e={key:0,class:"flex"};function es(s,o,a,y,r,t){const x=m("ns-close-button"),c=m("ns-notice"),f=m("ns-tabs-item"),g=m("ns-tabs");return i(),l("div",ge,[e("div",we,[e("h3",Ce,n(t.__("Load Coupon")),1),e("div",null,[p(x,{onClick:o[0]||(o[0]=d=>t.closePopup())})])]),e("div",ke,[p(g,{onActive:o[5]||(o[5]=d=>t.setActiveTab(d)),active:r.activeTab},{default:b(()=>[p(f,{label:t.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"},{default:b(()=>[e("div",Se,[D(e("input",{ref:"coupon",onKeyup:o[1]||(o[1]=Q(d=>t.loadCoupon(),["enter"])),"onUpdate:modelValue":o[2]||(o[2]=d=>r.couponCode=d),type:"text",class:"coupon-field w-full text-primary p-2 outline-none",placeholder:r.placeHolder},null,40,Pe),[[I,r.couponCode]]),e("button",{onClick:o[3]||(o[3]=d=>t.loadCoupon()),class:"px-3 py-2"},n(t.__("Load")),1)]),e("div",Oe,[p(c,{color:"info"},{description:b(()=>[C(n(t.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")),1)]),_:1})]),r.order&&r.order.customer_id===void 0?(i(),l("div",Ve,[e("button",{onClick:o[4]||(o[4]=d=>t.selectCustomer()),class:"w-full border p-2 outline-none ns-numpad-key info cursor-pointer text-center"},n(t.__("Click here to choose a customer.")),1)])):u("",!0),r.order&&r.order.customer_id!==void 0?(i(),l("div",Te,[p(c,{color:"success"},{description:b(()=>[C(n(t.__("Loading Coupon For : ")+`${r.order.customer.first_name} ${r.order.customer.last_name}`),1)]),_:1})])):u("",!0),e("div",je,[r.coupon?(i(),l("div",Le,[e("table",Ne,[e("tbody",null,[e("tr",null,[e("td",Fe,n(t.__("Coupon Name")),1),e("td",Ae,n(r.coupon.name),1)]),e("tr",null,[e("td",qe,n(t.__("Discount"))+" ("+n(t.getCouponType(r.coupon.type))+")",1),e("td",Re,n(t.getDiscountValue(r.coupon)),1)]),e("tr",null,[e("td",He,n(t.__("Usage")),1),e("td",Ie,n((r.coupon.customer_coupon.length>0?r.coupon.customer_coupon[0].usage:0)+"/"+(r.coupon.limit_usage||t.__("Unlimited"))),1)]),e("tr",null,[e("td",Qe,n(t.__("Valid From")),1),e("td",De,n(r.coupon.valid_hours_start||t.__("N/A")),1)]),e("tr",null,[e("td",Ue,n(t.__("Valid Till")),1),e("td",We,n(r.coupon.valid_hours_end||t.__("N/A")),1)]),e("tr",null,[e("td",ze,n(t.__("Categories")),1),e("td",Be,[e("ul",null,[(i(!0),l(v,null,k(r.coupon.categories,d=>(i(),l("li",{class:"rounded-full px-3 py-1 border",key:d.id},n(d.category.name),1))),128)),r.coupon.categories.length===0?(i(),l("li",Ee,n(t.__("Not applicable")),1)):u("",!0)])])]),e("tr",null,[e("td",Me,n(t.__("Products")),1),e("td",Ke,[e("ul",null,[(i(!0),l(v,null,k(r.coupon.products,d=>(i(),l("li",{class:"rounded-full px-3 py-1 border",key:d.id},n(d.product.name),1))),128)),r.coupon.products.length===0?(i(),l("li",Ge,n(t.__("Not applicable")),1)):u("",!0)])])])])])])):u("",!0)])]),_:1},8,["label"]),p(f,{label:t.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"},{default:b(()=>[r.order?(i(),l("ul",Ye,[(i(!0),l(v,null,k(r.order.coupons,(d,j)=>(i(),l("li",{key:j,class:"flex justify-between elevation-surface border items-center px-2 py-1"},[e("div",Je,[e("h3",Xe,[e("span",null,n(d.name),1),e("span",null,n(t.getDiscountValue(d)),1)])]),e("div",null,[p(x,{onClick:F=>t.removeCoupon(j)},null,8,["onClick"])])]))),128)),r.order.coupons.length===0?(i(),l("li",Ze,n(t.__("No coupons applies to the cart.")),1)):u("",!0)])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])]),r.coupon?(i(),l("div",$e,[e("button",{onClick:o[6]||(o[6]=d=>t.apply()),class:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold"},n(t.__("Apply")),1),e("button",{onClick:o[7]||(o[7]=d=>t.cancel()),class:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold"},n(t.__("Cancel")),1)])):u("",!0)])}const ss=V(ve,[["render",es]]),ts={name:"ns-pos-customers",props:["popup"],data(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],userCan:s=>POS.userCan(s),rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:M},unmounted(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted(){this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe(s=>{this.options=s}),this.subscription=POS.order.subscribe(s=>{this.order=s,this.popup.params.customer!==void 0?(this.activeTab="account-payment",this.customer=this.popup.params.customer,this.loadCustomerOrders()):s.customer!==void 0&&(this.activeTab="account-payment",this.customer=s.customer,this.loadCustomerOrders())}),this.popupCloser()},methods:{__:h,nsCurrency:q,reload(){this.loadCustomerOrders()},popupResolver:T,popupCloser:O,getWalletHistoryLabel(s){switch(s){case"add":return h("Crediting");case"deduct":return h("Removing");case"refund":return h("Refunding");case"payment":return h("Payment");default:return h("Unknow")}},getType(s){switch(s){case"percentage_discount":return h("Percentage Discount");case"flat_discount":return h("Flat Discount")}},closeWithOverlayClicked:O,async openOrderOptions(s){try{const o=await new Promise((a,y)=>{P.show(G,{order:s,resolve:a,reject:y})});this.reload()}catch{w.error(h("An error occurred while opening the order options")).subscribe()}},doChangeTab(s){this.selectedTab=s,s==="coupons"&&this.loadCoupons(),s==="rewards"&&this.loadRewards(),s==="wallet-history"&&this.loadAccounHistory(),s==="orders"&&this.loadCustomerOrders()},loadAccounHistory(){this.isLoadingHistory=!0,S.get(`/api/customers/${this.customer.id}/account-history`).subscribe({next:s=>{this.walletHistories=s.data,this.isLoadingHistory=!1},error:s=>{this.isLoadingHistory=!1}})},loadCoupons(){this.isLoadingCoupons=!0,S.get(`/api/customers/${this.customer.id}/coupons`).subscribe({next:s=>{this.coupons=s,this.isLoadingCoupons=!1},error:s=>{this.isLoadingCoupons=!1}})},loadRewards(s=`/api/customers/${this.customer.id}/rewards`){this.isLoadingRewards=!0,S.get(s).subscribe({next:o=>{this.rewardsResponse=o,this.isLoadingRewards=!1},error:o=>{this.isLoadingRewards=!1}})},prefillForm(s){this.popup.params.name!==void 0&&(s.main.value=this.popup.params.name)},openCustomerSelection(){this.popup.close(s=>{P.show(U)})},loadCustomerOrders(){this.isLoadingOrders=!0,S.get(`/api/customers/${this.customer.id}/orders`).subscribe({next:s=>{this.orders=s,this.isLoadingOrders=!1},error:s=>{this.isLoadingOrders=!1}})},newTransaction(s){new Promise((a,y)=>{P.show(xe,{customer:s,resolve:a,reject:y})}).then(a=>{POS.loadCustomer(s.id).subscribe(y=>{POS.selectCustomer(y)})})},applyCoupon(s){this.order.customer===void 0?P.show(R,{title:h("Use Customer ?"),message:h("No customer is selected. Would you like to proceed with this customer ?"),onAction:o=>{o&&POS.selectCustomer(this.customer).then(a=>{this.proceedApplyingCoupon(s)})}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(s):this.order.customer.id!==this.customer.id&&P.show(R,{title:h("Change Customer ?"),message:h("Would you like to assign this customer to the ongoing order ?"),onAction:o=>{o&&POS.selectCustomer(this.customer).then(a=>{this.proceedApplyingCoupon(s)})}})},proceedApplyingCoupon(s){new Promise((o,a)=>{P.show(ss,{apply_coupon:s.code,resolve:o,reject:a})}).then(o=>{this.popupResolver(!1)}).catch(o=>{})},handleSavedCustomer(s){w.success(s.message).subscribe(),POS.selectCustomer(s.data.entry),this.popup.close()}}},os={id:"ns-pos-customers",class:"shadow-lg rounded w-95vw h-95vh lg:w-3/5-screen flex flex-col overflow-hidden"},rs={class:"ns-header p-2 flex justify-between items-center border-b"},is={class:"font-semibold"},ls={class:"ns-body flex-auto flex p-2 overflow-y-auto"},cs={key:1,class:"h-full flex-col w-full flex items-center justify-center text-primary"},us=e("i",{class:"lar la-hand-paper ns-icon text-6xl"},null,-1),as={class:"font-medium text-2xl"},ds={key:0,class:"flex-auto w-full flex items-center justify-center flex-col p-4"},_s=e("i",{class:"lar la-frown text-6xl"},null,-1),ps={class:"font-medium text-2xl"},hs={class:"my-2"},fs={key:1,class:"flex flex-col flex-auto"},ms={class:"flex-auto p-2 flex flex-col"},bs={class:"flex flex-wrap"},ys={class:"px-4 mb-4 w-full"},xs={class:"font-semibold"},vs={class:"flex flex-wrap ns-tab-cards -mx-2 w-full"},gs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ws={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},Cs={class:"font-medium text-lg"},ks={class:"w-full flex justify-end"},Ss={class:"font-bold"},Ps={class:"px-2 mb-4 w-full md:w-1/4 flex"},Os={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},Vs={class:"font-medium text-lg"},Ts={class:"w-full flex justify-end"},js={class:"font-bold"},Ls={class:"px-2 mb-4 w-full md:w-1/4 flex"},Ns={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},Fs={class:"font-medium text-lg"},As={class:"w-full flex justify-end"},qs={class:"font-bold"},Rs={class:"px-2 mb-4 w-full md:w-1/4 flex"},Hs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},Is={class:"font-medium text-lg"},Qs={class:"w-full flex justify-end"},Ds={class:"font-bold"},Us={class:"flex flex-auto flex-col overflow-hidden"},Ws={key:0,class:"flex-auto h-full justify-center flex items-center"},zs={class:"py-2 w-full"},Bs={class:"font-semibold text-primary"},Es={class:"flex-auto flex-col flex overflow-hidden"},Ms={class:"flex-auto overflow-y-auto"},Ks={class:"table ns-table w-full"},Gs={class:"text-primary"},Ys={colspan:"3",width:"150",class:"p-2 border font-semibold"},Js={width:"50",class:"p-2 border font-semibold"},Xs={class:"text-primary"},Zs={key:0},$s={class:"border p-2 text-center",colspan:"4"},et={colspan:"3",class:"border p-2 text-center"},st={class:"flex flex-col items-start"},tt={class:"font-bold"},ot={class:"md:-mx-2 w-full flex flex-col md:flex-row"},nt={class:"md:px-2 flex items-start w-full md:w-1/4"},rt={class:"md:px-2 flex items-start w-full md:w-1/4"},it={class:"md:px-2 flex items-start w-full md:w-1/4"},lt={class:"border p-2 text-center"},ct=["onClick"],ut=e("i",{class:"las la-wallet"},null,-1),at={class:"ml-1"},dt={key:0,class:"flex-auto h-full justify-center flex items-center"},_t={class:"py-2 w-full"},pt={class:"font-semibold text-primary"},ht={class:"flex-auto flex-col flex overflow-hidden"},ft={class:"flex-auto overflow-y-auto"},mt={class:"table ns-table w-full"},bt={class:"text-primary"},yt={colspan:"3",width:"150",class:"p-2 border font-semibold"},xt={class:"text-primary"},vt={key:0},gt={class:"border p-2 text-center",colspan:"3"},wt={colspan:"3",class:"border p-2 text-center"},Ct={class:"flex flex-col items-start"},kt={class:"font-bold"},St={class:"md:-mx-2 w-full flex flex-col md:flex-row"},Pt={class:"md:px-2 flex items-start w-full md:w-1/3"},Ot={class:"md:px-2 flex items-start w-full md:w-1/3"},Vt={key:0,class:"flex-auto h-full justify-center flex items-center"},Tt={class:"py-2 w-full"},jt={class:"font-semibold text-primary"},Lt={class:"flex-auto flex-col flex overflow-hidden"},Nt={class:"flex-auto overflow-y-auto"},Ft={class:"table ns-table w-full"},At={class:"text-primary"},qt={width:"150",class:"p-2 border font-semibold"},Rt={class:"p-2 border font-semibold"},Ht=e("th",{class:"p-2 border font-semibold"},null,-1),It={class:"text-primary text-sm"},Qt={key:0},Dt={class:"border p-2 text-center",colspan:"4"},Ut={width:"300",class:"border p-2"},Wt={class:""},zt={class:"-mx-2 flex"},Bt={class:"text-xs text-primary px-2"},Et={class:"text-xs text-primary px-2"},Mt={class:"border p-2 text-center"},Kt={key:0},Gt={key:1},Yt={class:"border p-2 text-right"},Jt={key:0,class:"flex-auto h-full justify-center flex items-center"},Xt={class:"py-2 w-full"},Zt={class:"font-semibold text-primary"},$t={class:"flex-auto flex-col flex overflow-hidden"},eo={class:"flex-auto overflow-y-auto"},so={class:"table ns-table w-full"},to={class:"text-primary"},oo={width:"150",class:"p-2 border font-semibold"},no={class:"p-2 border font-semibold"},ro={class:"p-2 border font-semibold"},io={key:0,class:"text-primary text-sm"},lo={key:0},co={class:"border p-2 text-center",colspan:"4"},uo={width:"300",class:"border p-2"},ao={class:"text-center"},_o={width:"300",class:"border p-2"},po={class:"text-center"},ho={width:"300",class:"border p-2"},fo={class:"text-center"},mo={class:"py-1 flex justify-end"},bo={class:"p-2 border-t border-box-edge flex justify-between"},yo=e("div",null,null,-1);function xo(s,o,a,y,r,t){const x=m("ns-close-button"),c=m("ns-crud-form"),f=m("ns-tabs-item"),g=m("ns-button"),d=m("ns-spinner"),j=m("ns-paginate"),F=m("ns-tabs");return i(),l("div",os,[e("div",rs,[e("h3",is,n(t.__("Customers")),1),e("div",null,[p(x,{onClick:o[0]||(o[0]=_=>a.popup.close())})])]),e("div",ls,[p(F,{active:r.activeTab,onActive:o[7]||(o[7]=_=>r.activeTab=_)},{default:b(()=>[p(f,{identifier:"create-customers",label:t.__("New Customer")},{default:b(()=>[r.userCan("nexopos.create.customers")?(i(),N(c,{key:0,onUpdated:o[1]||(o[1]=_=>t.prefillForm(_)),onSave:o[2]||(o[2]=_=>t.handleSavedCustomer(_)),"submit-url":"/api/crud/ns.customers",src:"/api/crud/ns.customers/form-config"},{title:b(()=>[C(n(t.__("Customer Name")),1)]),save:b(()=>[C(n(t.__("Save Customer")),1)]),_:1})):u("",!0),r.userCan("nexopos.create.customers")?u("",!0):(i(),l("div",cs,[us,e("h3",as,n(t.__("Not Authorized")),1),e("p",null,n(t.__("Creating customers has been explicitly disabled from the settings.")),1)]))]),_:1},8,["label"]),p(f,{identifier:"account-payment",label:t.__("Customer Account"),class:"flex",padding:"p-0 flex"},{default:b(()=>[r.customer===null?(i(),l("div",ds,[_s,e("h3",ps,n(t.__("No Customer Selected")),1),e("p",null,n(t.__("In order to see a customer account, you need to select one customer.")),1),e("div",hs,[p(g,{onClick:o[3]||(o[3]=_=>t.openCustomerSelection()),type:"info"},{default:b(()=>[C(n(t.__("Select Customer")),1)]),_:1})])])):u("",!0),r.customer?(i(),l("div",fs,[e("div",ms,[e("div",bs,[e("div",ys,[e("h2",xs,n(t.__("Summary For"))+" : "+n(r.customer.first_name),1)]),e("div",vs,[e("div",gs,[e("div",ws,[e("h3",Cs,n(t.__("Purchases")),1),e("div",ks,[e("h2",Ss,n(t.nsCurrency(r.customer.purchases_amount)),1)])])]),e("div",Ps,[e("div",Os,[e("h3",Vs,n(t.__("Owed")),1),e("div",Ts,[e("h2",js,n(t.nsCurrency(r.customer.owed_amount)),1)])])]),e("div",Ls,[e("div",Ns,[e("h3",Fs,n(t.__("Wallet Amount")),1),e("div",As,[e("h2",qs,n(t.nsCurrency(r.customer.account_amount)),1)])])]),e("div",Rs,[e("div",Hs,[e("h3",Is,n(t.__("Credit Limit")),1),e("div",Qs,[e("h2",Ds,n(t.nsCurrency(r.customer.credit_limit_amount)),1)])])])])]),e("div",Us,[p(F,{active:r.selectedTab,onChangeTab:o[5]||(o[5]=_=>t.doChangeTab(_))},{default:b(()=>[p(f,{identifier:"orders",label:t.__("Orders")},{default:b(()=>[r.isLoadingOrders?(i(),l("div",Ws,[p(d,{size:"36"})])):u("",!0),r.isLoadingOrders?u("",!0):(i(),l(v,{key:1},[e("div",zs,[e("h2",Bs,n(t.__("Last Purchases")),1)]),e("div",Es,[e("div",Ms,[e("table",Ks,[e("thead",null,[e("tr",Gs,[e("th",Ys,n(t.__("Order")),1),e("th",Js,n(t.__("Options")),1)])]),e("tbody",Xs,[r.orders.length===0?(i(),l("tr",Zs,[e("td",$s,n(t.__("No orders...")),1)])):u("",!0),(i(!0),l(v,null,k(r.orders,_=>(i(),l("tr",{key:_.id},[e("td",et,[e("div",st,[e("h3",tt,n(t.__("Code"))+": "+n(_.code),1),e("div",ot,[e("div",nt,[e("small",null,n(t.__("Total"))+": "+n(t.nsCurrency(_.total)),1)]),e("div",rt,[e("small",null,n(t.__("Status"))+": "+n(_.human_status),1)]),e("div",it,[e("small",null,n(t.__("Delivery"))+": "+n(_.human_delivery_status),1)])])])]),e("td",lt,[e("button",{onClick:W=>t.openOrderOptions(_),class:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success"},[ut,e("span",at,n(t.__("Options")),1)],8,ct)])]))),128))])])])])],64))]),_:1},8,["label"]),p(f,{identifier:"wallet-history",label:t.__("Wallet History")},{default:b(()=>[r.isLoadingHistory?(i(),l("div",dt,[p(d,{size:"36"})])):u("",!0),r.isLoadingHistory?u("",!0):(i(),l(v,{key:1},[e("div",_t,[e("h2",pt,n(t.__("Wallet History")),1)]),e("div",ht,[e("div",ft,[e("table",mt,[e("thead",null,[e("tr",bt,[e("th",yt,n(t.__("Transaction")),1)])]),e("tbody",xt,[r.walletHistories.length===0?(i(),l("tr",vt,[e("td",gt,n(t.__("No History...")),1)])):u("",!0),(i(!0),l(v,null,k(r.walletHistories,_=>(i(),l("tr",{key:_.id},[e("td",wt,[e("div",Ct,[e("h3",kt,n(t.__("Transaction"))+": "+n(t.getWalletHistoryLabel(_.operation)),1),e("div",St,[e("div",Pt,[e("small",null,n(t.__("Amount"))+": "+n(t.nsCurrency(s.amount)),1)]),e("div",Ot,[e("small",null,n(t.__("Date"))+": "+n(_.created_at),1)])])])])]))),128))])])])])],64))]),_:1},8,["label"]),p(f,{identifier:"coupons",label:t.__("Coupons")},{default:b(()=>[r.isLoadingCoupons?(i(),l("div",Vt,[p(d,{size:"36"})])):u("",!0),r.isLoadingCoupons?u("",!0):(i(),l(v,{key:1},[e("div",Tt,[e("h2",jt,n(t.__("Coupons")),1)]),e("div",Lt,[e("div",Nt,[e("table",Ft,[e("thead",null,[e("tr",At,[e("th",qt,n(t.__("Name")),1),e("th",Rt,n(t.__("Type")),1),Ht])]),e("tbody",It,[r.coupons.length===0?(i(),l("tr",Qt,[e("td",Dt,n(t.__("No coupons for the selected customer...")),1)])):u("",!0),(i(!0),l(v,null,k(r.coupons,_=>(i(),l("tr",{key:_.id},[e("td",Ut,[e("h3",null,n(_.name),1),e("div",Wt,[e("ul",zt,[e("li",Bt,n(t.__("Usage :"))+" "+n(_.usage)+"/"+n(_.limit_usage),1),e("li",Et,n(t.__("Code :"))+" "+n(_.code),1)])])]),e("td",Mt,[C(n(t.getType(_.coupon.type))+" ",1),_.coupon.type==="percentage_discount"?(i(),l("span",Kt," ("+n(_.coupon.discount_value)+"%) ",1)):u("",!0),_.coupon.type==="flat_discount"?(i(),l("span",Gt," ("+n(t.nsCurrency(s.value))+") ",1)):u("",!0)]),e("td",Yt,[p(g,{onClick:W=>t.applyCoupon(_),type:"info"},{default:b(()=>[C(n(t.__("Use Coupon")),1)]),_:2},1032,["onClick"])])]))),128))])])])])],64))]),_:1},8,["label"]),p(f,{identifier:"rewards",label:t.__("Rewards")},{default:b(()=>[r.isLoadingRewards?(i(),l("div",Jt,[p(d,{size:"36"})])):u("",!0),r.isLoadingRewards?u("",!0):(i(),l(v,{key:1},[e("div",Xt,[e("h2",Zt,n(t.__("Rewards")),1)]),e("div",$t,[e("div",eo,[e("table",so,[e("thead",null,[e("tr",to,[e("th",oo,n(t.__("Name")),1),e("th",no,n(t.__("Points")),1),e("th",ro,n(t.__("Target")),1)])]),r.rewardsResponse.data?(i(),l("tbody",io,[r.rewardsResponse.data.length===0?(i(),l("tr",lo,[e("td",co,n(t.__("No rewards available the selected customer...")),1)])):u("",!0),(i(!0),l(v,null,k(r.rewardsResponse.data,_=>(i(),l("tr",{key:_.id},[e("td",uo,[e("h3",ao,n(_.reward_name),1)]),e("td",_o,[e("h3",po,n(_.points),1)]),e("td",ho,[e("h3",fo,n(_.target),1)])]))),128))])):u("",!0)])])]),e("div",mo,[p(j,{pagination:r.rewardsResponse,onLoad:o[4]||(o[4]=_=>t.loadRewards(_))},null,8,["pagination"])])],64))]),_:1},8,["label"])]),_:1},8,["active"])])]),e("div",bo,[yo,e("div",null,[p(g,{onClick:o[6]||(o[6]=_=>t.newTransaction(r.customer)),type:"info"},{default:b(()=>[C(n(t.__("Account Transaction")),1)]),_:1})])])])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])])])}const A=V(ts,[["render",xo]]),Jn=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"})),vo={props:["popup"],data(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected(){return!1}},watch:{searchCustomerValue(s){clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout(()=>{this.searchCustomer(s)},500)}},mounted(){this.orderSubscription=POS.order.subscribe(s=>{this.order=s}),this.getRecentCustomers(),this.$refs.searchField.focus(),this.popupCloser()},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:h,popupCloser:O,nsCurrency:q,resolveIfQueued:T,attemptToChoose(){if(this.customers.length===1)return this.selectCustomer(this.customers[0]);w.info(h("Too many results.")).subscribe()},openCustomerHistory(s,o){o.stopImmediatePropagation(),this.popup.close(),P.show(A,{customer:s,activeTab:"account-payment"})},selectCustomer(s){this.customers.forEach(o=>o.selected=!1),s.selected=!0,this.isLoading=!0,POS.selectCustomer(s).then(o=>{this.isLoading=!1,this.resolveIfQueued(s)}).catch(o=>{this.isLoading=!1})},searchCustomer(s){S.post("/api/customers/search",{search:s}).subscribe(o=>{o.forEach(a=>a.selected=!1),this.customers=o})},createCustomerWithMatch(s){this.resolveIfQueued(!1),P.show(A,{name:s})},getRecentCustomers(){this.isLoading=!0,S.get("/api/customers/recently-active").subscribe({next:s=>{this.isLoading=!1,s.forEach(o=>o.selected=!1),this.customers=s},error:s=>{this.isLoading=!1}})}}},go={id:"ns-pos-customer-select-popup",class:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108"},wo={id:"header",class:"border-b ns-box-header text-center font-semibold text-2xl py-2"},Co={class:"relative"},ko={class:"p-2 border-b ns-box-body items-center flex justify-between"},So={class:"flex items-center justify-between"},Po=e("i",{class:"las la-eye"},null,-1),Oo=[Po],Vo={class:"p-2 border-b ns-box-body flex justify-between text-primary"},To={class:"input-group flex-auto border-2 rounded"},jo={class:"h-3/5-screen xl:h-2/5-screen overflow-y-auto ns-scrollbar"},Lo={class:"ns-vertical-menu"},No={key:0,class:"p-2 text-center text-primary"},Fo={class:"border-b border-dashed border-info-primary"},Ao=["onClick"],qo={class:"flex flex-col"},Ro={key:0,class:"text-xs text-secondary"},Ho={key:1,class:"text-xs text-secondary"},Io={class:"flex items-center"},Qo={key:0,class:"text-error-primary"},Do={key:1},Uo={class:"purchase-amount"},Wo=["onClick"],zo=e("i",{class:"las la-eye"},null,-1),Bo=[zo],Eo={key:0,class:"z-10 top-0 absolute w-full h-full flex items-center justify-center"};function Mo(s,o,a,y,r,t){const x=m("ns-spinner");return i(),l("div",go,[e("div",wo,[e("h2",null,n(t.__("Select Customer")),1)]),e("div",Co,[e("div",ko,[e("span",null,n(t.__("Selected"))+" : ",1),e("div",So,[e("span",null,n(r.order.customer?`${r.order.customer.first_name} ${r.order.customer.last_name}`:"N/A"),1),r.order.customer?(i(),l("button",{key:0,onClick:o[0]||(o[0]=c=>t.openCustomerHistory(r.order.customer,c)),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent"},Oo)):u("",!0)])]),e("div",Vo,[e("div",To,[D(e("input",{ref:"searchField",onKeydown:o[1]||(o[1]=Q(c=>t.attemptToChoose(),["enter"])),"onUpdate:modelValue":o[2]||(o[2]=c=>r.searchCustomerValue=c),placeholder:"Search Customer",type:"text",class:"outline-none w-full p-2"},null,544),[[I,r.searchCustomerValue]])])]),e("div",jo,[e("ul",Lo,[r.customers&&r.customers.length===0?(i(),l("li",No,n(t.__("No customer match your query...")),1)):u("",!0),r.customers&&r.customers.length===0?(i(),l("li",{key:1,onClick:o[3]||(o[3]=c=>t.createCustomerWithMatch(r.searchCustomerValue)),class:"p-2 cursor-pointer text-center text-primary"},[e("span",Fo,n(t.__("Create a customer")),1)])):u("",!0),(i(!0),l(v,null,k(r.customers,c=>(i(),l("li",{onClick:f=>t.selectCustomer(c),key:c.id,class:"cursor-pointer p-2 border-b text-primary flex justify-between items-center"},[e("div",qo,[e("span",null,n(c.first_name)+" "+n(c.last_name),1),c.group?(i(),l("small",Ro,n(c.group.name),1)):(i(),l("small",Ho,n(t.__("No Group Assigned")),1))]),e("p",Io,[c.owe_amount>0?(i(),l("span",Qo,"-"+n(t.nsCurrency(c.owe_amount)),1)):u("",!0),c.owe_amount>0?(i(),l("span",Do,"/")):u("",!0),e("span",Uo,n(t.nsCurrency(c.purchases_amount)),1),e("button",{onClick:f=>t.openCustomerHistory(c,f),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info"},Bo,8,Wo)])],8,Ao))),128))])]),r.isLoading?(i(),l("div",Eo,[p(x,{size:"24",border:"8"})])):u("",!0)])])}const U=V(vo,[["render",Mo]]),Ko={name:"ns-pos-discount-popup",props:["popup"],data(){return{finalValue:1,virtualStock:null,popupSubscription:null,mode:"",type:"",allSelected:!0,isLoading:!1,keys:[...[7,8,9].map(s=>({identifier:s,value:s})),...[4,5,6].map(s=>({identifier:s,value:s})),...[1,2,3].map(s=>({identifier:s,value:s})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}]}},mounted(){this.mode=this.popup.params.reference.discount_type||"percentage",this.type=this.popup.params.type,this.mode==="percentage"?this.finalValue=this.popup.params.reference.discount_percentage||1:this.finalValue=this.popup.params.reference.discount||1,this.popupCloser()},methods:{__:h,nsCurrency:q,popupResolver:T,popupCloser:O,setPercentageType(s){this.mode=s},closePopup(){this.popup.close()},inputValue(s){s.identifier==="next"?(this.popup.params.onSubmit({discount_type:this.mode,discount_percentage:this.mode==="percentage"?this.finalValue:void 0,discount:this.mode==="flat"?this.finalValue:void 0}),this.popup.close()):s.identifier==="backspace"?this.allSelected?(this.finalValue=0,this.allSelected=!1):(this.finalValue=this.finalValue.toString(),this.finalValue=this.finalValue.substr(0,this.finalValue.length-1)||0):this.allSelected?(this.finalValue=s.value,this.finalValue=parseFloat(this.finalValue),this.allSelected=!1):(this.finalValue+=""+s.value,this.finalValue=parseFloat(this.finalValue),this.mode==="percentage"&&(this.finalValue=this.finalValue>100?100:this.finalValue))}}},Go={id:"discount-popup",class:"ns-box shadow min-h-2/5-screen w-6/7-screen md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen relative"},Yo={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},Jo={key:0,class:"text-xl font-bold text-primary text-center"},Xo={key:1,class:"text-xl font-bold text-primary text-center"},Zo={id:"screen",class:"h-16 ns-box-body text-white flex items-center justify-center"},$o={class:"font-bold text-3xl"},en={key:0},sn={key:1},tn={id:"switch-mode",class:"flex"},on=e("hr",{class:"border-r border-box-edge"},null,-1),nn={id:"numpad",class:"grid grid-flow-row grid-cols-3 grid-rows-3"},rn=["onClick"],ln={key:0};function cn(s,o,a,y,r,t){const x=m("ns-close-button");return i(),l("div",Go,[e("div",Yo,[e("div",null,[r.type==="product"?(i(),l("h1",Jo,n(t.__("Product Discount")),1)):u("",!0),r.type==="cart"?(i(),l("h1",Xo,n(t.__("Cart Discount")),1)):u("",!0)]),e("div",null,[p(x,{onClick:o[0]||(o[0]=c=>t.closePopup())})])]),e("div",Zo,[e("h1",$o,[r.mode==="flat"?(i(),l("span",en,n(t.nsCurrency(r.finalValue)),1)):u("",!0),r.mode==="percentage"?(i(),l("span",sn,n(r.finalValue)+"%",1)):u("",!0)])]),e("div",tn,[e("button",{onClick:o[1]||(o[1]=c=>t.setPercentageType("flat")),class:L([r.mode==="flat"?"bg-tab-active":"bg-tab-inactive text-tertiary","outline-none w-1/2 py-2 flex items-center justify-center"])},n(t.__("Flat")),3),on,e("button",{onClick:o[2]||(o[2]=c=>t.setPercentageType("percentage")),class:L([r.mode==="percentage"?"bg-tab-active":"bg-tab-inactive text-tertiary","outline-none w-1/2 py-2 flex items-center justify-center"])},n(t.__("Percentage")),3)]),e("div",nn,[(i(!0),l(v,null,k(r.keys,(c,f)=>(i(),l("div",{onClick:g=>t.inputValue(c),key:f,class:"text-primary ns-numpad-key info text-xl font-bold border h-24 flex items-center justify-center cursor-pointer"},[c.value!==void 0?(i(),l("span",ln,n(c.value),1)):u("",!0),c.icon?(i(),l("i",{key:1,class:L(["las",c.icon])},null,2)):u("",!0)],8,rn))),128))])])}const Xn=V(Ko,[["render",cn]]),un={data(){return{types:[],settingsSubscription:null,urls:{}}},props:["popup"],mounted(){this.settingsSubscription=POS.settings.subscribe(s=>{this.urls=s.urls}),this.types=POS.types.getValue(),Object.values(this.types).length===1&&this.select(Object.keys(this.types)[0]),this.popupCloser()},methods:{__:h,popupCloser:O,popupResolver:T,resolveIfQueued:T,async select(s){Object.values(this.types).forEach(a=>a.selected=!1),this.types[s].selected=!0;const o=this.types[s];try{const a=await POS.triggerOrderTypeSelection(o);POS.types.next(this.types),this.resolveIfQueued(o)}catch(a){throw a}}}},an={id:"ns-order-type",class:"h-full w-4/5-screen md:w-2/5-screen lg:w-2/5-screen xl:w-2/6-screen shadow-lg"},dn={id:"header",class:"h-16 flex justify-center items-center"},_n={class:"font-bold"},pn={key:0,class:"ns-box-body grid grid-flow-row grid-cols-1 grid-rows-1"},hn={class:"h-full w-full flex items-center justify-center flex-col"},fn=e("i",{class:"las la-frown text-7xl text-error-tertiary"},null,-1),mn={class:"p-4 md:w-2/3"},bn={class:"text-center"},yn={class:"flex justify-center mt-4 mb-2 -mx-2"},xn={class:"px-2"},vn={class:"px-2"},gn={key:1,class:"ns-box-body grid grid-flow-row grid-cols-2 grid-rows-2"},wn=["onClick"],Cn=["src"],kn={class:"font-semibold text-xl my-2"};function Sn(s,o,a,y,r,t){const x=m("ns-link");return i(),l("div",an,[e("div",dn,[e("h3",_n,n(t.__("Define The Order Type")),1)]),Object.values(r.types).length===0?(i(),l("div",pn,[e("div",hn,[fn,e("div",mn,[e("p",bn,n(t.__("No payment type has been selected on the settings. Please check your POS features and choose the supported order type")),1),e("div",yn,[e("div",xn,[p(x,{target:"_blank",type:"info",href:"https://my.nexopos.com/en/documentation/components/order-types"},{default:b(()=>[C(n(t.__("Read More")),1)]),_:1})]),e("div",vn,[p(x,{target:"_blank",type:"info",href:r.urls.order_type_url},{default:b(()=>[C(n(t.__("Configure")),1)]),_:1},8,["href"])])])])])])):u("",!0),Object.values(r.types).length>0?(i(),l("div",gn,[(i(!0),l(v,null,k(r.types,c=>(i(),l("div",{onClick:f=>t.select(c.identifier),key:c.identifier,class:L([c.selected?"active":"","ns-numpad-key info h-56 flex items-center justify-center flex-col cursor-pointer border"])},[e("img",{src:c.icon,alt:"",class:"w-32 h-32"},null,8,Cn),e("h4",kn,n(c.label),1)],10,wn))),128))])):u("",!0)])}const Zn=V(un,[["render",Sn]]),Pn={name:"ns-pos-shipping-popup",props:["popup"],computed:{activeTabFields(){if(this.tabs!==null){for(let s in this.tabs)if(this.tabs[s].active)return this.tabs[s].fields}return[]},useBillingInfo(){return this.tabs!==null?this.tabs.billing.fields[0].value:new Object},useShippingInfo(){return this.tabs!==null?this.tabs.shipping.fields[0].value:new Object}},unmounted(){this.orderSubscription.unsubscribe()},mounted(){this.orderSubscription=POS.order.subscribe(s=>this.order=s),this.popupCloser(),this.loadForm()},data(){return{tabs:null,orderSubscription:null,order:null,formValidation:new H}},watch:{useBillingInfo(s){s===1&&this.tabs.billing.fields.forEach(o=>{o.name!=="_use_customer_billing"&&(o.value=this.order.customer.billing?this.order.customer.billing[o.name]:o.value)})},useShippingInfo(s){s===1&&this.tabs.shipping.fields.forEach(o=>{o.name!=="_use_customer_shipping"&&(o.value=this.order.customer.shipping?this.order.customer.shipping[o.name]:o.value)})}},methods:{__,popupCloser:O,resolveIfQueued:T,submitInformations(){const s=this.formValidation.extractForm({tabs:this.tabs});for(let o in s.general)["shipping","shipping_rate"].includes(o)&&(s.general[o]=parseFloat(s.general[o]));this.order={...this.order,...s.general},delete s.general,delete s.shipping._use_customer_shipping,delete s.billing._use_customer_billing,this.order.addresses=s,POS.order.next(this.order),POS.refreshCart(),this.resolveIfQueued(!0)},closePopup(){this.resolveIfQueued(!1)},toggle(s){for(let o in this.tabs)this.tabs[o].active=!1;this.tabs[s].active=!0},loadForm(){S.get("/api/forms/ns.pos-addresses").subscribe(({tabs:s})=>{for(let o in s)o==="general"?s[o].fields.forEach(a=>{a.value=this.order[a.name]||""}):s[o].fields.forEach(a=>{a.value=this.order.addresses[o]?this.order.addresses[o][a.name]:""});this.tabs=this.formValidation.initializeTabs(s)})}}},On={class:"ns-box w-6/7-screen md:w-4/5-screen lg:w-3/5-screen h-6/7-screen md:h-4/5-screen shadow-lg flex flex-col overflow-hidden"},Vn={class:"p-2 border-b ns-box-header flex justify-between items-center"},Tn={class:"font-bold text-primary"},jn={class:"tools"},Ln=e("i",{class:"las la-times"},null,-1),Nn=[Ln],Fn={class:"flex-auto ns-box-body p-2 overflow-y-auto ns-tab"},An={id:"tabs-container"},qn={class:"header flex",style:{"margin-bottom":"-1px"}},Rn=["onClick"],Hn={class:"border ns-tab-item"},In={class:"px-4"},Qn={class:"-mx-4 flex flex-wrap"},Dn={class:"p-2 flex justify-between border-t ns-box-footer"},Un=e("div",null,null,-1);function Wn(s,o,a,y,r,t){const x=m("ns-field"),c=m("ns-button");return i(),l("div",On,[e("div",Vn,[e("h3",Tn,n(t.__("Shipping & Billing")),1),e("div",jn,[e("button",{onClick:o[0]||(o[0]=f=>t.closePopup()),class:"ns-close-button rounded-full h-8 w-8 border items-center justify-center"},Nn)])]),e("div",Fn,[e("div",An,[e("div",qn,[(i(!0),l(v,null,k(r.tabs,(f,g)=>(i(),l("div",{key:g,onClick:d=>t.toggle(g),class:L([f.active?"border-b-0 active":"inactive","tab rounded-tl rounded-tr border tab px-3 py-2 text-primary cursor-pointer"]),style:{"margin-right":"-1px"}},n(f.label),11,Rn))),128))]),e("div",Hn,[e("div",In,[e("div",Qn,[(i(!0),l(v,null,k(t.activeTabFields,(f,g)=>(i(),l("div",{key:g,class:L("p-4 w-full md:w-1/2 lg:w-1/3")},[p(x,{onBlur:d=>r.formValidation.checkField(f),onChange:d=>r.formValidation.checkField(f),field:f},null,8,["onBlur","onChange","field"])]))),128))])])])])]),e("div",Dn,[Un,e("div",null,[p(c,{onClick:o[1]||(o[1]=f=>t.submitInformations()),type:"info"},{default:b(()=>[C(n(t.__("Save")),1)]),_:1})])])])}const $n=V(Pn,[["render",Wn]]);export{Yn as P,Xn as a,Zn as b,$n as c,ss as d,Jn as e,U as n};
