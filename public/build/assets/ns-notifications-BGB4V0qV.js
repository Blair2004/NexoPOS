import{t as k,b as u,n as m}from"./bootstrap-CTGbPB8U.js";import{_ as f}from"./lang-BINodpp-.js";import{n as v}from"./ns-prompt-popup-Clv0LWBA.js";import{h as y,i as N}from"./components-Wv7K25xh.js";import{d as w}from"./currency-DQAAGb0G.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as E,c as r,o as c,b as s,a as h,t as a,n as b,F as _,e as x,f as A}from"./runtime-core.esm-bundler-lHXuXxGr.js";import"./chart-ka-CGrsc.js";import"./runtime-dom.esm-bundler-BhgnMY0Q.js";import"./ns-avatar-yPNTyn6S.js";import"./ns-avatar-image-DuMgcjn0.js";const I={name:"ns-notifications",data(){return{notifications:[],visible:!1,socketEnabled:!1,interval:null}},components:{nsCloseButton:N,NsButton:y},mounted(){document.addEventListener("click",this.checkClickedItem),typeof Echo>"u"?this.interval=setInterval(()=>{this.loadNotifications()},15e3):(this.interval=setInterval(()=>{this.socketEnabled=Echo.connector.pusher.connection.state==="connected"},1e3),Echo.private(`App.User.${ns.user.attributes.user_id}`).listen("NotificationUpdatedEvent",e=>{this.pushNotificationIfNew(e.notification)}).listen("NotificationCreatedEvent",e=>{this.pushNotificationIfNew(e.notification)}).listen("NotificationDeletedEvent",e=>{this.deleteNotificationIfExists(e.notification)})),this.loadNotifications()},unmounted(){clearInterval(this.interval)},methods:{__:f,timespan:k,nsNumberAbbreviate:w,executeAsync(e,t){Popup.show(v,{title:f("Confirm Your Action"),message:e.message||f("Are you sure you want to perform this action ?"),onAction:n=>{if(n){const p=e.data===void 0?"get":"post";e.url.search("/?/")===-1?e.url+=`?notification_id=${t.id}`:e.url+=`&notification_id=${t.id}`,u[p](e.url,e.data).subscribe({next:i=>{m.success(i.message),this.loadNotifications()},error:i=>{m.error(i.message)}})}}})},pushNotificationIfNew(e){this.notifications.filter(n=>n.id===e.id).length>0||this.notifications.unshift(e)},deleteNotificationIfExists(e){const t=this.notifications.filter(n=>n.id===e.id);if(t.length>0){const n=this.notifications.indexOf(t[0]);this.notifications.splice(n,1)}},deleteAll(){Popup.show(v,{title:f("Confirm Your Action"),message:f("Would you like to clear all the notifications ?"),onAction:e=>{e&&u.delete("/api/notifications/all").subscribe(t=>{m.success(t.message)})}})},checkClickedItem(e){let t;document.getElementById("notification-center")?t=document.getElementById("notification-center").contains(e.srcElement):t=!1;const n=document.getElementById("notification-button").contains(e.srcElement);!t&&!n&&this.visible&&(this.visible=!1)},loadNotifications(){u.get("/api/notifications").subscribe(e=>{this.notifications=e})},triggerLink(e){if(e.url!=="url"&&e.actions===null)return window.open(e.url,"_blank")},closeNotice(e,t){u.delete(`/api/notifications/${t.id}`).subscribe(n=>{this.socketEnabled||this.loadNotifications()}),e.stopPropagation()}}},B={id:"notificaton-wrapper"},j={key:0,class:"relative float-right"},P={class:"absolute -ml-6 -mt-8"},L={class:"counter w-8 h-8 rounded-full text-xs flex items-center justify-center"},V={key:0,class:"h-0 w-0",id:"notification-center"},z={class:"absolute left-0 top-0 sm:relative w-screen zoom-out-entrance anim-duration-300 h-[80vh] sm:w-64 sm:h-108 flex flex-row-reverse"},D={class:"z-50 sm:rounded-lg shadow-lg h-full w-full md:mt-2 overflow-y-hidden flex flex-col"},F={class:"overflow-y-auto flex flex-col flex-auto"},S=["onClick"],U={class:"flex items-center justify-between"},Y={class:"font-semibold"},H={class:"py-1 text-sm"},O={class:"flex justify-between"},W={class:"-mx-1 flex"},q={class:"ns-button info px-1"},G=["onClick"],J={class:"text-xs date"},K={key:0,class:"h-full w-full flex items-center justify-center"},M={class:"flex flex-col items-center"},Q={class:"text-fontcolor-soft text-sm"},R={class:"cursor-pointer clear-all"};function T(e,t,n,p,i,l){const g=E("ns-close-button");return c(),r("div",B,[s("div",{id:"notification-button",onClick:t[0]||(t[0]=o=>i.visible=!i.visible),class:b([i.visible?"panel-visible border-0 shadow-lg":"border panel-hidden","hover:shadow-lg hover:border-opacity-0 rounded-full h-12 w-12 cursor-pointer font-bold text-2xl justify-center items-center flex"])},[i.notifications.length>0?(c(),r("div",j,[s("div",P,[s("div",L,a(l.nsNumberAbbreviate(i.notifications.length,"abbreviate")),1)])])):h("",!0),t[3]||(t[3]=s("i",{class:"las la-bell"},null,-1))],2),i.visible?(c(),r("div",V,[s("div",z,[s("div",D,[s("div",{onClick:t[1]||(t[1]=o=>i.visible=!1),class:"sm:hidden p-2 cursor-pointer flex items-center justify-center border-b border-gray-200"},t[4]||(t[4]=[s("h3",{class:"font-semibold hover:text-info-primary"},"Close",-1)])),s("div",F,[(c(!0),r(_,null,x(i.notifications,o=>(c(),r("div",{key:o.id,class:"notification-card notice border-b"},[s("div",{class:b(["p-2",o.actions===null?"cursor-pointer":""]),onClick:d=>l.triggerLink(o)},[s("div",U,[s("h1",Y,a(o.title),1),A(g,{onClick:d=>l.closeNotice(d,o)},null,8,["onClick"])]),s("p",H,a(o.description),1),s("div",O,[s("div",W,[(c(!0),r(_,null,x(o.actions,d=>(c(),r("div",q,[s("button",{onClick:X=>l.executeAsync(d,o),class:"text-xs cursor-pointer px-2 py-1"},a(d.label),9,G)]))),256))]),s("div",null,[s("span",J,a(l.timespan(o.updated_at)),1)])])],10,S)]))),128)),i.notifications.length===0?(c(),r("div",K,[s("div",M,[t[5]||(t[5]=s("i",{class:"las la-laugh-wink text-5xl text-font"},null,-1)),s("p",Q,a(l.__("Nothing to care about !")),1)])])):h("",!0)]),s("div",R,[s("h3",{onClick:t[2]||(t[2]=o=>l.deleteAll()),class:"text-sm p-2 flex items-center justify-center w-full font-semibold"},a(l.__("Clear All")),1)])])])])):h("",!0)])}const ae=C(I,[["render",T]]);export{ae as default};
