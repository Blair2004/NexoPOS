import{p as S,b as w,P as O,F,n as T,a as V,d as z}from"./bootstrap-BLifOXMN.js";import{_ as a}from"./lang-BINodpp-.js";import{a as W,h as E,g as M,i as K,n as H}from"./ns-prompt-popup-Bc23cHDk.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,o as l,c as i,f as h,e as d,a as e,t as r,g as L,F as g,b as k,w as v,i as C,h as G,B as I,n as A}from"./runtime-core.esm-bundler-CZ21d09l.js";import{v as Q,w as U}from"./runtime-dom.esm-bundler-BXIQQKg6.js";import{n as Y}from"./ns-orders-preview-popup-DdsBXzCn.js";import{n as q}from"./currency-DQAAGb0G.js";const J={name:"ns-pos-quantity-popup",props:["popup"],components:{nsNumpad:W,nsNumpadPlus:E},data(){return{finalValue:1,virtualStock:null,options:{},optionsSubscription:null,allSelected:!0,isLoading:!1}},beforeDestroy(){this.optionsSubscription.unsubscribe()},mounted(){this.optionsSubscription=POS.options.subscribe(t=>{this.options=t}),this.popup.params.product.quantity&&(this.finalValue=this.popup.params.product.quantity),this.popupCloser()},unmounted(){nsHotPress.destroy("pos-quantity-numpad"),nsHotPress.destroy("pos-quantity-backspace"),nsHotPress.destroy("pos-quantity-enter")},methods:{__:a,popupCloser:S,closePopup(){this.popup.params.reject(!1),this.popup.close()},updateQuantity(t){this.finalValue=t},defineQuantity(t){const{product:s,data:c}=this.popup.params;if(t===0)return w.error(a("Please provide a quantity"));if(s.$original().stock_management==="enabled"&&s.$original().type==="materialized"){const b=POS.getStockUsage(s.$original().id,c.unit_quantity_id)-(s.quantity||0);if(t>parseFloat(c.$quantities().quantity)-b)return w.error(a("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",c.$quantities().quantity-b))}this.resolve({quantity:t})},resolve(t){this.popup.params.resolve(t),this.popup.close()}}},X={class:"ns-box shadow min-h-[40vh] w-3/4-screen md:w-3/5-screen lg:w-2/5-screen xl:w-2/5-screen relative"},Z={key:0,id:"loading-overlay",style:{background:"rgb(202 202 202 / 49%)"},class:"flex w-full h-full absolute top-O left-0 items-center justify-center"},$={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},ee={class:"text-xl font-bold text-fontcolor text-center"},se={id:"screen",class:"h-24 primary ns-box-body flex items-center justify-center"},te={class:"font-bold text-3xl"};function oe(t,s,c,b,n,o){const y=f("ns-spinner"),_=f("ns-close-button"),m=f("ns-numpad"),x=f("ns-numpad-plus");return l(),i("div",X,[n.isLoading?(l(),i("div",Z,[h(y)])):d("",!0),e("div",$,[e("div",null,[e("h1",ee,r(o.__("Define Quantity")),1)]),e("div",null,[h(_,{onClick:s[0]||(s[0]=u=>o.closePopup())})])]),e("div",se,[e("h1",te,r(n.finalValue),1)]),n.options.ns_pos_numpad==="default"?(l(),L(m,{key:1,floating:n.options.ns_pos_allow_decimal_quantities,onChanged:s[1]||(s[1]=u=>o.updateQuantity(u)),onNext:s[2]||(s[2]=u=>o.defineQuantity(u)),value:n.finalValue},null,8,["floating","value"])):d("",!0),n.options.ns_pos_numpad==="advanced"?(l(),L(x,{key:2,onChanged:s[3]||(s[3]=u=>o.updateQuantity(u)),onNext:s[4]||(s[4]=u=>o.defineQuantity(u)),value:n.finalValue},null,8,["value"])):d("",!0)])}const ne=j(J,[["render",oe]]);class Gn{constructor(s){this.product=s}run(s){return new Promise((c,b)=>{const n=this.product;if(POS.options.getValue().ns_pos_show_quantity!==!1||!POS.processingAddQueue)O.show(ne,{resolve:c,reject:b,product:n,data:s});else{if(n.$original().stock_management==="enabled"&&n.$original().type==="materialized"){const _=POS.getStockUsage(n.$original().id,s.unit_quantity_id)-(n.quantity||0);if(1>parseFloat(s.$quantities().quantity)-_)return w.error(a("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",(s.$quantities().quantity-_).toString()))}c({quantity:1})}})}}const re={mounted(){this.closeWithOverlayClicked(),this.loadTransactionFields()},props:["popup"],data(){return{fields:[],isSubmiting:!1,formValidation:new F}},methods:{__:a,closeWithOverlayClicked:S,proceed(){const t=this.popup.params.customer,s=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,T.post(`/api/customers/${t.id}/account-history`,s).subscribe({next:c=>{this.isSubmiting=!1,w.success(c.message),this.popup.params.resolve(c),this.popup.close()},error:c=>{this.isSubmiting=!1,w.error(c.message),this.popup.params.reject(c)}})},close(){this.popup.close(),this.popup.params.reject(!1)},loadTransactionFields(){T.get("/api/fields/ns.customers-account").subscribe({next:t=>{this.fields=this.formValidation.createFields(t)}})}}},le={class:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-[85vh] md:h-[80vh] lg:h-[75vh] overflow-hidden shadow-lg ns-box flex flex-col relative"},ie={class:"p-2 border-b ns-box-header flex justify-between items-center"},ce={class:"font-semibold"},ue={class:"flex-auto overflow-y-auto"},de={key:0,class:"h-full w-full flex items-center justify-center"},ae={key:1,class:"p-2"},_e={class:"p-2 ns-box-footer justify-between border-t flex"},pe={class:"px-1"},he={class:"-mx-2 flex flex-wrap"},fe={class:"px-1"},me={class:"px-1"},be={key:0,class:"h-full w-full absolute flex items-center justify-center",style:{background:"rgb(0 98 171 / 45%)"}};function ve(t,s,c,b,n,o){const y=f("ns-close-button"),_=f("ns-spinner"),m=f("ns-field"),x=f("ns-button");return l(),i("div",le,[e("div",ie,[e("h2",ce,r(o.__("New Transaction")),1),e("div",null,[h(y,{onClick:s[0]||(s[0]=u=>o.close())})])]),e("div",ue,[n.fields.length===0?(l(),i("div",de,[h(_)])):d("",!0),n.fields.length>0?(l(),i("div",ae,[(l(!0),i(g,null,k(n.fields,(u,P)=>(l(),L(m,{field:u,key:P},null,8,["field"]))),128))])):d("",!0)]),e("div",_e,[s[3]||(s[3]=e("div",null,null,-1)),e("div",pe,[e("div",he,[e("div",fe,[h(x,{type:"error",onClick:s[1]||(s[1]=u=>o.close())},{default:v(()=>[C(r(o.__("Close")),1)]),_:1})]),e("div",me,[h(x,{type:"info",onClick:s[2]||(s[2]=u=>o.proceed())},{default:v(()=>[C(r(o.__("Proceed")),1)]),_:1})])])])]),n.isSubmiting===0?(l(),i("div",be,[h(_)])):d("",!0)])}const xe=j(re,[["render",ve]]),ye={name:"ns-pos-coupons-load-popup",props:["popup"],components:{nsNotice:M},data(){return{placeHolder:a("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,coupon:null}},mounted(){this.popupCloser(),this.orderSubscriber=POS.order.subscribe(t=>{this.order=G(t),this.order.coupons.length>0&&(this.activeTab="active-coupons")}),this.popup.params&&this.popup.params.apply_coupon&&(this.couponCode=this.popup.params.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:t=>{this.coupon=t,this.apply()}}))},unmounted(){this.orderSubscriber.unsubscribe()},methods:{__:a,popupCloser:S,popupResolver:V,selectCustomer(){Popup.show(B)},cancel(){this.coupon=null,this.couponCode=null},removeCoupon(t){this.order.coupons.splice(t,1),POS.refreshCart()},apply(){try{if(this.coupon.valid_hours_start!==null&&!ns.date.moment.isAfter(this.coupon.valid_hours_start)&&this.coupon.valid_hours_start.length>0)return w.error(a("The coupon is out from validity date range."));if(this.coupon.valid_hours_end!==null&&!ns.date.moment.isBefore(this.coupon.valid_hours_end)&&this.coupon.valid_hours_end.length>0)return w.error(a("The coupon is out from validity date range."));const t=this.coupon.products;if(t.length>0){const b=t.map(n=>n.product_id);if(this.order.products.filter(n=>b.includes(n.product_id)).length===0)return w.error(a("This coupon requires products that aren't available on the cart at the moment."))}const s=this.coupon.categories;if(s.length>0){const b=s.map(n=>n.category_id);if(this.order.products.filter(n=>b.includes(n.$original().category_id)).length===0)return w.error(a("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s"))}let c={customer_coupon_id:this.coupon.customer_coupon.length>0?this.coupon.customer_coupon[0].id:0,minimum_cart_value:this.coupon.minimum_cart_value,maximum_cart_value:this.coupon.maximum_cart_value,name:this.coupon.name,type:this.coupon.type,value:0,coupon_id:this.coupon.id,limit_usage:this.coupon.limit_usage,code:this.coupon.code,discount_value:this.coupon.discount_value,categories:this.coupon.categories,products:this.coupon.products};this.cancel(),POS.pushCoupon(c),this.activeTab="active-coupons",setTimeout(()=>{this.popupResolver(c)},500),w.success(a("The coupon has applied to the cart."))}catch(t){console.log(t)}},getCouponType(t){switch(t){case"percentage_discount":return a("Percentage");case"flat_discount":return a("Flat");default:return a("Unknown Type")}},getDiscountValue(t){switch(t.type){case"percentage_discount":return t.discount_value+"%";case"flat_discount":return this.$options.filters.currency(t.discount_value)}},closePopup(){this.popupResolver(!1)},setActiveTab(t){this.activeTab=t,t==="apply-coupon"&&setTimeout(()=>{document.querySelector(".coupon-field").select()},10)},getCoupon(t){return!this.order.customer_id>0?w.error(a("You must select a customer before applying a coupon.")):T.post(`/api/customers/coupons/${t}`,{customer_id:this.order.customer_id})},loadCoupon(){const t=this.couponCode;this.getCoupon(t).subscribe({next:s=>{this.coupon=s,w.success(a("The coupon has been loaded."))},error:s=>{w.error(s.message||a("An unexpected error occurred."))}})}}},ge={class:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-1/3-screen"},we={class:"border-b ns-box-header p-2 flex justify-between items-center"},Ce={class:"font-bold"},ke={class:"p-1 ns-box-body"},Pe={class:"border-2 input-group info rounded flex"},Se=["placeholder"],Oe={class:"pt-2"},Te={key:0,class:"pt-2 flex"},je={key:1,class:"pt-2"},Ve={class:"overflow-hidden"},Le={key:0,class:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},Ne={class:"w-full ns-table"},Ae={class:"p-2 w-1/2 border"},Re={class:"p-2 w-1/2 border"},Fe={class:"p-2 w-1/2 border"},qe={class:"p-2 w-1/2 border"},He={class:"p-2 w-1/2 border"},De={class:"p-2 w-1/2 border"},Ie={class:"p-2 w-1/2 border"},Qe={class:"p-2 w-1/2 border"},Ue={class:"p-2 w-1/2 border"},Be={class:"p-2 w-1/2 border"},ze={class:"p-2 w-1/2 border"},We={class:"p-2 w-1/2 border"},Ee={key:0},Me={class:"p-2 w-1/2 border"},Ke={class:"p-2 w-1/2 border"},Ge={key:0},Ye={key:0},Je={class:"flex-auto"},Xe={class:"font-semibold text-fontcolor p-2 flex justify-between"},Ze={key:0,class:"flex justify-between elevation-surface border items-center p-2"},$e={key:0,class:"flex"};function es(t,s,c,b,n,o){const y=f("ns-close-button"),_=f("ns-notice"),m=f("ns-tabs-item"),x=f("ns-tabs");return l(),i("div",ge,[e("div",we,[e("h3",Ce,r(o.__("Load Coupon")),1),e("div",null,[h(y,{onClick:s[0]||(s[0]=u=>o.closePopup())})])]),e("div",ke,[h(x,{onActive:s[5]||(s[5]=u=>o.setActiveTab(u)),active:n.activeTab},{default:v(()=>[h(m,{label:o.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"},{default:v(()=>[e("div",Pe,[I(e("input",{ref:"coupon",onKeyup:s[1]||(s[1]=U(u=>o.loadCoupon(),["enter"])),"onUpdate:modelValue":s[2]||(s[2]=u=>n.couponCode=u),type:"text",class:"coupon-field w-full text-fontcolor p-2 outline-hidden",placeholder:n.placeHolder},null,40,Se),[[Q,n.couponCode]]),e("button",{onClick:s[3]||(s[3]=u=>o.loadCoupon()),class:"px-3 py-2"},r(o.__("Load")),1)]),e("div",Oe,[h(_,{color:"info"},{description:v(()=>[C(r(o.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")),1)]),_:1})]),n.order&&n.order.customer_id===void 0?(l(),i("div",Te,[e("button",{onClick:s[4]||(s[4]=u=>o.selectCustomer()),class:"w-full border p-2 outline-hidden ns-numpad-key info cursor-pointer text-center"},r(o.__("Click here to choose a customer.")),1)])):d("",!0),n.order&&n.order.customer_id!==void 0?(l(),i("div",je,[h(_,{color:"success"},{description:v(()=>[C(r(o.__("Loading Coupon For : ")+`${n.order.customer.first_name} ${n.order.customer.last_name}`),1)]),_:1})])):d("",!0),e("div",Ve,[n.coupon?(l(),i("div",Le,[e("table",Ne,[e("tbody",null,[e("tr",null,[e("td",Ae,r(o.__("Coupon Name")),1),e("td",Re,r(n.coupon.name),1)]),e("tr",null,[e("td",Fe,r(o.__("Discount"))+" ("+r(o.getCouponType(n.coupon.type))+")",1),e("td",qe,r(o.getDiscountValue(n.coupon)),1)]),e("tr",null,[e("td",He,r(o.__("Usage")),1),e("td",De,r((n.coupon.customer_coupon.length>0?n.coupon.customer_coupon[0].usage:0)+"/"+(n.coupon.limit_usage||o.__("Unlimited"))),1)]),e("tr",null,[e("td",Ie,r(o.__("Valid From")),1),e("td",Qe,r(n.coupon.valid_hours_start||o.__("N/A")),1)]),e("tr",null,[e("td",Ue,r(o.__("Valid Till")),1),e("td",Be,r(n.coupon.valid_hours_end||o.__("N/A")),1)]),e("tr",null,[e("td",ze,r(o.__("Categories")),1),e("td",We,[e("ul",null,[(l(!0),i(g,null,k(n.coupon.categories,u=>(l(),i("li",{class:"rounded-full px-3 py-1 border",key:u.id},r(u.category.name),1))),128)),n.coupon.categories.length===0?(l(),i("li",Ee,r(o.__("Not applicable")),1)):d("",!0)])])]),e("tr",null,[e("td",Me,r(o.__("Products")),1),e("td",Ke,[e("ul",null,[(l(!0),i(g,null,k(n.coupon.products,u=>(l(),i("li",{class:"rounded-full px-3 py-1 border",key:u.id},r(u.product.name),1))),128)),n.coupon.products.length===0?(l(),i("li",Ge,r(o.__("Not applicable")),1)):d("",!0)])])])])])])):d("",!0)])]),_:1},8,["label"]),h(m,{label:o.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"},{default:v(()=>[n.order?(l(),i("ul",Ye,[(l(!0),i(g,null,k(n.order.coupons,(u,P)=>(l(),i("li",{key:P,class:"flex justify-between elevation-surface border items-center px-2 py-1"},[e("div",Je,[e("h3",Xe,[e("span",null,r(u.name),1),e("span",null,r(o.getDiscountValue(u)),1)])]),e("div",null,[h(y,{onClick:N=>o.removeCoupon(P)},null,8,["onClick"])])]))),128)),n.order.coupons.length===0?(l(),i("li",Ze,r(o.__("No coupons applies to the cart.")),1)):d("",!0)])):d("",!0)]),_:1},8,["label"])]),_:1},8,["active"])]),n.coupon?(l(),i("div",$e,[e("button",{onClick:s[6]||(s[6]=u=>o.apply()),class:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold"},r(o.__("Apply")),1),e("button",{onClick:s[7]||(s[7]=u=>o.cancel()),class:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold"},r(o.__("Cancel")),1)])):d("",!0)])}const ss=j(ye,[["render",es]]),ts={name:"ns-pos-customers",props:["popup"],data(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],userCan:t=>POS.userCan(t),rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:K},unmounted(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted(){this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe(t=>{this.options=t}),this.subscription=POS.order.subscribe(t=>{this.order=t,this.popup.params.customer!==void 0?(this.activeTab="account-payment",this.customer=this.popup.params.customer,this.loadCustomerOrders()):t.customer!==void 0&&(this.activeTab="account-payment",this.customer=t.customer,this.loadCustomerOrders())}),this.popupCloser()},methods:{__:a,nsCurrency:q,reload(){this.loadCustomerOrders()},popupResolver:V,popupCloser:S,getWalletHistoryLabel(t){switch(t){case"add":return a("Crediting");case"deduct":return a("Removing");case"refund":return a("Refunding");case"payment":return a("Payment");default:return a("Unknow")}},getType(t){switch(t){case"percentage_discount":return a("Percentage Discount");case"flat_discount":return a("Flat Discount")}},closeWithOverlayClicked:S,async openOrderOptions(t){try{const s=await new Promise((c,b)=>{O.show(Y,{order:t,resolve:c,reject:b})});this.reload()}catch{w.error(a("An error occurred while opening the order options"))}},doChangeTab(t){this.selectedTab=t,t==="coupons"&&this.loadCoupons(),t==="rewards"&&this.loadRewards(),t==="wallet-history"&&this.loadAccounHistory(),t==="orders"&&this.loadCustomerOrders()},loadAccounHistory(){this.isLoadingHistory=!0,T.get(`/api/customers/${this.customer.id}/account-history`).subscribe({next:t=>{this.walletHistories=t.data,this.isLoadingHistory=!1},error:t=>{this.isLoadingHistory=!1}})},loadCoupons(){this.isLoadingCoupons=!0,T.get(`/api/customers/${this.customer.id}/coupons`).subscribe({next:t=>{this.coupons=t,this.isLoadingCoupons=!1},error:t=>{this.isLoadingCoupons=!1}})},loadRewards(t=`/api/customers/${this.customer.id}/rewards`){this.isLoadingRewards=!0,T.get(t).subscribe({next:s=>{this.rewardsResponse=s,this.isLoadingRewards=!1},error:s=>{this.isLoadingRewards=!1}})},prefillForm(t){this.popup.params.name!==void 0&&(t.main.value=this.popup.params.name)},openCustomerSelection(){this.popup.close(t=>{O.show(B)})},loadCustomerOrders(){this.isLoadingOrders=!0,T.get(`/api/customers/${this.customer.id}/orders`).subscribe({next:t=>{this.orders=t,this.isLoadingOrders=!1},error:t=>{this.isLoadingOrders=!1}})},newTransaction(t){new Promise((c,b)=>{O.show(xe,{customer:t,resolve:c,reject:b})}).then(c=>{POS.loadCustomer(t.id).subscribe(b=>{POS.selectCustomer(b)})})},applyCoupon(t){this.order.customer===void 0?O.show(H,{title:a("Use Customer ?"),message:a("No customer is selected. Would you like to proceed with this customer ?"),onAction:s=>{s&&POS.selectCustomer(this.customer).then(c=>{this.proceedApplyingCoupon(t)})}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(t):this.order.customer.id!==this.customer.id&&O.show(H,{title:a("Change Customer ?"),message:a("Would you like to assign this customer to the ongoing order ?"),onAction:s=>{s&&POS.selectCustomer(this.customer).then(c=>{this.proceedApplyingCoupon(t)})}})},proceedApplyingCoupon(t){new Promise((s,c)=>{O.show(ss,{apply_coupon:t.code,resolve:s,reject:c})}).then(s=>{this.popupResolver(!1)}).catch(s=>{})},handleSavedCustomer(t){w.success(t.message),POS.selectCustomer(t.data.entry),this.popup.close()}}},os={id:"ns-pos-customers",class:"shadow-lg rounded-lg w-[95vw] h-[95vh] lg:w-3/5-screen flex flex-col overflow-hidden"},rs={class:"ns-header p-2 flex justify-between items-center border-b"},ls={class:"font-semibold"},is={class:"ns-body flex-auto flex p-2 overflow-y-auto"},cs={key:1,class:"h-full flex-col w-full flex items-center justify-center text-font"},us={class:"font-medium text-2xl"},ds={key:0,class:"flex-auto w-full flex items-center justify-center flex-col p-4"},as={class:"font-medium text-2xl"},_s={class:"my-2"},ps={key:1,class:"flex flex-col flex-auto"},hs={class:"flex-auto p-2 flex flex-col"},fs={class:"flex flex-wrap"},ms={class:"px-4 mb-4 w-full"},bs={class:"font-semibold"},vs={class:"flex flex-wrap ns-tab-cards -mx-2 w-full"},xs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ys={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},gs={class:"font-medium text-lg"},ws={class:"w-full flex justify-end"},Cs={class:"font-bold"},ks={class:"px-2 mb-4 w-full md:w-1/4 flex"},Ps={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},Ss={class:"font-medium text-lg"},Os={class:"w-full flex justify-end"},Ts={class:"font-bold"},js={class:"px-2 mb-4 w-full md:w-1/4 flex"},Vs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},Ls={class:"font-medium text-lg"},Ns={class:"w-full flex justify-end"},As={class:"font-bold"},Rs={class:"px-2 mb-4 w-full md:w-1/4 flex"},Fs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},qs={class:"font-medium text-lg"},Hs={class:"w-full flex justify-end"},Ds={class:"font-bold"},Is={class:"flex flex-auto flex-col overflow-hidden"},Qs={key:0,class:"flex-auto h-full justify-center flex items-center"},Us={class:"py-2 w-full"},Bs={class:"font-semibold text-font"},zs={class:"flex-auto flex-col flex overflow-hidden"},Ws={class:"flex-auto overflow-y-auto"},Es={class:"table ns-table w-full"},Ms={class:"text-fontcolor"},Ks={colspan:"3",width:"150",class:"p-2 border font-semibold"},Gs={width:"50",class:"p-2 border font-semibold"},Ys={class:"text-fontcolor"},Js={key:0},Xs={class:"border p-2 text-center",colspan:"4"},Zs={colspan:"3",class:"border p-2 text-center"},$s={class:"flex flex-col items-start"},et={class:"font-bold"},st={class:"md:-mx-2 w-full flex flex-col md:flex-row"},tt={class:"md:px-2 flex items-start w-full md:w-1/4"},ot={class:"md:px-2 flex items-start w-full md:w-1/4"},nt={class:"md:px-2 flex items-start w-full md:w-1/4"},rt={class:"border p-2 text-center"},lt=["onClick"],it={class:"ml-1"},ct={key:0,class:"flex-auto h-full justify-center flex items-center"},ut={class:"py-2 w-full"},dt={class:"font-semibold text-font"},at={class:"flex-auto flex-col flex overflow-hidden"},_t={class:"flex-auto overflow-y-auto"},pt={class:"table ns-table w-full"},ht={class:"text-fontcolor"},ft={colspan:"3",width:"150",class:"p-2 border font-semibold"},mt={class:"text-fontcolor"},bt={key:0},vt={class:"border p-2 text-center",colspan:"3"},xt={colspan:"3",class:"border p-2 text-center"},yt={class:"flex flex-col items-start"},gt={class:"font-bold"},wt={class:"md:-mx-2 w-full flex flex-col md:flex-row"},Ct={class:"md:px-2 flex items-start w-full md:w-1/3"},kt={class:"md:px-2 flex items-start w-full md:w-1/3"},Pt={key:0,class:"flex-auto h-full justify-center flex items-center"},St={class:"py-2 w-full"},Ot={class:"font-semibold text-font"},Tt={class:"flex-auto flex-col flex overflow-hidden"},jt={class:"flex-auto overflow-y-auto"},Vt={class:"table ns-table w-full"},Lt={class:"text-fontcolor"},Nt={width:"150",class:"p-2 border font-semibold"},At={class:"p-2 border font-semibold"},Rt={class:"text-fontcolor text-sm"},Ft={key:0},qt={class:"border p-2 text-center",colspan:"4"},Ht={width:"300",class:"border p-2"},Dt={class:""},It={class:"-mx-2 flex"},Qt={class:"text-xs text-fontcolor px-2"},Ut={class:"text-xs text-fontcolor px-2"},Bt={class:"border p-2 text-center"},zt={key:0},Wt={key:1},Et={class:"border p-2 text-right"},Mt={key:0,class:"flex-auto h-full justify-center flex items-center"},Kt={class:"py-2 w-full"},Gt={class:"font-semibold text-font"},Yt={class:"flex-auto flex-col flex overflow-hidden"},Jt={class:"flex-auto overflow-y-auto"},Xt={class:"table ns-table w-full"},Zt={class:"text-fontcolor"},$t={width:"150",class:"p-2 border font-semibold"},eo={class:"p-2 border font-semibold"},so={class:"p-2 border font-semibold"},to={key:0,class:"text-fontcolor text-sm"},oo={key:0},no={class:"border p-2 text-center",colspan:"4"},ro={width:"300",class:"border p-2"},lo={class:"text-center"},io={width:"300",class:"border p-2"},co={class:"text-center"},uo={width:"300",class:"border p-2"},ao={class:"text-center"},_o={class:"py-1 flex justify-end"},po={class:"p-2 border-t border-box-edge flex justify-between"};function ho(t,s,c,b,n,o){const y=f("ns-close-button"),_=f("ns-crud-form"),m=f("ns-tabs-item"),x=f("ns-button"),u=f("ns-spinner"),P=f("ns-paginate"),N=f("ns-tabs");return l(),i("div",os,[e("div",rs,[e("h3",ls,r(o.__("Customers")),1),e("div",null,[h(y,{onClick:s[0]||(s[0]=p=>c.popup.close())})])]),e("div",is,[h(N,{active:n.activeTab,onActive:s[7]||(s[7]=p=>n.activeTab=p)},{default:v(()=>[h(m,{identifier:"create-customers",label:o.__("New Customer")},{default:v(()=>[n.userCan("nexopos.create.customers")?(l(),L(_,{key:0,onUpdated:s[1]||(s[1]=p=>o.prefillForm(p)),onSave:s[2]||(s[2]=p=>o.handleSavedCustomer(p)),"submit-url":"/api/crud/ns.customers",src:"/api/crud/ns.customers/form-config"},{title:v(()=>[C(r(o.__("Customer Name")),1)]),save:v(()=>[C(r(o.__("Save Customer")),1)]),_:1})):d("",!0),n.userCan("nexopos.create.customers")?d("",!0):(l(),i("div",cs,[s[8]||(s[8]=e("i",{class:"lar la-hand-paper ns-icon text-6xl"},null,-1)),e("h3",us,r(o.__("Not Authorized")),1),e("p",null,r(o.__("Creating customers has been explicitly disabled from the settings.")),1)]))]),_:1},8,["label"]),h(m,{identifier:"account-payment",label:o.__("Customer Account"),class:"flex",padding:"p-0 flex"},{default:v(()=>[n.customer===null?(l(),i("div",ds,[s[9]||(s[9]=e("i",{class:"lar la-frown text-6xl"},null,-1)),e("h3",as,r(o.__("No Customer Selected")),1),e("p",null,r(o.__("In order to see a customer account, you need to select one customer.")),1),e("div",_s,[h(x,{onClick:s[3]||(s[3]=p=>o.openCustomerSelection()),type:"info"},{default:v(()=>[C(r(o.__("Select Customer")),1)]),_:1})])])):d("",!0),n.customer?(l(),i("div",ps,[e("div",hs,[e("div",fs,[e("div",ms,[e("h2",bs,r(o.__("Summary For"))+" : "+r(n.customer.first_name),1)]),e("div",vs,[e("div",xs,[e("div",ys,[e("h3",gs,r(o.__("Purchases")),1),e("div",ws,[e("h2",Cs,r(o.nsCurrency(n.customer.purchases_amount)),1)])])]),e("div",ks,[e("div",Ps,[e("h3",Ss,r(o.__("Owed")),1),e("div",Os,[e("h2",Ts,r(o.nsCurrency(n.customer.owed_amount)),1)])])]),e("div",js,[e("div",Vs,[e("h3",Ls,r(o.__("Wallet Amount")),1),e("div",Ns,[e("h2",As,r(o.nsCurrency(n.customer.account_amount)),1)])])]),e("div",Rs,[e("div",Fs,[e("h3",qs,r(o.__("Credit Limit")),1),e("div",Hs,[e("h2",Ds,r(o.nsCurrency(n.customer.credit_limit_amount)),1)])])])])]),e("div",Is,[h(N,{active:n.selectedTab,onChangeTab:s[5]||(s[5]=p=>o.doChangeTab(p))},{default:v(()=>[h(m,{identifier:"orders",label:o.__("Orders")},{default:v(()=>[n.isLoadingOrders?(l(),i("div",Qs,[h(u,{size:"36"})])):d("",!0),n.isLoadingOrders?d("",!0):(l(),i(g,{key:1},[e("div",Us,[e("h2",Bs,r(o.__("Last Purchases")),1)]),e("div",zs,[e("div",Ws,[e("table",Es,[e("thead",null,[e("tr",Ms,[e("th",Ks,r(o.__("Order")),1),e("th",Gs,r(o.__("Options")),1)])]),e("tbody",Ys,[n.orders.length===0?(l(),i("tr",Js,[e("td",Xs,r(o.__("No orders...")),1)])):d("",!0),(l(!0),i(g,null,k(n.orders,p=>(l(),i("tr",{key:p.id},[e("td",Zs,[e("div",$s,[e("h3",et,r(o.__("Code"))+": "+r(p.code),1),e("div",st,[e("div",tt,[e("small",null,r(o.__("Total"))+": "+r(o.nsCurrency(p.total)),1)]),e("div",ot,[e("small",null,r(o.__("Status"))+": "+r(p.human_status),1)]),e("div",nt,[e("small",null,r(o.__("Delivery"))+": "+r(p.human_delivery_status),1)])])])]),e("td",rt,[e("button",{onClick:R=>o.openOrderOptions(p),class:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success"},[s[10]||(s[10]=e("i",{class:"las la-wallet"},null,-1)),e("span",it,r(o.__("Options")),1)],8,lt)])]))),128))])])])])],64))]),_:1},8,["label"]),h(m,{identifier:"wallet-history",label:o.__("Wallet History")},{default:v(()=>[n.isLoadingHistory?(l(),i("div",ct,[h(u,{size:"36"})])):d("",!0),n.isLoadingHistory?d("",!0):(l(),i(g,{key:1},[e("div",ut,[e("h2",dt,r(o.__("Wallet History")),1)]),e("div",at,[e("div",_t,[e("table",pt,[e("thead",null,[e("tr",ht,[e("th",ft,r(o.__("Transaction")),1)])]),e("tbody",mt,[n.walletHistories.length===0?(l(),i("tr",bt,[e("td",vt,r(o.__("No History...")),1)])):d("",!0),(l(!0),i(g,null,k(n.walletHistories,p=>(l(),i("tr",{key:p.id},[e("td",xt,[e("div",yt,[e("h3",gt,r(o.__("Transaction"))+": "+r(o.getWalletHistoryLabel(p.operation)),1),e("div",wt,[e("div",Ct,[e("small",null,r(o.__("Amount"))+": "+r(o.nsCurrency(t.amount)),1)]),e("div",kt,[e("small",null,r(o.__("Date"))+": "+r(p.created_at),1)])])])])]))),128))])])])])],64))]),_:1},8,["label"]),h(m,{identifier:"coupons",label:o.__("Coupons")},{default:v(()=>[n.isLoadingCoupons?(l(),i("div",Pt,[h(u,{size:"36"})])):d("",!0),n.isLoadingCoupons?d("",!0):(l(),i(g,{key:1},[e("div",St,[e("h2",Ot,r(o.__("Coupons")),1)]),e("div",Tt,[e("div",jt,[e("table",Vt,[e("thead",null,[e("tr",Lt,[e("th",Nt,r(o.__("Name")),1),e("th",At,r(o.__("Type")),1),s[11]||(s[11]=e("th",{class:"p-2 border font-semibold"},null,-1))])]),e("tbody",Rt,[n.coupons.length===0?(l(),i("tr",Ft,[e("td",qt,r(o.__("No coupons for the selected customer...")),1)])):d("",!0),(l(!0),i(g,null,k(n.coupons,p=>(l(),i("tr",{key:p.id},[e("td",Ht,[e("h3",null,r(p.name),1),e("div",Dt,[e("ul",It,[e("li",Qt,r(o.__("Usage :"))+" "+r(p.usage)+"/"+r(p.limit_usage),1),e("li",Ut,r(o.__("Code :"))+" "+r(p.code),1)])])]),e("td",Bt,[C(r(o.getType(p.coupon.type))+" ",1),p.coupon.type==="percentage_discount"?(l(),i("span",zt," ("+r(p.coupon.discount_value)+"%) ",1)):d("",!0),p.coupon.type==="flat_discount"?(l(),i("span",Wt," ("+r(o.nsCurrency(t.value))+") ",1)):d("",!0)]),e("td",Et,[h(x,{onClick:R=>o.applyCoupon(p),type:"info"},{default:v(()=>[C(r(o.__("Use Coupon")),1)]),_:2},1032,["onClick"])])]))),128))])])])])],64))]),_:1},8,["label"]),h(m,{identifier:"rewards",label:o.__("Rewards")},{default:v(()=>[n.isLoadingRewards?(l(),i("div",Mt,[h(u,{size:"36"})])):d("",!0),n.isLoadingRewards?d("",!0):(l(),i(g,{key:1},[e("div",Kt,[e("h2",Gt,r(o.__("Rewards")),1)]),e("div",Yt,[e("div",Jt,[e("table",Xt,[e("thead",null,[e("tr",Zt,[e("th",$t,r(o.__("Name")),1),e("th",eo,r(o.__("Points")),1),e("th",so,r(o.__("Target")),1)])]),n.rewardsResponse.data?(l(),i("tbody",to,[n.rewardsResponse.data.length===0?(l(),i("tr",oo,[e("td",no,r(o.__("No rewards available the selected customer...")),1)])):d("",!0),(l(!0),i(g,null,k(n.rewardsResponse.data,p=>(l(),i("tr",{key:p.id},[e("td",ro,[e("h3",lo,r(p.reward_name),1)]),e("td",io,[e("h3",co,r(p.points),1)]),e("td",uo,[e("h3",ao,r(p.target),1)])]))),128))])):d("",!0)])])]),e("div",_o,[h(P,{pagination:n.rewardsResponse,onLoad:s[4]||(s[4]=p=>o.loadRewards(p))},null,8,["pagination"])])],64))]),_:1},8,["label"])]),_:1},8,["active"])])]),e("div",po,[s[12]||(s[12]=e("div",null,null,-1)),e("div",null,[h(x,{onClick:s[6]||(s[6]=p=>o.newTransaction(n.customer)),type:"info"},{default:v(()=>[C(r(o.__("Account Transaction")),1)]),_:1})])])])):d("",!0)]),_:1},8,["label"])]),_:1},8,["active"])])])}const D=j(ts,[["render",ho]]),fo={props:["popup"],data(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected(){return!1}},watch:{searchCustomerValue(t){clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout(()=>{this.searchCustomer(t)},500)}},mounted(){this.orderSubscription=POS.order.subscribe(t=>{this.order=t}),this.getRecentCustomers(),this.$refs.searchField.focus(),this.popupCloser()},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:a,popupCloser:S,nsCurrency:q,resolveIfQueued:V,attemptToChoose(){if(this.customers.length===1)return this.selectCustomer(this.customers[0]);w.info(a("Too many results."))},openCustomerHistory(t,s){s.stopImmediatePropagation(),this.popup.close(),O.show(D,{customer:t,activeTab:"account-payment"})},selectCustomer(t){this.customers.forEach(s=>s.selected=!1),t.selected=!0,this.isLoading=!0,POS.selectCustomer(t).then(s=>{this.isLoading=!1,this.resolveIfQueued(t)}).catch(s=>{this.isLoading=!1})},searchCustomer(t){T.post("/api/customers/search",{search:t}).subscribe(s=>{s.forEach(c=>c.selected=!1),this.customers=s})},createCustomerWithMatch(t){this.resolveIfQueued(!1),O.show(D,{name:t})},getRecentCustomers(){this.isLoading=!0,T.get("/api/customers/recently-active").subscribe({next:t=>{this.isLoading=!1,t.forEach(s=>s.selected=!1),this.customers=t},error:t=>{this.isLoading=!1}})}}},mo={id:"ns-pos-customer-select-popup",class:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108"},bo={id:"header",class:"border-b ns-box-header text-center font-semibold text-2xl py-2"},vo={class:"relative"},xo={class:"p-2 border-b ns-box-body items-center flex justify-between"},yo={class:"flex items-center justify-between"},go={class:"p-2 border-b ns-box-body flex justify-between text-font"},wo={class:"input-group flex-auto border-2 rounded"},Co={class:"h-[60vh] xl:h-[60vh] overflow-y-auto ns-scrollbar"},ko={class:"ns-vertical-menu"},Po={key:0,class:"p-2 text-center text-font"},So={class:"border-b border-dashed border-info-primary"},Oo=["onClick"],To={class:"flex flex-col"},jo={key:0,class:"text-xs text-fontcolor-soft"},Vo={key:1,class:"text-xs text-fontcolor-soft"},Lo={class:"flex items-center"},No={key:0,class:"text-error-primary"},Ao={key:1},Ro={class:"purchase-amount"},Fo=["onClick"],qo={key:0,class:"z-10 top-0 absolute w-full h-full flex items-center justify-center"};function Ho(t,s,c,b,n,o){const y=f("ns-spinner");return l(),i("div",mo,[e("div",bo,[e("h2",null,r(o.__("Select Customer")),1)]),e("div",vo,[e("div",xo,[e("span",null,r(o.__("Selected"))+" : ",1),e("div",yo,[e("span",null,r(n.order.customer?`${n.order.customer.first_name} ${n.order.customer.last_name}`:"N/A"),1),n.order.customer?(l(),i("button",{key:0,onClick:s[0]||(s[0]=_=>o.openCustomerHistory(n.order.customer,_)),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent"},s[4]||(s[4]=[e("i",{class:"las la-eye"},null,-1)]))):d("",!0)])]),e("div",go,[e("div",wo,[I(e("input",{ref:"searchField",onKeydown:s[1]||(s[1]=U(_=>o.attemptToChoose(),["enter"])),"onUpdate:modelValue":s[2]||(s[2]=_=>n.searchCustomerValue=_),placeholder:"Search Customer",type:"text",class:"outline-hidden w-full p-2"},null,544),[[Q,n.searchCustomerValue]])])]),e("div",Co,[e("ul",ko,[n.customers&&n.customers.length===0?(l(),i("li",Po,r(o.__("No customer match your query...")),1)):d("",!0),n.customers&&n.customers.length===0?(l(),i("li",{key:1,onClick:s[3]||(s[3]=_=>o.createCustomerWithMatch(n.searchCustomerValue)),class:"p-2 cursor-pointer text-center text-font"},[e("span",So,r(o.__("Create a customer")),1)])):d("",!0),(l(!0),i(g,null,k(n.customers,_=>(l(),i("li",{onClick:m=>o.selectCustomer(_),key:_.id,class:"cursor-pointer p-2 border-b text-fontcolor flex justify-between items-center"},[e("div",To,[e("span",null,r(_.first_name)+" "+r(_.last_name),1),_.group?(l(),i("small",jo,r(_.group.name),1)):(l(),i("small",Vo,r(o.__("No Group Assigned")),1))]),e("p",Lo,[_.owe_amount>0?(l(),i("span",No,"-"+r(o.nsCurrency(_.owe_amount)),1)):d("",!0),_.owe_amount>0?(l(),i("span",Ao,"/")):d("",!0),e("span",Ro,r(o.nsCurrency(_.purchases_amount)),1),e("button",{onClick:m=>o.openCustomerHistory(_,m),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info"},s[5]||(s[5]=[e("i",{class:"las la-eye"},null,-1)]),8,Fo)])],8,Oo))),128))])]),n.isLoading?(l(),i("div",qo,[h(y,{size:"24",border:"8"})])):d("",!0)])])}const B=j(fo,[["render",Ho]]),Do={name:"ns-pos-discount-popup",props:["popup"],data(){return{finalValue:1,virtualStock:null,popupSubscription:null,mode:"",type:"",allSelected:!0,isLoading:!1,keys:[...[7,8,9].map(t=>({identifier:t,value:t})),...[4,5,6].map(t=>({identifier:t,value:t})),...[1,2,3].map(t=>({identifier:t,value:t})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}]}},mounted(){this.mode=this.popup.params.reference.discount_type||"percentage",this.type=this.popup.params.type,this.mode==="percentage"?this.finalValue=this.popup.params.reference.discount_percentage||1:this.finalValue=this.popup.params.reference.discount||1,this.popupCloser()},methods:{__:a,nsCurrency:q,popupResolver:V,popupCloser:S,submitValue(){this.popup.params.onSubmit({discount_type:this.mode,discount_percentage:this.mode==="percentage"?this.finalValue:void 0,discount:this.mode==="flat"?this.finalValue:void 0}),this.popup.close()},setPercentageType(t){this.mode=t},closePopup(){this.popup.close()},inputValue(t){this.finalValue=t}}},Io={id:"discount-popup",class:"ns-box shadow w-6/7-screen md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen relative"},Qo={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},Uo={key:0,class:"text-xl font-bold text-fontcolor text-center"},Bo={key:1,class:"text-xl font-bold text-fontcolor text-center"},zo={id:"screen",class:"h-16 ns-box-body text-white flex items-center justify-center"},Wo={class:"font-bold text-3xl"},Eo={key:0},Mo={key:1},Ko={id:"switch-mode",class:"flex"},Go={key:1,class:"border-r border-box-edge"};function Yo(t,s,c,b,n,o){const y=f("ns-close-button"),_=f("ns-numpad");return l(),i("div",Io,[e("div",Qo,[e("div",null,[n.type==="product"?(l(),i("h1",Uo,r(o.__("Product Discount")),1)):d("",!0),n.type==="cart"?(l(),i("h1",Bo,r(o.__("Cart Discount")),1)):d("",!0)]),e("div",null,[h(y,{onClick:s[0]||(s[0]=m=>o.closePopup())})])]),e("div",zo,[e("h1",Wo,[n.mode==="flat"?(l(),i("span",Eo,r(o.nsCurrency(n.finalValue)),1)):d("",!0),n.mode==="percentage"?(l(),i("span",Mo,r(n.finalValue)+"%",1)):d("",!0)])]),e("div",Ko,[c.popup.params.reference.disable_flat?d("",!0):(l(),i("button",{key:0,onClick:s[1]||(s[1]=m=>o.setPercentageType("flat")),class:A([n.mode==="flat"?"bg-tab-active":"bg-tab-inactive text-secondary","outline-hidden w-1/2 py-2 flex items-center justify-center"])},r(o.__("Flat")),3)),c.popup.params.reference.disable_flat?d("",!0):(l(),i("hr",Go)),c.popup.params.reference.disable_percentage?d("",!0):(l(),i("button",{key:2,onClick:s[2]||(s[2]=m=>o.setPercentageType("percentage")),class:A([(n.mode==="percentage"?"bg-tab-active":"bg-tab-inactive text-secondary")+" "+(c.popup.params.reference.disable_flat?"w-full":"w-1/2"),"outline-hidden py-2 flex items-center justify-center"])},r(o.__("Percentage")),3))]),h(_,{floating:!0,onNext:s[3]||(s[3]=m=>o.submitValue()),onChanged:s[4]||(s[4]=m=>o.inputValue(m)),value:n.finalValue,limit:"1000"},null,8,["value"])])}const Yn=j(Do,[["render",Yo]]),Jo={props:["popup","order"],methods:{__:a,popupResolver:V,popupCloser:S,closePopup(){this.options.ns_orders_force_driver_selection==="yes"?(this.popup.params.reject(!1),this.popup.close()):this.popupResolver({driver_id:null})},proceed(){this.popupResolver({driver_id:null})},assignDriver(t){var s,c,b,n;this.popupResolver({driver_id:t.id,driver_name:(s=t.billing)!=null&&s.first_name||(c=t.billing)!=null&&c.last_name?`${(b=t.billing)==null?void 0:b.first_name} ${(n=t.billing)==null?void 0:n.last_name}`:t.username})},loadDrivers(t){nsHttpClient.get([void 0,null].includes(t)?"/api/drivers":`/api/drivers/${t}`).subscribe({next:s=>{this.drivers=s}})}},data(){return{drivers:[],options:{},mappedStatus:{available:a("Available"),busy:a("Busy"),offline:a("Offline"),disabled:a("Disabled")},fields:[],optionsSubscription:null}},mounted(){this.popupCloser(),this.loadDrivers(),this.order.delivery_status==="delivered"&&(z.error(a("Forbidden Action"),a("The order is already delivered, you cannot change the driver.")),this.popupResolver(!1)),this.optionsSubscription=POS.options.subscribe(t=>{this.options=t}),this.fields=new F().createFields([{type:"switch",name:"status",options:[{label:a("All"),value:null},{label:a("Available"),value:"available"},{label:a("Busy"),value:"busy"},{label:a("Offline"),value:"offline"}]}])},beforeDestroy(){this.optionsSubscription&&this.optionsSubscription.unsubscribe()}},Xo={class:"ns-box shadow w-[90vw] md:w-[80vw] lg:w-[70vw] xl:w-[60vw] h-[90vh] md:h-[80vh] lg:h-[70vh] xl:h-[60vh] flex flex-col"},Zo={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},$o={class:"text-xl font-bold text-fontcolor text-center"},en={class:"ns-box-body flex-auto overflow-y-auto"},sn={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},tn=["onClick"],on={key:0,class:"text-lg font-bold"},nn={key:1,class:"text-lg font-bold"},rn={class:"text-sm"},ln={class:"ns-box-footer flex flex-col md:flex-row p-2 border-t flex justify-between"};function cn(t,s,c,b,n,o){const y=f("ns-close-button"),_=f("ns-avatar-image"),m=f("ns-switch"),x=f("ns-button");return l(),i("div",Xo,[e("div",Zo,[e("div",null,[e("h1",$o,r(o.__("Drivers")),1)]),e("div",null,[h(y,{onClick:s[0]||(s[0]=u=>o.closePopup())})])]),e("div",en,[e("div",sn,[(l(!0),i(g,null,k(n.drivers,(u,P)=>{var N,p,R;return l(),i("div",{onClick:In=>o.assignDriver(u),key:P,class:A([((N=c.order)==null?void 0:N.driver_id)===u.id?"active":"","flex flex-col items-center justify-center p-2 ns-numpad-key"])},[h(_,{name:u.username,size:24,url:u.attribute?u.attribute.avatar_link:"/images/user.png"},null,8,["name","url"]),(p=u.billing)!=null&&p.first_name||(R=u.billing)!=null&&R.last_name?(l(),i("h2",on,r(u.billing.first_name)+" "+r(u.billing.last_name),1)):(l(),i("h2",nn,r(u.username),1)),e("p",rn,r(u.status?n.mappedStatus[u.status]:o.__("Unknown")),1)],10,tn)}),128))])]),e("div",ln,[e("div",null,[(l(!0),i(g,null,k(n.fields,u=>(l(),L(m,{onChange:s[1]||(s[1]=P=>o.loadDrivers(P)),size:"72",field:u},null,8,["field"]))),256))]),e("div",null,[n.options.ns_orders_force_driver_selection==="no"?(l(),L(x,{key:0,onClick:s[2]||(s[2]=u=>o.proceed()),type:"info"},{default:v(()=>[C(r(o.__("Skip")),1)]),_:1})):d("",!0)])])])}const Jn=j(Jo,[["render",cn]]),un={data(){return{types:[],settingsSubscription:null,urls:{}}},props:["popup"],mounted(){this.settingsSubscription=POS.settings.subscribe(t=>{this.urls=t.urls}),this.types=POS.types.getValue(),Object.values(this.types).length===1&&this.select(Object.keys(this.types)[0]),this.popupCloser()},methods:{__:a,popupCloser:S,popupResolver:V,resolveIfQueued:V,async select(t){Object.values(this.types).forEach(c=>c.selected=!1),this.types[t].selected=!0;const s=this.types[t];await POS.triggerOrderTypeSelection(s),POS.types.next(this.types),this.resolveIfQueued(s)}}},dn={id:"ns-order-type",class:"h-full w-4/5-screen md:w-2/5-screen lg:w-2/5-screen xl:w-1/3-screen ns-box"},an={id:"header",class:"h-16 flex justify-center items-center"},_n={class:"font-bold"},pn={key:0,class:"ns-box-body grid grid-flow-row grid-cols-1 grid-rows-1"},hn={class:"h-full w-full flex items-center justify-center flex-col"},fn={class:"p-4 md:w-2/3"},mn={class:"text-center"},bn={class:"flex justify-center mt-4 mb-2 -mx-2"},vn={class:"px-2"},xn={class:"px-2"},yn={key:1,class:"ns-box-body grid grid-flow-row grid-cols-2 grid-rows-2"},gn=["onClick"],wn=["src"],Cn={class:"font-semibold text-xl my-2"};function kn(t,s,c,b,n,o){const y=f("ns-link");return l(),i("div",dn,[e("div",an,[e("h3",_n,r(o.__("Define The Order Type")),1)]),Object.values(n.types).length===0?(l(),i("div",pn,[e("div",hn,[s[0]||(s[0]=e("i",{class:"las la-frown text-7xl text-error-tertiary"},null,-1)),e("div",fn,[e("p",mn,r(o.__("No payment type has been selected on the settings. Please check your POS features and choose the supported order type")),1),e("div",bn,[e("div",vn,[h(y,{target:"_blank",type:"info",href:"https://my.nexopos.com/en/documentation/components/order-types"},{default:v(()=>[C(r(o.__("Read More")),1)]),_:1})]),e("div",xn,[h(y,{target:"_blank",type:"info",href:n.urls.order_type_url},{default:v(()=>[C(r(o.__("Configure")),1)]),_:1},8,["href"])])])])])])):d("",!0),Object.values(n.types).length>0?(l(),i("div",yn,[(l(!0),i(g,null,k(n.types,_=>(l(),i("div",{onClick:m=>o.select(_.identifier),key:_.identifier,class:A([_.selected?"active":"","ns-numpad-key h-56 flex items-center justify-center flex-col cursor-pointer border"])},[e("img",{src:_.icon,alt:"",class:"w-32 h-32"},null,8,wn),e("span",Cn,r(_.label),1)],10,gn))),128))])):d("",!0)])}const Xn=j(un,[["render",kn]]),Pn={name:"ns-pos-shipping-popup",props:["popup"],computed:{activeTabFields(){if(this.tabs!==null){for(let t in this.tabs)if(this.tabs[t].active)return this.tabs[t].fields}return[]},useBillingInfo(){return this.tabs!==null?this.tabs.billing.fields[0].value:new Object},useShippingInfo(){return this.tabs!==null?this.tabs.shipping.fields[0].value:new Object}},unmounted(){this.orderSubscription.unsubscribe()},mounted(){this.orderSubscription=POS.order.subscribe(t=>this.order=t),this.popupCloser(),this.loadForm()},data(){return{tabs:null,orderSubscription:null,order:null,formValidation:new F}},watch:{useBillingInfo(t){t===1&&this.order.customer&&this.tabs.billing.fields.forEach(s=>{s.name!=="_use_customer_billing"&&(s.value=this.order.customer.billing?this.order.customer.billing[s.name]:s.value)})},useShippingInfo(t){t===1&&this.order.customer&&this.tabs.shipping.fields.forEach(s=>{s.name!=="_use_customer_shipping"&&(s.value=this.order.customer.shipping?this.order.customer.shipping[s.name]:s.value)})}},methods:{__,popupCloser:S,resolveIfQueued:V,submitInformations(){if(this.formValidation.validateForm({tabs:this.tabs}).length>0){w.error(__("Please correct the errors in the form"));return}const s=this.formValidation.extractForm({tabs:this.tabs});for(let c in s.general)["shipping","shipping_rate"].includes(c)&&(s.general[c]=parseFloat(s.general[c]));this.order={...this.order,...s.general},delete s.general,delete s.shipping._use_customer_shipping,delete s.billing._use_customer_billing,this.order.addresses=s,POS.order.next(this.order),POS.refreshCart(),this.resolveIfQueued(!0)},closePopup(){this.resolveIfQueued(!1)},toggle(t){for(let s in this.tabs)this.tabs[s].active=!1;this.tabs[t].active=!0},loadForm(){nsHttpClient.get("/api/forms/ns.pos-addresses").subscribe(({tabs:t})=>{for(let s in t)s==="general"?t[s].fields.forEach(c=>{c.value=this.order[c.name]||(/\d/.test(c.value)||c.value.length>0?c.value:"")}):t[s].fields.forEach(c=>{c.value=this.order.addresses[s]?this.order.addresses[s][c.name]:""});this.tabs=this.formValidation.initializeTabs(t)})}}},Sn={class:"ns-box w-6/7-screen md:w-4/5-screen lg:w-3/5-screen h-[85vh] md:h-[80vh] shadow-lg flex flex-col overflow-hidden"},On={class:"p-2 border-b ns-box-header flex justify-between items-center"},Tn={class:"font-bold text-font"},jn={class:"tools"},Vn={class:"flex-auto ns-box-body p-2 overflow-y-auto ns-tab"},Ln={id:"tabs-container"},Nn={class:"header flex",style:{"margin-bottom":"-1px"}},An=["onClick"],Rn={class:"ns-tab-item"},Fn={class:"px-4 border"},qn={class:"-mx-4 flex flex-wrap"},Hn={class:"p-2 flex justify-between border-t ns-box-footer"};function Dn(t,s,c,b,n,o){const y=f("ns-notice"),_=f("ns-field"),m=f("ns-button");return l(),i("div",Sn,[e("div",On,[e("h3",Tn,r(o.__("Shipping & Billing")),1),e("div",jn,[e("button",{onClick:s[0]||(s[0]=x=>o.closePopup()),class:"ns-close-button rounded-full h-8 w-8 border items-center justify-center"},s[2]||(s[2]=[e("i",{class:"las la-times"},null,-1)]))])]),e("div",Vn,[n.order!=null&&!n.order.customer?(l(),L(y,{key:0,class:"mb-2"},{title:v(()=>[C(r(o.__("No customer is selected")),1)]),description:v(()=>[C(r(o.__("Please select a customer before proceeding")),1)]),_:1})):d("",!0),e("div",Ln,[e("div",Nn,[(l(!0),i(g,null,k(n.tabs,(x,u)=>(l(),i("div",{key:u,onClick:P=>o.toggle(u),class:A([x.active?"border-b-0 active":"inactive","tab rounded-tl rounded-tr border tab px-3 py-2 text-fontcolor cursor-pointer"]),style:{"margin-right":"-1px"}},r(x.label),11,An))),128))]),e("div",Rn,[e("div",Fn,[e("div",qn,[(l(!0),i(g,null,k(o.activeTabFields,(x,u)=>(l(),i("div",{key:u,class:A("p-4 w-full md:w-1/2 lg:w-1/3")},[h(_,{onBlur:P=>n.formValidation.checkField(x),onChange:P=>n.formValidation.checkField(x),field:x},null,8,["onBlur","onChange","field"])]))),128))])])])])]),e("div",Hn,[s[3]||(s[3]=e("div",null,null,-1)),e("div",null,[h(m,{onClick:s[1]||(s[1]=x=>o.submitInformations()),type:"info"},{default:v(()=>[C(r(o.__("Save")),1)]),_:1})])])])}const Zn=j(Pn,[["render",Dn]]);export{Jn as N,Gn as P,Yn as a,Xn as b,Zn as c,ss as d,D as e,B as n};
