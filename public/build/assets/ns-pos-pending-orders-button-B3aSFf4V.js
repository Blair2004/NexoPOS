import{b as k,a as P,p as T,P as F}from"./bootstrap-DI8pXSaz.js";import{n as $}from"./ns-prompt-popup-CidREd5w.js";import{n as j}from"./currency-BCJk0SN4.js";import{_ as f}from"./lang-BINodpp-.js";import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as h,c as d,o as i,b as s,i as v,a as O,t as n,f as c,F as w,e as y,w as x,B as S}from"./runtime-core.esm-bundler-DUdZl5j1.js";import{v as V,w as H}from"./runtime-dom.esm-bundler-BJBE8XOq.js";import"./chart-BXKSDqJb.js";const L={data(){return{products:[],isLoading:!1}},props:["popup"],computed:{order(){return this.popup.params.order}},mounted(){this.loadProducts()},methods:{__:f,nsCurrency:j,close(){this.popup.params.reject(!1),this.popup.close()},loadProducts(){this.isLoading=!0;const r=this.popup.params.order.id;k.get(`/api/orders/${r}/products`).subscribe(e=>{this.isLoading=!1,this.products=e})},openOrder(){this.popup.close(),this.popup.params.resolve(this.order)}}},A={class:"shadow-lg ns-box w-[85.71vw] md:w-[60vw] lg:w-[40vw] h-[70vh] flex flex-col overflow-hidden"},B={class:"p-2 flex justify-between text-fontcolor items-center border-b ns-box-header"},N={class:"font-semibold"},U={key:0},D={class:"flex-auto p-2 overflow-y-auto ns-box-body"},q={key:0,class:"flex-auto relative"},K={class:"h-full w-full flex items-center justify-center"},E={class:"flex-col border-b border-info-primary py-2"},M={class:"title font-semibold text-fontcolor flex justify-between"},R={class:"text-sm text-font"},Y={class:"flex justify-end p-2 border-t ns-box-footer"},z={class:"px-1"},G={class:"-mx-2 flex"},I={class:"px-1"},J={class:"px-1"};function Q(r,e,a,b,p,t){const l=h("ns-close-button"),u=h("ns-spinner"),_=h("ns-button");return i(),d("div",A,[s("div",B,[s("h3",N,[v(n(t.__("Products"))+" â€” "+n(t.order.code)+" ",1),t.order.title?(i(),d("span",U,"("+n(t.order.title)+")",1)):O("",!0)]),s("div",null,[c(l,{onClick:e[0]||(e[0]=m=>t.close())})])]),s("div",D,[p.isLoading?(i(),d("div",q,[s("div",K,[c(u)])])):O("",!0),p.isLoading?O("",!0):(i(!0),d(w,{key:1},y(p.products,m=>(i(),d("div",{class:"item",key:m.id},[s("div",E,[s("div",M,[s("span",null,n(m.name)+" (x"+n(m.quantity)+")",1),s("span",null,n(t.nsCurrency(r.price)),1)]),s("div",R,[s("ul",null,[s("li",null,n(t.__("Unit"))+" : "+n(m.unit.name),1)])])])]))),128))]),s("div",Y,[s("div",z,[s("div",G,[s("div",I,[c(_,{onClick:e[1]||(e[1]=m=>t.openOrder()),type:"info"},{default:x(()=>[v(n(t.__("Open")),1)]),_:1})]),s("div",J,[c(_,{onClick:e[2]||(e[2]=m=>t.close()),type:"error"},{default:x(()=>[v(n(t.__("Close")),1)]),_:1})])])])])])}const W=g(L,[["render",Q]]),X={props:["orders"],data(){return{searchField:"",columns:{rightColumn:[],leftColumn:[]}}},watch:{orders(){this.$nextTick(()=>{nsHooks.doAction("ns-pos-pending-orders-refreshed",this.orders.map(r=>({order:r,dom:document.querySelector(`[data-order-id="${r.id}"]`)})))})}},mounted(){this.columns.leftColumn=nsHooks.applyFilters("ns-pending-orders-left-column",[{label:f("Code"),value:r=>r.code},{label:f("Cashier"),value:r=>r.user_username},{label:f("Total"),value:r=>r.total},{label:f("Tendered"),value:r=>r.tendered}]),this.columns.rightColumn=nsHooks.applyFilters("ns-pending-orders-right-column",[{label:f("Customer"),value:r=>`${r.customer_first_name} ${r.customer_last_name}`},{label:f("Date"),value:r=>r.created_at},{label:f("Type"),value:r=>r.type}]),this.popupCloser()},name:"ns-pos-pending-order",methods:{__:f,popupCloser:P,previewOrder(r){this.$emit("previewOrder",r)},proceedOpenOrder(r){this.$emit("proceedOpenOrder",r)},searchOrder(){this.$emit("searchOrder",this.searchField)},printOrder(r){this.$emit("printOrder",r)}}},Z={class:"flex flex-auto flex-col overflow-hidden"},ee={class:"p-1"},se={class:"flex rounded border-2 input-group info"},re={class:"mr-1 hidden md:visible"},te={class:"overflow-y-auto flex flex-auto"},oe={class:"flex p-2 flex-auto flex-col overflow-y-auto"},ne=["data-order-id"],le={class:"text-fontcolor"},de={class:"px-2"},ie={class:"flex flex-wrap -mx-4"},ae={class:"w-full md:w-1/2 px-2"},pe={class:"w-full md:w-1/2 px-2"},ue={class:"flex justify-end w-full mt-2"},ce={class:"flex rounded-lg overflow-hidden ns-buttons"},fe=["onClick"],_e=["onClick"],me=["onClick"],ve={key:0,class:"h-full v-full items-center justify-center flex"},he={class:"text-semibold text-font"};function xe(r,e,a,b,p,t){return i(),d("div",Z,[s("div",ee,[s("div",se,[S(s("input",{onKeyup:e[0]||(e[0]=H(l=>t.searchOrder(),["enter"])),"onUpdate:modelValue":e[1]||(e[1]=l=>p.searchField=l),type:"text",class:"p-2 outline-hidden flex-auto"},null,544),[[V,p.searchField]]),s("button",{onClick:e[2]||(e[2]=l=>t.searchOrder()),class:"w-16 md:w-24"},[e[3]||(e[3]=s("i",{class:"las la-search"},null,-1)),s("span",re,n(t.__("Search")),1)])])]),s("div",te,[s("div",oe,[(i(!0),d(w,null,y(a.orders,l=>(i(),d("div",{"data-order-id":l.id,class:"border-b ns-box-body w-full py-2 ns-order-line",key:l.id},[s("h3",le,n(l.title||"Untitled Order"),1),s("div",de,[s("div",ie,[s("div",ae,[(i(!0),d(w,null,y(p.columns.leftColumn,(u,_)=>(i(),d("p",{key:_,class:"text-sm text-font"},[s("strong",null,n(u.label),1),v(" : "+n(u.value(l)),1)]))),128))]),s("div",pe,[(i(!0),d(w,null,y(p.columns.rightColumn,(u,_)=>(i(),d("p",{key:_,class:"text-sm text-font"},[s("strong",null,n(u.label),1),v(" : "+n(u.value(l)),1)]))),128))])])]),s("div",ue,[s("div",ce,[s("button",{onClick:u=>t.proceedOpenOrder(l),class:"info outline-hidden px-2 py-1"},[e[4]||(e[4]=s("i",{class:"las la-lock-open"},null,-1)),v(" "+n(t.__("Open")),1)],8,fe),s("button",{onClick:u=>t.previewOrder(l),class:"success outline-hidden px-2 py-1"},[e[5]||(e[5]=s("i",{class:"las la-eye"},null,-1)),v(" "+n(t.__("Products")),1)],8,_e),s("button",{onClick:u=>t.printOrder(l),class:"warning outline-hidden px-2 py-1"},[e[6]||(e[6]=s("i",{class:"las la-print"},null,-1)),v(" "+n(t.__("Print")),1)],8,me)])])],8,ne))),128)),a.orders.length===0?(i(),d("div",ve,[s("h3",he,n(t.__("Nothing to display...")),1)])):O("",!0)])])])}const be=g(X,[["render",xe]]),Oe={props:["popup"],components:{nsPosPendingOrders:be},methods:{__:f,popupResolver:T,popupCloser:P,searchOrder(r){nsHttpClient.get(`/api/crud/${this.active}?search=${r}`).subscribe(e=>{this.orders=e.data})},setActiveTab(r){this.active=r,this.loadOrderFromType(r)},openOrder(r){POS.loadOrder(r.id),this.popup.close()},loadOrderFromType(r){nsHttpClient.get(`/api/crud/${r}`).subscribe(e=>{this.orders=e.data})},previewOrder(r){new Promise((a,b)=>{Popup.show(W,{order:r,resolve:a,reject:b})}).then(a=>{this.proceedOpenOrder(r)},a=>a)},printOrder(r){POS.print.process(r.id,"sale")},proceedOpenOrder(r){if(POS.products.getValue().length>0)return Popup.show($,{title:f("Confirm Your Action"),message:f("The cart is not empty. Opening an order will clear your cart would you proceed ?"),onAction:a=>{a&&this.openOrder(r)}});this.openOrder(r)}},data(){return{active:"ns.hold-orders",searchField:"",orders:[]}},mounted(){this.loadOrderFromType(this.active),this.popupCloser()}},we={class:"shadow-lg ns-box w-[85.71vw] md:w-[60vw] lg:w-[40vw] h-[75vh] flex flex-col overflow-hidden"},ye={class:"p-2 flex justify-between text-fontcolor items-center ns-box-header border-b"},ge={class:"font-semibold"},Pe={class:"p-2 flex overflow-hidden flex-auto ns-box-body"},Ce={class:"p-2 flex justify-between ns-box-footer border-t"};function ke(r,e,a,b,p,t){const l=h("ns-close-button"),u=h("ns-pos-pending-orders"),_=h("ns-tabs-item"),m=h("ns-tabs"),C=h("ns-button");return i(),d("div",we,[s("div",ye,[s("h3",ge,n(t.__("Orders")),1),s("div",null,[c(l,{onClick:e[0]||(e[0]=o=>a.popup.close())})])]),s("div",Pe,[c(m,{active:p.active,onChangeTab:e[13]||(e[13]=o=>t.setActiveTab(o))},{default:x(()=>[c(_,{identifier:"ns.hold-orders",label:t.__("On Hold"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:x(()=>[c(u,{orders:p.orders,onSearchOrder:e[1]||(e[1]=o=>t.searchOrder(o)),onPreviewOrder:e[2]||(e[2]=o=>t.previewOrder(o)),onPrintOrder:e[3]||(e[3]=o=>t.printOrder(o)),onProceedOpenOrder:e[4]||(e[4]=o=>t.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"]),c(_,{identifier:"ns.unpaid-orders",label:t.__("Unpaid"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:x(()=>[c(u,{orders:p.orders,onSearchOrder:e[5]||(e[5]=o=>t.searchOrder(o)),onPreviewOrder:e[6]||(e[6]=o=>t.previewOrder(o)),onPrintOrder:e[7]||(e[7]=o=>t.printOrder(o)),onProceedOpenOrder:e[8]||(e[8]=o=>t.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"]),c(_,{identifier:"ns.partially-paid-orders",label:t.__("Partially Paid"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:x(()=>[c(u,{orders:p.orders,onSearchOrder:e[9]||(e[9]=o=>t.searchOrder(o)),onPreviewOrder:e[10]||(e[10]=o=>t.previewOrder(o)),onPrintOrder:e[11]||(e[11]=o=>t.printOrder(o)),onProceedOpenOrder:e[12]||(e[12]=o=>t.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"])]),_:1},8,["active"])]),s("div",Ce,[e[15]||(e[15]=s("div",null,null,-1)),s("div",null,[c(C,{onClick:e[14]||(e[14]=o=>a.popup.close()),type:"info"},{default:x(()=>[v(n(t.__("Close")),1)]),_:1})])])])}const Te=g(Oe,[["render",ke]]),Fe={name:"ns-pos-pending-orders-button",methods:{__:f,openPendingOrdersPopup(){F.show(Te)}}},$e={class:"ns-button default"};function je(r,e,a,b,p,t){return i(),d("div",$e,[s("button",{onClick:e[0]||(e[0]=l=>t.openPendingOrdersPopup()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[e[1]||(e[1]=s("i",{class:"mr-1 text-xl lar la-hand-pointer"},null,-1)),s("span",null,n(t.__("Orders")),1)])])}const De=g(Fe,[["render",je]]);export{De as default};
