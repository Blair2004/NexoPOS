import{b as x,d as h,h as w}from"./bootstrap-BsWQM_6D.js";import{c as C,e as T}from"./components-DUSFgsKA.js";import{_ as i,n as k}from"./currency-Dtag6qPd.js";import{N as f}from"./ns-prompt-popup-CwRKP6Ip.js";import{j as D}from"./join-array-NDqpMoMN.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as U,o as c,c as n,a as t,f as v,n as F,t as s,e as p,F as b,b as m}from"./runtime-core.esm-bundler-VrNrzzXC.js";import"./chart-CAYz1qzV.js";import"./ns-avatar-image-Pigdi04i.js";const L={name:"ns-sale-report",data(){return{saleReport:"",startDateField:{name:"start_date",type:"datetime",value:ns.date.moment.startOf("day").format()},endDateField:{name:"end_date",type:"datetime",value:ns.date.moment.endOf("day").format()},result:[],isLoading:!1,users:[],ns:window.ns,summary:{},selectedUser:"",selectedCategory:"",reportType:{label:i("Report Type"),name:"reportType",type:"select",value:"categories_report",options:[{label:i("Categories Detailed"),value:"categories_report"},{label:i("Categories Summary"),value:"categories_summary"},{label:i("Products"),value:"products_report"}],description:i("Allow you to choose the report type.")},filterUser:{label:i("Filter User"),name:"filterUser",type:"select",value:"",options:[],description:i("Allow you to choose the report type.")},filterCategory:{label:i("Filter By Category"),name:"filterCategory",type:"multiselect",value:"",options:[],description:i("Allow you to choose the category.")},field:{type:"datetimepicker",value:"2021-02-07",name:"date"}}},components:{nsDatepicker:C,nsDateTimePicker:T},computed:{},methods:{__:i,nsCurrency:k,joinArray:D,printSaleReport(){this.$htmlToPaper("sale-report")},async openSettings(){try{const d=await new Promise((o,a)=>{Popup.show(f,{...this.reportType,resolve:o,reject:a})});this.reportType.value=d,this.result=[],this.loadReport()}catch(d){console.log({exception:d})}},async openUserFiltering(){try{this.isLoading=!0;const d=await new Promise((a,_)=>{x.get("/api/users").subscribe({next:r=>{this.users=r,this.isLoading=!1,this.filterUser.options=[{label:i("All Users"),value:""},...this.users.map(e=>({label:e.username,value:e.id}))],Popup.show(f,{...this.filterUser,resolve:a,reject:_})},error:r=>{this.isLoading=!1,h.error(i("No user was found for proceeding the filtering.")),_(r)}})}),o=this.users.filter(a=>a.id===d);if(o.length>0){let a=o[0];this.selectedUser=`${a.username} ${a.first_name||a.last_name?a.first_name+" "+a.last_name:""}`,this.filterUser.value=d,this.result=[],this.loadReport()}}catch(d){console.log({exception:d})}},async openCategoryFiltering(){try{let d=[];this.isLoading=!0;const o=await new Promise((a,_)=>{x.get("/api/categories").subscribe({next:r=>{this.isLoading=!1,d=r,this.filterCategory.options=[...r.map(e=>({label:e.name,value:e.id}))],Popup.show(f,{...this.filterCategory,resolve:a,reject:_})},error:r=>{this.isLoading=!1,h.error(i("No category was found for proceeding the filtering.")),_(r)}})});if(o.length>0){let a=d.filter(_=>o.includes(_.id)).map(_=>_.name);this.selectedCategory=this.joinArray(a),this.filterCategory.value=o}else this.selectedCategory="",this.filterCategory.value=[];this.result=[],this.loadReport()}catch(d){console.log(d)}},getType(d){const o=this.reportType.options.filter(a=>a.value===d);return o.length>0?o[0].label:i("Unknown")},loadReport(){if(this.startDate===null||this.endDate===null)return h.error(i("Unable to proceed. Select a correct time range.")).subscribe();const d=w(this.startDate);if(w(this.endDate).isBefore(d))return h.error(i("Unable to proceed. The current time range is not valid.")).subscribe();this.isLoading=!0,x.post("/api/reports/sale-report",{startDate:this.startDateField.value,endDate:this.endDateField.value,type:this.reportType.value,user_id:this.filterUser.value,categories_id:this.filterCategory.value}).subscribe({next:a=>{this.isLoading=!1,this.result=a.result,this.summary=a.summary},error:a=>{this.isLoading=!1,h.error(a.message).subscribe()}})},computeTotal(d,o){return d.length>0?d.map(a=>parseFloat(a[o])).reduce((a,_)=>a+_):0}},props:["storeLogo","storeName"],mounted(){}},S={id:"report-section",class:"px-4"},R={class:"flex -mx-2"},B={class:"px-2"},N={class:"px-2"},A={class:"px-2"},j={class:"pl-2"},M={class:"flex -mx-2"},q={class:"px-2"},H={class:"pl-2"},O={class:"px-2"},Q={class:"pl-2"},V={class:"px-2"},z={class:"pl-2"},E={class:"px-2"},G={class:"pl-2"},I={id:"sale-report",class:"anim-duration-500 fade-in-entrance"},J={class:"flex w-full"},K={class:"my-4 flex justify-between w-full"},W={class:"text-secondary"},X=["innerHTML"],Y={class:"pb-1 border-b border-dashed"},Z={class:"pb-1 border-b border-dashed"},$=["src","alt"],tt={class:"-mx-4 flex md:flex-row flex-col"},et={class:"w-full md:w-1/2 px-4"},st={class:"shadow rounded my-4 ns-box"},rt={class:"border-b ns-box-body"},ot={class:"table ns-table w-full"},lt={class:"text-primary"},at={class:""},dt={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-info-primary text-white"},it={class:"p-2 border text-right border-info-primary"},ct={class:""},nt={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},_t={class:"p-2 border text-right border-error-primary"},ut={class:""},ht={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},pt={class:"p-2 border text-right border-error-primary"},bt={key:0,class:""},mt={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},yt={class:"p-2 border text-right border-error-primary"},xt={class:""},ft={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-info-primary text-white"},gt={class:"p-2 border text-right border-success-primary"},wt={class:""},vt={width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-secondary text-white"},Ct={class:"p-2 border text-right border-success-primary"},Tt={class:""},kt={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-success-secondary text-white"},Dt={class:"p-2 border text-right border-success-primary"},Pt={class:""},Ut={width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-secondary text-white"},Ft={class:"p-2 border text-right border-success-primary"},Lt={key:0,class:"bg-box-background shadow rounded my-4"},St={class:"border-b border-box-edge"},Rt={class:"table ns-table w-full"},Bt={class:"text-primary"},Nt={class:"border p-2 text-left"},At={width:"150",class:"border p-2"},jt={width:"150",class:"border p-2"},Mt={width:"150",class:"border p-2"},qt={width:"150",class:"border p-2"},Ht={width:"150",class:"border p-2"},Ot={width:"150",class:"border p-2"},Qt={class:"text-primary"},Vt={class:"p-2 border"},zt={class:"p-2 border text-right"},Et={class:"p-2 border text-right"},Gt={class:"p-2 border text-right"},It={class:"p-2 border text-right"},Jt={class:"p-2 border text-right"},Kt={class:"p-2 border text-right"},Wt={class:"text-primary font-semibold"},Xt={class:"p-2 border text-right text-primary"},Yt={class:"p-2 border text-right text-primary"},Zt={class:"p-2 border text-right text-primary"},$t={class:"p-2 border text-right text-primary"},te={class:"p-2 border text-right text-primary"},ee={class:"p-2 border text-right text-primary"},se={key:1,class:"bg-box-background shadow rounded my-4"},re={class:"border-b border-box-edge"},oe={class:"table ns-table w-full"},le={class:"text-primary"},ae={class:"border p-2 text-left"},de={class:"border p-2 text-left"},ie={width:"100",class:"border p-2"},ce={width:"150",class:"border p-2"},ne={width:"150",class:"border p-2"},_e={width:"150",class:"border p-2"},ue={width:"150",class:"border p-2"},he={width:"150",class:"border p-2"},pe={class:"text-primary"},be={class:"p-2 border"},me={class:"p-2 border"},ye={class:"p-2 border text-right"},xe={class:"p-2 border text-right"},fe={class:"p-2 border text-right"},ge={class:"p-2 border text-right"},we={class:"p-2 border text-right"},ve={class:"p-2 border text-right"},Ce={class:"bg-info-primary"},Te={colspan:"2",class:"p-2 border border-info-secondary"},ke={class:"p-2 border text-right border-info-secondary"},De={class:"p-2 border text-right border-info-secondary"},Pe={class:"p-2 border text-right border-info-secondary"},Ue={class:"p-2 border text-right border-info-secondary"},Fe={class:"p-2 border text-right border-info-secondary"},Le={class:"p-2 border text-right border-info-secondary"},Se={class:"text-primary font-semibold"},Re={class:"p-2 border text-right text-primary"},Be={class:"p-2 border text-right text-primary"},Ne={class:"p-2 border text-right text-primary"},Ae={class:"p-2 border text-right text-primary"},je={class:"p-2 border text-right text-primary"},Me={class:"p-2 border text-right text-primary"},qe={key:2,class:"bg-box-background shadow rounded my-4"},He={class:"border-b border-box-edge"},Oe={class:"table ns-table w-full"},Qe={class:"text-primary"},Ve={class:"border p-2 text-left"},ze={width:"100",class:"border p-2"},Ee={width:"150",class:"border p-2"},Ge={width:"150",class:"border p-2"},Ie={width:"150",class:"border p-2"},Je={width:"150",class:"border p-2"},Ke={class:"text-primary"},We={class:"p-2 border text-left border-info-primary"},Xe={class:"p-2 border text-right border-info-primary"},Ye={class:"p-2 border text-right border-info-primary"},Ze={class:"p-2 border text-right border-info-primary"},$e={class:"p-2 border text-right border-info-primary"},ts={class:"p-2 border text-right border-info-primary"},es={class:"text-primary font-semibold"},ss={class:"p-2 border text-right text-primary"},rs={class:"p-2 border text-right text-primary"},os={class:"p-2 border text-right text-primary"},ls={class:"p-2 border text-right text-primary"},as={class:"p-2 border text-right text-primary"};function ds(d,o,a,_,r,e){const g=U("ns-date-time-picker");return c(),n("div",S,[t("div",R,[t("div",B,[v(g,{field:r.startDateField},null,8,["field"])]),t("div",N,[v(g,{field:r.endDateField},null,8,["field"])]),t("div",A,[t("button",{onClick:o[0]||(o[0]=l=>e.loadReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[t("i",{class:F([r.isLoading?"animate-spin":"","las la-sync-alt text-xl"])},null,2),t("span",j,s(e.__("Load")),1)])])]),t("div",M,[t("div",q,[t("button",{onClick:o[1]||(o[1]=l=>e.printSaleReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[o[5]||(o[5]=t("i",{class:"las la-print text-xl"},null,-1)),t("span",H,s(e.__("Print")),1)])]),t("div",O,[t("button",{onClick:o[2]||(o[2]=l=>e.openSettings()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[o[6]||(o[6]=t("i",{class:"las la-filter text-xl"},null,-1)),t("span",Q,s(e.__("By Type"))+" : "+s(e.getType(r.reportType.value)),1)])]),t("div",V,[t("button",{onClick:o[3]||(o[3]=l=>e.openUserFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[o[7]||(o[7]=t("i",{class:"las la-filter text-xl"},null,-1)),t("span",z,s(e.__("By User"))+" : "+s(r.selectedUser||e.__("All Users")),1)])]),t("div",E,[t("button",{onClick:o[4]||(o[4]=l=>e.openCategoryFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[o[8]||(o[8]=t("i",{class:"las la-filter text-xl"},null,-1)),t("span",G,s(e.__("By Category"))+" : "+s(r.selectedCategory||e.__("All Category")),1)])])]),t("div",I,[t("div",J,[t("div",K,[t("div",W,[t("ul",null,[t("li",{class:"pb-1 border-b border-dashed",innerHTML:e.__("Range : {date1} â€” {date2}").replace("{date1}",r.startDateField.value).replace("{date2}",r.endDateField.value)},null,8,X),t("li",Y,s(e.__("Document : Sale Report")),1),t("li",Z,s(e.__("By : {user}").replace("{user}",r.ns.user.username)),1)])]),t("div",null,[t("img",{class:"w-24",src:a.storeLogo,alt:a.storeName},null,8,$)])])]),t("div",null,[t("div",tt,[t("div",et,[t("div",st,[t("div",rt,[t("table",ot,[t("tbody",lt,[t("tr",at,[t("td",dt,s(e.__("Sub Total")),1),t("td",it,s(e.nsCurrency(r.summary.subtotal)),1)]),t("tr",ct,[t("td",nt,s(e.__("Sales Discounts")),1),t("td",_t,s(e.nsCurrency(r.summary.sales_discounts)),1)]),t("tr",ut,[t("td",ht,s(e.__("Sales Taxes")),1),t("td",pt,s(e.nsCurrency(r.summary.sales_taxes)),1)]),r.summary.product_taxes>0?(c(),n("tr",bt,[t("td",mt,s(e.__("Product Taxes")),1),t("td",yt,s(e.nsCurrency(r.summary.product_taxes)),1)])):p("",!0),t("tr",xt,[t("td",ft,s(e.__("Shipping")),1),t("td",gt,s(e.nsCurrency(r.summary.shipping)),1)]),t("tr",wt,[t("td",vt,s(e.__("Total")),1),t("td",Ct,s(e.nsCurrency(r.summary.total)),1)]),t("tr",Tt,[t("td",kt,s(e.__("Cost Of Goods")),1),t("td",Dt,s(e.nsCurrency(r.summary.total_purchase_price)),1)]),t("tr",Pt,[t("td",Ut,s(e.__("Profit")),1),t("td",Ft,s(e.nsCurrency(r.summary.profit)),1)])])])])])]),o[9]||(o[9]=t("div",{class:"w-full md:w-1/2 px-4"},null,-1))])]),r.reportType.value==="products_report"?(c(),n("div",Lt,[t("div",St,[t("table",Rt,[t("thead",Bt,[t("tr",null,[t("th",Nt,s(e.__("Products")),1),t("th",At,s(e.__("Quantity")),1),t("th",jt,s(e.__("Discounts")),1),t("th",Mt,s(e.__("Cost")),1),t("th",qt,s(e.__("Taxes")),1),t("th",Ht,s(e.__("Total")),1),t("th",Ot,s(e.__("Profit")),1)])]),t("tbody",Qt,[(c(!0),n(b,null,m(r.result,l=>(c(),n("tr",{key:l.id},[t("td",Vt,s(l.name),1),t("td",zt,s(l.quantity),1),t("td",Et,s(e.nsCurrency(l.discount)),1),t("td",Gt,s(e.nsCurrency(l.total_purchase_price)),1),t("td",It,s(e.nsCurrency(l.tax_value)),1),t("td",Jt,s(e.nsCurrency(l.total_price)),1),t("td",Kt,s(e.nsCurrency(Math.chain(l.total_price).subtract(Math.chain(l.total_purchase_price).add(l.tax_value).done()).done())),1)]))),128))]),t("tfoot",Wt,[t("tr",null,[o[10]||(o[10]=t("td",{class:"p-2 border text-primary"},null,-1)),t("td",Xt,s(e.computeTotal(r.result,"quantity")),1),t("td",Yt,s(e.nsCurrency(e.computeTotal(r.result,"discount"))),1),t("td",Zt,s(e.nsCurrency(e.computeTotal(r.result,"total_purchase_price"))),1),t("td",$t,s(e.nsCurrency(e.computeTotal(r.result,"tax_value"))),1),t("td",te,s(e.nsCurrency(e.computeTotal(r.result,"total_price"))),1),t("td",ee,s(e.nsCurrency(e.computeTotal(r.result,"total_price")-e.computeTotal(r.result,"total_purchase_price")-e.computeTotal(r.result,"tax_value"))),1)])])])])])):p("",!0),r.reportType.value==="categories_report"?(c(),n("div",se,[t("div",re,[t("table",oe,[t("thead",le,[t("tr",null,[t("th",ae,s(e.__("Category")),1),t("th",de,s(e.__("Product")),1),t("th",ie,s(e.__("Quantity")),1),t("th",ce,s(e.__("Discounts")),1),t("th",ne,s(e.__("Taxes")),1),t("th",_e,s(e.__("Total")),1),t("th",ue,s(e.__("Purchase Price")),1),t("th",he,s(e.__("Profit")),1)])]),t("tbody",pe,[(c(!0),n(b,null,m(r.result,(l,y)=>(c(),n(b,{key:y},[l.products.length>0?(c(!0),n(b,{key:0},m(l.products,u=>(c(),n("tr",{key:parseInt(l.id+""+u.id)},[t("td",be,s(l.name),1),t("td",me,s(u.name),1),t("td",ye,s(u.quantity),1),t("td",xe,s(e.nsCurrency(u.discount)),1),t("td",fe,s(e.nsCurrency(u.tax_value)),1),t("td",ge,s(e.nsCurrency(u.total_price)),1),t("td",we,s(e.nsCurrency(u.total_purchase_price)),1),t("td",ve,s(e.nsCurrency(u.total_price-(u.total_purchase_price+u.tax_value+u.discount))),1)]))),128)):p("",!0),t("tr",Ce,[t("td",Te,s(l.name),1),t("td",ke,s(e.computeTotal(l.products,"quantity")),1),t("td",De,s(e.nsCurrency(e.computeTotal(l.products,"discount"))),1),t("td",Pe,s(e.nsCurrency(e.computeTotal(l.products,"tax_value"))),1),t("td",Ue,s(e.nsCurrency(e.computeTotal(l.products,"total_price"))),1),t("td",Fe,s(e.nsCurrency(e.computeTotal(l.products,"total_purchase_price"))),1),t("td",Le,s(e.nsCurrency(e.computeTotal(l.products,"total_price")-(e.computeTotal(l.products,"total_purchase_price")+e.computeTotal(l.products,"tax_value")+e.computeTotal(l.products,"discount")))),1)])],64))),128))]),t("tfoot",Se,[t("tr",null,[o[11]||(o[11]=t("td",{colspan:"2",class:"p-2 border text-primary"},null,-1)),t("td",Re,s(e.computeTotal(r.result,"total_sold_items")),1),t("td",Be,s(e.nsCurrency(e.computeTotal(r.result,"total_discount"))),1),t("td",Ne,s(e.nsCurrency(e.computeTotal(r.result,"total_tax_value"))),1),t("td",Ae,s(e.nsCurrency(e.computeTotal(r.result,"total_price"))),1),t("td",je,s(e.nsCurrency(e.computeTotal(r.result,"total_purchase_price"))),1),t("td",Me,s(e.nsCurrency(e.computeTotal(r.result,"total_price")-(e.computeTotal(r.result,"total_purchase_price")+e.computeTotal(r.result,"total_discount")+e.computeTotal(r.result,"total_tax_value")))),1)])])])])])):p("",!0),r.reportType.value==="categories_summary"?(c(),n("div",qe,[t("div",He,[t("table",Oe,[t("thead",Qe,[t("tr",null,[t("th",Ve,s(e.__("Category")),1),t("th",ze,s(e.__("Quantity")),1),t("th",Ee,s(e.__("Discounts")),1),t("th",Ge,s(e.__("Cost")),1),t("th",Ie,s(e.__("Taxes")),1),t("th",Je,s(e.__("Total")),1)])]),t("tbody",Ke,[(c(!0),n(b,null,m(r.result,(l,y)=>(c(),n("tr",{key:y,class:""},[t("td",We,s(l.name),1),t("td",Xe,s(e.computeTotal(l.products,"quantity")),1),t("td",Ye,s(e.nsCurrency(e.computeTotal(l.products,"discount"))),1),t("td",Ze,s(e.nsCurrency(e.computeTotal(l.products,"total_purchase_price"))),1),t("td",$e,s(e.nsCurrency(e.computeTotal(l.products,"tax_value"))),1),t("td",ts,s(e.nsCurrency(e.computeTotal(l.products,"total_price"))),1)]))),128))]),t("tfoot",es,[t("tr",null,[o[12]||(o[12]=t("td",{class:"p-2 border text-primary"},null,-1)),t("td",ss,s(e.computeTotal(r.result,"total_sold_items")),1),t("td",rs,s(e.nsCurrency(e.computeTotal(r.result,"total_discount"))),1),t("td",os,s(e.nsCurrency(e.computeTotal(r.result,"total_purchase_price"))),1),t("td",ls,s(e.nsCurrency(e.computeTotal(r.result,"total_tax_value"))),1),t("td",as,s(e.nsCurrency(e.computeTotal(r.result,"total_price"))),1)])])])])])):p("",!0)])])}const xs=P(L,[["render",ds]]);export{xs as default};
