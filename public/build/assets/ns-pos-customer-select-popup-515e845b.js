import{F as I,p as L,n as g,a as x,e as N,P as S}from"./bootstrap-0aabbab9.js";import{_ as a,n as V}from"./currency-47ec5b79.js";import{w as H,m as F}from"./npm~@vue~runtime-dom_-a668b91e.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import{ae as f,a6 as l,z as i,A as e,c as d,y as u,F as v,ac as C,x as W,ax as m,H as w,az as U}from"./npm~@vue~runtime-core_-ff0bdc0c.js";import{U as t}from"./npm~@vue~shared_-82b01912.js";import{a as q,b as B}from"./ns-paginate-19e98260.js";import{r as E}from"./npm~@vue~reactivity_-481192b6.js";import R from"./ns-pos-confirm-popup-07a76865.js";import{n as M}from"./ns-orders-preview-popup-86a40fe6.js";const K={mounted(){this.closeWithOverlayClicked(),this.loadTransactionFields()},props:["popup"],data(){return{fields:[],isSubmiting:!1,formValidation:new I}},methods:{__:a,closeWithOverlayClicked:L,proceed(){const o=this.popup.params.customer,n=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,g.post(`/api/customers/${o.id}/account-history`,n).subscribe({next:p=>{this.isSubmiting=!1,x.success(p.message).subscribe(),this.popup.params.resolve(p),this.popup.close()},error:p=>{this.isSubmiting=!1,x.error(p.message).subscribe(),this.popup.params.reject(p)}})},close(){this.popup.close(),this.popup.params.reject(!1)},loadTransactionFields(){g.get("/api/fields/ns.customers-account").subscribe({next:o=>{this.fields=this.formValidation.createFields(o)}})}}},Q={class:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-6/7-screen md:h-5/7-screen lg:h-5/7-screen overflow-hidden shadow-lg ns-box flex flex-col relative"},Y={class:"p-2 border-b ns-box-header flex justify-between items-center"},G={class:"font-semibold"},J={class:"flex-auto overflow-y-auto"},X={key:0,class:"h-full w-full flex items-center justify-center"},Z={key:1,class:"p-2"},$={class:"p-2 ns-box-footer justify-between border-t flex"},ee=e("div",null,null,-1),se={class:"px-1"},te={class:"-mx-2 flex flex-wrap"},oe={class:"px-1"},re={class:"px-1"},ne={key:0,class:"h-full w-full absolute flex items-center justify-center",style:{background:"rgb(0 98 171 / 45%)"}};function le(o,n,p,y,r,s){const k=f("ns-close-button"),h=f("ns-spinner"),b=f("ns-field"),T=f("ns-button");return l(),i("div",Q,[e("div",Y,[e("h2",G,t(s.__("New Transaction")),1),e("div",null,[d(k,{onClick:n[0]||(n[0]=_=>s.close())})])]),e("div",J,[r.fields.length===0?(l(),i("div",X,[d(h)])):u("",!0),r.fields.length>0?(l(),i("div",Z,[(l(!0),i(v,null,C(r.fields,(_,P)=>(l(),W(b,{field:_,key:P},null,8,["field"]))),128))])):u("",!0)]),e("div",$,[ee,e("div",se,[e("div",te,[e("div",oe,[d(T,{type:"error",onClick:n[1]||(n[1]=_=>s.close())},{default:m(()=>[w(t(s.__("Close")),1)]),_:1})]),e("div",re,[d(T,{type:"info",onClick:n[2]||(n[2]=_=>s.proceed())},{default:m(()=>[w(t(s.__("Proceed")),1)]),_:1})])])])]),r.isSubmiting===0?(l(),i("div",ne,[d(h)])):u("",!0)])}const ie=O(K,[["render",le]]),ce={name:"ns-pos-coupons-load-popup",props:["popup"],components:{nsNotice:q},data(){return{placeHolder:a("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,coupon:null}},mounted(){this.popupCloser(),this.orderSubscriber=POS.order.subscribe(o=>{this.order=E(o),this.order.coupons.length>0&&(this.activeTab="active-coupons")}),this.popup.params&&this.popup.params.apply_coupon&&(this.couponCode=this.popup.params.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:o=>{this.coupon=o,this.apply()}}))},unmounted(){this.orderSubscriber.unsubscribe()},methods:{__:a,popupCloser:L,popupResolver:N,selectCustomer(){Popup.show(z)},cancel(){this.coupon=null,this.couponCode=null},removeCoupon(o){this.order.coupons.splice(o,1),POS.refreshCart()},apply(){try{if(this.coupon.valid_hours_start!==null&&!ns.date.moment.isAfter(this.coupon.valid_hours_start)&&this.coupon.valid_hours_start.length>0)return x.error(a("The coupon is out from validity date range.")).subscribe();if(this.coupon.valid_hours_end!==null&&!ns.date.moment.isBefore(this.coupon.valid_hours_end)&&this.coupon.valid_hours_end.length>0)return x.error(a("The coupon is out from validity date range.")).subscribe();const o=this.coupon.products;if(o.length>0){const y=o.map(r=>r.product_id);if(this.order.products.filter(r=>y.includes(r.product_id)).length===0)return x.error(a("This coupon requires products that aren't available on the cart at the moment.")).subscribe()}const n=this.coupon.categories;if(n.length>0){const y=n.map(r=>r.category_id);if(this.order.products.filter(r=>y.includes(r.$original().category_id)).length===0)return x.error(a("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s")).subscribe()}let p={customer_coupon_id:this.coupon.customer_coupon.length>0?this.coupon.customer_coupon[0].id:0,minimum_cart_value:this.coupon.minimum_cart_value,maximum_cart_value:this.coupon.maximum_cart_value,name:this.coupon.name,type:this.coupon.type,value:0,id:this.coupon.id,limit_usage:this.coupon.limit_usage,code:this.coupon.code,discount_value:this.coupon.discount_value,categories:this.coupon.categories,products:this.coupon.products};this.cancel(),POS.pushCoupon(p),this.activeTab="active-coupons",setTimeout(()=>{this.popupResolver(p)},500),x.success(a("The coupon has applied to the cart.")).subscribe()}catch(o){console.log(o)}},getCouponType(o){switch(o){case"percentage_discount":return a("Percentage");case"flat_discount":return a("Flat");default:return a("Unknown Type")}},getDiscountValue(o){switch(o.type){case"percentage_discount":return o.discount_value+"%";case"flat_discount":return this.$options.filters.currency(o.discount_value)}},closePopup(){this.popupResolver(!1)},setActiveTab(o){this.activeTab=o,o==="apply-coupon"&&setTimeout(()=>{document.querySelector(".coupon-field").select()},10)},getCoupon(o){return!this.order.customer_id>0?x.error(a("You must select a customer before applying a coupon.")):g.post(`/api/customers/coupons/${o}`,{customer_id:this.order.customer_id})},loadCoupon(){const o=this.couponCode;this.getCoupon(o).subscribe({next:n=>{this.coupon=n,x.success(a("The coupon has been loaded.")).subscribe()},error:n=>{x.error(n.message||a("An unexpected error occurred.")).subscribe()}})}}},ue={class:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-2/6-screen"},de={class:"border-b ns-box-header p-2 flex justify-between items-center"},ae={class:"font-bold"},_e={class:"p-1 ns-box-body"},pe={class:"border-2 input-group info rounded flex"},he=["placeholder"],me={class:"pt-2"},fe={key:0,class:"pt-2 flex"},be={key:1,class:"pt-2"},ye={class:"overflow-hidden"},xe={key:0,class:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},ve={class:"w-full ns-table"},we={class:"p-2 w-1/2 border"},ge={class:"p-2 w-1/2 border"},Ce={class:"p-2 w-1/2 border"},ke={class:"p-2 w-1/2 border"},Te={class:"p-2 w-1/2 border"},Se={class:"p-2 w-1/2 border"},Pe={class:"p-2 w-1/2 border"},Le={class:"p-2 w-1/2 border"},Oe={class:"p-2 w-1/2 border"},je={class:"p-2 w-1/2 border"},Ae={class:"p-2 w-1/2 border"},Ne={class:"p-2 w-1/2 border"},Re={key:0},Ve={class:"p-2 w-1/2 border"},He={class:"p-2 w-1/2 border"},Fe={key:0},We={key:0},Ue={class:"flex-auto"},ze={class:"font-semibold text-primary p-2 flex justify-between"},De={key:0,class:"flex justify-between elevation-surface border items-center p-2"},Ie={key:0,class:"flex"};function qe(o,n,p,y,r,s){const k=f("ns-close-button"),h=f("ns-notice"),b=f("ns-tabs-item"),T=f("ns-tabs");return l(),i("div",ue,[e("div",de,[e("h3",ae,t(s.__("Load Coupon")),1),e("div",null,[d(k,{onClick:n[0]||(n[0]=_=>s.closePopup())})])]),e("div",_e,[d(T,{onActive:n[5]||(n[5]=_=>s.setActiveTab(_)),active:r.activeTab},{default:m(()=>[d(b,{label:s.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"},{default:m(()=>[e("div",pe,[U(e("input",{ref:"coupon",onKeyup:n[1]||(n[1]=H(_=>s.loadCoupon(),["enter"])),"onUpdate:modelValue":n[2]||(n[2]=_=>r.couponCode=_),type:"text",class:"coupon-field w-full text-primary p-2 outline-none",placeholder:r.placeHolder},null,40,he),[[F,r.couponCode]]),e("button",{onClick:n[3]||(n[3]=_=>s.loadCoupon()),class:"px-3 py-2"},t(s.__("Load")),1)]),e("div",me,[d(h,{color:"info"},{description:m(()=>[w(t(s.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")),1)]),_:1})]),r.order&&r.order.customer_id===void 0?(l(),i("div",fe,[e("button",{onClick:n[4]||(n[4]=_=>s.selectCustomer()),class:"w-full border p-2 outline-none ns-numpad-key info cursor-pointer text-center"},t(s.__("Click here to choose a customer.")),1)])):u("",!0),r.order&&r.order.customer_id!==void 0?(l(),i("div",be,[d(h,{color:"success"},{description:m(()=>[w(t(s.__("Loading Coupon For : ")+`${r.order.customer.first_name} ${r.order.customer.last_name}`),1)]),_:1})])):u("",!0),e("div",ye,[r.coupon?(l(),i("div",xe,[e("table",ve,[e("tbody",null,[e("tr",null,[e("td",we,t(s.__("Coupon Name")),1),e("td",ge,t(r.coupon.name),1)]),e("tr",null,[e("td",Ce,t(s.__("Discount"))+" ("+t(s.getCouponType(r.coupon.type))+")",1),e("td",ke,t(s.getDiscountValue(r.coupon)),1)]),e("tr",null,[e("td",Te,t(s.__("Usage")),1),e("td",Se,t((r.coupon.customer_coupon.length>0?r.coupon.customer_coupon[0].usage:0)+"/"+(r.coupon.limit_usage||s.__("Unlimited"))),1)]),e("tr",null,[e("td",Pe,t(s.__("Valid From")),1),e("td",Le,t(r.coupon.valid_hours_start||s.__("N/A")),1)]),e("tr",null,[e("td",Oe,t(s.__("Valid Till")),1),e("td",je,t(r.coupon.valid_hours_end||s.__("N/A")),1)]),e("tr",null,[e("td",Ae,t(s.__("Categories")),1),e("td",Ne,[e("ul",null,[(l(!0),i(v,null,C(r.coupon.categories,_=>(l(),i("li",{class:"rounded-full px-3 py-1 border",key:_.id},t(_.category.name),1))),128)),r.coupon.categories.length===0?(l(),i("li",Re,t(s.__("Not applicable")),1)):u("",!0)])])]),e("tr",null,[e("td",Ve,t(s.__("Products")),1),e("td",He,[e("ul",null,[(l(!0),i(v,null,C(r.coupon.products,_=>(l(),i("li",{class:"rounded-full px-3 py-1 border",key:_.id},t(_.product.name),1))),128)),r.coupon.products.length===0?(l(),i("li",Fe,t(s.__("Not applicable")),1)):u("",!0)])])])])])])):u("",!0)])]),_:1},8,["label"]),d(b,{label:s.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"},{default:m(()=>[r.order?(l(),i("ul",We,[(l(!0),i(v,null,C(r.order.coupons,(_,P)=>(l(),i("li",{key:P,class:"flex justify-between elevation-surface border items-center px-2 py-1"},[e("div",Ue,[e("h3",ze,[e("span",null,t(_.name),1),e("span",null,t(s.getDiscountValue(_)),1)])]),e("div",null,[d(k,{onClick:j=>s.removeCoupon(P)},null,8,["onClick"])])]))),128)),r.order.coupons.length===0?(l(),i("li",De,t(s.__("No coupons applies to the cart.")),1)):u("",!0)])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])]),r.coupon?(l(),i("div",Ie,[e("button",{onClick:n[6]||(n[6]=_=>s.apply()),class:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold"},t(s.__("Apply")),1),e("button",{onClick:n[7]||(n[7]=_=>s.cancel()),class:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold"},t(s.__("Cancel")),1)])):u("",!0)])}const Be=O(ce,[["render",qe]]),Ee={name:"ns-pos-customers",props:["popup"],data(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:B},unmounted(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted(){this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe(o=>{this.options=o}),this.subscription=POS.order.subscribe(o=>{this.order=o,this.popup.params.customer!==void 0?(this.activeTab="account-payment",this.customer=this.popup.params.customer,this.loadCustomerOrders()):o.customer!==void 0&&(this.activeTab="account-payment",this.customer=o.customer,this.loadCustomerOrders())}),this.popupCloser()},methods:{__:a,nsCurrency:V,reload(){this.loadCustomerOrders()},popupResolver:N,popupCloser:L,getWalletHistoryLabel(o){switch(o){case"add":return a("Crediting");case"deduct":return a("Removing");case"refund":return a("Refunding");case"payment":return a("Payment");default:return a("Unknow")}},getType(o){switch(o){case"percentage_discount":return a("Percentage Discount");case"flat_discount":return a("Flat Discount")}},closeWithOverlayClicked:L,async openOrderOptions(o){try{const n=await new Promise((p,y)=>{S.show(M,{order:o,resolve:p,reject:y})});this.reload()}catch{x.error(a("An error occurred while opening the order options")).subscribe()}},doChangeTab(o){this.selectedTab=o,o==="coupons"&&this.loadCoupons(),o==="rewards"&&this.loadRewards(),o==="wallet-history"&&this.loadAccounHistory(),o==="orders"&&this.loadCustomerOrders()},loadAccounHistory(){this.isLoadingHistory=!0,g.get(`/api/customers/${this.customer.id}/account-history`).subscribe({next:o=>{this.walletHistories=o.data,this.isLoadingHistory=!1},error:o=>{this.isLoadingHistory=!1}})},loadCoupons(){this.isLoadingCoupons=!0,g.get(`/api/customers/${this.customer.id}/coupons`).subscribe({next:o=>{this.coupons=o,this.isLoadingCoupons=!1},error:o=>{this.isLoadingCoupons=!1}})},loadRewards(o=`/api/customers/${this.customer.id}/rewards`){this.isLoadingRewards=!0,g.get(o).subscribe({next:n=>{this.rewardsResponse=n,this.isLoadingRewards=!1},error:n=>{this.isLoadingRewards=!1}})},prefillForm(o){this.popup.params.name!==void 0&&(o.main.value=this.popup.params.name)},openCustomerSelection(){this.popup.close(o=>{S.show(z)})},loadCustomerOrders(){this.isLoadingOrders=!0,g.get(`/api/customers/${this.customer.id}/orders`).subscribe({next:o=>{this.orders=o,this.isLoadingOrders=!1},error:o=>{this.isLoadingOrders=!1}})},newTransaction(o){new Promise((p,y)=>{S.show(ie,{customer:o,resolve:p,reject:y})}).then(p=>{POS.loadCustomer(o.id).subscribe(y=>{POS.selectCustomer(y)})})},applyCoupon(o){this.order.customer===void 0?S.show(R,{title:a("Use Customer ?"),message:a("No customer is selected. Would you like to proceed with this customer ?"),onAction:n=>{n&&POS.selectCustomer(this.customer).then(p=>{this.proceedApplyingCoupon(o)})}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(o):this.order.customer.id!==this.customer.id&&S.show(R,{title:a("Change Customer ?"),message:a("Would you like to assign this customer to the ongoing order ?"),onAction:n=>{n&&POS.selectCustomer(this.customer).then(p=>{this.proceedApplyingCoupon(o)})}})},proceedApplyingCoupon(o){new Promise((n,p)=>{S.show(Be,{apply_coupon:o.code,resolve:n,reject:p})}).then(n=>{this.popupResolver(!1)}).catch(n=>{})},handleSavedCustomer(o){x.success(o.message).subscribe(),POS.selectCustomer(o.entry),this.popup.close()}}},Me={id:"ns-pos-customers",class:"shadow-lg rounded w-95vw h-95vh lg:w-3/5-screen flex flex-col overflow-hidden"},Ke={class:"ns-header p-2 flex justify-between items-center border-b"},Qe={class:"font-semibold"},Ye={class:"ns-body flex-auto flex p-2 overflow-y-auto"},Ge={key:1,class:"h-full flex-col w-full flex items-center justify-center text-primary"},Je=e("i",{class:"lar la-hand-paper ns-icon text-6xl"},null,-1),Xe={class:"font-medium text-2xl"},Ze={key:0,class:"flex-auto w-full flex items-center justify-center flex-col p-4"},$e=e("i",{class:"lar la-frown text-6xl"},null,-1),es={class:"font-medium text-2xl"},ss={class:"my-2"},ts={key:1,class:"flex flex-col flex-auto"},os={class:"flex-auto p-2 flex flex-col"},rs={class:"flex flex-wrap"},ls={class:"px-4 mb-4 w-full"},is={class:"font-semibold"},cs={class:"flex flex-wrap ns-tab-cards -mx-2 w-full"},us={class:"px-2 mb-4 w-full md:w-1/4 flex"},ds={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},as={class:"font-medium text-lg"},_s={class:"w-full flex justify-end"},ps={class:"font-bold"},hs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ms={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},fs={class:"font-medium text-lg"},bs={class:"w-full flex justify-end"},ys={class:"font-bold"},xs={class:"px-2 mb-4 w-full md:w-1/4 flex"},vs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},ws={class:"font-medium text-lg"},gs={class:"w-full flex justify-end"},Cs={class:"font-bold"},ks={class:"px-2 mb-4 w-full md:w-1/4 flex"},Ts={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},Ss={class:"font-medium text-lg"},Ps={class:"w-full flex justify-end"},Ls={class:"font-bold"},Os={class:"flex flex-auto flex-col overflow-hidden"},js={key:0,class:"flex-auto h-full justify-center flex items-center"},As={class:"py-2 w-full"},Ns={class:"font-semibold text-primary"},Rs={class:"flex-auto flex-col flex overflow-hidden"},Vs={class:"flex-auto overflow-y-auto"},Hs={class:"table ns-table w-full"},Fs={class:"text-primary"},Ws={colspan:"3",width:"150",class:"p-2 border font-semibold"},Us={width:"50",class:"p-2 border font-semibold"},zs={class:"text-primary"},Ds={key:0},Is={class:"border p-2 text-center",colspan:"4"},qs={colspan:"3",class:"border p-2 text-center"},Bs={class:"flex flex-col items-start"},Es={class:"font-bold"},Ms={class:"md:-mx-2 w-full flex flex-col md:flex-row"},Ks={class:"md:px-2 flex items-start w-full md:w-1/4"},Qs={class:"md:px-2 flex items-start w-full md:w-1/4"},Ys={class:"md:px-2 flex items-start w-full md:w-1/4"},Gs={class:"border p-2 text-center"},Js=["onClick"],Xs=e("i",{class:"las la-wallet"},null,-1),Zs={class:"ml-1"},$s={key:0,class:"flex-auto h-full justify-center flex items-center"},et={class:"py-2 w-full"},st={class:"font-semibold text-primary"},tt={class:"flex-auto flex-col flex overflow-hidden"},ot={class:"flex-auto overflow-y-auto"},rt={class:"table ns-table w-full"},nt={class:"text-primary"},lt={colspan:"3",width:"150",class:"p-2 border font-semibold"},it={class:"text-primary"},ct={key:0},ut={class:"border p-2 text-center",colspan:"3"},dt={colspan:"3",class:"border p-2 text-center"},at={class:"flex flex-col items-start"},_t={class:"font-bold"},pt={class:"md:-mx-2 w-full flex flex-col md:flex-row"},ht={class:"md:px-2 flex items-start w-full md:w-1/3"},mt={class:"md:px-2 flex items-start w-full md:w-1/3"},ft={key:0,class:"flex-auto h-full justify-center flex items-center"},bt={class:"py-2 w-full"},yt={class:"font-semibold text-primary"},xt={class:"flex-auto flex-col flex overflow-hidden"},vt={class:"flex-auto overflow-y-auto"},wt={class:"table ns-table w-full"},gt={class:"text-primary"},Ct={width:"150",class:"p-2 border font-semibold"},kt={class:"p-2 border font-semibold"},Tt=e("th",{class:"p-2 border font-semibold"},null,-1),St={class:"text-primary text-sm"},Pt={key:0},Lt={class:"border p-2 text-center",colspan:"4"},Ot={width:"300",class:"border p-2"},jt={class:""},At={class:"-mx-2 flex"},Nt={class:"text-xs text-primary px-2"},Rt={class:"text-xs text-primary px-2"},Vt={class:"border p-2 text-center"},Ht={key:0},Ft={key:1},Wt={class:"border p-2 text-right"},Ut={key:0,class:"flex-auto h-full justify-center flex items-center"},zt={class:"py-2 w-full"},Dt={class:"font-semibold text-primary"},It={class:"flex-auto flex-col flex overflow-hidden"},qt={class:"flex-auto overflow-y-auto"},Bt={class:"table ns-table w-full"},Et={class:"text-primary"},Mt={width:"150",class:"p-2 border font-semibold"},Kt={class:"p-2 border font-semibold"},Qt={class:"p-2 border font-semibold"},Yt={key:0,class:"text-primary text-sm"},Gt={key:0},Jt={class:"border p-2 text-center",colspan:"4"},Xt={width:"300",class:"border p-2"},Zt={class:"text-center"},$t={width:"300",class:"border p-2"},eo={class:"text-center"},so={width:"300",class:"border p-2"},to={class:"text-center"},oo={class:"py-1 flex justify-end"},ro={class:"p-2 border-t border-box-edge flex justify-between"},no=e("div",null,null,-1);function lo(o,n,p,y,r,s){const k=f("ns-close-button"),h=f("ns-crud-form"),b=f("ns-tabs-item"),T=f("ns-button"),_=f("ns-spinner"),P=f("ns-paginate"),j=f("ns-tabs");return l(),i("div",Me,[e("div",Ke,[e("h3",Qe,t(s.__("Customers")),1),e("div",null,[d(k,{onClick:n[0]||(n[0]=c=>p.popup.close())})])]),e("div",Ye,[d(j,{active:r.activeTab,onActive:n[7]||(n[7]=c=>r.activeTab=c)},{default:m(()=>[d(b,{identifier:"create-customers",label:s.__("New Customer")},{default:m(()=>[r.options.ns_pos_customers_creation_enabled==="yes"?(l(),W(h,{key:0,onUpdated:n[1]||(n[1]=c=>s.prefillForm(c)),onSave:n[2]||(n[2]=c=>s.handleSavedCustomer(c)),"submit-url":"/api/crud/ns.customers",src:"/api/crud/ns.customers/form-config"},{title:m(()=>[w(t(s.__("Customer Name")),1)]),save:m(()=>[w(t(s.__("Save Customer")),1)]),_:1})):u("",!0),r.options.ns_pos_customers_creation_enabled!=="yes"?(l(),i("div",Ge,[Je,e("h3",Xe,t(s.__("Not Authorized")),1),e("p",null,t(s.__("Creating customers has been explicitly disabled from the settings.")),1)])):u("",!0)]),_:1},8,["label"]),d(b,{identifier:"account-payment",label:s.__("Customer Account"),class:"flex",padding:"p-0 flex"},{default:m(()=>[r.customer===null?(l(),i("div",Ze,[$e,e("h3",es,t(s.__("No Customer Selected")),1),e("p",null,t(s.__("In order to see a customer account, you need to select one customer.")),1),e("div",ss,[d(T,{onClick:n[3]||(n[3]=c=>s.openCustomerSelection()),type:"info"},{default:m(()=>[w(t(s.__("Select Customer")),1)]),_:1})])])):u("",!0),r.customer?(l(),i("div",ts,[e("div",os,[e("div",rs,[e("div",ls,[e("h2",is,t(s.__("Summary For"))+" : "+t(r.customer.first_name),1)]),e("div",cs,[e("div",us,[e("div",ds,[e("h3",as,t(s.__("Purchases")),1),e("div",_s,[e("h2",ps,t(s.nsCurrency(r.customer.purchases_amount)),1)])])]),e("div",hs,[e("div",ms,[e("h3",fs,t(s.__("Owed")),1),e("div",bs,[e("h2",ys,t(s.nsCurrency(r.customer.owed_amount)),1)])])]),e("div",xs,[e("div",vs,[e("h3",ws,t(s.__("Wallet Amount")),1),e("div",gs,[e("h2",Cs,t(s.nsCurrency(r.customer.account_amount)),1)])])]),e("div",ks,[e("div",Ts,[e("h3",Ss,t(s.__("Credit Limit")),1),e("div",Ps,[e("h2",Ls,t(s.nsCurrency(r.customer.credit_limit_amount)),1)])])])])]),e("div",Os,[d(j,{active:r.selectedTab,onChangeTab:n[5]||(n[5]=c=>s.doChangeTab(c))},{default:m(()=>[d(b,{identifier:"orders",label:s.__("Orders")},{default:m(()=>[r.isLoadingOrders?(l(),i("div",js,[d(_,{size:"36"})])):u("",!0),r.isLoadingOrders?u("",!0):(l(),i(v,{key:1},[e("div",As,[e("h2",Ns,t(s.__("Last Purchases")),1)]),e("div",Rs,[e("div",Vs,[e("table",Hs,[e("thead",null,[e("tr",Fs,[e("th",Ws,t(s.__("Order")),1),e("th",Us,t(s.__("Options")),1)])]),e("tbody",zs,[r.orders.length===0?(l(),i("tr",Ds,[e("td",Is,t(s.__("No orders...")),1)])):u("",!0),(l(!0),i(v,null,C(r.orders,c=>(l(),i("tr",{key:c.id},[e("td",qs,[e("div",Bs,[e("h3",Es,t(s.__("Code"))+": "+t(c.code),1),e("div",Ms,[e("div",Ks,[e("small",null,t(s.__("Total"))+": "+t(s.nsCurrency(c.total)),1)]),e("div",Qs,[e("small",null,t(s.__("Status"))+": "+t(c.human_status),1)]),e("div",Ys,[e("small",null,t(s.__("Delivery"))+": "+t(c.human_delivery_status),1)])])])]),e("td",Gs,[e("button",{onClick:D=>s.openOrderOptions(c),class:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success"},[Xs,e("span",Zs,t(s.__("Options")),1)],8,Js)])]))),128))])])])])],64))]),_:1},8,["label"]),d(b,{identifier:"wallet-history",label:s.__("Wallet History")},{default:m(()=>[r.isLoadingHistory?(l(),i("div",$s,[d(_,{size:"36"})])):u("",!0),r.isLoadingHistory?u("",!0):(l(),i(v,{key:1},[e("div",et,[e("h2",st,t(s.__("Wallet History")),1)]),e("div",tt,[e("div",ot,[e("table",rt,[e("thead",null,[e("tr",nt,[e("th",lt,t(s.__("Transaction")),1)])]),e("tbody",it,[r.walletHistories.length===0?(l(),i("tr",ct,[e("td",ut,t(s.__("No History...")),1)])):u("",!0),(l(!0),i(v,null,C(r.walletHistories,c=>(l(),i("tr",{key:c.id},[e("td",dt,[e("div",at,[e("h3",_t,t(s.__("Transaction"))+": "+t(s.getWalletHistoryLabel(c.operation)),1),e("div",pt,[e("div",ht,[e("small",null,t(s.__("Amount"))+": "+t(s.nsCurrency(o.amount)),1)]),e("div",mt,[e("small",null,t(s.__("Date"))+": "+t(c.created_at),1)])])])])]))),128))])])])])],64))]),_:1},8,["label"]),d(b,{identifier:"coupons",label:s.__("Coupons")},{default:m(()=>[r.isLoadingCoupons?(l(),i("div",ft,[d(_,{size:"36"})])):u("",!0),r.isLoadingCoupons?u("",!0):(l(),i(v,{key:1},[e("div",bt,[e("h2",yt,t(s.__("Coupons")),1)]),e("div",xt,[e("div",vt,[e("table",wt,[e("thead",null,[e("tr",gt,[e("th",Ct,t(s.__("Name")),1),e("th",kt,t(s.__("Type")),1),Tt])]),e("tbody",St,[r.coupons.length===0?(l(),i("tr",Pt,[e("td",Lt,t(s.__("No coupons for the selected customer...")),1)])):u("",!0),(l(!0),i(v,null,C(r.coupons,c=>(l(),i("tr",{key:c.id},[e("td",Ot,[e("h3",null,t(c.name),1),e("div",jt,[e("ul",At,[e("li",Nt,t(s.__("Usage :"))+" "+t(c.usage)+"/"+t(c.limit_usage),1),e("li",Rt,t(s.__("Code :"))+" "+t(c.code),1)])])]),e("td",Vt,[w(t(s.getType(c.coupon.type))+" ",1),c.coupon.type==="percentage_discount"?(l(),i("span",Ht," ("+t(c.coupon.discount_value)+"%) ",1)):u("",!0),c.coupon.type==="flat_discount"?(l(),i("span",Ft," ("+t(s.nsCurrency(o.value))+") ",1)):u("",!0)]),e("td",Wt,[d(T,{onClick:D=>s.applyCoupon(c),type:"info"},{default:m(()=>[w(t(s.__("Use Coupon")),1)]),_:2},1032,["onClick"])])]))),128))])])])])],64))]),_:1},8,["label"]),d(b,{identifier:"rewards",label:s.__("Rewards")},{default:m(()=>[r.isLoadingRewards?(l(),i("div",Ut,[d(_,{size:"36"})])):u("",!0),r.isLoadingRewards?u("",!0):(l(),i(v,{key:1},[e("div",zt,[e("h2",Dt,t(s.__("Rewards")),1)]),e("div",It,[e("div",qt,[e("table",Bt,[e("thead",null,[e("tr",Et,[e("th",Mt,t(s.__("Name")),1),e("th",Kt,t(s.__("Points")),1),e("th",Qt,t(s.__("Target")),1)])]),r.rewardsResponse.data?(l(),i("tbody",Yt,[r.rewardsResponse.data.length===0?(l(),i("tr",Gt,[e("td",Jt,t(s.__("No rewards available the selected customer...")),1)])):u("",!0),(l(!0),i(v,null,C(r.rewardsResponse.data,c=>(l(),i("tr",{key:c.id},[e("td",Xt,[e("h3",Zt,t(c.reward_name),1)]),e("td",$t,[e("h3",eo,t(c.points),1)]),e("td",so,[e("h3",to,t(c.target),1)])]))),128))])):u("",!0)])])]),e("div",oo,[d(P,{pagination:r.rewardsResponse,onLoad:n[4]||(n[4]=c=>s.loadRewards(c))},null,8,["pagination"])])],64))]),_:1},8,["label"])]),_:1},8,["active"])])]),e("div",ro,[no,e("div",null,[d(T,{onClick:n[6]||(n[6]=c=>s.newTransaction(r.customer)),type:"info"},{default:m(()=>[w(t(s.__("Account Transaction")),1)]),_:1})])])])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])])])}const A=O(Ee,[["render",lo]]),qo=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"})),io={props:["popup"],data(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected(){return!1}},watch:{searchCustomerValue(o){clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout(()=>{this.searchCustomer(o)},500)}},mounted(){this.orderSubscription=POS.order.subscribe(o=>{this.order=o}),this.getRecentCustomers(),this.$refs.searchField.focus()},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:a,nsCurrency:V,resolveIfQueued:N,attemptToChoose(){if(this.customers.length===1)return this.selectCustomer(this.customers[0]);x.info(a("Too many results.")).subscribe()},openCustomerHistory(o,n){n.stopImmediatePropagation(),this.popup.close(),S.show(A,{customer:o,activeTab:"account-payment"})},selectCustomer(o){this.customers.forEach(n=>n.selected=!1),o.selected=!0,this.isLoading=!0,POS.selectCustomer(o).then(n=>{this.isLoading=!1,this.resolveIfQueued(o)}).catch(n=>{this.isLoading=!1})},searchCustomer(o){g.post("/api/customers/search",{search:o}).subscribe(n=>{n.forEach(p=>p.selected=!1),this.customers=n})},createCustomerWithMatch(o){this.resolveIfQueued(!1),S.show(A,{name:o})},getRecentCustomers(){this.isLoading=!0,g.get("/api/customers/recently-active").subscribe({next:o=>{this.isLoading=!1,o.forEach(n=>n.selected=!1),this.customers=o},error:o=>{this.isLoading=!1}})}}},co={id:"ns-pos-customer-select-popup",class:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108"},uo={id:"header",class:"border-b ns-box-header text-center font-semibold text-2xl py-2"},ao={class:"relative"},_o={class:"p-2 border-b ns-box-body items-center flex justify-between"},po={class:"flex items-center justify-between"},ho=e("i",{class:"las la-eye"},null,-1),mo=[ho],fo={class:"p-2 border-b ns-box-body flex justify-between text-primary"},bo={class:"input-group flex-auto border-2 rounded"},yo={class:"h-3/5-screen xl:h-2/5-screen overflow-y-auto ns-scrollbar"},xo={class:"ns-vertical-menu"},vo={key:0,class:"p-2 text-center text-primary"},wo={class:"border-b border-dashed border-info-primary"},go=["onClick"],Co={class:"flex items-center"},ko={key:0,class:"text-error-primary"},To={key:1},So={class:"purchase-amount"},Po=["onClick"],Lo=e("i",{class:"las la-eye"},null,-1),Oo=[Lo],jo={key:0,class:"z-10 top-0 absolute w-full h-full flex items-center justify-center"};function Ao(o,n,p,y,r,s){const k=f("ns-spinner");return l(),i("div",co,[e("div",uo,[e("h2",null,t(s.__("Select Customer")),1)]),e("div",ao,[e("div",_o,[e("span",null,t(s.__("Selected"))+" : ",1),e("div",po,[e("span",null,t(r.order.customer?r.order.customer.name:"N/A"),1),r.order.customer?(l(),i("button",{key:0,onClick:n[0]||(n[0]=h=>s.openCustomerHistory(r.order.customer,h)),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent"},mo)):u("",!0)])]),e("div",fo,[e("div",bo,[U(e("input",{ref:"searchField",onKeydown:n[1]||(n[1]=H(h=>s.attemptToChoose(),["enter"])),"onUpdate:modelValue":n[2]||(n[2]=h=>r.searchCustomerValue=h),placeholder:"Search Customer",type:"text",class:"outline-none w-full p-2"},null,544),[[F,r.searchCustomerValue]])])]),e("div",yo,[e("ul",xo,[r.customers&&r.customers.length===0?(l(),i("li",vo,t(s.__("No customer match your query...")),1)):u("",!0),r.customers&&r.customers.length===0?(l(),i("li",{key:1,onClick:n[3]||(n[3]=h=>s.createCustomerWithMatch(r.searchCustomerValue)),class:"p-2 cursor-pointer text-center text-primary"},[e("span",wo,t(s.__("Create a customer")),1)])):u("",!0),(l(!0),i(v,null,C(r.customers,h=>(l(),i("li",{onClick:b=>s.selectCustomer(h),key:h.id,class:"cursor-pointer p-2 border-b text-primary flex justify-between items-center"},[e("span",null,t(h.first_name),1),e("p",Co,[h.owe_amount>0?(l(),i("span",ko,"-"+t(s.nsCurrency(h.owe_amount)),1)):u("",!0),h.owe_amount>0?(l(),i("span",To,"/")):u("",!0),e("span",So,t(s.nsCurrency(h.purchases_amount)),1),e("button",{onClick:b=>s.openCustomerHistory(h,b),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info"},Oo,8,Po)])],8,go))),128))])]),r.isLoading?(l(),i("div",jo,[d(k,{size:"24",border:"8"})])):u("",!0)])])}const z=O(io,[["render",Ao]]);export{Be as a,qo as b,z as n};
