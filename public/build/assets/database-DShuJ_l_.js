import{F as q}from"./bootstrap-BUS1wR_0.js";import{_ as s}from"./lang-BINodpp-.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as b,c as d,o as i,a as o,b as a,t as r,F as h,e as F,g as f,w as _,A as y,i as P,f as k}from"./runtime-core.esm-bundler-D4l6Snf1.js";import"./currency-BIpHMLzL.js";import"./chart-CFvJmF2u.js";import"./runtime-dom.esm-bundler-DaZ-XdMB.js";const C={data:()=>({formValidation:new q,firstPartFields:[],secondPartFields:[],fields:[],isLoading:!1,isCheckingDatabase:!1,__:s}),computed:{form(){return this.formValidation.extractFields([...this.firstPartFields,...this.secondPartFields])},isMySQL(){return this.form.database_driver==="mysql"},isMariaDB(){return this.form.database_driver==="mariadb"},isSqlite(){return this.form.database_driver==="sqlite"}},methods:{validate(){if(this.formValidation.validateFields(this.firstPartFields)&&this.formValidation.validateFields(this.secondPartFields)){this.isLoading=!0,this.formValidation.disableFields(this.firstPartFields),this.formValidation.disableFields(this.secondPartFields);const e={...this.formValidation.getValue(this.firstPartFields),...this.formValidation.getValue(this.secondPartFields)};this.checkDatabase(e).subscribe(n=>{this.formValidation.enableFields(this.firstPartFields),this.formValidation.enableFields(this.secondPartFields),nsRouter.push("configuration"),nsSnackBar.success(n.message,s("OKAY"),{duration:5e3})},n=>{this.formValidation.enableFields(this.firstPartFields),this.formValidation.enableFields(this.secondPartFields),this.isLoading=!1,nsSnackBar.error(n.message,s("OKAY"))})}},checkDatabase(e){return nsHttpClient.post("/api/setup/database",e)},checkExisting(){return nsHttpClient.get("/api/setup/check-database")},sliceRange(e,c,n){const p=e.length,u=Math.ceil(p/c);return e.splice(n*u,u)},loadFields(){this.fields=this.formValidation.createFields([{label:s("Driver"),description:s("Set the database driver"),name:"database_driver",value:"mysql",type:"select",options:[{label:"MySQL",value:"mysql"},{label:"MariaDB",value:"mariadb"},{label:"SQLite",value:"sqlite"}],validation:"required"},{label:s("Hostname"),description:s("Provide the database hostname"),name:"hostname",value:"localhost",show:e=>["mysql","mariadb"].includes(e.database_driver)},{label:s("Username"),description:s("Username required to connect to the database."),name:"username",value:"root",show:e=>["mysql","mariadb"].includes(e.database_driver)},{label:s("Password"),description:s("The username password required to connect."),name:"password",value:"",show:e=>["mysql","mariadb"].includes(e.database_driver)},{label:s("Database Name"),description:s("Provide the database name. Leave empty to use default file for SQLite Driver."),name:"database_name",value:"nexopos_v4",show:e=>["mysql","mariadb"].includes(e.database_driver)},{label:s("Database Prefix"),description:s("Provide the database prefix."),name:"database_prefix",value:"ns_",validation:"required",show:e=>["mysql","mariadb"].includes(e.database_driver)},{label:s("Port"),description:s("Provide the hostname port."),name:"database_port",value:"3306",validation:"required",show:e=>["mysql","mariadb"].includes(e.database_driver)}]),this.firstPartFields=Object.values(this.sliceRange([...this.fields],2,0)),this.secondPartFields=Object.values(this.sliceRange([...this.fields],2,1))}},mounted(){this.isCheckingDatabase=!0,this.checkExisting().subscribe({next:e=>{nsRouter.push("configuration")},error:e=>{this.isCheckingDatabase=!1,this.loadFields()}})}},D={key:0,class:"bg-white rounded shadow my-4"},L={class:"welcome-box border-b border-gray-300 p-3 text-gray-600"},B={class:"border-b pb-4 mb-4"},M={key:0},x={class:"font-bold text-lg"},N={key:1},O={class:"font-bold text-lg"},Q={key:2},R={class:"font-bold text-lg"},j={class:"md:-mx-4 md:flex"},H={class:"md:px-4 md:w-1/2 w-full"},A={class:"md:px-4 md:w-1/2 w-full"},E={class:"bg-gray-200 p-3 flex justify-end"},Y={key:1,class:"bg-white shadow rounded p-3 flex justify-center items-center"},$={class:"flex items-center"},z={class:"ml-3"};function K(e,c,n,p,u,l){const v=b("ns-field"),g=b("ns-spinner"),w=b("ns-button");return i(),d(h,null,[e.isCheckingDatabase?o("",!0):(i(),d("div",D,[a("div",L,[a("div",B,[l.isMySQL?(i(),d("div",M,[a("h3",x,r(e.__("MySQL is selected as database driver")),1),a("p",null,r(e.__("Please provide the credentials to ensure NexoPOS can connect to the database.")),1)])):o("",!0),l.isSqlite?(i(),d("div",N,[a("h3",O,r(e.__("Sqlite is selected as database driver")),1),a("p",null,r(e.__("Make sure Sqlite module is available for PHP. Your database will be located on the database directory.")),1)])):o("",!0),l.isMariaDB?(i(),d("div",Q,[a("h3",R,r(e.__("MariaDB is selected as database driver")),1),a("p",null,r(e.__("Please provide the credentials to ensure NexoPOS can connect to the database.")),1)])):o("",!0)]),a("div",j,[a("div",H,[(i(!0),d(h,null,F(e.firstPartFields,(t,m)=>(i(),d(h,{key:m},[t.show===void 0||t.show!==void 0&&t.show(l.form)?(i(),f(v,{key:0,field:t,onChange:V=>e.formValidation.validateField(t)},{default:_(()=>[a("span",null,r(t.label),1),y(e.$slots,"description",{},()=>[P(r(t.description),1)])]),_:2},1032,["field","onChange"])):o("",!0)],64))),128))]),a("div",A,[(i(!0),d(h,null,F(e.secondPartFields,(t,m)=>(i(),d(h,{key:m},[t.show===void 0||t.show!==void 0&&t.show(l.form)?(i(),f(v,{key:0,field:t,onChange:V=>e.formValidation.validateField(t)},{default:_(()=>[a("span",null,r(t.label),1),y(e.$slots,"description",{},()=>[P(r(t.description),1)])]),_:2},1032,["field","onChange"])):o("",!0)],64))),128))])])]),a("div",E,[k(w,{disabled:e.isLoading,onClick:c[0]||(c[0]=t=>l.validate()),type:"info"},{default:_(()=>[e.isLoading?(i(),f(g,{key:0,class:"mr-2",size:6})):o("",!0),a("span",null,r(e.__("Save Settings")),1)]),_:1},8,["disabled"])])])),e.isCheckingDatabase?(i(),d("div",Y,[a("div",$,[k(g,{size:10}),a("span",z,r(e.__("Checking database connectivity...")),1)])])):o("",!0)],64)}const Z=S(C,[["render",K]]);export{Z as default};
