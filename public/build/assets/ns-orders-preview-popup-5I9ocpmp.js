import{a as T,b as v,n as m,F as R,p as I,P as F,c as D,i as M}from"./bootstrap-DI8pXSaz.js";import{n as V}from"./currency-BCJk0SN4.js";import{_ as u}from"./lang-BINodpp-.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as h,c as a,o as l,b as e,t as n,f as y,a as _,F as x,e as w,g as k,w as P,i as S,B as U,n as G}from"./runtime-core.esm-bundler-DUdZl5j1.js";import{a as Q,n as O,N as H,f as z,d as $}from"./ns-prompt-popup-CidREd5w.js";import{a as Y,v as L}from"./runtime-dom.esm-bundler-BJBE8XOq.js";const J={props:["popup"],mounted(){this.popuCloser(),this.loadFields(),this.product=this.popup.params.product},data(){return{formValidation:new R,fields:[],product:null}},methods:{__:u,popuCloser:T,close(){this.popup.params.reject(!1),this.popup.close()},addProduct(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){const r=this.formValidation.extractFields(this.fields),t={...this.product,...r};return this.popup.params.resolve(t),this.close()}m.error(u("The form is not valid."))},loadFields(){v.get("/api/fields/ns.refund-product").subscribe(r=>{this.fields=this.formValidation.createFields(r),this.fields.forEach(t=>{t.value=this.product[t.name]||""})})}}},K={class:"shadow-xl ns-box w-95vw md:w-[60vw] lg:w-[42.86vw] h-95vh md:h-[60vh] lg:h-[70vh] overflow-hidden flex flex-col"},X={class:"p-2 flex justify-between border-b ns-box-header items-center"},Z={class:"text-semibold"},ee={class:"flex-auto overflow-y-auto relative ns-scrollbar"},te={class:"p-2"},se={key:0,class:"h-full w-full flex items-center justify-center"},re={class:"p-2 flex justify-between items-center border-t ns-box-body"};function ne(r,t,o,f,i,s){const b=h("ns-close-button"),d=h("ns-field"),c=h("ns-spinner"),g=h("ns-button");return l(),a("div",K,[e("div",X,[e("h3",Z,n(s.__("Products")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=p=>s.close())})])]),e("div",ee,[e("div",te,[(l(!0),a(x,null,w(i.fields,(p,C)=>(l(),k(d,{key:C,field:p},null,8,["field"]))),128))]),i.fields.length===0?(l(),a("div",se,[y(c)])):_("",!0)]),e("div",re,[t[2]||(t[2]=e("div",null,null,-1)),e("div",null,[y(g,{onClick:t[1]||(t[1]=p=>s.addProduct()),type:"info"},{default:P(()=>[S(n(s.__("Add Product")),1)]),_:1})])])])}const B=A(J,[["render",ne]]),oe={components:{nsNumpad:Q},props:["popup"],data(){return{product:null,seeValue:0,availableQuantity:0}},mounted(){this.product=this.popup.params.product,this.availableQuantity=this.popup.params.availableQuantity,this.seeValue=this.product.quantity},methods:{__:u,popupResolver:I,close(){this.popup.params.reject(!1),this.popup.close()},setChangedValue(r){this.seeValue=r},updateQuantity(r){if(r>this.availableQuantity)return m.error("Unable to proceed as the quantity provided is exceed the available quantity.");this.product.quantity=parseFloat(r),this.popup.params.resolve(this.product),this.popup.close()}}},ie={class:"shadow-xl ns-box overflow-hidden w-95vw md:w-[66.67vw] lg:w-[42.86vw]"},le={class:"p-2 flex justify-between ns-box-header"},de={class:"font-semibold"},ae={key:0,class:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},ce={class:"text-fontcolor text-sm"},ue={key:1,class:"flex-auto overflow-y-auto p-2"};function fe(r,t,o,f,i,s){const b=h("ns-close-button"),d=h("ns-numpad");return l(),a("div",ie,[e("div",le,[e("h3",de,n(s.__("Quantity")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=c=>s.close())})])]),i.product?(l(),a("div",ae,[e("span",null,n(i.seeValue),1),e("span",ce,"("+n(i.availableQuantity)+" "+n(s.__("available"))+")",1)])):_("",!0),i.product?(l(),a("div",ue,[y(d,{value:i.product.quantity,onNext:t[1]||(t[1]=c=>s.updateQuantity(c)),onChanged:t[2]||(t[2]=c=>s.setChangedValue(c))},null,8,["value"])])):_("",!0)])}const _e=A(oe,[["render",fe]]),me={components:{nsNumpad:Q},props:["order"],computed:{total(){return this.refundables.length>0?this.refundables.map(r=>parseFloat(r.unit_price)*parseFloat(r.quantity)).reduce((r,t)=>r+t)+this.shippingFees:0+this.shippingFees},shippingFees(){return this.refundShipping?this.order.shipping:0}},data(){return{isSubmitting:!1,formValidation:new R,refundables:[],paymentOptions:[],paymentField:[],print:new D({urls:systemUrls,options:systemOptions}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map(r=>({label:`${r.name} - ${r.unit.name} (x${r.quantity})`,value:r.id})),validation:"required",name:"product_id",label:u("Product"),description:u("Select the product to perform a refund.")}]}},methods:{__:u,nsCurrency:V,updateScreen(r){this.screen=r},toggleRefundShipping(r){this.refundShipping=r,this.refundShipping},proceedPayment(){if(this.selectedPaymentGateway===!1)return m.error(u("Please select a payment gateway before proceeding."));if(this.total===0)return m.error(u("There is nothing to refund."));if(this.screen===0)return m.error(u("Please provide a valid payment amount."));F.show(O,{title:u("Confirm Your Action"),message:u("The refund will be made on the current order."),onAction:r=>{r&&this.doProceed()}})},doProceed(){const r={products:this.refundables,total:this.screen,payment:{identifier:this.selectedPaymentGateway},refund_shipping:this.refundShipping};this.isSubmitting=!0,v.post(`/api/orders/${this.order.id}/refund`,r).subscribe({next:t=>{this.isSubmitting=!1,this.$emit("changed",!0),t.data.order.payment_status==="refunded"&&this.$emit("loadTab","details"),this.print.process(t.data.orderRefund.id,"refund"),m.success(t.message)},error:t=>{this.isSubmitting=!1,m.error(t.message)}})},addProduct(){if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return m.error(u("Please select a product before proceeding."));const r=this.formValidation.extractFields(this.selectFields),t=this.order.products.filter(s=>s.id===r.product_id),o=this.refundables.filter(s=>s.id===r.product_id);if(o.length>0&&o.map(b=>parseInt(b.quantity)).reduce((b,d)=>b+d)===t[0].quantity)return m.error(u("Not enough quantity to proceed."));if(t[0].quantity===0)return m.error(u("Not enough quantity to proceed."));const f={...t[0],condition:"",description:""};new Promise((s,b)=>{F.show(B,{resolve:s,reject:b,product:f})}).then(s=>{s.quantity=this.getProductOriginalQuantity(s.id)-this.getProductUsedQuantity(s.id),this.refundables.push(s)},s=>s)},getProductOriginalQuantity(r){const t=this.order.products.filter(o=>o.id===r);return t.length>0?t.map(o=>parseFloat(o.quantity)).reduce((o,f)=>o+f):0},getProductUsedQuantity(r){const t=this.refundables.filter(o=>o.id===r);return t.length>0?t.map(f=>parseFloat(f.quantity)).reduce((f,i)=>f+i):0},openSettings(r){new Promise((o,f)=>{F.show(B,{resolve:o,reject:f,product:r})}).then(o=>{const f=this.refundables.indexOf(r);this.$set(this.refundables,f,o)},o=>o)},async selectPaymentGateway(){try{this.selectedPaymentGateway=await new Promise((r,t)=>{F.show(H,{resolve:r,reject:t,value:[this.selectedPaymentOption],...this.paymentField[0]})}),this.selectedPaymentGatewayLabel=this.paymentField[0].options.filter(r=>r.value===this.selectedPaymentGateway)[0].label}catch{m.error(u("An error has occured while seleting the payment gateway."))}},changeQuantity(r){new Promise((o,f)=>{const i=this.getProductOriginalQuantity(r.id)-this.getProductUsedQuantity(r.id)+parseFloat(r.quantity);F.show(_e,{resolve:o,reject:f,product:r,availableQuantity:i})}).then(o=>{if(o.quantity>this.getProductUsedQuantity(r.id)-r.quantity){const f=this.refundables.indexOf(r);this.$set(this.refundables,f,o)}})},deleteProduct(r){new Promise((t,o)=>{F.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this product ?"),onAction:f=>{if(f){const i=this.refundables.indexOf(r);this.refundables.splice(i,1)}}})})}},mounted(){this.selectFields=this.formValidation.createFields(this.selectFields),v.get("/api/orders/payments").subscribe(r=>{this.paymentField=r})}},pe={class:"-m-4 flex-auto flex flex-wrap relative"},he={key:0,class:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},be={class:"px-4 w-full lg:w-1/2"},ye={class:"py-2 border-b-2 text-fontcolor border-info-primary"},ve={class:"my-2"},xe={class:"border-b border-info-primary flex justify-between items-center mb-2"},we={class:"flex-auto flex-col flex"},ge={class:"p-2 flex"},ke={class:"flex justify-between p-2"},Pe={class:"flex items-center text-font"},Ce={key:0,class:"mr-2"},je={class:"py-1 border-b-2 text-fontcolor border-info-primary"},Se={class:"px-2 text-fontcolor flex justify-between flex-auto"},Oe={class:"flex flex-col"},Fe={class:"py-2"},Ae={key:0,class:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},Ve={key:1,class:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},De={class:"flex items-center justify-center"},Ue={class:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},Te={class:"flex"},Re=["onClick"],Ie=["onClick"],qe=["onClick"],Qe={class:"px-4 w-full lg:w-1/2"},Ne={class:"py-2 border-b-2 text-fontcolor border-info-primary"},Ye={class:"py-2"},Le={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},Be={class:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},Ge={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"};function We(r,t,o,f,i,s){const b=h("ns-spinner"),d=h("ns-field"),c=h("ns-checkbox"),g=h("ns-numpad-plus");return l(),a("div",pe,[i.isSubmitting?(l(),a("div",he,[y(b)])):_("",!0),e("div",be,[e("h3",ye,n(s.__("Refund With Products")),1),e("div",ve,[e("ul",null,[e("li",xe,[e("div",we,[e("div",ge,[(l(!0),a(x,null,w(i.selectFields,(p,C)=>(l(),k(d,{field:p,key:C},null,8,["field"]))),128))]),e("div",ke,[e("div",Pe,[o.order.shipping>0?(l(),a("span",Ce,n(s.__("Refund Shipping")),1)):_("",!0),o.order.shipping>0?(l(),k(c,{key:1,onChange:t[0]||(t[0]=p=>s.toggleRefundShipping(p)),checked:i.refundShipping},null,8,["checked"])):_("",!0)]),e("div",null,[e("button",{onClick:t[1]||(t[1]=p=>s.addProduct()),class:"border rounded-full px-2 py-1 ns-inset-button info"},n(s.__("Add Product")),1)])])])]),e("li",null,[e("h4",je,n(s.__("Products")),1)]),(l(!0),a(x,null,w(i.refundables,p=>(l(),a("li",{key:p.id,class:"elevation-surface border flex justify-between items-center mb-2"},[e("div",Se,[e("div",Oe,[e("p",Fe,[e("span",null,n(p.name),1),p.condition==="damaged"?(l(),a("span",Ae,n(s.__("Damaged")),1)):_("",!0),p.condition==="unspoiled"?(l(),a("span",Ve,n(s.__("Unspoiled")),1)):_("",!0)]),e("small",null,n(p.unit.name),1)]),e("div",De,[e("span",Ue,n(s.nsCurrency(p.unit_price*p.quantity)),1)])]),e("div",Te,[e("p",{onClick:C=>s.openSettings(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},[...t[5]||(t[5]=[e("i",{class:"las la-cog text-xl"},null,-1)])],8,Re),e("p",{onClick:C=>s.deleteProduct(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},[...t[6]||(t[6]=[e("i",{class:"las la-trash"},null,-1)])],8,Ie),e("p",{onClick:C=>s.changeQuantity(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},n(p.quantity),9,qe)])]))),128))])])]),e("div",Qe,[e("h3",Ne,n(s.__("Summary")),1),e("div",Ye,[e("div",Le,[e("span",null,n(s.__("Total")),1),e("span",null,n(s.nsCurrency(s.total)),1)]),e("div",Be,[e("span",null,n(s.__("Paid")),1),e("span",null,n(s.nsCurrency(o.order.tendered)),1)]),e("div",{onClick:t[2]||(t[2]=p=>s.selectPaymentGateway()),class:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer"},[e("span",null,n(s.__("Payment Gateway")),1),e("span",null,n(i.selectedPaymentGateway?r.selectedPaymentGatewayLabel:"N/A"),1)]),e("div",Ge,[e("span",null,n(s.__("Screen")),1),e("span",null,n(s.nsCurrency(i.screen)),1)]),e("div",null,[y(g,{currency:!0,onChanged:t[3]||(t[3]=p=>s.updateScreen(p)),value:i.screen,onNext:t[4]||(t[4]=p=>s.proceedPayment(p))},null,8,["value"])])])])])}const Ee=A(me,[["render",We]]);class N{getTypeLabel(t){const o=typeLabels.filter(f=>f.value===t);return o.length>0?o[0].label:u("Unknown Status")}getDeliveryStatus(t){const o=deliveryStatuses.filter(f=>f.value===t);return o.length>0?o[0].label:u("Unknown Status")}getProcessingStatus(t){const o=processingStatuses.filter(f=>f.value===t);return o.length>0?o[0].label:u("Unknown Status")}getPaymentStatus(t){const o=paymentLabels.filter(f=>f.value===t);return o.length>0?o[0].label:u("Unknown Status")}}const Me={props:["order"],data(){return{labels:new N,validation:new R,inputValue:0,print:new D({urls:systemUrls,options:systemOptions}),fields:[],paymentTypes}},computed:{paymentsLabels(){const r=new Object;return this.paymentTypes.forEach(t=>{r[t.value]=t.label}),r}},methods:{__:u,nsCurrency:V,updateValue(r){this.inputValue=r},loadPaymentFields(){v.get("/api/orders/payments").subscribe(r=>{this.fields=this.validation.createFields(r)})},printPaymentReceipt(r){this.print.process(r.id,"payment")},submitPayment(r){if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return m.error(u("Unable to proceed the form is not valid"));if(parseFloat(r)==0)return m.error(u("Please provide a valid value"));r=parseFloat(r);const t={...this.validation.extractFields(this.fields),value:r};Popup.show(O,{title:u("Confirm Your Action"),message:u("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",V(r)),onAction:o=>{o&&v.post(`/api/orders/${this.order.id}/payments`,t).subscribe(f=>{m.success(f.message),this.$emit("changed")},f=>{m.error(f.message)})}})}},components:{nsNumpad:Q},mounted(){this.loadPaymentFields()}},He={class:"flex -mx-4 flex-wrap"},ze={class:"px-2 w-full md:w-1/2"},$e={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},Je={class:"px-2 w-full md:w-1/2"},Ke={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface success border text-xl font-bold"},Xe={class:"px-2 w-full md:w-1/2"},Ze={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface error border text-xl font-bold"},et={key:0},tt={key:1},st={class:"px-2 w-full md:w-1/2"},rt={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface warning border text-xl font-bold"},nt={class:"flex -mx-4 flex-wrap"},ot={class:"px-2 w-full mb-4 md:w-1/2"},it={key:0},lt={class:"font-semibold border-b-2 border-info-primary py-2"},dt={class:"py-2"},at={class:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},ct={key:1,class:"flex items-center justify-center h-full"},ut={class:"text-fontcolor font-semibold"},ft={class:"px-2 w-full mb-4 md:w-1/2"},_t={class:"font-semibold border-b-2 border-info-primary py-2 mb-2"},mt={class:"flex items-center"},pt=["onClick"];function ht(r,t,o,f,i,s){const b=h("ns-field"),d=h("ns-numpad-plus");return l(),a(x,null,[e("div",He,[e("div",ze,[e("div",$e,[e("span",null,n(s.__("Total")),1),e("span",null,n(s.nsCurrency(o.order.total)),1)])]),e("div",Je,[e("div",Ke,[e("span",null,n(s.__("Paid")),1),e("span",null,n(s.nsCurrency(o.order.tendered)),1)])]),e("div",Xe,[e("div",Ze,[e("span",null,n(s.__("Unpaid")),1),o.order.total-o.order.tendered>0?(l(),a("span",et,n(s.nsCurrency(o.order.total-o.order.tendered)),1)):_("",!0),o.order.total-o.order.tendered<=0?(l(),a("span",tt,n(s.nsCurrency(0)),1)):_("",!0)])]),e("div",st,[e("div",rt,[e("span",null,n(s.__("Customer Account")),1),e("span",null,n(s.nsCurrency(o.order.customer.account_amount)),1)])])]),e("div",nt,[e("div",ot,[o.order.payment_status!=="paid"?(l(),a("div",it,[e("h3",lt,n(s.__("Payment")),1),e("div",dt,[(l(!0),a(x,null,w(i.fields,(c,g)=>(l(),k(b,{field:c,key:g},null,8,["field"]))),128)),e("div",at,n(s.nsCurrency(i.inputValue)),1),y(d,{floating:!0,onNext:t[0]||(t[0]=c=>s.submitPayment(c)),onChanged:t[1]||(t[1]=c=>s.updateValue(c)),value:i.inputValue},null,8,["value"])])])):_("",!0),o.order.payment_status==="paid"?(l(),a("div",ct,[e("h3",ut,n(s.__("No payment possible for paid order.")),1)])):_("",!0)]),e("div",ft,[e("h3",_t,n(s.__("Payment History")),1),e("ul",null,[(l(!0),a(x,null,w(o.order.payments,c=>(l(),a("li",{key:c.id,class:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[e("span",mt,[e("a",{href:"javascript:void(0)",onClick:g=>s.printPaymentReceipt(c),class:"m-1 rounded-full hover:bg-info-tertiary hover:text-white flex items-center justify-center h-8 w-8"},[...t[2]||(t[2]=[e("i",{class:"las la-print"},null,-1)])],8,pt),S(" "+n(s.paymentsLabels[c.identifier]||s.__("Unknown")),1)]),e("span",null,n(s.nsCurrency(c.value)),1)]))),128))])])])],64)}const bt=A(Me,[["render",ht]]),yt={name:"ns-orders-refund-popup",props:["popup"],data(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,systemUrls,print:new D({urls:systemUrls,options:systemOptions})}},methods:{__:u,nsCurrency:V,popupCloser:T,popupResolver:I,toggleProductView(r){this.view="details",this.previewed=r},loadOrderRefunds(){nsHttpClient.get(`/api/orders/${this.order.id}/refunds`).subscribe(r=>{this.loaded=!0,this.refunds=r.refunds},r=>{m.error(r.message)})},close(){this.popup.close()},printRefundReceipt(r){this.print.process(r.id,"refund")}},mounted(){this.order=this.popup.params.order,this.popupCloser(),this.loadOrderRefunds()}},vt={class:"shadow-lg w-95vw h-95vh md:w-[60vw] md:h-[60vh] ns-box flex flex-col overflow-hidden"},xt={class:"border-b p-2 flex items-center justify-between ns-box-header"},wt={class:"flex"},gt={class:"overflow-auto flex-auto ns-box-body"},kt={key:0,class:"flex h-full w-full items-center justify-center"},Pt={key:1,class:"flex h-full w-full items-center flex-col justify-center"},Ct={class:"md:w-80 text-sm text-fontcolor-soft text-center"},jt={class:"w-full md:flex-auto p-2"},St={class:"font-semibold mb-1"},Ot={class:"flex -mx-1 text-sm text-font"},Ft={class:"px-1"},At={class:"px-1"},Vt=["onClick"],Dt=["onClick"],Ut={class:"w-full md:flex-auto p-2"},Tt={class:"font-semibold mb-1"},Rt={class:"flex -mx-1 text-sm text-font"},It={class:"px-1"},qt={class:"px-1"},Qt={class:"px-1"};function Nt(r,t,o,f,i,s){const b=h("ns-close-button"),d=h("ns-spinner");return l(),a("div",vt,[e("div",xt,[e("h3",null,n(s.__("Order Refunds")),1),e("div",wt,[i.view==="details"?(l(),a("div",{key:0,onClick:t[0]||(t[0]=c=>i.view="summary"),class:"flex items-center justify-center cursor-pointer rounded-full px-3 border ns-inset-button mr-1"},n(s.__("Go Back")),1)):_("",!0),y(b,{onClick:t[1]||(t[1]=c=>s.close())})])]),e("div",gt,[i.view==="summary"?(l(),a(x,{key:0},[i.loaded?_("",!0):(l(),a("div",kt,[y(d,{size:"24"})])),i.loaded&&i.refunds.length===0?(l(),a("div",Pt,[t[2]||(t[2]=e("i",{class:"las la-laugh-wink text-5xl"},null,-1)),e("p",Ct,n(s.__("No refunds made so far. Good news right?")),1)])):_("",!0),i.loaded&&i.refunds.length>0?(l(!0),a(x,{key:2},w(i.refunds,c=>(l(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",jt,[e("h3",St,n(i.order.code),1),e("div",null,[e("ul",Ot,[e("li",Ft,n(s.__("Total"))+" : "+n(s.nsCurrency(c.total)),1),e("li",At,n(s.__("By"))+" : "+n(c.author.username),1)])])]),e("div",{onClick:g=>s.toggleProductView(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},[...t[3]||(t[3]=[e("i",{class:"las la-eye"},null,-1)])],8,Vt),e("div",{onClick:g=>s.printRefundReceipt(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},[...t[4]||(t[4]=[e("i",{class:"las la-print"},null,-1)])],8,Dt)]))),128)):_("",!0)],64)):_("",!0),i.view==="details"?(l(!0),a(x,{key:1},w(i.previewed.refunded_products,c=>(l(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",Ut,[e("h3",Tt,n(c.product.name),1),e("div",null,[e("ul",Rt,[e("li",It,n(s.__("Condition"))+" : "+n(c.condition),1),e("li",qt,n(s.__("Quantity"))+" : "+n(c.quantity),1),e("li",Qt,n(s.__("Total"))+" : "+n(s.nsCurrency(c.total_price)),1)])])])]))),128)):_("",!0)])])}const Yt=A(yt,[["render",Nt]]),Lt={props:["order"],data(){return{processingStatuses,deliveryStatuses,labels:new N,showProcessingSelect:!1,showDeliverySelect:!1,systemUrls}},mounted(){},methods:{__:u,nsCurrency:V,submitProcessingChange(){F.show(O,{title:u("Would you proceed ?"),message:u("The processing status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/processing`,{process_status:this.order.process_status}).subscribe({next:t=>{this.showProcessingSelect=!1,m.success(t.message)},error:t=>{m.error(t.message||u("Unexpected error occurred."))}})}})},openRefunds(){try{const r=new Promise((t,o)=>{const f=this.order;F.show(Yt,{order:f,resolve:t,reject:o})})}catch{}},submitDeliveryStatus(){F.show(O,{title:u("Would you proceed ?"),message:u("The delivery status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/delivery`,{delivery_status:this.order.delivery_status}).subscribe({next:t=>{this.showDeliverySelect=!1,m.success(t.message)},error:t=>{m.error(t.message||u("Unexpected error occurred."))}})}})}}},Bt={class:"-mx-4 flex flex-wrap"},Gt={class:"flex-auto"},Wt={class:"w-full mb-2 flex-wrap flex"},Et={class:"w-full mb-2 px-4"},Mt={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},Ht={class:"mb-2 w-full md:w-1/2 px-4"},zt={class:"elevation-surface border p-2 flex justify-between items-start"},$t={class:"text-semibold text-font"},Jt={class:"font-semibold text-fontcolor-soft"},Kt={class:"mb-2 w-full md:w-1/2 px-4"},Xt={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},Zt={class:"text-semibold"},es={class:""},ts={key:0,class:"ml-1"},ss={key:1,class:"ml-1"},rs={class:"font-semibold text-font"},os={class:"mb-2 w-full md:w-1/2 px-4"},is={class:"p-2 flex justify-between items-start elevation-surface border"},ls={class:"text-semibold text-font"},ds={class:"font-semibold text-fontcolor-soft"},as={class:"mb-2 w-full md:w-1/2 px-4"},cs={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},us={class:"text-semibold"},fs={class:"font-semibold text-font"},_s={class:"mb-2 w-full md:w-1/2 px-4"},ms={class:"p-2 flex justify-between items-start border ns-notice success"},ps={class:"text-semibold"},hs={class:"font-semibold text-font"},bs={class:"mb-2 w-full md:w-1/2 px-4"},ys={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface info border"},vs={class:"text-semibold"},xs={class:"font-semibold"},ws={class:"mb-2 w-full md:w-1/2 px-4"},gs={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},ks={class:"text-semibold"},Ps={class:"font-semibold"},Cs={class:"mb-2 w-full md:w-1/2 px-4"},js={class:"p-2 flex justify-between items-start elevation-surface border"},Ss={class:"text-semibold"},Os={class:"font-semibold"},Fs={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},As={class:"mb-2"},Vs={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},Ds={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Us={class:"text-semibold text-font"},Ts={key:0,class:"font-semibold text-fontcolor-soft"},Rs=["href"],Is={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},qs={class:"text-semibold text-font"},Qs={class:"font-semibold text-fontcolor-soft"},Ns={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Ys={class:"text-semibold text-font"},Ls={class:"font-semibold text-fontcolor-soft mt-2 md:mt-0 w-full md:w-auto"},Bs={class:"w-full text-center"},Gs={key:0,class:"flex-auto flex"},Ws={class:"ns-select flex items-center justify-center"},Es=["value"],Ms={class:"pl-2 flex"},Hs={class:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},zs={class:"text-semibold text-font"},$s={class:"font-semibold text-fontcolor-soft mt-2 md:mt-0 w-full md:w-auto"},Js={class:"w-full text-center"},Ks={key:0,class:"flex-auto flex"},Xs={class:"ns-select flex items-center justify-center"},Zs=["value"],er={class:"pl-2 flex"},tr={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},sr={class:"text-semibold text-font"},rr={class:"font-semibold text-fontcolor-soft"},nr={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},or={class:"mb-2"},ir={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},lr={class:"text-semibold text-font"},dr={class:"text-fontcolor-soft text-sm"},ar={class:"font-semibold text-fontcolor-soft"},cr={class:"mb-2"},ur={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary flex justify-between"},fr={class:"text-semibold text-font"},_r={class:"text-fontcolor-soft text-sm"},mr={class:"font-semibold text-fontcolor-soft"};function pr(r,t,o,f,i,s){const b=h("ns-close-button");return l(),a("div",Bt,[e("div",Gt,[e("div",Wt,[e("div",Et,[e("h3",Mt,n(s.__("Payment Summary")),1)]),e("div",Ht,[e("div",zt,[e("div",null,[e("h4",$t,n(s.__("Sub Total")),1)]),e("div",Jt,n(s.nsCurrency(o.order.subtotal)),1)])]),e("div",Kt,[e("div",Xt,[e("div",null,[e("h4",Zt,[e("span",es,n(s.__("Discount")),1),o.order.discount_type==="percentage"?(l(),a("span",ts,"("+n(o.order.discount_percentage)+"%)",1)):_("",!0),o.order.discount_type==="flat"?(l(),a("span",ss,"(Flat)")):_("",!0)])]),e("div",rs,n(s.nsCurrency(o.order.discount)),1)])]),e("div",os,[e("div",is,[e("div",null,[e("span",ls,n(s.__("Shipping")),1)]),e("div",ds,n(s.nsCurrency(o.order.shipping)),1)])]),e("div",as,[e("div",cs,[e("div",null,[e("span",us,n(s.__("Coupons")),1)]),e("div",fs,n(s.nsCurrency(o.order.total_coupons)),1)])]),e("div",_s,[e("div",ms,[e("div",null,[e("span",ps,n(s.__("Total")),1)]),e("div",hs,n(s.nsCurrency(o.order.total)),1)])]),e("div",bs,[e("div",ys,[e("div",null,[e("span",vs,n(s.__("Taxes")),1)]),e("div",xs,n(s.nsCurrency(o.order.tax_value)),1)])]),e("div",ws,[e("div",gs,[e("div",null,[e("span",ks,n(s.__("Change")),1)]),e("div",Ps,n(s.nsCurrency(o.order.change)),1)])]),e("div",Cs,[e("div",js,[e("div",null,[e("span",Ss,n(s.__("Paid")),1)]),e("div",Os,n(s.nsCurrency(o.order.tendered)),1)])])])]),e("div",Fs,[e("div",As,[e("h3",Vs,n(s.__("Order Status")),1)]),e("div",Ds,[e("div",null,[e("h4",Us,[e("span",null,n(s.__("Customer")),1)])]),o.order?(l(),a("div",Ts,[e("a",{class:"border-b border-dashed border-info-primary",href:i.systemUrls.customer_edit_url.replace("#customer",o.order.customer.id),target:"_blank",rel:"noopener noreferrer"},n(o.order.customer.first_name)+" "+n(o.order.customer.last_name),9,Rs)])):_("",!0)]),e("div",Is,[e("div",null,[e("h4",qs,[e("span",null,n(s.__("Type")),1)])]),e("div",Qs,n(i.labels.getTypeLabel(o.order.type)),1)]),e("div",Ns,[e("div",null,[e("h4",Ys,[e("span",null,n(s.__("Delivery Status")),1)])]),e("div",Ls,[e("div",Bs,[i.showDeliverySelect?_("",!0):(l(),a("span",{key:0,onClick:t[0]||(t[0]=d=>i.showDeliverySelect=!0),class:"font-semibold text-fontcolor-soft border-b border-info-primary cursor-pointer border-dashed"},n(i.labels.getDeliveryStatus(o.order.delivery_status)),1))]),i.showDeliverySelect?(l(),a("div",Gs,[e("div",Ws,[U(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[1]||(t[1]=d=>o.order.delivery_status=d)},[(l(!0),a(x,null,w(i.deliveryStatuses,(d,c)=>(l(),a("option",{key:c,value:d.value},n(d.label),9,Es))),128))],512),[[Y,o.order.delivery_status]])]),e("div",Ms,[y(b,{onClick:t[2]||(t[2]=d=>i.showDeliverySelect=!1)}),e("button",{onClick:t[3]||(t[3]=d=>s.submitDeliveryStatus(o.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},n(s.__("Save")),1)])])):_("",!0)])]),e("div",Hs,[e("div",null,[e("h4",zs,[e("span",null,n(s.__("Processing Status")),1)])]),e("div",$s,[e("div",Js,[i.showProcessingSelect?_("",!0):(l(),a("span",{key:0,onClick:t[4]||(t[4]=d=>i.showProcessingSelect=!0),class:"border-b border-info-primary cursor-pointer border-dashed"},n(i.labels.getProcessingStatus(o.order.process_status)),1))]),i.showProcessingSelect?(l(),a("div",Ks,[e("div",Xs,[U(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[5]||(t[5]=d=>o.order.process_status=d)},[(l(!0),a(x,null,w(i.processingStatuses,(d,c)=>(l(),a("option",{key:c,value:d.value},n(d.label),9,Zs))),128))],512),[[Y,o.order.process_status]])]),e("div",er,[y(b,{onClick:t[6]||(t[6]=d=>i.showProcessingSelect=!1)}),e("button",{onClick:t[7]||(t[7]=d=>s.submitProcessingChange(o.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},n(s.__("Save")),1)])])):_("",!0)])]),e("div",tr,[e("div",null,[e("h4",sr,[e("span",null,n(s.__("Payment Status")),1)])]),e("div",rr,n(i.labels.getPaymentStatus(o.order.payment_status)),1)])]),e("div",nr,[e("div",or,[e("h3",ir,n(s.__("Products")),1)]),(l(!0),a(x,null,w(o.order.products,d=>(l(),a("div",{key:d.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",lr,n(d.name)+" (x"+n(d.quantity)+")",1),e("p",dr,n(d.unit.name||"N/A"),1)]),e("div",ar,n(s.nsCurrency(d.total_price)),1)]))),128)),e("div",cr,[e("h3",ur,[e("span",null,n(s.__("Refunded Products")),1),e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=d=>s.openRefunds()),class:"border-b border-info-primary border-dashed"},n(s.__("All Refunds")),1)])]),(l(!0),a(x,null,w(o.order.refunded_products,(d,c)=>(l(),a("div",{key:c,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",fr,n(d.order_product.name)+" (x"+n(d.quantity)+")",1),e("p",_r,[S(n(d.unit.name||"N/A")+" | ",1),e("span",{class:G(["rounded-full px-2",d.condition==="damaged"?"bg-error-tertiary text-white":"bg-info-tertiary text-white"])},n(d.condition),3)])]),e("div",mr,n(s.nsCurrency(d.total_price)),1)]))),128))])])}const hr=A(Lt,[["render",pr]]),br={name:"ns-order-instalments-payment",props:["popup"],components:{nsNotice:z},data(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:u("Select the payment type that must apply to the current order."),label:u("Payment Type"),validation:"required",options:paymentTypes}],print:new D({urls:systemUrls,options:systemOptions}),validation:new R,order:null,instalment:null}},methods:{__:u,popupResolver:I,popupCloser:T,close(){this.popupResolver(!1)},updateInstalmentAsDue(r){nsHttpClient.put(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/`,{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:t=>{this.submitPayment()},error:t=>{m.error(t.message||u("An unexpected error has occurred"))}})},submitPayment(){if(!this.validation.validateFields(this.fields))return m.error(__m("The form is not valid.")).subcribe();nsHttpClient.post(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/pay`,{...this.validation.extractFields(this.fields)}).subscribe({next:r=>{this.popupResolver(!0),this.print.exec(r.data.payment.id,"payment"),m.success(r.message)},error:r=>{r.status==="error"&&Popup.show(O,{title:u("Update Instalment Date"),message:u("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:t=>{t&&this.updateInstalmentAsDue(this.instalment)}}),m.error(r.message||u("An unexpected error has occurred"))}})}},mounted(){this.popupCloser(),this.order=this.popup.params.order,this.instalment=this.popup.params.instalment,this.fields=this.validation.createFields(this.fields)}},yr={class:"shadow-lg ns-box w-95vw md:w-[66.67vw] lg:w-[33.33vw]"},vr={class:"p-2 flex justify-between border-b items-center"},xr={class:"p-2 ns-box-body"},wr={class:"border-t ns-box-footer p-2 flex justify-end"};function gr(r,t,o,f,i,s){const b=h("ns-close-button"),d=h("ns-notice"),c=h("ns-field"),g=h("ns-button");return l(),a("div",yr,[e("div",vr,[e("h3",null,n(s.__("Payment Method")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=p=>s.close())})])]),e("div",xr,[y(d,{color:"info",class:"py-2 p-4 text-center border text-fontcolor rounded-lg"},{default:P(()=>[S(n(s.__("Before submitting the payment, choose the payment type used for that order.")),1)]),_:1}),t[2]||(t[2]=e("br",null,null,-1)),(l(!0),a(x,null,w(i.fields,(p,C)=>(l(),k(c,{key:C,field:p},null,8,["field"]))),128))]),e("div",wr,[y(g,{onClick:t[1]||(t[1]=p=>s.submitPayment()),type:"info"},{default:P(()=>[S(n(s.__("Submit Payment")),1)]),_:1})])])}const kr=A(br,[["render",gr]]),Pr={props:["order"],name:"ns-order-instalments",data(){return{labels:new N,original:[],instalments:[],print:new D({urls:systemUrls,options:systemOptions,type:"payment"})}},mounted(){this.loadInstalments()},computed:{totalInstalments(){return this.instalments.length>0?this.instalments.map(r=>r.amount).reduce((r,t)=>parseFloat(r)+parseFloat(t)):0}},methods:{__:u,nsCurrency:V,loadInstalments(){v.get(`/api/orders/${this.order.id}/instalments`).subscribe(r=>{this.original=r,this.instalments=r.map(t=>(t.price_clicked=!1,t.date_clicked=!1,t.date=moment(t.date).format("YYYY-MM-DD"),t))})},showReceipt(r){if(r.payment_id===null)return m.error(u("This instalment doesn't have any payment attached."));this.print.process(r.payment_id,"payment")},addInstalment(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to create this instalment ?"),onAction:t=>{t&&v.post(`/api/orders/${this.order.id}/instalments`,{instalment:r}).subscribe({next:o=>{this.loadInstalments(),m.success(o.message)},error:o=>{m.error(o.message||u("An unexpected error has occurred"))}})}})},deleteInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this instalment ?"),onAction:t=>{t&&v.delete(`/api/orders/${this.order.id}/instalments/${r.id}`).subscribe({next:o=>{const f=this.instalments.indexOf(r);this.instalments.splice(f,1),m.success(o.message)},error:o=>{m.error(o.message||u("An unexpected error has occurred"))}})}})},async markAsPaid(r){try{const t=await new Promise((o,f)=>{Popup.show(kr,{order:this.order,instalment:r,resolve:o,reject:f})});this.loadInstalments()}catch{}},togglePriceEdition(r){r.paid||(r.price_clicked=!r.price_clicked,this.$forceUpdate(),r.price_clicked&&setTimeout(()=>{this.$refs.amount[0].select()},100))},updateInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to update that instalment ?"),onAction:t=>{t&&v.put(`/api/orders/${this.order.id}/instalments/${r.id}`,{instalment:r}).subscribe({next:o=>{m.success(o.message)},error:o=>{m.error(o.message||u("An unexpected error has occurred"))}})}})},toggleDateEdition(r){r.paid||(r.date_clicked=!r.date_clicked,this.$forceUpdate(),r.date_clicked&&setTimeout(()=>{this.$refs.date[0].select()},200))}}},Cr={class:"-mx-4 flex-auto flex flex-wrap"},jr={class:"flex flex-auto"},Sr={class:"w-full mb-2 flex-wrap"},Or={class:"w-full mb-2 px-4"},Fr={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},Ar={class:"px-4"},Vr={class:"border-table-th-edge border-t text-font"},Dr={class:"p-2"},Ur=["onClick"],Tr={key:1},Rr=["onBlur","onUpdate:modelValue"],Ir={class:"flex items-center"},qr={class:"flex items-center px-2 h-full border-r"},Qr=["onClick"],Nr={key:1},Yr=["onUpdate:modelValue","onBlur"],Lr={key:0,class:"w-36 justify-center flex items-center px-2 h-full border-r"},Br={class:"px-2"},Gr={class:"px-2"},Wr={class:"px-2"},Er={key:1,class:"w-36 justify-center flex items-center px-2 h-full border-r"},Mr={class:"px-2"},Hr={class:"ns-button info"},zr=["onClick"],$r={key:2,class:"w-36 justify-center flex items-center px-2 h-full"},Jr={class:"ns-button info"},Kr=["onClick"],Xr={class:"flex justify-between p-2 border-r border-b border-l elevation-surface"},Zr={class:"flex items-center justify-center"},en={class:"ml-1 text-sm"},tn={class:"-mx-2 flex flex-wrap items-center"},sn={class:"px-2"},rn={class:"px-2"},nn={class:"ns-button info"};function on(r,t,o,f,i,s){const b=h("ns-icon-button");return l(),a("div",Cr,[e("div",jr,[e("div",Sr,[e("div",Or,[e("h3",Fr,n(s.__("Instalments")),1)]),e("div",Ar,[e("ul",Vr,[(l(!0),a(x,null,w(i.instalments,d=>(l(),a("li",{class:G([d.paid?"success":"info","border-b border-l flex justify-between elevation-surface"]),key:d.id},[e("span",Dr,[d.date_clicked?_("",!0):(l(),a("span",{key:0,onClick:c=>s.toggleDateEdition(d)},n(d.date),9,Ur)),d.date_clicked?(l(),a("span",Tr,[U(e("input",{onBlur:c=>s.toggleDateEdition(d),"onUpdate:modelValue":c=>d.date=c,type:"date",ref_for:!0,ref:"date",class:"border border-info-primary rounded"},null,40,Rr),[[L,d.date]])])):_("",!0)]),e("div",Ir,[e("div",qr,[d.price_clicked?_("",!0):(l(),a("span",{key:0,onClick:c=>s.togglePriceEdition(d)},n(s.nsCurrency(d.amount)),9,Qr)),d.price_clicked?(l(),a("span",Nr,[U(e("input",{ref_for:!0,ref:"amount","onUpdate:modelValue":c=>d.amount=c,onBlur:c=>s.togglePriceEdition(d),type:"text",class:"border border-info-primary p-1"},null,40,Yr),[[L,d.amount]])])):_("",!0)]),!d.paid&&d.id?(l(),a("div",Lr,[e("div",Br,[y(b,{type:"success",onClick:c=>s.markAsPaid(d),className:"la-money-bill-wave-alt"},null,8,["onClick"])]),e("div",Gr,[y(b,{type:"info",onClick:c=>s.updateInstalment(d),className:"la-save"},null,8,["onClick"])]),e("div",Wr,[y(b,{type:"error",onClick:c=>s.deleteInstalment(d),className:"la-trash-alt"},null,8,["onClick"])])])):_("",!0),!d.paid&&!d.id?(l(),a("div",Er,[e("div",Mr,[e("div",Hr,[e("button",{onClick:c=>s.createInstalment(d),class:"px-3 py-1 rounded-full"},[t[1]||(t[1]=e("i",{class:"las la-plus"},null,-1)),S(" "+n(s.__("Create")),1)],8,zr)])])])):_("",!0),d.paid?(l(),a("div",$r,[e("div",Jr,[e("button",{onClick:c=>s.showReceipt(d),class:"px-3 text-xs py-1 rounded-full"},[t[2]||(t[2]=e("i",{class:"las la-print"},null,-1)),S(" "+n(s.__("Receipt")),1)],8,Kr)])])):_("",!0)])],2))),128)),e("li",Xr,[e("div",Zr,[e("span",null,n(s.__("Total :"))+" "+n(s.nsCurrency(o.order.total)),1),e("span",en," ("+n(s.__("Remaining :"))+" "+n(s.nsCurrency(o.order.total-s.totalInstalments))+") ",1)]),e("div",tn,[e("span",sn,n(s.__("Instalments:"))+" "+n(s.nsCurrency(s.totalInstalments)),1),e("span",rn,[e("div",nn,[e("button",{onClick:t[0]||(t[0]=d=>s.addInstalment()),class:"rounded-full px-3 py-1"},n(s.__("Add Instalment")),1)])])])])])])])])])}const ln=A(Pr,[["render",on]]),dn={name:"ns-orders-preview-popup",props:["popup"],data(){return{active:"details",order:new Object,rawOrder:new Object,products:[],payments:[],options:null,print:new D({urls:systemUrls,options:systemOptions}),settings:null,orderDetailLoaded:!1}},components:{nsOrderRefund:Ee,nsOrderPayment:bt,nsOrderDetails:hr,nsOrderInstalments:ln},computed:{isVoidable(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble(){return["hold"].includes(this.order.payment_status)}},methods:{__:u,popupResolver:I,popupCloser:T,nsCurrency:V,closePopup(r=!1){this.popupResolver(r)},setActive(r){this.active=r},printOrder(){this.print.process(this.order.id,"sale")},refresh(){this.loadOrderDetails(this.order.id)},loadOrderDetails(r){this.orderDetailLoaded=!1,M([v.get(`/api/orders/${r}`),v.get(`/api/orders/${r}/products`),v.get(`/api/orders/${r}/payments`)]).subscribe(t=>{this.orderDetailLoaded=!0,this.order=t[0],this.products=t[1],this.payments=t[2]})},deleteOrder(){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this order"),onAction:r=>{r&&v.delete(`/api/orders/${this.order.id}`).subscribe({next:t=>{m.success(t.message),this.refreshCrudTable(),this.closePopup(!0)},error:t=>{m.error(t.message)}})}})},voidOrder(){try{const r=new Promise((t,o)=>{Popup.show($,{resolve:t,reject:o,title:u("Confirm Your Action"),message:u("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:f=>{f!==!1&&v.post(`/api/orders/${this.order.id}/void`,{reason:f}).subscribe({next:i=>{m.success(i.message),this.refreshCrudTable(),this.closePopup(!0)},error:i=>{m.error(i.message)}})}})})}catch(r){console.log(r)}},refreshCrudTable(){this.popup.params.component.$emit("updated",!0)}},watch:{active(){this.active==="details"&&this.loadOrderDetails(this.rawOrder.id)}},mounted(){this.rawOrder=this.popup.params.order,this.options=systemOptions,this.urls=systemUrls,this.loadOrderDetails(this.rawOrder.id),this.popupCloser()}},an={class:"h-95vh w-95vw md:h-[80vh] md:w-[85.71vw] overflow-hidden shadow-xl ns-box flex flex-col"},cn={class:"border-b ns-box-header p-3 flex items-center justify-between"},un={class:"p-2 ns-box-body overflow-hidden flex flex-auto"},fn={key:1,class:"h-full w-full flex items-center justify-center"},_n={key:0,class:"p-2 flex justify-between border-t ns-box-footer"};function mn(r,t,o,f,i,s){const b=h("ns-close-button"),d=h("ns-order-details"),c=h("ns-tabs-item"),g=h("ns-order-payment"),p=h("ns-order-refund"),C=h("ns-order-instalments"),W=h("ns-tabs"),E=h("ns-spinner"),q=h("ns-button");return l(),a("div",an,[e("div",cn,[e("div",null,[e("h3",null,n(s.__("Order Options")),1)]),e("div",null,[y(b,{onClick:t[0]||(t[0]=j=>s.closePopup(!0))})])]),e("div",un,[i.order.id?(l(),k(W,{key:0,active:i.active,onActive:t[5]||(t[5]=j=>s.setActive(j))},{default:P(()=>[y(c,{label:s.__("Details"),identifier:"details",class:"overflow-y-auto"},{default:P(()=>[i.order?(l(),k(d,{key:0,order:i.order},null,8,["order"])):_("",!0)]),_:1},8,["label"]),y(c,{visible:!["order_void","hold","refunded","partially_refunded"].includes(i.order.payment_status),label:s.__("Payments"),identifier:"payments"},{default:P(()=>[i.order?(l(),k(g,{key:0,onChanged:t[1]||(t[1]=j=>s.refresh()),order:i.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"]),y(c,{visible:!["order_void","hold","refunded"].includes(i.order.payment_status),label:s.__("Refund & Return"),identifier:"refund"},{default:P(()=>[i.order?(l(),k(p,{key:0,onLoadTab:t[2]||(t[2]=j=>s.setActive(j)),onChanged:t[3]||(t[3]=j=>s.refresh()),order:i.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"]),y(c,{visible:["partially_paid","unpaid"].includes(i.order.payment_status)&&i.order.support_instalments,label:s.__("Installments"),identifier:"instalments"},{default:P(()=>[i.order?(l(),k(C,{key:0,onChanged:t[4]||(t[4]=j=>s.refresh()),order:i.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"])]),_:1},8,["active"])):_("",!0),i.order.id?_("",!0):(l(),a("div",fn,[y(E)]))]),i.orderDetailLoaded?(l(),a("div",_n,[e("div",null,[s.isVoidable?(l(),k(q,{key:0,onClick:t[6]||(t[6]=j=>s.voidOrder()),type:"error"},{default:P(()=>[t[9]||(t[9]=e("i",{class:"las la-ban"},null,-1)),S(" "+n(s.__("Void")),1)]),_:1})):_("",!0),s.isDeleteAble?(l(),k(q,{key:1,onClick:t[7]||(t[7]=j=>s.deleteOrder()),type:"error"},{default:P(()=>[t[10]||(t[10]=e("i",{class:"las la-trash"},null,-1)),S(" "+n(s.__("Delete")),1)]),_:1})):_("",!0)]),e("div",null,[y(q,{onClick:t[8]||(t[8]=j=>s.printOrder()),type:"info"},{default:P(()=>[t[11]||(t[11]=e("i",{class:"las la-print"},null,-1)),S(" "+n(s.__("Print")),1)]),_:1})])])):_("",!0)])}const gn=A(dn,[["render",mn]]);export{gn as a,Yt as n};
