import{a as A,p as L,b as v,n as f,F as N}from"./bootstrap-DI8pXSaz.js";import{_ as d}from"./lang-BINodpp-.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{n as S}from"./ns-prompt-popup-CidREd5w.js";import{Q as V}from"./browser-B-RaiDhA.js";import{v as F}from"./runtime-dom.esm-bundler-BJBE8XOq.js";import{r as u,c as l,o as i,b as e,B,t as s,f as _,w as p,i as h,F as y,e as g,a as b,g as q}from"./runtime-core.esm-bundler-DUdZl5j1.js";import"./currency-BCJk0SN4.js";import"./chart-BXKSDqJb.js";const Q={name:"ns-token-output",props:["popup"],data(){return{accessToken:"",qrCodeSRC:""}},mounted(){this.accessToken=this.popup.params.result.data.token.plainTextToken,this.popupCloser(),setTimeout(()=>{this.$refs.token.select(),this.$refs.token.setSelectionRange(0,99999),this.setQRCode()},100)},methods:{__:d,popupResolver:L,popupCloser:A,setQRCode(){V.toDataURL(this.accessToken).then(n=>{this.qrCodeSRC=n}).catch(n=>{console.log(n)})},close(){navigator.clipboard.writeText(this.$refs.token.value),this.popupResolver(!0)}}},U={id:"alert-popup",class:"w-[85.71vw] md:w-[57.14vw] lg:w-[42.86vw] flex flex-col shadow-lg"},j={class:"flex items-center justify-center flex-col flex-auto p-4"},D={class:"text-3xl font-body mb-4"},I=["src"],O={class:"text-xs text-fontcolor-soft py-2"},Y={class:"py-4 text-center"},E={class:"action-buttons flex border-t justify-end items-center p-2"};function M(n,o,c,w,r,t){const k=u("ns-button");return i(),l("div",U,[e("div",j,[e("h2",D,s(t.__("API Token")),1),e("img",{id:"token-qrcode",class:"border-2 w-64 h-64",src:r.qrCodeSRC},null,8,I),e("p",O,s(t.__("This QR code is provided to ease authentication on external applications.")),1),o[2]||(o[2]=e("br",null,null,-1)),e("p",Y,s(t.__(`The API token has been generated. Make sure to copy this code on a safe place as it will only be displayed once.
                If you loose this token, you'll need to revoke it and generate a new one.`)),1),B(e("input",{ref:"token","onUpdate:modelValue":o[0]||(o[0]=m=>r.accessToken=m),readonly:"",type:"text",class:"my-2 p-2 w-full border-2 rounded border-input-edge bg-input-background"},null,512),[[F,r.accessToken]])]),e("div",E,[_(k,{onClick:o[1]||(o[1]=m=>t.close()),type:"info"},{default:p(()=>[h(s(t.__("Copy And Close")),1)]),_:1})])])}const G=T(Q,[["render",M]]),H={name:"ns-token",data(){return{validation:new N,tokens:[],isLoading:!1,fields:[{type:"text",label:d("Token Name"),name:"name",description:d("This will be used to identifier the token."),validation:"required"}]}},methods:{__:d,createToken(){if(!this.validation.validateFields(this.fields))return f.error(d("Unable to proceed, the form is not valid."));v.post("/api/users/create-token",this.validation.extractFields(this.fields)).subscribe(async n=>{try{await new Promise((o,c)=>{Popup.show(G,{resolve:o,reject:c,result:n})}),this.loadTokens()}catch(o){console.log(o)}})},revokeToken(n){Popup.show(S,{title:d("Confirm Your Action"),message:d("You're about to delete a token that might be in use by an external app. Deleting will prevent that app from accessing the API. Would you like to proceed ?"),onAction:o=>{o&&v.delete(`/api/users/tokens/${n.id}`).subscribe({next:c=>{this.loadTokens(),f.success(c.message)},error:c=>{f.error(c.message||"An unexpected error occured.")}})}})},loadTokens(){this.isLoading=!0,v.get("/api/users/tokens").subscribe({next:n=>{this.isLoading=!1,this.tokens=n},error:n=>{f.error("Unable to load the token. An unexpected error occured.")}})}},mounted(){this.fields=this.validation.createFields(this.fields),this.loadTokens()}},W={class:"-mx-2"},z={class:"px-2 w-full md:w-1/2"},J={class:"mb-4"},K={class:"my-2"},X={class:"flex justify-end"},Z={class:"py-2 border-b-4 text-center border-box-edge text-xl"},$={key:0},ee={class:"flex flex-col"},te={class:"text-lg"},se={class:"text-xs text-secondary"},oe={class:"text-xs text-secondary"},ne={class:"text-xs text-secondary"},re={key:1,class:"my-4"},ie={key:2,class:"mt-2"},ae={class:"text-center text-secondary text-sm my-4"};function le(n,o,c,w,r,t){const k=u("ns-notice"),m=u("ns-field"),C=u("ns-button"),R=u("ns-close-button"),P=u("ns-spinner");return i(),l("div",W,[e("div",z,[e("div",J,[_(k,null,{title:p(()=>[h(s(t.__("About Token")),1)]),description:p(()=>[h(s(t.__(`Token are used to provide a secure access to NexoPOS resources without having to share your personal username and password.
                       Once generated, they won't expires until you explicitely revoke it.`)),1)]),_:1})]),e("div",K,[(i(!0),l(y,null,g(r.fields,(a,x)=>(i(),q(m,{key:x,field:a},null,8,["field"]))),128)),e("div",X,[_(C,{onClick:o[0]||(o[0]=a=>t.createToken()),type:"info"},{default:p(()=>[h(s(t.__("Save Token")),1)]),_:1})])]),e("div",null,[e("h3",Z,s(t.__("Generated Tokens")),1),r.tokens.length>0&&!r.isLoading?(i(),l("ul",$,[(i(!0),l(y,null,g(r.tokens,(a,x)=>(i(),l("li",{key:x,class:"p-2 border-b flex justify-between items-center border-box-edge"},[e("div",ee,[e("h4",te,s(a.name),1),e("div",null,[e("ul",null,[e("li",null,[e("span",se,s(t.__("Created"))+": "+s(a.created_at),1)]),e("li",null,[e("span",oe,s(t.__("Last Use"))+": "+s(a.last_used_at||t.__("Never")),1)]),e("li",null,[e("span",ne,s(t.__("Expires"))+": "+s(a.expires_at||t.__("Never")),1)])])])]),e("div",null,[_(R,{onClick:ce=>t.revokeToken(a),class:"px-2"},{default:p(()=>[h(s(t.__("Revoke")),1)]),_:1},8,["onClick"])])]))),128))])):b("",!0),r.isLoading?(i(),l("div",re,[_(P)])):b("",!0),!r.isLoading&&r.tokens.length===0?(i(),l("div",ie,[e("div",ae,s(t.__("You haven't yet generated any token for your account. Create one to get started.")),1)])):b("",!0)])])])}const ve=T(H,[["render",le]]);export{ve as default};
