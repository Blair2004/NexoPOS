import{F as T,p as R,a as p,n as v,e as I,P as O}from"./bootstrap-0aabbab9.js";import{_ as u,n as F}from"./currency-47ec5b79.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{ae as h,a6 as d,z as a,A as e,c as y,F as x,ac as w,x as g,y as m,ax as P,H as V,az as D}from"./npm~@vue~runtime-core_-ff0bdc0c.js";import{U as n,z as G}from"./npm~@vue~shared_-82b01912.js";import{n as Q}from"./ns-numpad-plus-f3ffaa01.js";import{n as L,a as M}from"./ns-paginate-19e98260.js";import S from"./ns-pos-confirm-popup-07a76865.js";import{P as U}from"./print-3c0412fa.js";import"./npm~@dicebear~avatars_-e73ed2cc.js";import"./npm~@dicebear~avatars-avataaars-sprites_-e47afe24.js";import"./npm~moment-fbc5633a.js";import"./ns-switch-0a4d4345.js";import"./npm~vue2-daterange-picker-f17f6b76.js";import"./npm~vuedraggable-90a90e9d.js";import"./npm~vue-upload-component-9e5d4563.js";import"./npm~lodash-f7a36ac5.js";import H from"./ns-prompt-popup-64b67141.js";import{l as $,m as N}from"./npm~@vue~runtime-dom_-a668b91e.js";import{f as z}from"./npm~rxjs-a7e91008.js";const J={props:["popup"],mounted(){this.popuCloser(),this.loadFields(),this.product=this.popup.params.product},data(){return{formValidation:new T,fields:[],product:null}},methods:{__:u,popuCloser:R,close(){this.popup.params.reject(!1),this.popup.close()},addProduct(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){const r=this.formValidation.extractFields(this.fields),t={...this.product,...r};return this.popup.params.resolve(t),this.close()}p.error(u("The form is not valid.")).subscribe()},loadFields(){v.get("/api/fields/ns.refund-product").subscribe(r=>{this.fields=this.formValidation.createFields(r),this.fields.forEach(t=>{t.value=this.product[t.name]||""})})}}},K={class:"shadow-xl ns-box w-95vw md:w-3/5-screen lg:w-3/7-screen h-95vh md:h-3/5-screen lg:h-3/7-screen overflow-hidden flex flex-col"},X={class:"p-2 flex justify-between border-b ns-box-header items-center"},Z={class:"text-semibold"},ee={class:"flex-auto overflow-y-auto relative ns-scrollbar"},se={class:"p-2"},te={key:0,class:"h-full w-full flex items-center justify-center"},re={class:"p-2 flex justify-between items-center border-t ns-box-body"},ne=e("div",null,null,-1);function ie(r,t,i,_,o,s){const b=h("ns-close-button"),l=h("ns-field"),c=h("ns-spinner"),k=h("ns-button");return d(),a("div",K,[e("div",X,[e("h3",Z,n(s.__("Products")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=f=>s.close())})])]),e("div",ee,[e("div",se,[(d(!0),a(x,null,w(o.fields,(f,C)=>(d(),g(l,{key:C,field:f},null,8,["field"]))),128))]),o.fields.length===0?(d(),a("div",te,[y(c)])):m("",!0)]),e("div",re,[ne,e("div",null,[y(k,{onClick:t[1]||(t[1]=f=>s.addProduct()),type:"info"},{default:P(()=>[V(n(s.__("Add Product")),1)]),_:1})])])])}const B=A(J,[["render",ie]]),oe={components:{nsNumpad:Q},props:["popup"],data(){return{product:null,seeValue:0,availableQuantity:0}},mounted(){this.product=this.popup.params.product,this.availableQuantity=this.popup.params.availableQuantity,this.seeValue=this.product.quantity},methods:{__:u,popupResolver:I,close(){this.popup.params.reject(!1),this.popup.close()},setChangedValue(r){this.seeValue=r},updateQuantity(r){if(r>this.availableQuantity)return p.error("Unable to proceed as the quantity provided is exceed the available quantity.").subscribe();this.product.quantity=parseFloat(r),this.popup.params.resolve(this.product),this.popup.close()}}},le={class:"shadow-xl ns-box overflow-hidden w-95vw md:w-4/6-screen lg:w-3/7-screen"},de={class:"p-2 flex justify-between ns-box-header"},ae={class:"font-semibold"},ce={key:0,class:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},ue={class:"text-primary text-sm"},_e={key:1,class:"flex-auto overflow-y-auto p-2"};function me(r,t,i,_,o,s){const b=h("ns-close-button"),l=h("ns-numpad");return d(),a("div",le,[e("div",de,[e("h3",ae,n(s.__("Quantity")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=c=>s.close())})])]),o.product?(d(),a("div",ce,[e("span",null,n(o.seeValue),1),e("span",ue,"("+n(o.availableQuantity)+" "+n(s.__("available"))+")",1)])):m("",!0),o.product?(d(),a("div",_e,[y(l,{value:o.product.quantity,onNext:t[1]||(t[1]=c=>s.updateQuantity(c)),onChanged:t[2]||(t[2]=c=>s.setChangedValue(c))},null,8,["value"])])):m("",!0)])}const pe=A(oe,[["render",me]]),fe={components:{nsNumpad:Q},props:["order"],computed:{total(){return this.refundables.length>0?this.refundables.map(r=>parseFloat(r.unit_price)*parseFloat(r.quantity)).reduce((r,t)=>r+t)+this.shippingFees:0+this.shippingFees},shippingFees(){return this.refundShipping?this.order.shipping:0}},data(){return{isSubmitting:!1,formValidation:new T,refundables:[],paymentOptions:[],paymentField:[],print:new U({urls:systemUrls,options:systemOptions}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map(r=>({label:`${r.name} - ${r.unit.name} (x${r.quantity})`,value:r.id})),validation:"required",name:"product_id",label:u("Product"),description:u("Select the product to perform a refund.")}]}},methods:{__:u,nsCurrency:F,updateScreen(r){this.screen=r},toggleRefundShipping(r){this.refundShipping=r,this.refundShipping},proceedPayment(){if(this.selectedPaymentGateway===!1)return p.error(u("Please select a payment gateway before proceeding.")).subscribe();if(this.total===0)return p.error(u("There is nothing to refund.")).subscribe();if(this.screen===0)return p.error(u("Please provide a valid payment amount.")).subscribe();O.show(S,{title:u("Confirm Your Action"),message:u("The refund will be made on the current order."),onAction:r=>{r&&this.doProceed()}})},doProceed(){const r={products:this.refundables,total:this.screen,payment:this.selectedPaymentGateway,refund_shipping:this.refundShipping};this.isSubmitting=!0,v.post(`/api/orders/${this.order.id}/refund`,r).subscribe({next:t=>{this.isSubmitting=!1,this.$emit("changed",!0),t.data.order.payment_status==="refunded"&&this.$emit("loadTab","details"),this.print.process(t.data.orderRefund.id,"refund"),p.success(t.message).subscribe()},error:t=>{this.isSubmitting=!1,p.error(t.message).subscribe()}})},addProduct(){if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return p.error(u("Please select a product before proceeding.")).subscribe();const r=this.formValidation.extractFields(this.selectFields),t=this.order.products.filter(s=>s.id===r.product_id),i=this.refundables.filter(s=>s.id===r.product_id);if(i.length>0&&i.map(b=>parseInt(b.quantity)).reduce((b,l)=>b+l)===t[0].quantity)return p.error(u("Not enough quantity to proceed.")).subscribe();if(t[0].quantity===0)return p.error(u("Not enough quantity to proceed.")).subscribe();const _={...t[0],condition:"",description:""};new Promise((s,b)=>{O.show(B,{resolve:s,reject:b,product:_})}).then(s=>{s.quantity=this.getProductOriginalQuantity(s.id)-this.getProductUsedQuantity(s.id),this.refundables.push(s)},s=>s)},getProductOriginalQuantity(r){const t=this.order.products.filter(i=>i.id===r);return t.length>0?t.map(i=>parseFloat(i.quantity)).reduce((i,_)=>i+_):0},getProductUsedQuantity(r){const t=this.refundables.filter(i=>i.id===r);return t.length>0?t.map(_=>parseFloat(_.quantity)).reduce((_,o)=>_+o):0},openSettings(r){new Promise((i,_)=>{O.show(B,{resolve:i,reject:_,product:r})}).then(i=>{const _=this.refundables.indexOf(r);this.$set(this.refundables,_,i)},i=>i)},selectPaymentGateway(){new Promise((t,i)=>{O.show(L,{resolve:t,reject:i,value:[this.selectedPaymentOption],...this.paymentField[0]})}).then(t=>{this.selectedPaymentGateway=t[0]},t=>t)},changeQuantity(r){new Promise((i,_)=>{const o=this.getProductOriginalQuantity(r.id)-this.getProductUsedQuantity(r.id)+parseFloat(r.quantity);O.show(pe,{resolve:i,reject:_,product:r,availableQuantity:o})}).then(i=>{if(i.quantity>this.getProductUsedQuantity(r.id)-r.quantity){const _=this.refundables.indexOf(r);this.$set(this.refundables,_,i)}})},deleteProduct(r){new Promise((t,i)=>{O.show(S,{title:u("Confirm Your Action"),message:u("Would you like to delete this product ?"),onAction:_=>{if(_){const o=this.refundables.indexOf(r);this.refundables.splice(o,1)}}})})}},mounted(){this.selectFields=this.formValidation.createFields(this.selectFields),v.get("/api/orders/payments").subscribe(r=>{this.paymentField=r})}},he={class:"-m-4 flex-auto flex flex-wrap relative"},be={key:0,class:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},ye={class:"px-4 w-full lg:w-1/2"},ve={class:"py-2 border-b-2 text-primary border-info-primary"},xe={class:"my-2"},we={class:"border-b border-info-primary flex justify-between items-center mb-2"},ge={class:"flex-auto flex-col flex"},ke={class:"p-2 flex"},Pe={class:"flex justify-between p-2"},Ce={class:"flex items-center text-primary"},je={key:0,class:"mr-2"},Se={class:"py-1 border-b-2 text-primary border-info-primary"},Oe={class:"px-2 text-primary flex justify-between flex-auto"},Ve={class:"flex flex-col"},Ae={class:"py-2"},Fe={key:0,class:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},Ue={key:1,class:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},De={class:"flex items-center justify-center"},Te={class:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},Re={class:"flex"},Ie=["onClick"],qe=e("i",{class:"las la-cog text-xl"},null,-1),Qe=[qe],Ye=["onClick"],$e=e("i",{class:"las la-trash"},null,-1),Ne=[$e],Be=["onClick"],Ge={class:"px-4 w-full lg:w-1/2"},We={class:"py-2 border-b-2 text-primary border-info-primary"},Ee={class:"py-2"},Le={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},Me={class:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},He={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"};function ze(r,t,i,_,o,s){const b=h("ns-spinner"),l=h("ns-field"),c=h("ns-checkbox"),k=h("ns-numpad-plus");return d(),a("div",he,[o.isSubmitting?(d(),a("div",be,[y(b)])):m("",!0),e("div",ye,[e("h3",ve,n(s.__("Refund With Products")),1),e("div",xe,[e("ul",null,[e("li",we,[e("div",ge,[e("div",ke,[(d(!0),a(x,null,w(o.selectFields,(f,C)=>(d(),g(l,{field:f,key:C},null,8,["field"]))),128))]),e("div",Pe,[e("div",Ce,[i.order.shipping>0?(d(),a("span",je,n(s.__("Refund Shipping")),1)):m("",!0),i.order.shipping>0?(d(),g(c,{key:1,onChange:t[0]||(t[0]=f=>s.toggleRefundShipping(f)),checked:o.refundShipping},null,8,["checked"])):m("",!0)]),e("div",null,[e("button",{onClick:t[1]||(t[1]=f=>s.addProduct()),class:"border rounded-full px-2 py-1 ns-inset-button info"},n(s.__("Add Product")),1)])])])]),e("li",null,[e("h4",Se,n(s.__("Products")),1)]),(d(!0),a(x,null,w(o.refundables,f=>(d(),a("li",{key:f.id,class:"elevation-surface border flex justify-between items-center mb-2"},[e("div",Oe,[e("div",Ve,[e("p",Ae,[e("span",null,n(f.name),1),f.condition==="damaged"?(d(),a("span",Fe,n(s.__("Damaged")),1)):m("",!0),f.condition==="unspoiled"?(d(),a("span",Ue,n(s.__("Unspoiled")),1)):m("",!0)]),e("small",null,n(f.unit.name),1)]),e("div",De,[e("span",Te,n(s.nsCurrency(f.unit_price*f.quantity)),1)])]),e("div",Re,[e("p",{onClick:C=>s.openSettings(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Qe,8,Ie),e("p",{onClick:C=>s.deleteProduct(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Ne,8,Ye),e("p",{onClick:C=>s.changeQuantity(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},n(f.quantity),9,Be)])]))),128))])])]),e("div",Ge,[e("h3",We,n(s.__("Summary")),1),e("div",Ee,[e("div",Le,[e("span",null,n(s.__("Total")),1),e("span",null,n(s.nsCurrency(s.total)),1)]),e("div",Me,[e("span",null,n(s.__("Paid")),1),e("span",null,n(s.nsCurrency(i.order.tendered)),1)]),e("div",{onClick:t[2]||(t[2]=f=>s.selectPaymentGateway()),class:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer"},[e("span",null,n(s.__("Payment Gateway")),1),e("span",null,n(o.selectedPaymentGateway?o.selectedPaymentGateway.label:"N/A"),1)]),e("div",He,[e("span",null,n(s.__("Screen")),1),e("span",null,n(s.nsCurrency(o.screen)),1)]),e("div",null,[y(k,{currency:!0,onChanged:t[3]||(t[3]=f=>s.updateScreen(f)),value:o.screen,onNext:t[4]||(t[4]=f=>s.proceedPayment(f))},null,8,["value"])])])])])}const Je=A(fe,[["render",ze]]);class Y{getTypeLabel(t){const i=typeLabels.filter(_=>_.value===t);return i.length>0?i[0].label:u("Unknown Status")}getDeliveryStatus(t){const i=deliveryStatuses.filter(_=>_.value===t);return i.length>0?i[0].label:u("Unknown Status")}getProcessingStatus(t){const i=processingStatuses.filter(_=>_.value===t);return i.length>0?i[0].label:u("Unknown Status")}getPaymentStatus(t){const i=paymentLabels.filter(_=>_.value===t);return i.length>0?i[0].label:u("Unknown Status")}}const Ke={props:["order"],data(){return{labels:new Y,validation:new T,inputValue:0,fields:[],paymentTypes}},computed:{paymentsLabels(){const r=new Object;return this.paymentTypes.forEach(t=>{r[t.value]=t.label}),r}},methods:{__:u,nsCurrency:F,updateValue(r){this.inputValue=r},loadPaymentFields(){v.get("/api/orders/payments").subscribe(r=>{this.fields=this.validation.createFields(r)})},submitPayment(r){if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return p.error(u("Unable to proceed the form is not valid")).subscribe();if(parseFloat(r)==0)return p.error(u("Please provide a valid value")).subscribe();r=parseFloat(r);const t={...this.validation.extractFields(this.fields),value:r};Popup.show(S,{title:u("Confirm Your Action"),message:u("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",F(r)),onAction:i=>{i&&v.post(`/api/orders/${this.order.id}/payments`,t).subscribe(_=>{p.success(_.message).subscribe(),this.$emit("changed")},_=>{p.error(_.message).subscribe()})}})}},components:{nsNumpad:Q},mounted(){this.loadPaymentFields()}},Xe={class:""},Ze={class:"flex -mx-4 flex-wrap"},es={class:"px-2 w-full md:w-1/2"},ss={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},ts={class:"px-2 w-full md:w-1/2"},rs={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface success border text-xl font-bold"},is={class:"px-2 w-full md:w-1/2"},os={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface error border text-xl font-bold"},ls={key:0},ds={key:1},as={class:"px-2 w-full md:w-1/2"},cs={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface warning border text-xl font-bold"},us={class:"flex -mx-4 flex-wrap"},_s={class:"px-2 w-full mb-4 md:w-1/2"},ms={key:0},ps={class:"font-semibold border-b-2 border-info-primary py-2"},fs={class:"py-2"},hs={class:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},bs={key:1,class:"flex items-center justify-center h-full"},ys={class:"text-primary font-semibold"},vs={class:"px-2 w-full mb-4 md:w-1/2"},xs={class:"font-semibold border-b-2 border-info-primary py-2 mb-2"};function ws(r,t,i,_,o,s){const b=h("ns-field"),l=h("ns-numpad-plus");return d(),a("div",Xe,[e("div",Ze,[e("div",es,[e("div",ss,[e("span",null,n(s.__("Total")),1),e("span",null,n(s.nsCurrency(i.order.total)),1)])]),e("div",ts,[e("div",rs,[e("span",null,n(s.__("Paid")),1),e("span",null,n(s.nsCurrency(i.order.tendered)),1)])]),e("div",is,[e("div",os,[e("span",null,n(s.__("Unpaid")),1),i.order.total-i.order.tendered>0?(d(),a("span",ls,n(s.nsCurrency(i.order.total-i.order.tendered)),1)):m("",!0),i.order.total-i.order.tendered<=0?(d(),a("span",ds,n(s.nsCurrency(0)),1)):m("",!0)])]),e("div",as,[e("div",cs,[e("span",null,n(s.__("Customer Account")),1),e("span",null,n(s.nsCurrency(i.order.customer.account_amount)),1)])])]),e("div",us,[e("div",_s,[i.order.payment_status!=="paid"?(d(),a("div",ms,[e("h3",ps,n(s.__("Payment")),1),e("div",fs,[(d(!0),a(x,null,w(o.fields,(c,k)=>(d(),g(b,{field:c,key:k},null,8,["field"]))),128)),e("div",hs,n(s.nsCurrency(o.inputValue)),1),y(l,{floating:!0,onNext:t[0]||(t[0]=c=>s.submitPayment(c)),onChanged:t[1]||(t[1]=c=>s.updateValue(c)),value:o.inputValue},null,8,["value"])])])):m("",!0),i.order.payment_status==="paid"?(d(),a("div",bs,[e("h3",ys,n(s.__("No payment possible for paid order.")),1)])):m("",!0)]),e("div",vs,[e("h3",xs,n(s.__("Payment History")),1),e("ul",null,[(d(!0),a(x,null,w(i.order.payments,c=>(d(),a("li",{key:c.id,class:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[e("span",null,n(s.paymentsLabels[c.identifier]||s.__("Unknown")),1),e("span",null,n(s.nsCurrency(c.value)),1)]))),128))])])])])}const gs=A(Ke,[["render",ws]]),ks={name:"ns-orders-refund-popup",props:["popup"],data(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,systemUrls,print:new U({urls:systemUrls,options:systemOptions})}},methods:{__:u,nsCurrency:F,popupCloser:R,popupResolver:I,toggleProductView(r){this.view="details",this.previewed=r},loadOrderRefunds(){nsHttpClient.get(`/api/orders/${this.order.id}/refunds`).subscribe(r=>{this.loaded=!0,this.refunds=r.refunds},r=>{p.error(r.message).subscribe()})},close(){this.popup.close()},printRefundReceipt(r){this.print.process(r.id,"refund")}},mounted(){this.order=this.popup.params.order,this.popupCloser(),this.loadOrderRefunds()}},Ps={class:"shadow-lg w-95vw h-95vh md:w-3/5-screen md:h-3/5-screen ns-box flex flex-col overflow-hidden"},Cs={class:"border-b p-2 flex items-center justify-between ns-box-header"},js={class:"flex"},Ss={class:"overflow-auto flex-auto ns-box-body"},Os={key:0,class:"flex h-full w-full items-center justify-center"},Vs={key:1,class:"flex h-full w-full items-center justify-center"},As=e("i",{class:"lar la-frown-open"},null,-1),Fs=[As],Us={class:"w-full md:flex-auto p-2"},Ds={class:"font-semibold mb-1"},Ts={class:"flex -mx-1 text-sm text-primary"},Rs={class:"px-1"},Is={class:"px-1"},qs=["onClick"],Qs=e("i",{class:"las la-eye"},null,-1),Ys=[Qs],$s=["onClick"],Ns=e("i",{class:"las la-print"},null,-1),Bs=[Ns],Gs={class:"w-full md:flex-auto p-2"},Ws={class:"font-semibold mb-1"},Es={class:"flex -mx-1 text-sm text-primary"},Ls={class:"px-1"},Ms={class:"px-1"},Hs={class:"px-1"};function zs(r,t,i,_,o,s){const b=h("ns-close-button"),l=h("ns-spinner");return d(),a("div",Ps,[e("div",Cs,[e("h3",null,n(s.__("Order Refunds")),1),e("div",js,[o.view==="details"?(d(),a("div",{key:0,onClick:t[0]||(t[0]=c=>o.view="summary"),class:"flex items-center justify-center cursor-pointer rounded-full px-3 border ns-inset-button mr-1"},n(s.__("Go Back")),1)):m("",!0),y(b,{onClick:t[1]||(t[1]=c=>s.close())})])]),e("div",Ss,[o.view==="summary"?(d(),a(x,{key:0},[o.loaded?m("",!0):(d(),a("div",Os,[y(l,{size:"24"})])),o.loaded&&o.refunds.length===0?(d(),a("div",Vs,Fs)):m("",!0),o.loaded&&o.refunds.length>0?(d(!0),a(x,{key:2},w(o.refunds,c=>(d(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",Us,[e("h3",Ds,n(o.order.code),1),e("div",null,[e("ul",Ts,[e("li",Rs,n(s.__("Total"))+" : "+n(s.nsCurrency(c.total)),1),e("li",Is,n(s.__("By"))+" : "+n(c.author.username),1)])])]),e("div",{onClick:k=>s.toggleProductView(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},Ys,8,qs),e("div",{onClick:k=>s.printRefundReceipt(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},Bs,8,$s)]))),128)):m("",!0)],64)):m("",!0),o.view==="details"?(d(!0),a(x,{key:1},w(o.previewed.refunded_products,c=>(d(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",Gs,[e("h3",Ws,n(c.product.name),1),e("div",null,[e("ul",Es,[e("li",Ls,n(s.__("Condition"))+" : "+n(c.condition),1),e("li",Ms,n(s.__("Quantity"))+" : "+n(c.quantity),1),e("li",Hs,n(s.__("Total"))+" : "+n(s.nsCurrency(c.total_price)),1)])])])]))),128)):m("",!0)])])}const Js=A(ks,[["render",zs]]),Ks={props:["order"],data(){return{processingStatuses,deliveryStatuses,labels:new Y,showProcessingSelect:!1,showDeliverySelect:!1,systemUrls}},mounted(){},methods:{__:u,nsCurrency:F,submitProcessingChange(){O.show(S,{title:u("Would you proceed ?"),message:u("The processing status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/processing`,{process_status:this.order.process_status}).subscribe({next:t=>{this.showProcessingSelect=!1,p.success(t.message).subscribe()},error:t=>{p.error(t.message||u("Unexpected error occurred.")).subscribe()}})}})},openRefunds(){try{const r=new Promise((t,i)=>{const _=this.order;O.show(Js,{order:_,resolve:t,reject:i})})}catch{}},submitDeliveryStatus(){O.show(S,{title:u("Would you proceed ?"),message:u("The delivery status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/delivery`,{delivery_status:this.order.delivery_status}).subscribe({next:t=>{this.showDeliverySelect=!1,p.success(t.message).subscribe()},error:t=>{p.error(t.message||u("Unexpected error occurred.")).subscribe()}})}})}}},Xs={class:"-mx-4 flex flex-wrap"},Zs={class:"flex-auto"},et={class:"w-full mb-2 flex-wrap flex"},st={class:"w-full mb-2 px-4"},tt={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},rt={class:"mb-2 w-full md:w-1/2 px-4"},nt={class:"elevation-surface border p-2 flex justify-between items-start"},it={class:"text-semibold text-primary"},ot={class:"font-semibold text-secondary"},lt={class:"mb-2 w-full md:w-1/2 px-4"},dt={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},at={class:"text-semibold"},ct={class:""},ut={key:0,class:"ml-1"},_t={key:1,class:"ml-1"},mt={class:"font-semibold text-primary"},pt={class:"mb-2 w-full md:w-1/2 px-4"},ft={class:"p-2 flex justify-between items-start elevation-surface border"},ht={class:"text-semibold text-primary"},bt={class:"font-semibold text-secondary"},yt={class:"mb-2 w-full md:w-1/2 px-4"},vt={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},xt={class:"text-semibold"},wt={class:"font-semibold text-primary"},gt={class:"mb-2 w-full md:w-1/2 px-4"},kt={class:"p-2 flex justify-between items-start border ns-notice success"},Pt={class:"text-semibold"},Ct={class:"font-semibold text-primary"},jt={class:"mb-2 w-full md:w-1/2 px-4"},St={class:"p-2 flex justify-between items-start text-primary elevation-surface info border"},Ot={class:"text-semibold"},Vt={class:"font-semibold"},At={class:"mb-2 w-full md:w-1/2 px-4"},Ft={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},Ut={class:"text-semibold"},Dt={class:"font-semibold"},Tt={class:"mb-2 w-full md:w-1/2 px-4"},Rt={class:"p-2 flex justify-between items-start elevation-surface border"},It={class:"text-semibold"},qt={class:"font-semibold"},Qt={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},Yt={class:"mb-2"},$t={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},Nt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Bt={class:"text-semibold text-primary"},Gt={key:0,class:"font-semibold text-secondary"},Wt=["href"],Et={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Lt={class:"text-semibold text-primary"},Mt={class:"font-semibold text-secondary"},Ht={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},zt={class:"text-semibold text-primary"},Jt={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},Kt={class:"w-full text-center"},Xt={key:0,class:"flex-auto flex"},Zt={class:"ns-select flex items-center justify-center"},er=["value"],sr={class:"pl-2 flex"},tr={class:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},rr={class:"text-semibold text-primary"},nr={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},ir={class:"w-full text-center"},or={key:0,class:"flex-auto flex"},lr={class:"ns-select flex items-center justify-center"},dr=["value"],ar={class:"pl-2 flex"},cr={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},ur={class:"text-semibold text-primary"},_r={class:"font-semibold text-secondary"},mr={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},pr={class:"mb-2"},fr={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},hr={class:"text-semibold text-primary"},br={class:"text-secondary text-sm"},yr={class:"font-semibold text-secondary"},vr={class:"mb-2"},xr={class:"font-semibold text-secondary pb-2 border-b border-info-primary flex justify-between"},wr={class:"text-semibold text-primary"},gr={class:"text-secondary text-sm"},kr={class:"font-semibold text-secondary"};function Pr(r,t,i,_,o,s){const b=h("ns-close-button");return d(),a("div",Xs,[e("div",Zs,[e("div",et,[e("div",st,[e("h3",tt,n(s.__("Payment Summary")),1)]),e("div",rt,[e("div",nt,[e("div",null,[e("h4",it,n(s.__("Sub Total")),1)]),e("div",ot,n(s.nsCurrency(i.order.subtotal)),1)])]),e("div",lt,[e("div",dt,[e("div",null,[e("h4",at,[e("span",ct,n(s.__("Discount")),1),i.order.discount_type==="percentage"?(d(),a("span",ut,"("+n(i.order.discount_percentage)+"%)",1)):m("",!0),i.order.discount_type==="flat"?(d(),a("span",_t,"(Flat)")):m("",!0)])]),e("div",mt,n(s.nsCurrency(i.order.discount)),1)])]),e("div",pt,[e("div",ft,[e("div",null,[e("h4",ht,n(s.__("Shipping")),1)]),e("div",bt,n(s.nsCurrency(i.order.shipping)),1)])]),e("div",yt,[e("div",vt,[e("div",null,[e("h4",xt,n(s.__("Coupons")),1)]),e("div",wt,n(s.nsCurrency(i.order.total_coupons)),1)])]),e("div",gt,[e("div",kt,[e("div",null,[e("h4",Pt,n(s.__("Total")),1)]),e("div",Ct,n(s.nsCurrency(i.order.total)),1)])]),e("div",jt,[e("div",St,[e("div",null,[e("h4",Ot,n(s.__("Taxes")),1)]),e("div",Vt,n(s.nsCurrency(i.order.tax_value)),1)])]),e("div",At,[e("div",Ft,[e("div",null,[e("h4",Ut,n(s.__("Change")),1)]),e("div",Dt,n(s.nsCurrency(i.order.change)),1)])]),e("div",Tt,[e("div",Rt,[e("div",null,[e("h4",It,n(s.__("Paid")),1)]),e("div",qt,n(s.nsCurrency(i.order.tendered)),1)])])])]),e("div",Qt,[e("div",Yt,[e("h3",$t,n(s.__("Order Status")),1)]),e("div",Nt,[e("div",null,[e("h4",Bt,[e("span",null,n(s.__("Customer")),1)])]),i.order?(d(),a("div",Gt,[e("a",{class:"border-b border-dashed border-info-primary",href:o.systemUrls.customer_edit_url.replace("#customer",i.order.customer.id),target:"_blank",rel:"noopener noreferrer"},n(i.order.customer.first_name)+" "+n(i.order.customer.last_name),9,Wt)])):m("",!0)]),e("div",Et,[e("div",null,[e("h4",Lt,[e("span",null,n(s.__("Type")),1)])]),e("div",Mt,n(o.labels.getTypeLabel(i.order.type)),1)]),e("div",Ht,[e("div",null,[e("h4",zt,[e("span",null,n(s.__("Delivery Status")),1)])]),e("div",Jt,[e("div",Kt,[o.showDeliverySelect?m("",!0):(d(),a("span",{key:0,onClick:t[0]||(t[0]=l=>o.showDeliverySelect=!0),class:"font-semibold text-secondary border-b border-info-primary cursor-pointer border-dashed"},n(o.labels.getDeliveryStatus(i.order.delivery_status)),1))]),o.showDeliverySelect?(d(),a("div",Xt,[e("div",Zt,[D(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[1]||(t[1]=l=>i.order.delivery_status=l)},[(d(!0),a(x,null,w(o.deliveryStatuses,(l,c)=>(d(),a("option",{key:c,value:l.value},n(l.label),9,er))),128))],512),[[$,i.order.delivery_status]])]),e("div",sr,[y(b,{onClick:t[2]||(t[2]=l=>o.showDeliverySelect=!1)}),e("button",{onClick:t[3]||(t[3]=l=>s.submitDeliveryStatus(i.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},n(s.__("Save")),1)])])):m("",!0)])]),e("div",tr,[e("div",null,[e("h4",rr,[e("span",null,n(s.__("Processing Status")),1)])]),e("div",nr,[e("div",ir,[o.showProcessingSelect?m("",!0):(d(),a("span",{key:0,onClick:t[4]||(t[4]=l=>o.showProcessingSelect=!0),class:"border-b border-info-primary cursor-pointer border-dashed"},n(o.labels.getProcessingStatus(i.order.process_status)),1))]),o.showProcessingSelect?(d(),a("div",or,[e("div",lr,[D(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[5]||(t[5]=l=>i.order.process_status=l)},[(d(!0),a(x,null,w(o.processingStatuses,(l,c)=>(d(),a("option",{key:c,value:l.value},n(l.label),9,dr))),128))],512),[[$,i.order.process_status]])]),e("div",ar,[y(b,{onClick:t[6]||(t[6]=l=>o.showProcessingSelect=!1)}),e("button",{onClick:t[7]||(t[7]=l=>s.submitProcessingChange(i.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},n(s.__("Save")),1)])])):m("",!0)])]),e("div",cr,[e("div",null,[e("h4",ur,[e("span",null,n(s.__("Payment Status")),1)])]),e("div",_r,n(o.labels.getPaymentStatus(i.order.payment_status)),1)])]),e("div",mr,[e("div",pr,[e("h3",fr,n(s.__("Products")),1)]),(d(!0),a(x,null,w(i.order.products,l=>(d(),a("div",{key:l.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",hr,n(l.name)+" (x"+n(l.quantity)+")",1),e("p",br,n(l.unit.name||"N/A"),1)]),e("div",yr,n(s.nsCurrency(l.total_price)),1)]))),128)),e("div",vr,[e("h3",xr,[e("span",null,n(s.__("Refunded Products")),1),e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=l=>s.openRefunds()),class:"border-b border-info-primary border-dashed"},n(s.__("All Refunds")),1)])]),(d(!0),a(x,null,w(i.order.refunded_products,(l,c)=>(d(),a("div",{key:c,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",wr,n(l.order_product.name)+" (x"+n(l.quantity)+")",1),e("p",gr,[V(n(l.unit.name||"N/A")+" | ",1),e("span",{class:G(["rounded-full px-2",l.condition==="damaged"?"bg-error-tertiary text-white":"bg-info-tertiary text-white"])},n(l.condition),3)])]),e("div",kr,n(s.nsCurrency(l.total_price)),1)]))),128))])])}const Cr=A(Ks,[["render",Pr]]),jr={name:"ns-order-instalments-payment",props:["popup"],components:{nsNotice:M},data(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:u("Select the payment type that must apply to the current order."),label:u("Payment Type"),validation:"required",options:paymentTypes}],print:new U({urls:systemUrls,options:systemOptions}),validation:new T,order:null,instalment:null}},methods:{__:u,popupResolver:I,popupCloser:R,close(){this.popupResolver(!1)},updateInstalmentAsDue(r){nsHttpClient.put(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/`,{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:t=>{this.submitPayment()},error:t=>{p.error(t.message||u("An unexpected error has occurred")).subscribe()}})},submitPayment(){if(!this.validation.validateFields(this.fields))return p.error(__m("The form is not valid.")).subcribe();nsHttpClient.post(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/pay`,{...this.validation.extractFields(this.fields)}).subscribe({next:r=>{this.popupResolver(!0),this.print.exec(r.data.payment.id,"payment"),p.success(r.message).subscribe()},error:r=>{r.status==="failed"&&Popup.show(S,{title:u("Update Instalment Date"),message:u("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:t=>{t&&this.updateInstalmentAsDue(this.instalment)}}),p.error(r.message||u("An unexpected error has occurred")).subscribe()}})}},mounted(){this.popupCloser(),this.order=this.popup.params.order,this.instalment=this.popup.params.instalment,this.fields=this.validation.createFields(this.fields)}},Sr={class:"shadow-lg ns-box w-95vw md:w-2/3-screen lg:w-1/3-screen"},Or={class:"p-2 flex justify-between border-b items-center"},Vr={class:"p-2 ns-box-body"},Ar=e("br",null,null,-1),Fr={class:"border-t ns-box-footer p-2 flex justify-end"};function Ur(r,t,i,_,o,s){const b=h("ns-close-button"),l=h("ns-notice"),c=h("ns-field"),k=h("ns-button");return d(),a("div",Sr,[e("div",Or,[e("h3",null,n(s.__("Payment Method")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=f=>s.close())})])]),e("div",Vr,[y(l,{color:"info",class:"py-2 p-4 text-center border text-primary rounded-lg"},{default:P(()=>[V(n(s.__("Before submitting the payment, choose the payment type used for that order.")),1)]),_:1}),Ar,(d(!0),a(x,null,w(o.fields,(f,C)=>(d(),g(c,{key:C,field:f},null,8,["field"]))),128))]),e("div",Fr,[y(k,{onClick:t[1]||(t[1]=f=>s.submitPayment()),type:"info"},{default:P(()=>[V(n(s.__("Submit Payment")),1)]),_:1})])])}const Dr=A(jr,[["render",Ur]]),Tr={props:["order"],name:"ns-order-instalments",data(){return{labels:new Y,original:[],instalments:[],print:new U({urls:systemUrls,options:systemOptions,type:"payment"})}},mounted(){this.loadInstalments()},computed:{totalInstalments(){return this.instalments.length>0?this.instalments.map(r=>r.amount).reduce((r,t)=>parseFloat(r)+parseFloat(t)):0}},methods:{__:u,nsCurrency:F,loadInstalments(){v.get(`/api/orders/${this.order.id}/instalments`).subscribe(r=>{this.original=r,this.instalments=r.map(t=>(t.price_clicked=!1,t.date_clicked=!1,t.date=moment(t.date).format("YYYY-MM-DD"),t))})},showReceipt(r){if(r.payment_id===null)return p.error(u("This instalment doesn't have any payment attached.")).subscribe();this.print.process(r.payment_id,"payment")},addInstalment(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment(r){Popup.show(S,{title:u("Confirm Your Action"),message:u("Would you like to create this instalment ?"),onAction:t=>{t&&v.post(`/api/orders/${this.order.id}/instalments`,{instalment:r}).subscribe({next:i=>{this.loadInstalments(),p.success(i.message).subscribe()},error:i=>{p.error(i.message||u("An unexpected error has occurred")).subscribe()}})}})},deleteInstalment(r){Popup.show(S,{title:u("Confirm Your Action"),message:u("Would you like to delete this instalment ?"),onAction:t=>{t&&v.delete(`/api/orders/${this.order.id}/instalments/${r.id}`).subscribe({next:i=>{const _=this.instalments.indexOf(r);this.instalments.splice(_,1),p.success(i.message).subscribe()},error:i=>{p.error(i.message||u("An unexpected error has occurred")).subscribe()}})}})},async markAsPaid(r){try{const t=await new Promise((i,_)=>{Popup.show(Dr,{order:this.order,instalment:r,resolve:i,reject:_})});this.loadInstalments()}catch{}},togglePriceEdition(r){r.paid||(r.price_clicked=!r.price_clicked,this.$forceUpdate(),r.price_clicked&&setTimeout(()=>{this.$refs.amount[0].select()},100))},updateInstalment(r){Popup.show(S,{title:u("Confirm Your Action"),message:u("Would you like to update that instalment ?"),onAction:t=>{t&&v.put(`/api/orders/${this.order.id}/instalments/${r.id}`,{instalment:r}).subscribe({next:i=>{p.success(i.message).subscribe()},error:i=>{p.error(i.message||u("An unexpected error has occurred")).subscribe()}})}})},toggleDateEdition(r){r.paid||(r.date_clicked=!r.date_clicked,this.$forceUpdate(),r.date_clicked&&setTimeout(()=>{this.$refs.date[0].select()},200))}}},Rr={class:"-mx-4 flex-auto flex flex-wrap"},Ir={class:"flex flex-auto"},qr={class:"w-full mb-2 flex-wrap"},Qr={class:"w-full mb-2 px-4"},Yr={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},$r={class:"px-4"},Nr={class:"border-table-th-edge border-t text-primary"},Br={class:"p-2"},Gr=["onClick"],Wr={key:1},Er=["onBlur","onUpdate:modelValue"],Lr={class:"flex items-center"},Mr={class:"flex items-center px-2 h-full border-r"},Hr=["onClick"],zr={key:1},Jr=["onUpdate:modelValue","onBlur"],Kr={key:0,class:"w-36 justify-center flex items-center px-2 h-full border-r"},Xr={class:"px-2"},Zr={class:"px-2"},en={class:"px-2"},sn={key:1,class:"w-36 justify-center flex items-center px-2 h-full border-r"},tn={class:"px-2"},rn={class:"ns-button info"},nn=["onClick"],on=e("i",{class:"las la-plus"},null,-1),ln={key:2,class:"w-36 justify-center flex items-center px-2 h-full"},dn={class:"ns-button info"},an=["onClick"],cn=e("i",{class:"las la-print"},null,-1),un={class:"flex justify-between p-2 border-r border-b border-l elevation-surface"},_n={class:"flex items-center justify-center"},mn={class:"ml-1 text-sm"},pn={class:"-mx-2 flex flex-wrap items-center"},fn={class:"px-2"},hn={class:"px-2"},bn={class:"ns-button info"};function yn(r,t,i,_,o,s){const b=h("ns-icon-button");return d(),a("div",Rr,[e("div",Ir,[e("div",qr,[e("div",Qr,[e("h3",Yr,n(s.__("Instalments")),1)]),e("div",$r,[e("ul",Nr,[(d(!0),a(x,null,w(o.instalments,l=>(d(),a("li",{class:G([l.paid?"success":"info","border-b border-l flex justify-between elevation-surface"]),key:l.id},[e("span",Br,[l.date_clicked?m("",!0):(d(),a("span",{key:0,onClick:c=>s.toggleDateEdition(l)},n(l.date),9,Gr)),l.date_clicked?(d(),a("span",Wr,[D(e("input",{onBlur:c=>s.toggleDateEdition(l),"onUpdate:modelValue":c=>l.date=c,type:"date",ref_for:!0,ref:"date",class:"border border-info-primary rounded"},null,40,Er),[[N,l.date]])])):m("",!0)]),e("div",Lr,[e("div",Mr,[l.price_clicked?m("",!0):(d(),a("span",{key:0,onClick:c=>s.togglePriceEdition(l)},n(s.nsCurrency(l.amount)),9,Hr)),l.price_clicked?(d(),a("span",zr,[D(e("input",{ref_for:!0,ref:"amount","onUpdate:modelValue":c=>l.amount=c,onBlur:c=>s.togglePriceEdition(l),type:"text",class:"border border-info-primary p-1"},null,40,Jr),[[N,l.amount]])])):m("",!0)]),!l.paid&&l.id?(d(),a("div",Kr,[e("div",Xr,[y(b,{type:"success",onClick:c=>s.markAsPaid(l),className:"la-money-bill-wave-alt"},null,8,["onClick"])]),e("div",Zr,[y(b,{type:"info",onClick:c=>s.updateInstalment(l),className:"la-save"},null,8,["onClick"])]),e("div",en,[y(b,{type:"error",onClick:c=>s.deleteInstalment(l),className:"la-trash-alt"},null,8,["onClick"])])])):m("",!0),!l.paid&&!l.id?(d(),a("div",sn,[e("div",tn,[e("div",rn,[e("button",{onClick:c=>s.createInstalment(l),class:"px-3 py-1 rounded-full"},[on,V(" "+n(s.__("Create")),1)],8,nn)])])])):m("",!0),l.paid?(d(),a("div",ln,[e("div",dn,[e("button",{onClick:c=>s.showReceipt(l),class:"px-3 text-xs py-1 rounded-full"},[cn,V(" "+n(s.__("Receipt")),1)],8,an)])])):m("",!0)])],2))),128)),e("li",un,[e("div",_n,[e("span",null,n(s.__("Total :"))+" "+n(s.nsCurrency(i.order.total)),1),e("span",mn," ("+n(s.__("Remaining :"))+" "+n(s.nsCurrency(i.order.total-s.totalInstalments))+") ",1)]),e("div",pn,[e("span",fn,n(s.__("Instalments:"))+" "+n(s.nsCurrency(s.totalInstalments)),1),e("span",hn,[e("div",bn,[e("button",{onClick:t[0]||(t[0]=l=>s.addInstalment()),class:"rounded-full px-3 py-1"},n(s.__("Add Instalment")),1)])])])])])])])])])}const vn=A(Tr,[["render",yn]]),xn={name:"ns-orders-preview-popup",props:["popup"],data(){return{active:"details",order:new Object,rawOrder:new Object,products:[],payments:[],options:null,print:new U({urls:systemUrls,options:systemOptions}),settings:null}},components:{nsOrderRefund:Je,nsOrderPayment:gs,nsOrderDetails:Cr,nsOrderInstalments:vn},computed:{isVoidable(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble(){return["hold"].includes(this.order.payment_status)}},methods:{__:u,popupResolver:I,popupCloser:R,nsCurrency:F,closePopup(r=!1){this.popupResolver(r)},setActive(r){this.active=r},printOrder(){this.print.process(this.order.id,"sale")},refresh(){this.loadOrderDetails(this.order.id)},loadOrderDetails(r){z([v.get(`/api/orders/${r}`),v.get(`/api/orders/${r}/products`),v.get(`/api/orders/${r}/payments`)]).subscribe(t=>{this.order=t[0],this.products=t[1],this.payments=t[2]})},deleteOrder(){Popup.show(S,{title:u("Confirm Your Action"),message:u("Would you like to delete this order"),onAction:r=>{r&&v.delete(`/api/orders/${this.rawOrder.id}`).subscribe({next:t=>{p.success(t.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:t=>{p.error(t.message).subscribe()}})}})},voidOrder(){try{const r=new Promise((t,i)=>{Popup.show(H,{resolve:t,reject:i,title:u("Confirm Your Action"),message:u("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:_=>{_!==!1&&v.post(`/api/orders/${this.rawOrder.id}/void`,{reason:_}).subscribe({next:o=>{p.success(o.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:o=>{p.error(o.message).subscribe()}})}})})}catch(r){console.log(r)}},refreshCrudTable(){this.popup.params.component.$emit("updated",!0)}},watch:{active(){this.active==="details"&&this.loadOrderDetails(this.rawOrder.id)}},mounted(){this.rawOrder=this.popup.params.order,this.options=systemOptions,this.urls=systemUrls,this.loadOrderDetails(this.rawOrder.id),this.popupCloser()}},wn={class:"h-95vh w-95vw md:h-6/7-screen md:w-6/7-screen overflow-hidden shadow-xl ns-box flex flex-col"},gn={class:"border-b ns-box-header p-3 flex items-center justify-between"},kn={class:"p-2 ns-box-body overflow-hidden flex flex-auto"},Pn={key:1,class:"h-full w-full flex items-center justify-center"},Cn={class:"p-2 flex justify-between border-t ns-box-footer"},jn=e("i",{class:"las la-ban"},null,-1),Sn=e("i",{class:"las la-trash"},null,-1),On=e("i",{class:"las la-print"},null,-1);function Vn(r,t,i,_,o,s){const b=h("ns-close-button"),l=h("ns-order-details"),c=h("ns-tabs-item"),k=h("ns-order-payment"),f=h("ns-order-refund"),C=h("ns-order-instalments"),W=h("ns-tabs"),E=h("ns-spinner"),q=h("ns-button");return d(),a("div",wn,[e("div",gn,[e("div",null,[e("h3",null,n(s.__("Order Options")),1)]),e("div",null,[y(b,{onClick:t[0]||(t[0]=j=>s.closePopup(!0))})])]),e("div",kn,[o.order.id?(d(),g(W,{key:0,active:o.active,onActive:t[5]||(t[5]=j=>s.setActive(j))},{default:P(()=>[y(c,{label:s.__("Details"),identifier:"details",class:"overflow-y-auto"},{default:P(()=>[o.order?(d(),g(l,{key:0,order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["label"]),y(c,{visible:!["order_void","hold","refunded","partially_refunded"].includes(o.rawOrder.payment_status),label:s.__("Payments"),identifier:"payments"},{default:P(()=>[o.order?(d(),g(k,{key:0,onChanged:t[1]||(t[1]=j=>s.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"]),y(c,{visible:!["order_void","hold","refunded"].includes(o.rawOrder.payment_status),label:s.__("Refund & Return"),identifier:"refund"},{default:P(()=>[o.order?(d(),g(f,{key:0,onLoadTab:t[2]||(t[2]=j=>s.setActive(j)),onChanged:t[3]||(t[3]=j=>s.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"]),y(c,{visible:["partially_paid","unpaid"].includes(o.rawOrder.payment_status)&&o.rawOrder.support_instalments,label:s.__("Installments"),identifier:"instalments"},{default:P(()=>[o.order?(d(),g(C,{key:0,onChanged:t[4]||(t[4]=j=>s.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"])]),_:1},8,["active"])):m("",!0),o.order.id?m("",!0):(d(),a("div",Pn,[y(E)]))]),e("div",Cn,[e("div",null,[s.isVoidable?(d(),g(q,{key:0,onClick:t[6]||(t[6]=j=>s.voidOrder()),type:"error"},{default:P(()=>[jn,V(" "+n(s.__("Void")),1)]),_:1})):m("",!0),s.isDeleteAble?(d(),g(q,{key:1,onClick:t[7]||(t[7]=j=>s.deleteOrder()),type:"error"},{default:P(()=>[Sn,V(" "+n(s.__("Delete")),1)]),_:1})):m("",!0)]),e("div",null,[y(q,{onClick:t[8]||(t[8]=j=>s.printOrder()),type:"info"},{default:P(()=>[On,V(" "+n(s.__("Print")),1)]),_:1})])])])}const Jn=A(xn,[["render",Vn]]);export{Js as a,Jn as n};
