import{f as V,b as S}from"./components-jhJdQ7v7.js";import{c as M}from"./runtime-dom.esm-bundler-DaZ-XdMB.js";import{n as w,b as O,N as T,d as N,c as D}from"./ns-prompt-popup-hkqhRe3a.js";import{n as B,a as H}from"./ns-orders-preview-popup-DGghYaOO.js";import{n as R}from"./ns-procurement-quantity-BEhxMrnh.js";import{n as z}from"./currency-COpKd-rX.js";import{n as h,d as q,P as L,b as W,p as E,a as Y,F as I}from"./bootstrap-COKxfLi_.js";import{_ as a}from"./lang-BINodpp-.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as p,c,o as l,a as m,F as g,b as i,t as u,f,n as A,e as j,g as C,w as x,i as Q,s as G}from"./runtime-core.esm-bundler-D4l6Snf1.js";import"./ns-avatar-DRlb-nQV.js";import"./ns-avatar-image-B5T1F44X.js";import"./chart-CFvJmF2u.js";const J={name:"ns-products-convertion",props:["popup","unitQuantity","product"],data(){return{unitQuantities:[],isLoading:!1,unitPair:{from:{unit:{},unitQuantity:{},selected:!0,quantity:0,realQuantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]},to:{unit:{},unitQuantity:{},selected:!1,quantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]}},selected:""}},mounted(){this.loadProductQuantities(),console.log(this)},methods:{__:a,async submitConvertion(){if(this.unitPair.from.quantity===0)return h.error(a("The quantity should be greater than 0"));if(Math.floor(this.unitPair.to.quantity)===0)return h.error(a(`The provided quantity can't result in any convertion for unit "{destination}"`).replace("{destination}",this.unitPair.to.unit.name)).subscribe();if(this.unitPair.from.quantity!==this.unitPair.from.realQuantity)try{const e=await new Promise((t,o)=>{L.show(w,{title:a("Conversion Warning"),message:a("Only {quantity}({source}) can be converted to {destinationCount}({destination}). Would you like to proceed ?").replace("{quantity}",this.unitPair.from.realQuantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:d=>{d?t(!0):o(!1)}})});return this.proceedConversionSubmissions()}catch{return}try{const e=await new Promise((t,o)=>{L.show(w,{title:a("Confirm Conversion"),message:a("You're about to convert {quantity}({source}) to {destinationCount}({destination}). Would you like to proceed?").replace("{quantity}",this.unitPair.from.quantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:d=>{d?t(!0):o(!1)}})});return this.proceedConversionSubmissions()}catch{return}},proceedConversionSubmissions(){this.isLoading=!0,nsHttpClient.post(`/api/products/${this.unitQuantity.product_id}/units/conversion`,{from:this.unitPair.from.unit.id,to:this.unitPair.to.unit.id,quantity:this.unitPair.from.realQuantity}).subscribe({next:e=>(this.isLoading=!1,this.popup.close(),this.popup.params.resolve(e),q.success(a("Conversion Successful"),a("The product {product} has been converted successfully.").replace("{product}",this.product.name))),error:e=>(this.isLoading=!1,this.popup.params.reject(e),q.error(a("An error occured"),e.message||a("An error occured while converting the product {product}").replace("{product}",this.product.name)))})},handlePairUnitUpdated(e){const t=this.selectedUnitPair();t.unitQuantity=this.unitQuantities.filter(d=>d.unit.id===e.value)[0],t.unit=t.unitQuantity.unit,t.fields[0].value=e.value;const o=t===this.unitPair.from?this.unitPair.to:this.unitPair.from;o.unit.id===t.unit.id&&(o.unitQuantity=this.unitQuantities.filter(d=>d.unit.id!==t.unit.id)[0],o.unit=o.unitQuantity.unit,o.fields[0].value=o.unit.id),this.updateFromPairQuantity(this.unitPair.from.quantity)},updateFromPairQuantity(e){e.length===0&&(e=0),e>this.unitPair.from.unitQuantity.quantity&&(e=this.unitPair.from.unitQuantity.quantity,h.info(a("The quantity has been set to the maximum available"))),this.unitPair.from.quantity=parseFloat(e);const t=this.unitQuantities.filter(s=>s.unit.base_unit)[0];if(t.length===0)return q.error(a("An error occured"),a("The product {product} has no base unit").replace("{product}",this.product.name));const d=this.unitPair.from.quantity*this.unitPair.from.unit.value*t.unit.value/this.unitPair.to.unit.value;this.unitPair.from.unit.value<this.unitPair.to.unit.value?this.unitPair.from.realQuantity=Math.floor(d)*this.unitPair.to.unit.value:this.unitPair.from.realQuantity=this.unitPair.from.quantity,this.unitPair.to.quantity=d},switchPair(){const e=this.unitPair.from.unit,t=this.unitPair.to.unit;this.unitPair.from.unit=t,this.unitPair.from.unitQuantity=this.unitQuantities.filter(o=>o.unit.id===t.id)[0],this.unitPair.from.quantity=Math.floor(this.unitPair.to.quantity),this.unitPair.to.unit=e,this.unitPair.to.unitQuantity=this.unitQuantities.filter(o=>o.unit.id===e.id)[0],this.updateFromPairQuantity(this.unitPair.from.quantity)},selectedUnitPair(){return this.unitPair[this.unitPair.from.selected?"from":"to"]},setVisible(e,t){const o=t==="from"?"to":"from";e[t].selected=!0,e[o].selected=!1},loadProductQuantities(){nsHttpClient.get("/api/products/"+this.unitQuantity.product_id+"/units/quantities").subscribe({next:e=>{this.unitQuantities=e,this.unitPair.from.unit=this.unitQuantity.unit,this.unitPair.from.unitQuantity=this.unitQuantity,this.unitPair.from.fields[0].value=this.unitQuantity.unit.id,this.unitPair.from.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id})),this.unitPair.to.unit=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0].unit,this.unitPair.to.unitQuantity=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0],this.unitPair.to.fields[0].value=this.unitPair.to.unit.id,this.unitPair.to.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id}))}})}}},K={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},X={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},Z={class:"relative"},$={class:"border-b border-box-edge"},tt={class:"flex"},et={class:"font-bold text-3xl"},it={class:"border-r border-box-edge relative"},nt={class:"font-bold text-3xl"},st={class:"p-2 border-b border-box-edge"},ot={class:""},rt={key:0,class:"top-0 left-0 absolute h-full w-full flex items-center justify-center",style:{background:"rgb(121 121 121 / 20%)"}},at={key:1,class:"flex items-center h-full justify-center"};function ut(e,t,o,d,s,n){const b=p("ns-close-button"),P=p("ns-field"),y=p("ns-numpad"),_=p("ns-spinner");return l(),c("div",K,[s.unitQuantities.length>0?(l(),c(g,{key:0},[i("div",X,[i("div",null,u(n.__("Unit Conversion : {product}").replace("{product}",o.product.name)),1),i("div",null,[f(b,{onClick:t[0]||(t[0]=r=>o.popup.close())})])]),i("div",Z,[i("div",$,[i("div",tt,[i("div",{class:A(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",s.unitPair.from.selected?"bg-info-primary text-white":""]),onClick:t[1]||(t[1]=r=>n.setVisible(s.unitPair,"from"))},[i("span",null,u(s.unitPair.from.unit.name),1),i("h3",et,u(s.unitPair.from.quantity),1)],2),i("div",it,[i("div",{class:"rounded-full h-12 w-12 flex items-center justify-center absolute shadow bg-input-button p-2",onClick:t[2]||(t[2]=r=>n.switchPair()),style:{position:"absolute",left:"-22px",top:"14px"}},t[8]||(t[8]=[i("i",{class:"las la-exchange-alt text-3xl"},null,-1)]))]),i("div",{class:A(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",s.unitPair.to.selected?"bg-info-primary text-white":""]),onClick:t[3]||(t[3]=r=>n.setVisible(s.unitPair,"to"))},[i("span",null,u(s.unitPair.to.unit.name),1),i("h3",nt,u(Math.floor(s.unitPair.to.quantity)),1)],2)])]),i("div",st,[(l(!0),c(g,null,j(n.selectedUnitPair().fields,r=>(l(),C(P,{onChange:t[4]||(t[4]=v=>n.handlePairUnitUpdated(v)),field:r},null,8,["field"]))),256))]),i("div",ot,[f(y,{onNext:t[6]||(t[6]=r=>n.submitConvertion()),value:s.unitPair.from.quantity,onChanged:t[7]||(t[7]=r=>n.updateFromPairQuantity(r))},{"numpad-footer":x(()=>[i("div",{onClick:t[5]||(t[5]=r=>n.updateFromPairQuantity(s.unitPair.from.unitQuantity.quantity)),class:"w-full ns-numpad-key h-24 font-bold flex items-center justify-center cursor-pointer col-span-3"},u(n.__("Convert {quantity} available").replace("{quantity}",s.unitPair.from.unitQuantity.quantity)),1)]),_:1},8,["value"])]),s.isLoading?(l(),c("div",rt,[f(_,{size:"24"})])):m("",!0)])],64)):m("",!0),s.unitQuantities.length===0?(l(),c("div",at,[f(_)])):m("",!0)])}const lt=U(J,[["render",ut]]),dt={name:"ns-products-preview",props:["popup","product"],computed:{product(){return this.popup.params.product}},methods:{__:a,nsCurrency:z,changeActiveTab(e){this.active=e,this.active==="units-quantities"&&this.loadProductQuantities()},loadProductQuantities(){console.log("is loadinfg"),this.hasLoadedUnitQuantities=!1,W.get(`/api/products/${this.product.id}/units/quantities`).subscribe({next:e=>{this.unitQuantities=e,this.hasLoadedUnitQuantities=!0}})},async convert(e,t){try{const o=await new Promise((d,s)=>{Popup.show(lt,{unitQuantity:e,product:t,resolve:d,reject:s})});this.loadProductQuantities()}catch(o){console.log({exception:o})}}},data(){return{active:"units-quantities",unitQuantities:[],hasLoadedUnitQuantities:!1}},mounted(){this.loadProductQuantities()}},ct={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},pt={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},ft={class:"flex-auto overflow-y-auto ns-box-body"},ht={class:"p-2"},mt={key:0,class:"table ns-table w-full"},_t={class:"p-1 border"},vt={width:"150",class:"text-right p-1 border"},bt={width:"150",class:"text-right p-1 border"},Pt={width:"150",class:"text-right p-1 border"},yt={class:"p-1 border text-left"},gt=["onClick"],xt={class:"p-1 border text-right"},wt={class:"p-1 border text-right"},Ct={class:"p-1 border text-right"};function Qt(e,t,o,d,s,n){const b=p("ns-close-button"),P=p("ns-spinner"),y=p("ns-tabs-item"),_=p("ns-tabs");return l(),c("div",ct,[i("div",pt,[i("div",null,u(n.__("Previewing :"))+" "+u(n.product.name),1),i("div",null,[f(b,{onClick:t[0]||(t[0]=r=>o.popup.close())})])]),i("div",ft,[i("div",ht,[f(_,{active:s.active,onActive:t[1]||(t[1]=r=>n.changeActiveTab(r))},{default:x(()=>[f(y,{label:n.__("Units & Quantities"),identifier:"units-quantities"},{default:x(()=>[s.hasLoadedUnitQuantities?(l(),c("table",mt,[i("thead",null,[i("tr",null,[i("th",_t,u(n.__("Unit")),1),i("th",vt,u(n.__("Sale Price")),1),i("th",bt,u(n.__("Wholesale Price")),1),i("th",Pt,u(n.__("Quantity")),1)])]),i("tbody",null,[(l(!0),c(g,null,j(s.unitQuantities,r=>(l(),c("tr",{key:r.id},[i("td",yt,[Q(u(r.unit.name)+" ",1),n.product.rawType==="materialized"&&n.product.rawStockManagement==="enabled"?(l(),c(g,{key:0},[t[2]||(t[2]=Q(" â€” ")),i("a",{onClick:v=>n.convert(r,n.product),class:"text-sm text-info-secondary hover:underline border-dashed",href:"javascript:void(0)"},u(n.__("Convert")),9,gt)],64)):m("",!0)]),i("td",xt,u(n.nsCurrency(r.sale_price)),1),i("td",wt,u(n.nsCurrency(r.wholesale_price)),1),i("td",Ct,u(r.quantity),1)]))),128))])])):m("",!0),s.hasLoadedUnitQuantities?m("",!0):(l(),C(P,{key:1,size:"16",border:"4"}))]),_:1},8,["label"])]),_:1},8,["active"])])])])}const qt=U(dt,[["render",Qt]]),kt={name:"ns-drivers-status-popup",props:["popup","row","component"],methods:{__:a,popupCloser:Y,popupResolver:E,loadDriverStatusFields(){nsHttpClient.get("/api/fields/driver-status-fields").subscribe({next:e=>{this.loaded=!0,this.fields=this.validation.createFields(e)},error:e=>{this.loaded=!0,h.error(e.message),this.errorMessage=e.message}})},changeStatus(){this.validation.validateFields(this.fields)?Popup.show(w,{title:a("Confirm Your Action"),message:a("Are you sure you want to change the status of the driver?"),onAction:e=>{nsHttpClient.post(`/api/drivers/${this.row.id}/status`,this.validation.extractFields(this.fields)).subscribe({next:t=>{h.success(t.message),this.popupResolver(!0),this.component.$emit("reload")},error:t=>h.error(t.message)})}}):h.error(a("Make sure to choose a status for the driver."))}},data(){return{loaded:!1,validation:new I,fields:[],errorMessage:""}},mounted(){console.log(this.row),this.popupCloser(),this.loadDriverStatusFields()}},Ut={class:"shadow ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw]"},jt={class:"p-2 flex justify-between items-center ns-box-header border-b"},St={class:"ns-box-body"},Lt={key:0,class:"py-4 flex justify-center items-center"},At={key:2,class:"p-2"},Ft={class:"border-t ns-box-footer p-2 flex justify-end"};function Vt(e,t,o,d,s,n){const b=p("ns-close-button"),P=p("ns-spinner"),y=p("ns-notice"),_=p("ns-field"),r=p("ns-button");return l(),c("div",Ut,[i("div",jt,[i("h3",null,u(n.__("Driver: {name}").replace("{name}",o.row.username)),1),i("div",null,[f(b,{onClick:t[0]||(t[0]=v=>n.popupResolver(!1))})])]),i("div",St,[s.loaded?m("",!0):(l(),c("div",Lt,[f(P)])),s.errorMessage?(l(),C(y,{key:1,color:"error"},{description:x(()=>[Q(u(s.errorMessage),1)]),_:1})):(l(),c("div",At,[(l(!0),c(g,null,j(s.fields,v=>(l(),C(_,{field:v},null,8,["field"]))),256))]))]),i("div",Ft,[f(r,{onClick:t[1]||(t[1]=v=>n.changeStatus())},{default:x(()=>[Q(u(n.__("Change Status")),1)]),_:1})])])}const Mt=U(kt,[["render",Vt]]),F={nsOrderPreview:H,nsProductPreview:qt,nsAlertPopup:D,nsConfirmPopup:w,nsPromptPopup:N,nsMediaPopup:V,nsProcurementQuantity:R,nsOrdersRefund:B,nsSelectPopup:T,nsPOSLoadingPopup:O,nsDriversStatusPopup:Mt};for(let e in F)window[e]=F[e];const k=M({data(){return{popups:[],defaultClass:"absolute top-0 left-0 w-full h-full items-center flex overflow-y-auto justify-center is-popup"}},mounted(){nsState.subscribe(e=>{e.popups!==void 0&&(document.body.focus(),this.popups=G(e.popups),this.$forceUpdate())})},methods:{closePopup(e,t){(Object.values(t.target.classList).includes("is-popup")&&e.config!==void 0&&[void 0,!0].includes(e.config.closeOnOverlayClick)||Object.keys(e.config).length===0)&&(e.params&&typeof e.params.reject=="function"?(e.params.reject(!1),typeof e.close=="function"&&e.close(),t.stopPropagation()):e.close())},preventPropagation(e){e.stopImmediatePropagation()}}});for(let e in S)k.component(e,S[e]);document.addEventListener("DOMContentLoaded",()=>{k.mount("#dashboard-popups"),window.nsPopups=k});
