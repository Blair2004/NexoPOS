import{f as y,a as p,b as _}from"./bootstrap-f6f78c76.js";import{_ as b}from"./currency-47ec5b79.js";import{m as v}from"./npm~@vue~runtime-dom_-a668b91e.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import{f as w}from"./npm~rxjs-a7e91008.js";import{ae as P,a6 as o,z as l,A as n,az as j,y as d,F as u,ac as f,c as x}from"./npm~@vue~runtime-core_-ff0bdc0c.js";import{U as h,z as T}from"./npm~@vue~shared_-82b01912.js";import"./npm~lodash-f7a36ac5.js";import"./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js";import"./npm~laravel-echo-7ac8f47a.js";import"./npm~pusher-js-7b18aad5.js";import"./npm~axios-4a70c6fc.js";import"./npm~chart.js-3fed1729.js";import"./npm~moment-fbc5633a.js";import"./npm~vue-6a0d7c4c.js";import"./npm~@vue~compiler-dom_-04241bb4.js";import"./npm~@vue~compiler-core_-2a2ce8c7.js";import"./npm~@vue~reactivity_-481192b6.js";import"./npm~rx-1641e2f8.js";import"./npm~@wordpress~hooks_-18172e20.js";import"./npm~mathjs-1dff8408.js";import"./npm~@babel~runtime_-34ca84e8.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-15c479db.js";import"./npm~fraction.js-52b397f9.js";import"./npm~typed-function-e88d1f37.js";import"./npm~seedrandom-b246f2f9.js";import"./npm~javascript-natural-sort-11e7fc54.js";import"./npm~escape-latex-404addb9.js";import"./npm~numeral-faf61dd1.js";import"./npm~currency.js-57f74176.js";import"./npm~tslib-f3101d7c.js";const C={name:"ns-permissions",filters:[y],data(){return{permissions:[],toggled:!1,roles:[],searchText:""}},computed:{filteredPermissions(){return this.searchText.length!==0?this.permissions.filter(e=>{const s=new RegExp(this.searchText,"i");return s.test(e.name)||s.test(e.namespace)}):this.permissions}},mounted(){this.loadPermissionsAndRoles(),nsHotPress.create("ns-permissions").whenPressed("shift+/",e=>{this.$refs.search.focus(),setTimeout(()=>{this.searchText=""},5)}).whenPressed("/",e=>{this.$refs.search.focus(),setTimeout(()=>{this.searchText=""},5)})},methods:{__:b,async selectAllPermissions(e){const s=new Object;s[e.namespace]=new Object;let i=!1;if(e.locked&&(i=await new Promise((a,t)=>{Popup.show(nsConfirmPopup,{title:b("Confirm Your Action"),message:b("Would you like to bulk edit a system role ?"),onAction:c=>a(!!c)})})),!e.locked||e.locked&&i){const a=this.filterObjectByKeys(e.fields,this.filteredPermissions.map(t=>t.namespace));for(let t in a)e.fields[t].value=e.field.value,s[e.namespace][t]=e.field.value;this.arrayToObject(this.filteredPermissions,"namespace",t=>s[e.namespace][t.namespace]),p.put("/api/users/roles",s).subscribe(t=>{_.success(t.message,null,{duration:3e3}).subscribe()})}else e.field.value=!e.field.value},filterObjectByKeys(e,s){return Object.fromEntries(Object.entries(e).filter(([i])=>s.includes(i)))},arrayToObject(e,s,i){return Object.assign({},...e.map(a=>({[a[s]]:i(a)})))},submitPermissions(e,s){const i=new Object;i[e.namespace]=new Object,i[e.namespace][s.name]=s.value,p.put("/api/users/roles",i).subscribe(a=>{_.success(a.message,null,{duration:3e3}).subscribe()})},loadPermissionsAndRoles(){return w([p.get("/api/users/roles"),p.get("/api/users/permissions")]).subscribe(e=>{this.permissions=e[1],this.roles=e[0].map(s=>(s.fields={},s.field={type:"checkbox",name:s.namespace,value:!1},this.permissions.forEach(i=>{s.fields[i.namespace]={type:"checkbox",value:s.permissions.filter(a=>a.namespace===i.namespace).length>0,name:i.namespace,label:null}}),s))})}}},O={id:"permission-wrapper"},A={class:"my-2"},B=["placeholder"],z={class:"rounded shadow ns-box flex"},E={id:"permissions",class:"w- bg-gray-800 flex-shrink-0"},R={class:"h-24 py-4 px-2 border-b border-gray-700 text-gray-100 flex justify-between items-center"},V={key:0},N=n("i",{class:"las la-expand"},null,-1),D=[N],F=n("i",{class:"las la-compress"},null,-1),H=[F],K=["title"],S={key:0},U={key:1},J={class:"flex flex-auto overflow-hidden"},L={class:"overflow-y-auto"},M={class:"text-gray-700 flex"},W={class:"mx-1"},Y={class:"mx-1"};function q(e,s,i,a,t,c){const g=P("ns-checkbox");return o(),l("div",O,[n("div",A,[j(n("input",{ref:"search","onUpdate:modelValue":s[0]||(s[0]=r=>t.searchText=r),type:"text",placeholder:c.__('Press "/" to search permissions'),class:"border-2 p-2 w-full outline-none bg-input-background border-input-edge text-primary"},null,8,B),[[v,t.searchText]])]),n("div",z,[n("div",E,[n("div",R,[t.toggled?d("",!0):(o(),l("span",V,h(c.__("Permissions")),1)),n("div",null,[t.toggled?d("",!0):(o(),l("button",{key:0,onClick:s[1]||(s[1]=r=>t.toggled=!t.toggled),class:"rounded-full bg-white text-gray-700 h-6 w-6 flex items-center justify-center"},D)),t.toggled?(o(),l("button",{key:1,onClick:s[2]||(s[2]=r=>t.toggled=!t.toggled),class:"rounded-full bg-white text-gray-700 h-6 w-6 flex items-center justify-center"},H)):d("",!0)])]),(o(!0),l(u,null,f(c.filteredPermissions,r=>(o(),l("div",{key:r.id,class:T([t.toggled?"w-24":"w-54","p-2 border-b border-gray-700 text-gray-100"])},[n("a",{href:"javascript:void(0)",title:r.namespace},[t.toggled?d("",!0):(o(),l("span",S,h(r.name),1)),t.toggled?(o(),l("span",U,h(r.name),1)):d("",!0)],8,K)],2))),128))]),n("div",J,[n("div",L,[n("div",M,[(o(!0),l(u,null,f(t.roles,r=>(o(),l("div",{key:r.id,class:"h-24 py-4 px-2 w-56 items-center border-b justify-center flex role flex-shrink-0 border-r border-table-th-edge"},[n("p",W,[n("span",null,h(r.name),1)]),n("span",Y,[x(g,{onChange:m=>c.selectAllPermissions(r),field:r.field},null,8,["onChange","field"])])]))),128))]),(o(!0),l(u,null,f(c.filteredPermissions,r=>(o(),l("div",{key:r.id,class:"permission flex"},[(o(!0),l(u,null,f(t.roles,m=>(o(),l("div",{key:m.id,class:"border-b border-table-th-edge w-56 flex-shrink-0 p-2 flex items-center justify-center border-r"},[x(g,{onChange:G=>c.submitPermissions(m,m.fields[r.namespace]),field:m.fields[r.namespace]},null,8,["onChange","field"])]))),128))]))),128))])])])])}const Ce=k(C,[["render",q]]);export{Ce as default};
