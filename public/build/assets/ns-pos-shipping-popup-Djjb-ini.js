import{a as T,n as g,P as S,b as O,F as H,p as j}from"./bootstrap-DI8pXSaz.js";import{_ as h}from"./lang-BINodpp-.js";import{g as B,a as z,f as E,h as M,n as q}from"./ns-prompt-popup-CidREd5w.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,c as l,o as i,a as u,b as e,g as L,f as p,t as r,F as w,e as k,w as b,i as C,B as I,h as K,n as N}from"./runtime-core.esm-bundler-DUdZl5j1.js";import{w as Q,v as D}from"./runtime-dom.esm-bundler-BJBE8XOq.js";import{a as G}from"./ns-orders-preview-popup-5I9ocpmp.js";import{n as F}from"./currency-BCJk0SN4.js";const Y={name:"ns-pos-quantity-popup",props:["popup"],components:{nsNumpad:z,nsNumpadPlus:B},data(){return{finalValue:1,virtualStock:null,options:{},optionsSubscription:null,allSelected:!0,isLoading:!1}},beforeDestroy(){this.optionsSubscription.unsubscribe()},mounted(){this.optionsSubscription=POS.options.subscribe(o=>{this.options=o}),this.popup.params.product.quantity&&(this.finalValue=this.popup.params.product.quantity),this.popupCloser()},unmounted(){nsHotPress.destroy("pos-quantity-numpad"),nsHotPress.destroy("pos-quantity-backspace"),nsHotPress.destroy("pos-quantity-enter")},methods:{__:h,popupCloser:T,closePopup(){this.popup.params.reject(!1),this.popup.close()},updateQuantity(o){this.finalValue=o},defineQuantity(o){const{product:s,data:c}=this.popup.params;if(o===0)return g.error(h("Please provide a quantity"));if(s.$original().stock_management==="enabled"&&s.$original().type==="materialized"){const v=POS.getStockUsage(s.$original().id,c.unit_quantity_id)-(s.quantity||0);if(o>parseFloat(c.$quantities().quantity)-v)return g.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",c.$quantities().quantity-v))}this.resolve({quantity:o})},resolve(o){this.popup.params.resolve(o),this.popup.close()}}},J={class:"ns-box shadow min-h-[40vh] w-[75vw] md:w-[60vw] lg:w-[40vw] xl:w-[40vw] relative"},X={key:0,id:"loading-overlay",style:{background:"rgb(202 202 202 / 49%)"},class:"flex w-full h-full absolute top-O left-0 items-center justify-center"},Z={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},$={class:"text-xl font-bold text-fontcolor text-center"},ee={id:"screen",class:"h-24 primary ns-box-body flex items-center justify-center"},se={class:"font-bold text-3xl"};function te(o,s,c,v,n,t){const x=f("ns-spinner"),a=f("ns-close-button"),m=f("ns-numpad"),y=f("ns-numpad-plus");return i(),l("div",J,[n.isLoading?(i(),l("div",X,[p(x)])):u("",!0),e("div",Z,[e("div",null,[e("h1",$,r(t.__("Define Quantity")),1)]),e("div",null,[p(a,{onClick:s[0]||(s[0]=d=>t.closePopup())})])]),e("div",ee,[e("h1",se,r(n.finalValue),1)]),n.options.ns_pos_numpad==="default"?(i(),L(m,{key:1,floating:n.options.ns_pos_allow_decimal_quantities,onChanged:s[1]||(s[1]=d=>t.updateQuantity(d)),onNext:s[2]||(s[2]=d=>t.defineQuantity(d)),value:n.finalValue},null,8,["floating","value"])):u("",!0),n.options.ns_pos_numpad==="advanced"?(i(),L(y,{key:2,onChanged:s[3]||(s[3]=d=>t.updateQuantity(d)),onNext:s[4]||(s[4]=d=>t.defineQuantity(d)),value:n.finalValue},null,8,["value"])):u("",!0)])}const oe=V(Y,[["render",te]]);class Fn{constructor(s){this.product=s}run(s){return new Promise((c,v)=>{const n=this.product;if(POS.options.getValue().ns_pos_show_quantity!==!1||!POS.processingAddQueue)S.show(oe,{resolve:c,reject:v,product:n,data:s});else{if(n.$original().stock_management==="enabled"&&n.$original().type==="materialized"){const a=POS.getStockUsage(n.$original().id,s.unit_quantity_id)-(n.quantity||0);if(1>parseFloat(s.$quantities().quantity)-a)return g.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",(s.$quantities().quantity-a).toString()))}c({quantity:1})}})}}const ne={mounted(){this.closeWithOverlayClicked(),this.loadTransactionFields()},props:["popup"],data(){return{fields:[],isSubmiting:!1,formValidation:new H}},methods:{__:h,closeWithOverlayClicked:T,proceed(){const o=this.popup.params.customer,s=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,O.post(`/api/customers/${o.id}/account-history`,s).subscribe({next:c=>{this.isSubmiting=!1,g.success(c.message),this.popup.params.resolve(c),this.popup.close()},error:c=>{this.isSubmiting=!1,g.error(c.message),this.popup.params.reject(c)}})},close(){this.popup.close(),this.popup.params.reject(!1)},loadTransactionFields(){O.get("/api/fields/ns.customers-account").subscribe({next:o=>{this.fields=this.formValidation.createFields(o)}})}}},re={class:"w-[85.71vw] md:w-[71.43vw] lg:w-[57.14vw] h-[85vh] md:h-[80vh] lg:h-[75vh] overflow-hidden shadow-lg ns-box flex flex-col relative"},ie={class:"p-2 border-b ns-box-header flex justify-between items-center"},le={class:"font-semibold"},ce={class:"flex-auto overflow-y-auto"},ue={key:0,class:"h-full w-full flex items-center justify-center"},de={key:1,class:"p-2"},ae={class:"p-2 ns-box-footer justify-between border-t flex"},_e={class:"px-1"},pe={class:"-mx-2 flex flex-wrap"},he={class:"px-1"},fe={class:"px-1"},me={key:0,class:"h-full w-full absolute flex items-center justify-center",style:{background:"rgb(0 98 171 / 45%)"}};function be(o,s,c,v,n,t){const x=f("ns-close-button"),a=f("ns-spinner"),m=f("ns-field"),y=f("ns-button");return i(),l("div",re,[e("div",ie,[e("h2",le,r(t.__("New Transaction")),1),e("div",null,[p(x,{onClick:s[0]||(s[0]=d=>t.close())})])]),e("div",ce,[n.fields.length===0?(i(),l("div",ue,[p(a)])):u("",!0),n.fields.length>0?(i(),l("div",de,[(i(!0),l(w,null,k(n.fields,(d,P)=>(i(),L(m,{field:d,key:P},null,8,["field"]))),128))])):u("",!0)]),e("div",ae,[s[3]||(s[3]=e("div",null,null,-1)),e("div",_e,[e("div",pe,[e("div",he,[p(y,{type:"error",onClick:s[1]||(s[1]=d=>t.close())},{default:b(()=>[C(r(t.__("Close")),1)]),_:1})]),e("div",fe,[p(y,{type:"info",onClick:s[2]||(s[2]=d=>t.proceed())},{default:b(()=>[C(r(t.__("Proceed")),1)]),_:1})])])])]),n.isSubmiting===0?(i(),l("div",me,[p(a)])):u("",!0)])}const ve=V(ne,[["render",be]]),ye={name:"ns-pos-coupons-load-popup",props:["popup"],components:{nsNotice:E},data(){return{placeHolder:h("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,coupon:null}},mounted(){this.popupCloser(),this.orderSubscriber=POS.order.subscribe(o=>{this.order=K(o),this.order.coupons.length>0&&(this.activeTab="active-coupons")}),this.popup.params&&this.popup.params.apply_coupon&&(this.couponCode=this.popup.params.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:o=>{this.coupon=o,this.apply()}}))},unmounted(){this.orderSubscriber.unsubscribe()},methods:{__:h,popupCloser:T,popupResolver:j,selectCustomer(){Popup.show(U)},cancel(){this.coupon=null,this.couponCode=null},removeCoupon(o){this.order.coupons.splice(o,1),POS.refreshCart()},apply(){try{if(this.coupon.valid_hours_start!==null&&!ns.date.moment.isAfter(this.coupon.valid_hours_start)&&this.coupon.valid_hours_start.length>0)return g.error(h("The coupon is out from validity date range."));if(this.coupon.valid_hours_end!==null&&!ns.date.moment.isBefore(this.coupon.valid_hours_end)&&this.coupon.valid_hours_end.length>0)return g.error(h("The coupon is out from validity date range."));const o=this.coupon.products;if(o.length>0){const v=o.map(n=>n.product_id);if(this.order.products.filter(n=>v.includes(n.product_id)).length===0)return g.error(h("This coupon requires products that aren't available on the cart at the moment."))}const s=this.coupon.categories;if(s.length>0){const v=s.map(n=>n.category_id);if(this.order.products.filter(n=>v.includes(n.$original().category_id)).length===0)return g.error(h("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s"))}let c={customer_coupon_id:this.coupon.customer_coupon.length>0?this.coupon.customer_coupon[0].id:0,minimum_cart_value:this.coupon.minimum_cart_value,maximum_cart_value:this.coupon.maximum_cart_value,name:this.coupon.name,type:this.coupon.type,value:0,coupon_id:this.coupon.id,limit_usage:this.coupon.limit_usage,code:this.coupon.code,discount_value:this.coupon.discount_value,categories:this.coupon.categories,products:this.coupon.products};this.cancel(),POS.pushCoupon(c),this.activeTab="active-coupons",setTimeout(()=>{this.popupResolver(c)},500),g.success(h("The coupon has applied to the cart."))}catch(o){console.log(o)}},getCouponType(o){switch(o){case"percentage_discount":return h("Percentage");case"flat_discount":return h("Flat");default:return h("Unknown Type")}},getDiscountValue(o){switch(o.type){case"percentage_discount":return o.discount_value+"%";case"flat_discount":return this.$options.filters.currency(o.discount_value)}},closePopup(){this.popupResolver(!1)},setActiveTab(o){this.activeTab=o,o==="apply-coupon"&&setTimeout(()=>{document.querySelector(".coupon-field").select()},10)},getCoupon(o){return!this.order.customer_id>0?g.error(h("You must select a customer before applying a coupon.")):O.post(`/api/customers/coupons/${o}`,{customer_id:this.order.customer_id})},loadCoupon(){const o=this.couponCode;this.getCoupon(o).subscribe({next:s=>{this.coupon=s,g.success(h("The coupon has been loaded."))},error:s=>{g.error(s.message||h("An unexpected error occurred."))}})}}},xe={class:"shadow-lg ns-box w-95vw md:w-[50vw] lg:w-[33.33vw]"},ge={class:"border-b ns-box-header p-2 flex justify-between items-center"},we={class:"font-bold"},Ce={class:"p-1 ns-box-body"},ke={class:"border-2 input-group info rounded flex"},Pe=["placeholder"],Se={class:"pt-2"},Oe={key:0,class:"pt-2 flex"},Te={key:1,class:"pt-2"},Ve={class:"overflow-hidden"},je={key:0,class:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},Le={class:"w-full ns-table"},Ne={class:"p-2 w-1/2 border"},Ae={class:"p-2 w-1/2 border"},Fe={class:"p-2 w-1/2 border"},qe={class:"p-2 w-1/2 border"},Re={class:"p-2 w-1/2 border"},He={class:"p-2 w-1/2 border"},Ie={class:"p-2 w-1/2 border"},Qe={class:"p-2 w-1/2 border"},De={class:"p-2 w-1/2 border"},Ue={class:"p-2 w-1/2 border"},We={class:"p-2 w-1/2 border"},Be={class:"p-2 w-1/2 border"},ze={key:0},Ee={class:"p-2 w-1/2 border"},Me={class:"p-2 w-1/2 border"},Ke={key:0},Ge={key:0},Ye={class:"flex-auto"},Je={class:"font-semibold text-fontcolor p-2 flex justify-between"},Xe={key:0,class:"flex justify-between elevation-surface border items-center p-2"},Ze={key:0,class:"flex"};function $e(o,s,c,v,n,t){const x=f("ns-close-button"),a=f("ns-notice"),m=f("ns-tabs-item"),y=f("ns-tabs");return i(),l("div",xe,[e("div",ge,[e("h3",we,r(t.__("Load Coupon")),1),e("div",null,[p(x,{onClick:s[0]||(s[0]=d=>t.closePopup())})])]),e("div",Ce,[p(y,{onActive:s[5]||(s[5]=d=>t.setActiveTab(d)),active:n.activeTab},{default:b(()=>[p(m,{label:t.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"},{default:b(()=>[e("div",ke,[I(e("input",{ref:"coupon",onKeyup:s[1]||(s[1]=Q(d=>t.loadCoupon(),["enter"])),"onUpdate:modelValue":s[2]||(s[2]=d=>n.couponCode=d),type:"text",class:"coupon-field w-full text-fontcolor p-2 outline-hidden",placeholder:n.placeHolder},null,40,Pe),[[D,n.couponCode]]),e("button",{onClick:s[3]||(s[3]=d=>t.loadCoupon()),class:"px-3 py-2"},r(t.__("Load")),1)]),e("div",Se,[p(a,{color:"info"},{description:b(()=>[C(r(t.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")),1)]),_:1})]),n.order&&n.order.customer_id===void 0?(i(),l("div",Oe,[e("button",{onClick:s[4]||(s[4]=d=>t.selectCustomer()),class:"w-full border p-2 outline-hidden ns-numpad-key info cursor-pointer text-center"},r(t.__("Click here to choose a customer.")),1)])):u("",!0),n.order&&n.order.customer_id!==void 0?(i(),l("div",Te,[p(a,{color:"success"},{description:b(()=>[C(r(t.__("Loading Coupon For : ")+`${n.order.customer.first_name} ${n.order.customer.last_name}`),1)]),_:1})])):u("",!0),e("div",Ve,[n.coupon?(i(),l("div",je,[e("table",Le,[e("tbody",null,[e("tr",null,[e("td",Ne,r(t.__("Coupon Name")),1),e("td",Ae,r(n.coupon.name),1)]),e("tr",null,[e("td",Fe,r(t.__("Discount"))+" ("+r(t.getCouponType(n.coupon.type))+")",1),e("td",qe,r(t.getDiscountValue(n.coupon)),1)]),e("tr",null,[e("td",Re,r(t.__("Usage")),1),e("td",He,r((n.coupon.customer_coupon.length>0?n.coupon.customer_coupon[0].usage:0)+"/"+(n.coupon.limit_usage||t.__("Unlimited"))),1)]),e("tr",null,[e("td",Ie,r(t.__("Valid From")),1),e("td",Qe,r(n.coupon.valid_hours_start||t.__("N/A")),1)]),e("tr",null,[e("td",De,r(t.__("Valid Till")),1),e("td",Ue,r(n.coupon.valid_hours_end||t.__("N/A")),1)]),e("tr",null,[e("td",We,r(t.__("Categories")),1),e("td",Be,[e("ul",null,[(i(!0),l(w,null,k(n.coupon.categories,d=>(i(),l("li",{class:"rounded-full px-3 py-1 border",key:d.id},r(d.category.name),1))),128)),n.coupon.categories.length===0?(i(),l("li",ze,r(t.__("Not applicable")),1)):u("",!0)])])]),e("tr",null,[e("td",Ee,r(t.__("Products")),1),e("td",Me,[e("ul",null,[(i(!0),l(w,null,k(n.coupon.products,d=>(i(),l("li",{class:"rounded-full px-3 py-1 border",key:d.id},r(d.product.name),1))),128)),n.coupon.products.length===0?(i(),l("li",Ke,r(t.__("Not applicable")),1)):u("",!0)])])])])])])):u("",!0)])]),_:1},8,["label"]),p(m,{label:t.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"},{default:b(()=>[n.order?(i(),l("ul",Ge,[(i(!0),l(w,null,k(n.order.coupons,(d,P)=>(i(),l("li",{key:P,class:"flex justify-between elevation-surface border items-center px-2 py-1"},[e("div",Ye,[e("h3",Je,[e("span",null,r(d.name),1),e("span",null,r(t.getDiscountValue(d)),1)])]),e("div",null,[p(x,{onClick:A=>t.removeCoupon(P)},null,8,["onClick"])])]))),128)),n.order.coupons.length===0?(i(),l("li",Xe,r(t.__("No coupons applies to the cart.")),1)):u("",!0)])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])]),n.coupon?(i(),l("div",Ze,[e("button",{onClick:s[6]||(s[6]=d=>t.apply()),class:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold"},r(t.__("Apply")),1),e("button",{onClick:s[7]||(s[7]=d=>t.cancel()),class:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold"},r(t.__("Cancel")),1)])):u("",!0)])}const es=V(ye,[["render",$e]]),ss={name:"ns-pos-customers",props:["popup"],data(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],userCan:o=>POS.userCan(o),rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:M},unmounted(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted(){this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe(o=>{this.options=o}),this.subscription=POS.order.subscribe(o=>{this.order=o,this.popup.params.customer!==void 0?(this.activeTab="account-payment",this.customer=this.popup.params.customer,this.loadCustomerOrders()):o.customer!==void 0&&(this.activeTab="account-payment",this.customer=o.customer,this.loadCustomerOrders())}),this.popupCloser()},methods:{__:h,nsCurrency:F,reload(){this.loadCustomerOrders()},popupResolver:j,popupCloser:T,getWalletHistoryLabel(o){switch(o){case"add":return h("Crediting");case"deduct":return h("Removing");case"refund":return h("Refunding");case"payment":return h("Payment");default:return h("Unknow")}},getType(o){switch(o){case"percentage_discount":return h("Percentage Discount");case"flat_discount":return h("Flat Discount")}},closeWithOverlayClicked:T,async openOrderOptions(o){try{const s=await new Promise((c,v)=>{S.show(G,{order:o,resolve:c,reject:v})});this.reload()}catch{g.error(h("An error occurred while opening the order options"))}},doChangeTab(o){this.selectedTab=o,o==="coupons"&&this.loadCoupons(),o==="rewards"&&this.loadRewards(),o==="wallet-history"&&this.loadAccounHistory(),o==="orders"&&this.loadCustomerOrders()},loadAccounHistory(){this.isLoadingHistory=!0,O.get(`/api/customers/${this.customer.id}/account-history`).subscribe({next:o=>{this.walletHistories=o.data,this.isLoadingHistory=!1},error:o=>{this.isLoadingHistory=!1}})},loadCoupons(){this.isLoadingCoupons=!0,O.get(`/api/customers/${this.customer.id}/coupons`).subscribe({next:o=>{this.coupons=o,this.isLoadingCoupons=!1},error:o=>{this.isLoadingCoupons=!1}})},loadRewards(o=`/api/customers/${this.customer.id}/rewards`){this.isLoadingRewards=!0,O.get(o).subscribe({next:s=>{this.rewardsResponse=s,this.isLoadingRewards=!1},error:s=>{this.isLoadingRewards=!1}})},prefillForm(o){this.popup.params.name!==void 0&&(o.main.value=this.popup.params.name)},openCustomerSelection(){this.popup.close(o=>{S.show(U)})},loadCustomerOrders(){this.isLoadingOrders=!0,O.get(`/api/customers/${this.customer.id}/orders`).subscribe({next:o=>{this.orders=o,this.isLoadingOrders=!1},error:o=>{this.isLoadingOrders=!1}})},newTransaction(o){new Promise((c,v)=>{S.show(ve,{customer:o,resolve:c,reject:v})}).then(c=>{POS.loadCustomer(o.id).subscribe(v=>{POS.selectCustomer(v)})})},applyCoupon(o){this.order.customer===void 0?S.show(q,{title:h("Use Customer ?"),message:h("No customer is selected. Would you like to proceed with this customer ?"),onAction:s=>{s&&POS.selectCustomer(this.customer).then(c=>{this.proceedApplyingCoupon(o)})}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(o):this.order.customer.id!==this.customer.id&&S.show(q,{title:h("Change Customer ?"),message:h("Would you like to assign this customer to the ongoing order ?"),onAction:s=>{s&&POS.selectCustomer(this.customer).then(c=>{this.proceedApplyingCoupon(o)})}})},proceedApplyingCoupon(o){new Promise((s,c)=>{S.show(es,{apply_coupon:o.code,resolve:s,reject:c})}).then(s=>{this.popupResolver(!1)}).catch(s=>{})},handleSavedCustomer(o){g.success(o.message),POS.selectCustomer(o.data.entry),this.popup.close()}}},ts={id:"ns-pos-customers",class:"shadow-lg rounded-lg w-[95vw] h-[95vh] lg:w-[60vw] flex flex-col overflow-hidden"},os={class:"ns-header p-2 flex justify-between items-center border-b"},rs={class:"font-semibold"},is={class:"ns-body flex-auto flex p-2 overflow-y-auto"},ls={key:1,class:"h-full flex-col w-full flex items-center justify-center text-font"},cs={class:"font-medium text-2xl"},us={key:0,class:"flex-auto w-full flex items-center justify-center flex-col p-4"},ds={class:"font-medium text-2xl"},as={class:"my-2"},_s={key:1,class:"flex flex-col flex-auto"},ps={class:"flex-auto p-2 flex flex-col"},hs={class:"flex flex-wrap"},fs={class:"px-4 mb-4 w-full"},ms={class:"font-semibold"},bs={class:"flex flex-wrap ns-tab-cards -mx-2 w-full"},vs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ys={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},xs={class:"font-medium text-lg"},gs={class:"w-full flex justify-end"},ws={class:"font-bold"},Cs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ks={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},Ps={class:"font-medium text-lg"},Ss={class:"w-full flex justify-end"},Os={class:"font-bold"},Ts={class:"px-2 mb-4 w-full md:w-1/4 flex"},Vs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},js={class:"font-medium text-lg"},Ls={class:"w-full flex justify-end"},Ns={class:"font-bold"},As={class:"px-2 mb-4 w-full md:w-1/4 flex"},Fs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},qs={class:"font-medium text-lg"},Rs={class:"w-full flex justify-end"},Hs={class:"font-bold"},Is={class:"flex flex-auto flex-col overflow-hidden"},Qs={key:0,class:"flex-auto h-full justify-center flex items-center"},Ds={class:"py-2 w-full"},Us={class:"font-semibold text-font"},Ws={class:"flex-auto flex-col flex overflow-hidden"},Bs={class:"flex-auto overflow-y-auto"},zs={class:"table ns-table w-full"},Es={class:"text-fontcolor"},Ms={colspan:"3",width:"150",class:"p-2 border font-semibold"},Ks={width:"50",class:"p-2 border font-semibold"},Gs={class:"text-fontcolor"},Ys={key:0},Js={class:"border p-2 text-center",colspan:"4"},Xs={colspan:"3",class:"border p-2 text-center"},Zs={class:"flex flex-col items-start"},$s={class:"font-bold"},et={class:"md:-mx-2 w-full flex flex-col md:flex-row"},st={class:"md:px-2 flex items-start w-full md:w-1/4"},tt={class:"md:px-2 flex items-start w-full md:w-1/4"},ot={class:"md:px-2 flex items-start w-full md:w-1/4"},nt={class:"border p-2 text-center"},rt=["onClick"],it={class:"ml-1"},lt={key:0,class:"flex-auto h-full justify-center flex items-center"},ct={class:"py-2 w-full"},ut={class:"font-semibold text-font"},dt={class:"flex-auto flex-col flex overflow-hidden"},at={class:"flex-auto overflow-y-auto"},_t={class:"table ns-table w-full"},pt={class:"text-fontcolor"},ht={colspan:"3",width:"150",class:"p-2 border font-semibold"},ft={class:"text-fontcolor"},mt={key:0},bt={class:"border p-2 text-center",colspan:"3"},vt={colspan:"3",class:"border p-2 text-center"},yt={class:"flex flex-col items-start"},xt={class:"font-bold"},gt={class:"md:-mx-2 w-full flex flex-col md:flex-row"},wt={class:"md:px-2 flex items-start w-full md:w-1/3"},Ct={class:"md:px-2 flex items-start w-full md:w-1/3"},kt={key:0,class:"flex-auto h-full justify-center flex items-center"},Pt={class:"py-2 w-full"},St={class:"font-semibold text-font"},Ot={class:"flex-auto flex-col flex overflow-hidden"},Tt={class:"flex-auto overflow-y-auto"},Vt={class:"table ns-table w-full"},jt={class:"text-fontcolor"},Lt={width:"150",class:"p-2 border font-semibold"},Nt={class:"p-2 border font-semibold"},At={class:"text-fontcolor text-sm"},Ft={key:0},qt={class:"border p-2 text-center",colspan:"4"},Rt={width:"300",class:"border p-2"},Ht={class:""},It={class:"-mx-2 flex"},Qt={class:"text-xs text-fontcolor px-2"},Dt={class:"text-xs text-fontcolor px-2"},Ut={class:"border p-2 text-center"},Wt={key:0},Bt={key:1},zt={class:"border p-2 text-right"},Et={key:0,class:"flex-auto h-full justify-center flex items-center"},Mt={class:"py-2 w-full"},Kt={class:"font-semibold text-font"},Gt={class:"flex-auto flex-col flex overflow-hidden"},Yt={class:"flex-auto overflow-y-auto"},Jt={class:"table ns-table w-full"},Xt={class:"text-fontcolor"},Zt={width:"150",class:"p-2 border font-semibold"},$t={class:"p-2 border font-semibold"},eo={class:"p-2 border font-semibold"},so={key:0,class:"text-fontcolor text-sm"},to={key:0},oo={class:"border p-2 text-center",colspan:"4"},no={width:"300",class:"border p-2"},ro={class:"text-center"},io={width:"300",class:"border p-2"},lo={class:"text-center"},co={width:"300",class:"border p-2"},uo={class:"text-center"},ao={class:"py-1 flex justify-end"},_o={class:"p-2 border-t border-box-edge flex justify-between"};function po(o,s,c,v,n,t){const x=f("ns-close-button"),a=f("ns-crud-form"),m=f("ns-tabs-item"),y=f("ns-button"),d=f("ns-spinner"),P=f("ns-paginate"),A=f("ns-tabs");return i(),l("div",ts,[e("div",os,[e("h3",rs,r(t.__("Customers")),1),e("div",null,[p(x,{onClick:s[0]||(s[0]=_=>c.popup.close())})])]),e("div",is,[p(A,{active:n.activeTab,onActive:s[7]||(s[7]=_=>n.activeTab=_)},{default:b(()=>[p(m,{identifier:"create-customers",label:t.__("New Customer")},{default:b(()=>[n.userCan("nexopos.create.customers")?(i(),L(a,{key:0,onUpdated:s[1]||(s[1]=_=>t.prefillForm(_)),onSave:s[2]||(s[2]=_=>t.handleSavedCustomer(_)),"submit-url":"/api/crud/ns.customers",src:"/api/crud/ns.customers/form-config"},{title:b(()=>[C(r(t.__("Customer Name")),1)]),save:b(()=>[C(r(t.__("Save Customer")),1)]),_:1})):u("",!0),n.userCan("nexopos.create.customers")?u("",!0):(i(),l("div",ls,[s[8]||(s[8]=e("i",{class:"lar la-hand-paper ns-icon text-6xl"},null,-1)),e("h3",cs,r(t.__("Not Authorized")),1),e("p",null,r(t.__("Creating customers has been explicitly disabled from the settings.")),1)]))]),_:1},8,["label"]),p(m,{identifier:"account-payment",label:t.__("Customer Account"),class:"flex",padding:"p-0 flex"},{default:b(()=>[n.customer===null?(i(),l("div",us,[s[9]||(s[9]=e("i",{class:"lar la-frown text-6xl"},null,-1)),e("h3",ds,r(t.__("No Customer Selected")),1),e("p",null,r(t.__("In order to see a customer account, you need to select one customer.")),1),e("div",as,[p(y,{onClick:s[3]||(s[3]=_=>t.openCustomerSelection()),type:"info"},{default:b(()=>[C(r(t.__("Select Customer")),1)]),_:1})])])):u("",!0),n.customer?(i(),l("div",_s,[e("div",ps,[e("div",hs,[e("div",fs,[e("h2",ms,r(t.__("Summary For"))+" : "+r(n.customer.first_name),1)]),e("div",bs,[e("div",vs,[e("div",ys,[e("h3",xs,r(t.__("Purchases")),1),e("div",gs,[e("h2",ws,r(t.nsCurrency(n.customer.purchases_amount)),1)])])]),e("div",Cs,[e("div",ks,[e("h3",Ps,r(t.__("Owed")),1),e("div",Ss,[e("h2",Os,r(t.nsCurrency(n.customer.owed_amount)),1)])])]),e("div",Ts,[e("div",Vs,[e("h3",js,r(t.__("Wallet Amount")),1),e("div",Ls,[e("h2",Ns,r(t.nsCurrency(n.customer.account_amount)),1)])])]),e("div",As,[e("div",Fs,[e("h3",qs,r(t.__("Credit Limit")),1),e("div",Rs,[e("h2",Hs,r(t.nsCurrency(n.customer.credit_limit_amount)),1)])])])])]),e("div",Is,[p(A,{active:n.selectedTab,onChangeTab:s[5]||(s[5]=_=>t.doChangeTab(_))},{default:b(()=>[p(m,{identifier:"orders",label:t.__("Orders")},{default:b(()=>[n.isLoadingOrders?(i(),l("div",Qs,[p(d,{size:"36"})])):u("",!0),n.isLoadingOrders?u("",!0):(i(),l(w,{key:1},[e("div",Ds,[e("h2",Us,r(t.__("Last Purchases")),1)]),e("div",Ws,[e("div",Bs,[e("table",zs,[e("thead",null,[e("tr",Es,[e("th",Ms,r(t.__("Order")),1),e("th",Ks,r(t.__("Options")),1)])]),e("tbody",Gs,[n.orders.length===0?(i(),l("tr",Ys,[e("td",Js,r(t.__("No orders...")),1)])):u("",!0),(i(!0),l(w,null,k(n.orders,_=>(i(),l("tr",{key:_.id},[e("td",Xs,[e("div",Zs,[e("h3",$s,r(t.__("Code"))+": "+r(_.code),1),e("div",et,[e("div",st,[e("small",null,r(t.__("Total"))+": "+r(t.nsCurrency(_.total)),1)]),e("div",tt,[e("small",null,r(t.__("Status"))+": "+r(_.human_status),1)]),e("div",ot,[e("small",null,r(t.__("Delivery"))+": "+r(_.human_delivery_status),1)])])])]),e("td",nt,[e("button",{onClick:W=>t.openOrderOptions(_),class:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success"},[s[10]||(s[10]=e("i",{class:"las la-wallet"},null,-1)),e("span",it,r(t.__("Options")),1)],8,rt)])]))),128))])])])])],64))]),_:1},8,["label"]),p(m,{identifier:"wallet-history",label:t.__("Wallet History")},{default:b(()=>[n.isLoadingHistory?(i(),l("div",lt,[p(d,{size:"36"})])):u("",!0),n.isLoadingHistory?u("",!0):(i(),l(w,{key:1},[e("div",ct,[e("h2",ut,r(t.__("Wallet History")),1)]),e("div",dt,[e("div",at,[e("table",_t,[e("thead",null,[e("tr",pt,[e("th",ht,r(t.__("Transaction")),1)])]),e("tbody",ft,[n.walletHistories.length===0?(i(),l("tr",mt,[e("td",bt,r(t.__("No History...")),1)])):u("",!0),(i(!0),l(w,null,k(n.walletHistories,_=>(i(),l("tr",{key:_.id},[e("td",vt,[e("div",yt,[e("h3",xt,r(t.__("Transaction"))+": "+r(t.getWalletHistoryLabel(_.operation)),1),e("div",gt,[e("div",wt,[e("small",null,r(t.__("Amount"))+": "+r(t.nsCurrency(o.amount)),1)]),e("div",Ct,[e("small",null,r(t.__("Date"))+": "+r(_.created_at),1)])])])])]))),128))])])])])],64))]),_:1},8,["label"]),p(m,{identifier:"coupons",label:t.__("Coupons")},{default:b(()=>[n.isLoadingCoupons?(i(),l("div",kt,[p(d,{size:"36"})])):u("",!0),n.isLoadingCoupons?u("",!0):(i(),l(w,{key:1},[e("div",Pt,[e("h2",St,r(t.__("Coupons")),1)]),e("div",Ot,[e("div",Tt,[e("table",Vt,[e("thead",null,[e("tr",jt,[e("th",Lt,r(t.__("Name")),1),e("th",Nt,r(t.__("Type")),1),s[11]||(s[11]=e("th",{class:"p-2 border font-semibold"},null,-1))])]),e("tbody",At,[n.coupons.length===0?(i(),l("tr",Ft,[e("td",qt,r(t.__("No coupons for the selected customer...")),1)])):u("",!0),(i(!0),l(w,null,k(n.coupons,_=>(i(),l("tr",{key:_.id},[e("td",Rt,[e("h3",null,r(_.name),1),e("div",Ht,[e("ul",It,[e("li",Qt,r(t.__("Usage :"))+" "+r(_.usage)+"/"+r(_.limit_usage),1),e("li",Dt,r(t.__("Code :"))+" "+r(_.code),1)])])]),e("td",Ut,[C(r(t.getType(_.coupon.type))+" ",1),_.coupon.type==="percentage_discount"?(i(),l("span",Wt," ("+r(_.coupon.discount_value)+"%) ",1)):u("",!0),_.coupon.type==="flat_discount"?(i(),l("span",Bt," ("+r(t.nsCurrency(o.value))+") ",1)):u("",!0)]),e("td",zt,[p(y,{onClick:W=>t.applyCoupon(_),type:"info"},{default:b(()=>[C(r(t.__("Use Coupon")),1)]),_:1},8,["onClick"])])]))),128))])])])])],64))]),_:1},8,["label"]),p(m,{identifier:"rewards",label:t.__("Rewards")},{default:b(()=>[n.isLoadingRewards?(i(),l("div",Et,[p(d,{size:"36"})])):u("",!0),n.isLoadingRewards?u("",!0):(i(),l(w,{key:1},[e("div",Mt,[e("h2",Kt,r(t.__("Rewards")),1)]),e("div",Gt,[e("div",Yt,[e("table",Jt,[e("thead",null,[e("tr",Xt,[e("th",Zt,r(t.__("Name")),1),e("th",$t,r(t.__("Points")),1),e("th",eo,r(t.__("Target")),1)])]),n.rewardsResponse.data?(i(),l("tbody",so,[n.rewardsResponse.data.length===0?(i(),l("tr",to,[e("td",oo,r(t.__("No rewards available the selected customer...")),1)])):u("",!0),(i(!0),l(w,null,k(n.rewardsResponse.data,_=>(i(),l("tr",{key:_.id},[e("td",no,[e("h3",ro,r(_.reward_name),1)]),e("td",io,[e("h3",lo,r(_.points),1)]),e("td",co,[e("h3",uo,r(_.target),1)])]))),128))])):u("",!0)])])]),e("div",ao,[p(P,{pagination:n.rewardsResponse,onLoad:s[4]||(s[4]=_=>t.loadRewards(_))},null,8,["pagination"])])],64))]),_:1},8,["label"])]),_:1},8,["active"])])]),e("div",_o,[s[12]||(s[12]=e("div",null,null,-1)),e("div",null,[p(y,{onClick:s[6]||(s[6]=_=>t.newTransaction(n.customer)),type:"info"},{default:b(()=>[C(r(t.__("Account Transaction")),1)]),_:1})])])])):u("",!0)]),_:1},8,["label"])]),_:1},8,["active"])])])}const R=V(ss,[["render",po]]),ho={props:["popup"],data(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected(){return!1}},watch:{searchCustomerValue(o){clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout(()=>{this.searchCustomer(o)},500)}},mounted(){this.orderSubscription=POS.order.subscribe(o=>{this.order=o}),this.getRecentCustomers(),this.$refs.searchField.focus(),this.popupCloser()},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:h,popupCloser:T,nsCurrency:F,resolveIfQueued:j,attemptToChoose(){if(this.customers.length===1)return this.selectCustomer(this.customers[0]);g.info(h("Too many results."))},openCustomerHistory(o,s){s.stopImmediatePropagation(),this.popup.close(),S.show(R,{customer:o,activeTab:"account-payment"})},selectCustomer(o){this.customers.forEach(s=>s.selected=!1),o.selected=!0,this.isLoading=!0,POS.selectCustomer(o).then(s=>{this.isLoading=!1,this.resolveIfQueued(o)}).catch(s=>{this.isLoading=!1})},searchCustomer(o){O.post("/api/customers/search",{search:o}).subscribe(s=>{s.forEach(c=>c.selected=!1),this.customers=s})},createCustomerWithMatch(o){this.resolveIfQueued(!1),S.show(R,{name:o})},getRecentCustomers(){this.isLoading=!0,O.get("/api/customers/recently-active").subscribe({next:o=>{this.isLoading=!1,o.forEach(s=>s.selected=!1),this.customers=o},error:o=>{this.isLoading=!1}})}}},fo={id:"ns-pos-customer-select-popup",class:"ns-box shadow-xl w-[80vw] md:w-[40vw] xl:w-108"},mo={id:"header",class:"border-b ns-box-header text-center font-semibold text-2xl py-2"},bo={class:"relative"},vo={class:"p-2 border-b ns-box-body items-center flex justify-between"},yo={class:"flex items-center justify-between"},xo={class:"p-2 border-b ns-box-body flex justify-between text-font"},go={class:"input-group flex-auto border-2 rounded"},wo={class:"h-[60vh] xl:h-[60vh] overflow-y-auto ns-scrollbar"},Co={class:"ns-vertical-menu"},ko={key:0,class:"p-2 text-center text-font"},Po={class:"border-b border-dashed border-info-primary"},So=["onClick"],Oo={class:"flex flex-col"},To={key:0,class:"text-xs text-fontcolor-soft"},Vo={key:1,class:"text-xs text-fontcolor-soft"},jo={class:"flex items-center"},Lo={key:0,class:"text-error-primary"},No={key:1},Ao={class:"purchase-amount"},Fo=["onClick"],qo={key:0,class:"z-10 top-0 absolute w-full h-full flex items-center justify-center"};function Ro(o,s,c,v,n,t){const x=f("ns-spinner");return i(),l("div",fo,[e("div",mo,[e("h2",null,r(t.__("Select Customer")),1)]),e("div",bo,[e("div",vo,[e("span",null,r(t.__("Selected"))+" : ",1),e("div",yo,[e("span",null,r(n.order.customer?`${n.order.customer.first_name} ${n.order.customer.last_name}`:"N/A"),1),n.order.customer?(i(),l("button",{key:0,onClick:s[0]||(s[0]=a=>t.openCustomerHistory(n.order.customer,a)),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent"},[...s[4]||(s[4]=[e("i",{class:"las la-eye"},null,-1)])])):u("",!0)])]),e("div",xo,[e("div",go,[I(e("input",{ref:"searchField",onKeydown:s[1]||(s[1]=Q(a=>t.attemptToChoose(),["enter"])),"onUpdate:modelValue":s[2]||(s[2]=a=>n.searchCustomerValue=a),placeholder:"Search Customer",type:"text",class:"outline-hidden w-full p-2"},null,544),[[D,n.searchCustomerValue]])])]),e("div",wo,[e("ul",Co,[n.customers&&n.customers.length===0?(i(),l("li",ko,r(t.__("No customer match your query...")),1)):u("",!0),n.customers&&n.customers.length===0?(i(),l("li",{key:1,onClick:s[3]||(s[3]=a=>t.createCustomerWithMatch(n.searchCustomerValue)),class:"p-2 cursor-pointer text-center text-font"},[e("span",Po,r(t.__("Create a customer")),1)])):u("",!0),(i(!0),l(w,null,k(n.customers,a=>(i(),l("li",{onClick:m=>t.selectCustomer(a),key:a.id,class:"cursor-pointer p-2 border-b text-fontcolor flex justify-between items-center"},[e("div",Oo,[e("span",null,r(a.first_name)+" "+r(a.last_name),1),a.group?(i(),l("small",To,r(a.group.name),1)):(i(),l("small",Vo,r(t.__("No Group Assigned")),1))]),e("p",jo,[a.owe_amount>0?(i(),l("span",Lo,"-"+r(t.nsCurrency(a.owe_amount)),1)):u("",!0),a.owe_amount>0?(i(),l("span",No,"/")):u("",!0),e("span",Ao,r(t.nsCurrency(a.purchases_amount)),1),e("button",{onClick:m=>t.openCustomerHistory(a,m),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info"},[...s[5]||(s[5]=[e("i",{class:"las la-eye"},null,-1)])],8,Fo)])],8,So))),128))])]),n.isLoading?(i(),l("div",qo,[p(x,{size:"24",border:"8"})])):u("",!0)])])}const U=V(ho,[["render",Ro]]),Ho={name:"ns-pos-discount-popup",props:["popup"],data(){return{finalValue:1,virtualStock:null,popupSubscription:null,mode:"",type:"",allSelected:!0,isLoading:!1,keys:[...[7,8,9].map(o=>({identifier:o,value:o})),...[4,5,6].map(o=>({identifier:o,value:o})),...[1,2,3].map(o=>({identifier:o,value:o})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}]}},mounted(){this.mode=this.popup.params.reference.discount_type||"percentage",this.type=this.popup.params.type,this.mode==="percentage"?this.finalValue=this.popup.params.reference.discount_percentage||1:this.finalValue=this.popup.params.reference.discount||1,this.popupCloser()},methods:{__:h,nsCurrency:F,popupResolver:j,popupCloser:T,submitValue(){this.popup.params.onSubmit({discount_type:this.mode,discount_percentage:this.mode==="percentage"?this.finalValue:void 0,discount:this.mode==="flat"?this.finalValue:void 0}),this.popup.close()},setPercentageType(o){this.mode=o},closePopup(){this.popup.close()},inputValue(o){this.finalValue=o}}},Io={id:"discount-popup",class:"ns-box shadow w-[85.71vw] md:w-[60vw] lg:w-[60vw] xl:w-[40vw] relative"},Qo={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},Do={key:0,class:"text-xl font-bold text-fontcolor text-center"},Uo={key:1,class:"text-xl font-bold text-fontcolor text-center"},Wo={id:"screen",class:"h-16 ns-box-body text-white flex items-center justify-center"},Bo={class:"font-bold text-3xl"},zo={key:0},Eo={key:1},Mo={id:"switch-mode",class:"flex"},Ko={key:1,class:"border-r border-box-edge"};function Go(o,s,c,v,n,t){const x=f("ns-close-button"),a=f("ns-numpad");return i(),l("div",Io,[e("div",Qo,[e("div",null,[n.type==="product"?(i(),l("h1",Do,r(t.__("Product Discount")),1)):u("",!0),n.type==="cart"?(i(),l("h1",Uo,r(t.__("Cart Discount")),1)):u("",!0)]),e("div",null,[p(x,{onClick:s[0]||(s[0]=m=>t.closePopup())})])]),e("div",Wo,[e("h1",Bo,[n.mode==="flat"?(i(),l("span",zo,r(t.nsCurrency(n.finalValue)),1)):u("",!0),n.mode==="percentage"?(i(),l("span",Eo,r(n.finalValue)+"%",1)):u("",!0)])]),e("div",Mo,[c.popup.params.reference.disable_flat?u("",!0):(i(),l("button",{key:0,onClick:s[1]||(s[1]=m=>t.setPercentageType("flat")),class:N([n.mode==="flat"?"bg-tab-active":"bg-tab-inactive text-secondary","outline-hidden w-1/2 py-2 flex items-center justify-center"])},r(t.__("Flat")),3)),c.popup.params.reference.disable_flat?u("",!0):(i(),l("hr",Ko)),c.popup.params.reference.disable_percentage?u("",!0):(i(),l("button",{key:2,onClick:s[2]||(s[2]=m=>t.setPercentageType("percentage")),class:N([(n.mode==="percentage"?"bg-tab-active":"bg-tab-inactive text-secondary")+" "+(c.popup.params.reference.disable_flat?"w-full":"w-1/2"),"outline-hidden py-2 flex items-center justify-center"])},r(t.__("Percentage")),3))]),p(a,{floating:!0,onNext:s[3]||(s[3]=m=>t.submitValue()),onChanged:s[4]||(s[4]=m=>t.inputValue(m)),value:n.finalValue,limit:"1000"},null,8,["value"])])}const qn=V(Ho,[["render",Go]]),Yo={data(){return{types:[],settingsSubscription:null,urls:{}}},props:["popup"],mounted(){this.settingsSubscription=POS.settings.subscribe(o=>{this.urls=o.urls}),this.types=POS.types.getValue(),Object.values(this.types).length===1&&this.select(Object.keys(this.types)[0]),this.popupCloser()},methods:{__:h,popupCloser:T,popupResolver:j,resolveIfQueued:j,async select(o){Object.values(this.types).forEach(c=>c.selected=!1),this.types[o].selected=!0;const s=this.types[o];await POS.triggerOrderTypeSelection(s),POS.types.next(this.types),this.resolveIfQueued(s)}}},Jo={id:"ns-order-type",class:"h-full w-[80vw] md:w-[40vw] lg:w-[40vw] xl:w-[33.33vw] ns-box"},Xo={id:"header",class:"h-16 flex justify-center items-center"},Zo={class:"font-bold"},$o={key:0,class:"ns-box-body grid grid-flow-row grid-cols-1 grid-rows-1"},en={class:"h-full w-full flex items-center justify-center flex-col"},sn={class:"p-4 md:w-2/3"},tn={class:"text-center"},on={class:"flex justify-center mt-4 mb-2 -mx-2"},nn={class:"px-2"},rn={class:"px-2"},ln={key:1,class:"ns-box-body grid grid-flow-row grid-cols-2 grid-rows-2"},cn=["onClick"],un=["src"],dn={class:"font-semibold text-xl my-2"};function an(o,s,c,v,n,t){const x=f("ns-link");return i(),l("div",Jo,[e("div",Xo,[e("h3",Zo,r(t.__("Define The Order Type")),1)]),Object.values(n.types).length===0?(i(),l("div",$o,[e("div",en,[s[0]||(s[0]=e("i",{class:"las la-frown text-7xl text-error-tertiary"},null,-1)),e("div",sn,[e("p",tn,r(t.__("No payment type has been selected on the settings. Please check your POS features and choose the supported order type")),1),e("div",on,[e("div",nn,[p(x,{target:"_blank",type:"info",href:"https://my.nexopos.com/en/documentation/components/order-types"},{default:b(()=>[C(r(t.__("Read More")),1)]),_:1})]),e("div",rn,[p(x,{target:"_blank",type:"info",href:n.urls.order_type_url},{default:b(()=>[C(r(t.__("Configure")),1)]),_:1},8,["href"])])])])])])):u("",!0),Object.values(n.types).length>0?(i(),l("div",ln,[(i(!0),l(w,null,k(n.types,a=>(i(),l("div",{onClick:m=>t.select(a.identifier),key:a.identifier,class:N([a.selected?"active":"","ns-numpad-key h-56 flex items-center justify-center flex-col cursor-pointer border"])},[e("img",{src:a.icon,alt:"",class:"w-32 h-32"},null,8,un),e("span",dn,r(a.label),1)],10,cn))),128))])):u("",!0)])}const Rn=V(Yo,[["render",an]]),_n={name:"ns-pos-shipping-popup",props:["popup"],computed:{activeTabFields(){if(this.tabs!==null){for(let o in this.tabs)if(this.tabs[o].active)return this.tabs[o].fields}return[]},useBillingInfo(){return this.tabs!==null?this.tabs.billing.fields[0].value:new Object},useShippingInfo(){return this.tabs!==null?this.tabs.shipping.fields[0].value:new Object}},unmounted(){this.orderSubscription.unsubscribe()},mounted(){this.orderSubscription=POS.order.subscribe(o=>this.order=o),this.popupCloser(),this.loadForm()},data(){return{tabs:null,orderSubscription:null,order:null,formValidation:new H}},watch:{useBillingInfo(o){o===1&&this.order.customer&&this.tabs.billing.fields.forEach(s=>{s.name!=="_use_customer_billing"&&(s.value=this.order.customer.billing?this.order.customer.billing[s.name]:s.value)})},useShippingInfo(o){o===1&&this.order.customer&&this.tabs.shipping.fields.forEach(s=>{s.name!=="_use_customer_shipping"&&(s.value=this.order.customer.shipping?this.order.customer.shipping[s.name]:s.value)})}},methods:{__,popupCloser:T,resolveIfQueued:j,submitInformations(){if(this.formValidation.validateForm({tabs:this.tabs}).length>0){g.error(__("Please correct the errors in the form"));return}const s=this.formValidation.extractForm({tabs:this.tabs});for(let c in s.general)["shipping","shipping_rate"].includes(c)&&(s.general[c]=parseFloat(s.general[c]));this.order={...this.order,...s.general},delete s.general,delete s.shipping._use_customer_shipping,delete s.billing._use_customer_billing,this.order.addresses=s,POS.order.next(this.order),POS.refreshCart(),this.resolveIfQueued(!0)},closePopup(){this.resolveIfQueued(!1)},toggle(o){for(let s in this.tabs)this.tabs[s].active=!1;this.tabs[o].active=!0},loadForm(){nsHttpClient.get("/api/forms/ns.pos-addresses").subscribe(({tabs:o})=>{for(let s in o)s==="general"?o[s].fields.forEach(c=>{c.value=this.order[c.name]||(/\d/.test(c.value)||c.value.length>0?c.value:"")}):o[s].fields.forEach(c=>{c.value=this.order.addresses[s]?this.order.addresses[s][c.name]:""});this.tabs=this.formValidation.initializeTabs(o)})}}},pn={class:"ns-box w-[85.71vw] md:w-[80vw] lg:w-[60vw] h-[85vh] md:h-[80vh] shadow-lg flex flex-col overflow-hidden"},hn={class:"p-2 border-b ns-box-header flex justify-between items-center"},fn={class:"font-bold text-font"},mn={class:"tools"},bn={class:"flex-auto ns-box-body p-2 overflow-y-auto ns-tab"},vn={id:"tabs-container"},yn={class:"header flex",style:{"margin-bottom":"-1px"}},xn=["onClick"],gn={class:"ns-tab-item"},wn={class:"px-4 border"},Cn={class:"-mx-4 flex flex-wrap"},kn={class:"p-2 flex justify-between border-t ns-box-footer"};function Pn(o,s,c,v,n,t){const x=f("ns-notice"),a=f("ns-field"),m=f("ns-button");return i(),l("div",pn,[e("div",hn,[e("h3",fn,r(t.__("Shipping & Billing")),1),e("div",mn,[e("button",{onClick:s[0]||(s[0]=y=>t.closePopup()),class:"ns-close-button rounded-full h-8 w-8 border items-center justify-center"},[...s[2]||(s[2]=[e("i",{class:"las la-times"},null,-1)])])])]),e("div",bn,[n.order!=null&&!n.order.customer?(i(),L(x,{key:0,class:"mb-2"},{title:b(()=>[C(r(t.__("No customer is selected")),1)]),description:b(()=>[C(r(t.__("Please select a customer before proceeding")),1)]),_:1})):u("",!0),e("div",vn,[e("div",yn,[(i(!0),l(w,null,k(n.tabs,(y,d)=>(i(),l("div",{key:d,onClick:P=>t.toggle(d),class:N([y.active?"border-b-0 active":"inactive","tab rounded-tl rounded-tr border tab px-3 py-2 text-fontcolor cursor-pointer"]),style:{"margin-right":"-1px"}},r(y.label),11,xn))),128))]),e("div",gn,[e("div",wn,[e("div",Cn,[(i(!0),l(w,null,k(t.activeTabFields,(y,d)=>(i(),l("div",{key:d,class:N("p-4 w-full md:w-1/2 lg:w-1/3")},[p(a,{onBlur:P=>n.formValidation.checkField(y),onChange:P=>n.formValidation.checkField(y),field:y},null,8,["onBlur","onChange","field"])]))),128))])])])])]),e("div",kn,[s[3]||(s[3]=e("div",null,null,-1)),e("div",null,[p(m,{onClick:s[1]||(s[1]=y=>t.submitInformations()),type:"info"},{default:b(()=>[C(r(t.__("Save")),1)]),_:1})])])])}const Hn=V(_n,[["render",Pn]]);export{R as N,Fn as P,qn as a,Rn as b,Hn as c,es as d,U as n};
