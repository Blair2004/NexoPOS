import{G as v,d as u,f}from"./bootstrap-DbyJYEXV.js";import"./index.es-ua9LYOjR.js";import{N as _,n as g}from"./ns-prompt-popup-WYgvScdg.js";import{i as x}from"./components-C1ZaJ_TG.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as p,c as h,F as b,b as C,a as o,t as c,i as m}from"./runtime-core.esm-bundler-DzqFO6Tt.js";import"./currency-Dtag6qPd.js";import"./chart-D2s_fKm5.js";import"./ns-avatar-image-CIpC3xeh.js";const k={data(){return{rules:[],accounts:[],actions:[]}},mounted(){v([this.loadAccounts(),this.loadActions(),this.loadRules()]).subscribe({next:e=>{this.accounts=e[0],this.actions=e[1],this.rules=e[2]},error:e=>{u.error(e.message).subscribe()}})},methods:{__,loadRules(){return nsHttpClient.get("/api/transactions/rules")},addNewRule(){this.rules.push({on:"",action:"increase",account_id:"",do:"decrease",offset_account_id:""})},getActionName(e){return this.actions[e]||__("Not Defined")},async setRuleAction(e,t){if(this.actions.length===0)return u.error(__("No actions available").subscribe());try{e[t]=await new Promise((n,a)=>{const i=Object.keys(this.actions);Popup.show(_,{label:__("Choose Action"),description:__("Choose the action you want to perform."),options:Object.values(this.actions).map((s,r)=>({label:s,value:i[r]})),resolve:n,reject:a})})}catch{}},saveRule(e){nsHttpClient.post("/api/transactions/rules",{rule:e}).subscribe({next:t=>{t.status==="success"&&(e.id=t.data.id,f.success(__("Save Completed"),__("The rule has been saved successfully")))},error:t=>{u.error(t.message).subscribe()}})},getAccountName(e){var t;return((t=this.accounts.find(n=>n.id===e))==null?void 0:t.name)||__("Not Defined")},loadActions(){return nsHttpClient.get("/api/transactions-accounts/actions")},loadAccounts(){return nsHttpClient.get("/api/transactions-accounts")},async changeTransactionType(e,t){try{e[t]=await new Promise((n,a)=>{Popup.show(_,{label:__("Transaction Type"),description:__("Choose the transaction type you want to perform"),options:[{label:__("Increase"),value:"increase"},{label:__("Decrease"),value:"decrease"}],resolve:n,reject:a})})}catch(n){console.error(n)}},selectAccount(e,t){const n=Popup.show(x);nsHttpClient.get("/api/transactions-accounts").subscribe({next:async a=>{n.close();try{const i=await new Promise((s,r)=>{Popup.show(_,{label:__("Choose Account"),description:__("Choose the account you want to use"),options:a.map(d=>({label:d.name,value:d.id})),resolve:s,reject:r})});e[t]=i,console.log({rule:e})}catch{}}})},deleteRule(e){if(e.id)return Popup.show(g,{title:__("Delete Rule"),message:__("Are you sure you want to delete this rule?"),onAction:t=>{t&&this.deleteRemoteRule(e)}});this.rules=this.rules.filter(t=>t!==e)},deleteRemoteRule(e){nsHttpClient.delete(`/transactions/rules/${e.id}`).then(t=>{t.status==="success"&&(this.rules=this.rules.filter(n=>n.id!==e.id))}).catch(t=>{console.error(t)})}}},w={class:"flex"},A=["onClick"],R=o("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[o("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[o("i",{class:"las la-angle-double-right"})])],-1),N=["onClick"],P={class:"flex"},T=["onClick"],D=o("div",{class:"pt-2 relative w-0 border-l border-box-edge"},[o("div",{class:"absolute rounded-full w-6 h-6 flex -ml-3 items-center justify-center border border-box-edge p-1 bg-box-background"},[o("i",{class:"las la-angle-double-right"})])],-1),j=["onClick"],H=["onClick"],S={class:"flex flex-auto justify-end"},B=["onClick"],I=o("i",{class:"las la-save"},null,-1),O=["onClick"],V=o("i",{class:"lar la-times-circle"},null,-1),F=[V],E=o("i",{class:"las la-plus"},null,-1);function G(e,t,n,a,i,s){return p(),h(b,null,[(p(!0),h(b,null,C(i.rules,(r,d)=>(p(),h("div",{key:d,class:"rounded shadow text-primary overflow-hidden bg-box-background flex mb-2"},[o("div",w,[o("div",{onClick:l=>s.setRuleAction(r,"on"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},c(s.__("On : {action}").replace("{action}",s.getActionName(r.on))),9,A),R,o("div",{onClick:l=>s.changeTransactionType(r,"action"),class:"hover:bg-numpad-hover border-r border-box-edge cursor-pointer p-2 pl-4"},c(r.action==="increase"?s.__("Increase"):s.__("Decrease")),9,N)]),o("div",P,[o("div",{onClick:l=>s.selectAccount(r,"account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2 pr-4"},c(s.getAccountName(r.account_id)),9,T),D,o("div",{onClick:l=>s.changeTransactionType(r,"do"),class:"border-r hover:bg-numpad-hover cursor-pointer border-box-edge p-2 pl-4"},c(r.do==="increase"?s.__("Increase"):s.__("Decrease")),9,j),o("div",{onClick:l=>s.selectAccount(r,"offset_account_id"),class:"hover:bg-numpad-hover cursor-pointer p-2"},c(s.getAccountName(r.offset_account_id)),9,H)]),o("div",S,[o("div",{onClick:l=>s.saveRule(r),class:"p-2 border-l-box-edge border-l hover:bg-info-secondary hover:border-info-secondary cursor-pointer text-primary"},[I,m(" "+c(s.__("Save")),1)],8,B),o("div",{onClick:l=>s.deleteRule(r),class:"p-2 border-l-box-edge border-l hover:bg-error-secondary hover:border-error-secondary cursor-pointer text-primary"},F,8,O)])]))),128)),o("div",{onClick:t[0]||(t[0]=r=>s.addNewRule()),class:"rounded bg-box-background p-2 cursor-pointer text-primary flex text-center justify-center"},[o("span",null,[E,m(" "+c(s.__("Create a new rule")),1)])])],64)}const X=y(k,[["render",G]]);export{X as default};
