import{f as O,b as S}from"./components-DEhIxHMz.js";import{c as N}from"./runtime-dom.esm-bundler-DaZ-XdMB.js";import{n as Q,b as T,N as D,d as R,c as $}from"./ns-prompt-popup-CgPenOts.js";import{n as B,a as H}from"./ns-orders-preview-popup-CfkWIKkP.js";import{n as z}from"./ns-procurement-quantity-zvFG4gxo.js";import{n as W}from"./currency-COpKd-rX.js";import{n as y,d as U,P as L,b as E,p as V,a as M,F as Y}from"./bootstrap-BvuHheHc.js";import{_ as a}from"./lang-BINodpp-.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,c as d,o as u,a as h,F as g,b as i,t as l,f,n as A,e as q,g as x,w,i as C,s as I}from"./runtime-core.esm-bundler-D4l6Snf1.js";import"./ns-avatar-BDINLW_a.js";import"./ns-avatar-image-DCGLscGw.js";import"./chart-CFvJmF2u.js";const G={name:"ns-products-convertion",props:["popup","unitQuantity","product"],data(){return{unitQuantities:[],isLoading:!1,unitPair:{from:{unit:{},unitQuantity:{},selected:!0,quantity:0,realQuantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]},to:{unit:{},unitQuantity:{},selected:!1,quantity:0,fields:[{label:a("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]}},selected:""}},mounted(){this.loadProductQuantities(),console.log(this)},methods:{__:a,async submitConvertion(){if(this.unitPair.from.quantity===0)return y.error(a("The quantity should be greater than 0"));if(Math.floor(this.unitPair.to.quantity)===0)return y.error(a(`The provided quantity can't result in any convertion for unit "{destination}"`).replace("{destination}",this.unitPair.to.unit.name)).subscribe();if(this.unitPair.from.quantity!==this.unitPair.from.realQuantity)try{const e=await new Promise((t,s)=>{L.show(Q,{title:a("Conversion Warning"),message:a("Only {quantity}({source}) can be converted to {destinationCount}({destination}). Would you like to proceed ?").replace("{quantity}",this.unitPair.from.realQuantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:p=>{p?t(!0):s(!1)}})});return this.proceedConversionSubmissions()}catch{return}try{const e=await new Promise((t,s)=>{L.show(Q,{title:a("Confirm Conversion"),message:a("You're about to convert {quantity}({source}) to {destinationCount}({destination}). Would you like to proceed?").replace("{quantity}",this.unitPair.from.quantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:p=>{p?t(!0):s(!1)}})});return this.proceedConversionSubmissions()}catch{return}},proceedConversionSubmissions(){this.isLoading=!0,nsHttpClient.post(`/api/products/${this.unitQuantity.product_id}/units/conversion`,{from:this.unitPair.from.unit.id,to:this.unitPair.to.unit.id,quantity:this.unitPair.from.realQuantity}).subscribe({next:e=>(this.isLoading=!1,this.popup.close(),this.popup.params.resolve(e),U.success(a("Conversion Successful"),a("The product {product} has been converted successfully.").replace("{product}",this.product.name))),error:e=>(this.isLoading=!1,this.popup.params.reject(e),U.error(a("An error occured"),e.message||a("An error occured while converting the product {product}").replace("{product}",this.product.name)))})},handlePairUnitUpdated(e){const t=this.selectedUnitPair();t.unitQuantity=this.unitQuantities.filter(p=>p.unit.id===e.value)[0],t.unit=t.unitQuantity.unit,t.fields[0].value=e.value;const s=t===this.unitPair.from?this.unitPair.to:this.unitPair.from;s.unit.id===t.unit.id&&(s.unitQuantity=this.unitQuantities.filter(p=>p.unit.id!==t.unit.id)[0],s.unit=s.unitQuantity.unit,s.fields[0].value=s.unit.id),this.updateFromPairQuantity(this.unitPair.from.quantity)},updateFromPairQuantity(e){e.length===0&&(e=0),e>this.unitPair.from.unitQuantity.quantity&&(e=this.unitPair.from.unitQuantity.quantity,y.info(a("The quantity has been set to the maximum available"))),this.unitPair.from.quantity=parseFloat(e);const t=this.unitQuantities.filter(o=>o.unit.base_unit)[0];if(t.length===0)return U.error(a("An error occured"),a("The product {product} has no base unit").replace("{product}",this.product.name));const p=this.unitPair.from.quantity*this.unitPair.from.unit.value*t.unit.value/this.unitPair.to.unit.value;this.unitPair.from.unit.value<this.unitPair.to.unit.value?this.unitPair.from.realQuantity=Math.floor(p)*this.unitPair.to.unit.value:this.unitPair.from.realQuantity=this.unitPair.from.quantity,this.unitPair.to.quantity=p},switchPair(){const e=this.unitPair.from.unit,t=this.unitPair.to.unit;this.unitPair.from.unit=t,this.unitPair.from.unitQuantity=this.unitQuantities.filter(s=>s.unit.id===t.id)[0],this.unitPair.from.quantity=Math.floor(this.unitPair.to.quantity),this.unitPair.to.unit=e,this.unitPair.to.unitQuantity=this.unitQuantities.filter(s=>s.unit.id===e.id)[0],this.updateFromPairQuantity(this.unitPair.from.quantity)},selectedUnitPair(){return this.unitPair[this.unitPair.from.selected?"from":"to"]},setVisible(e,t){const s=t==="from"?"to":"from";e[t].selected=!0,e[s].selected=!1},loadProductQuantities(){nsHttpClient.get("/api/products/"+this.unitQuantity.product_id+"/units/quantities").subscribe({next:e=>{this.unitQuantities=e,this.unitPair.from.unit=this.unitQuantity.unit,this.unitPair.from.unitQuantity=this.unitQuantity,this.unitPair.from.fields[0].value=this.unitQuantity.unit.id,this.unitPair.from.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id})),this.unitPair.to.unit=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0].unit,this.unitPair.to.unitQuantity=e.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0],this.unitPair.to.fields[0].value=this.unitPair.to.unit.id,this.unitPair.to.fields[0].options=e.map(t=>({label:t.unit.name,value:t.unit.id}))}})}}},J={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},K={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},X={class:"relative"},Z={class:"border-b border-box-edge"},tt={class:"flex"},et={class:"font-bold text-3xl"},it={class:"border-r border-box-edge relative"},nt={class:"font-bold text-3xl"},st={class:"p-2 border-b border-box-edge"},ot={class:""},rt={key:0,class:"top-0 left-0 absolute h-full w-full flex items-center justify-center",style:{background:"rgb(121 121 121 / 20%)"}},ut={key:1,class:"flex items-center h-full justify-center"};function at(e,t,s,p,o,n){const _=c("ns-close-button"),v=c("ns-field"),b=c("ns-numpad"),m=c("ns-spinner");return u(),d("div",J,[o.unitQuantities.length>0?(u(),d(g,{key:0},[i("div",K,[i("div",null,l(n.__("Unit Conversion : {product}").replace("{product}",s.product.name)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>s.popup.close())})])]),i("div",X,[i("div",Z,[i("div",tt,[i("div",{class:A(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.from.selected?"bg-info-primary text-white":""]),onClick:t[1]||(t[1]=r=>n.setVisible(o.unitPair,"from"))},[i("span",null,l(o.unitPair.from.unit.name),1),i("h3",et,l(o.unitPair.from.quantity),1)],2),i("div",it,[i("div",{class:"rounded-full h-12 w-12 flex items-center justify-center absolute shadow bg-input-button p-2",onClick:t[2]||(t[2]=r=>n.switchPair()),style:{position:"absolute",left:"-22px",top:"14px"}},t[8]||(t[8]=[i("i",{class:"las la-exchange-alt text-3xl"},null,-1)]))]),i("div",{class:A(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.to.selected?"bg-info-primary text-white":""]),onClick:t[3]||(t[3]=r=>n.setVisible(o.unitPair,"to"))},[i("span",null,l(o.unitPair.to.unit.name),1),i("h3",nt,l(Math.floor(o.unitPair.to.quantity)),1)],2)])]),i("div",st,[(u(!0),d(g,null,q(n.selectedUnitPair().fields,r=>(u(),x(v,{onChange:t[4]||(t[4]=P=>n.handlePairUnitUpdated(P)),field:r},null,8,["field"]))),256))]),i("div",ot,[f(b,{onNext:t[6]||(t[6]=r=>n.submitConvertion()),value:o.unitPair.from.quantity,onChanged:t[7]||(t[7]=r=>n.updateFromPairQuantity(r))},{"numpad-footer":w(()=>[i("div",{onClick:t[5]||(t[5]=r=>n.updateFromPairQuantity(o.unitPair.from.unitQuantity.quantity)),class:"w-full ns-numpad-key h-24 font-bold flex items-center justify-center cursor-pointer col-span-3"},l(n.__("Convert {quantity} available").replace("{quantity}",o.unitPair.from.unitQuantity.quantity)),1)]),_:1},8,["value"])]),o.isLoading?(u(),d("div",rt,[f(m,{size:"24"})])):h("",!0)])],64)):h("",!0),o.unitQuantities.length===0?(u(),d("div",ut,[f(m)])):h("",!0)])}const lt=k(G,[["render",at]]),dt={name:"ns-products-preview",props:["popup","product"],computed:{product(){return this.popup.params.product}},methods:{__:a,nsCurrency:W,changeActiveTab(e){this.active=e,this.active==="units-quantities"&&this.loadProductQuantities()},loadProductQuantities(){console.log("is loadinfg"),this.hasLoadedUnitQuantities=!1,E.get(`/api/products/${this.product.id}/units/quantities`).subscribe({next:e=>{this.unitQuantities=e,this.hasLoadedUnitQuantities=!0}})},async convert(e,t){try{const s=await new Promise((p,o)=>{Popup.show(lt,{unitQuantity:e,product:t,resolve:p,reject:o})});this.loadProductQuantities()}catch(s){console.log({exception:s})}}},data(){return{active:"units-quantities",unitQuantities:[],hasLoadedUnitQuantities:!1}},mounted(){this.loadProductQuantities()}},ct={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},pt={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},ft={class:"flex-auto overflow-y-auto ns-box-body"},ht={class:"p-2"},mt={key:0,class:"table ns-table w-full"},_t={class:"p-1 border"},vt={width:"150",class:"text-right p-1 border"},bt={width:"150",class:"text-right p-1 border"},yt={width:"150",class:"text-right p-1 border"},Pt={class:"p-1 border text-left"},gt=["onClick"],wt={class:"p-1 border text-right"},xt={class:"p-1 border text-right"},Ct={class:"p-1 border text-right"};function Qt(e,t,s,p,o,n){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-tabs-item"),m=c("ns-tabs");return u(),d("div",ct,[i("div",pt,[i("div",null,l(n.__("Previewing :"))+" "+l(n.product.name),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>s.popup.close())})])]),i("div",ft,[i("div",ht,[f(m,{active:o.active,onActive:t[1]||(t[1]=r=>n.changeActiveTab(r))},{default:w(()=>[f(b,{label:n.__("Units & Quantities"),identifier:"units-quantities"},{default:w(()=>[o.hasLoadedUnitQuantities?(u(),d("table",mt,[i("thead",null,[i("tr",null,[i("th",_t,l(n.__("Unit")),1),i("th",vt,l(n.__("Sale Price")),1),i("th",bt,l(n.__("Wholesale Price")),1),i("th",yt,l(n.__("Quantity")),1)])]),i("tbody",null,[(u(!0),d(g,null,q(o.unitQuantities,r=>(u(),d("tr",{key:r.id},[i("td",Pt,[C(l(r.unit.name)+" ",1),n.product.rawType==="materialized"&&n.product.rawStockManagement==="enabled"?(u(),d(g,{key:0},[t[2]||(t[2]=C(" — ")),i("a",{onClick:P=>n.convert(r,n.product),class:"text-sm text-info-secondary hover:underline border-dashed",href:"javascript:void(0)"},l(n.__("Convert")),9,gt)],64)):h("",!0)]),i("td",wt,l(n.nsCurrency(r.sale_price)),1),i("td",xt,l(n.nsCurrency(r.wholesale_price)),1),i("td",Ct,l(r.quantity),1)]))),128))])])):h("",!0),o.hasLoadedUnitQuantities?h("",!0):(u(),x(v,{key:1,size:"16",border:"4"}))]),_:1},8,["label"])]),_:1},8,["active"])])])])}const kt=k(dt,[["render",Qt]]),qt={name:"ns-drivers-status-popup",props:["popup","row","component"],methods:{__:a,popupCloser:M,popupResolver:V,loadDriverStatusFields(){nsHttpClient.get("/api/fields/driver-status-fields").subscribe({next:e=>{this.loaded=!0,this.fields=this.validation.createFields(e)},error:e=>{this.loaded=!0,y.error(e.message),this.errorMessage=e.message}})},changeStatus(){this.validation.validateFields(this.fields)?Popup.show(Q,{title:a("Confirm Your Action"),message:a("Are you sure you want to change the status of the driver?"),onAction:e=>{nsHttpClient.post(`/api/drivers/${this.row.id}/status`,this.validation.extractFields(this.fields)).subscribe({next:t=>{y.success(t.message),this.popupResolver(!0),this.component.$emit("reload")},error:t=>y.error(t.message)})}}):y.error(a("Make sure to choose a status for the driver."))}},data(){return{loaded:!1,validation:new Y,fields:[],errorMessage:""}},mounted(){console.log(this.row),this.popupCloser(),this.loadDriverStatusFields()}},Ut={class:"shadow ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw]"},jt={class:"p-2 flex justify-between items-center ns-box-header border-b"},St={class:"ns-box-body"},Lt={key:0,class:"py-4 flex justify-center items-center"},At={key:2,class:"p-2"},Ft={class:"border-t ns-box-footer p-2 flex justify-end"};function Vt(e,t,s,p,o,n){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-notice"),m=c("ns-field"),r=c("ns-button");return u(),d("div",Ut,[i("div",jt,[i("h3",null,l(n.__("Driver: {name}").replace("{name}",s.row.username)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=P=>n.popupResolver(!1))})])]),i("div",St,[o.loaded?h("",!0):(u(),d("div",Lt,[f(v)])),o.errorMessage?(u(),x(b,{key:1,color:"error"},{description:w(()=>[C(l(o.errorMessage),1)]),_:1})):(u(),d("div",At,[(u(!0),d(g,null,q(o.fields,P=>(u(),x(m,{field:P},null,8,["field"]))),256))]))]),i("div",Ft,[f(r,{onClick:t[1]||(t[1]=P=>n.changeStatus())},{default:w(()=>[C(l(n.__("Change Status")),1)]),_:1})])])}const Mt=k(qt,[["render",Vt]]),Ot={name:"foo-bar",methods:{__:a,popupResolver:V,popupCloser:M},mounted(){console.log(this.order)},props:["order"]},Nt={class:"ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw] shadow"},Tt={class:"p-2 flex justify-between items-center ns-box-header border-b"},Dt={class:"box-body"},Rt={key:0,class:"py-4 flex justify-center items-center"},$t={key:1,class:"p-2"},Bt={class:"border-t ns-box-footer p-2 flex justify-end"};function Ht(e,t,s,p,o,n){const _=c("ns-close-button"),v=c("ns-spinner"),b=c("ns-field"),m=c("ns-button");return u(),d("div",Nt,[i("div",Tt,[i("h3",null,l(n.__("Order: {name}").replace("{name}",s.order.code)),1),i("div",null,[f(_,{onClick:t[0]||(t[0]=r=>n.popupResolver(!1))})])]),i("div",Dt,[e.loaded?h("",!0):(u(),d("div",Rt,[f(v)])),e.fields.length>0?(u(),d("div",$t,[(u(!0),d(g,null,q(e.fields,r=>(u(),x(b,{field:r},null,8,["field"]))),256))])):h("",!0)]),i("div",Bt,[f(m,{onClick:t[1]||(t[1]=r=>e.changeStatus())},{default:w(()=>[C(l(n.__("Change Status")),1)]),_:1})])])}const zt=k(Ot,[["render",Ht]]),F={nsOrderPreview:H,nsProductPreview:kt,nsAlertPopup:$,nsConfirmPopup:Q,nsPromptPopup:R,nsMediaPopup:O,nsProcurementQuantity:z,nsOrdersRefund:B,nsSelectPopup:D,nsPOSLoadingPopup:T,nsDriversStatusPopup:Mt,NsDriversOrdersPopup:zt};for(let e in F)window[e]=F[e];const j=N({data(){return{popups:[],defaultClass:"absolute top-0 left-0 w-full h-full items-center flex overflow-y-auto justify-center is-popup"}},mounted(){nsState.subscribe(e=>{e.popups!==void 0&&(document.body.focus(),this.popups=I(e.popups),this.$forceUpdate())})},methods:{closePopup(e,t){(Object.values(t.target.classList).includes("is-popup")&&e.config!==void 0&&[void 0,!0].includes(e.config.closeOnOverlayClick)||Object.keys(e.config).length===0)&&(e.params&&typeof e.params.reject=="function"?(e.params.reject(!1),typeof e.close=="function"&&e.close(),t.stopPropagation()):e.close())},preventPropagation(e){e.stopImmediatePropagation()}}});for(let e in S)j.component(e,S[e]);document.addEventListener("DOMContentLoaded",()=>{j.mount("#dashboard-popups"),window.nsPopups=j});
